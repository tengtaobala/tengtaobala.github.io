(function(){var e=this,t=e._,i={},n=Array.prototype,a=Object.prototype,r=Function.prototype,o=n.push,s=n.slice,l=n.concat,c=a.toString,d=a.hasOwnProperty,h=n.forEach,u=n.map,p=n.reduce,v=n.reduceRight,g=n.filter,f=n.every,m=n.some,_=n.indexOf,w=n.lastIndexOf,y=Array.isArray,b=Object.keys,x=r.bind,S=function(e){return e instanceof S?e:this instanceof S?void(this._wrapped=e):new S(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=S),exports._=S):e._=S,S.VERSION="1.4.4";var T=S.each=S.forEach=function(e,t,n){if(null!=e)if(h&&e.forEach===h)e.forEach(t,n);else if(e.length===+e.length){for(var a=0,r=e.length;r>a;a++)if(t.call(n,e[a],a,e)===i)return}else for(var o in e)if(S.has(e,o)&&t.call(n,e[o],o,e)===i)return};S.map=S.collect=function(e,t,i){var n=[];return null==e?n:u&&e.map===u?e.map(t,i):(T(e,function(e,a,r){n[n.length]=t.call(i,e,a,r)}),n)};var k="Reduce of empty array with no initial value";S.reduce=S.foldl=S.inject=function(e,t,i,n){var a=arguments.length>2;if(null==e&&(e=[]),p&&e.reduce===p)return n&&(t=S.bind(t,n)),a?e.reduce(t,i):e.reduce(t);if(T(e,function(e,r,o){a?i=t.call(n,i,e,r,o):(i=e,a=!0)}),!a)throw new TypeError(k);return i},S.reduceRight=S.foldr=function(e,t,i,n){var a=arguments.length>2;if(null==e&&(e=[]),v&&e.reduceRight===v)return n&&(t=S.bind(t,n)),a?e.reduceRight(t,i):e.reduceRight(t);var r=e.length;if(r!==+r){var o=S.keys(e);r=o.length}if(T(e,function(s,l,c){l=o?o[--r]:--r,a?i=t.call(n,i,e[l],l,c):(i=e[l],a=!0)}),!a)throw new TypeError(k);return i},S.find=S.detect=function(e,t,i){var n;return C(e,function(e,a,r){return t.call(i,e,a,r)?(n=e,!0):void 0}),n},S.filter=S.select=function(e,t,i){var n=[];return null==e?n:g&&e.filter===g?e.filter(t,i):(T(e,function(e,a,r){t.call(i,e,a,r)&&(n[n.length]=e)}),n)},S.reject=function(e,t,i){return S.filter(e,function(e,n,a){return!t.call(i,e,n,a)},i)},S.every=S.all=function(e,t,n){t||(t=S.identity);var a=!0;return null==e?a:f&&e.every===f?e.every(t,n):(T(e,function(e,r,o){return(a=a&&t.call(n,e,r,o))?void 0:i}),!!a)};var C=S.some=S.any=function(e,t,n){t||(t=S.identity);var a=!1;return null==e?a:m&&e.some===m?e.some(t,n):(T(e,function(e,r,o){return a||(a=t.call(n,e,r,o))?i:void 0}),!!a)};S.contains=S.include=function(e,t){return null==e?!1:_&&e.indexOf===_?-1!=e.indexOf(t):C(e,function(e){return e===t})},S.invoke=function(e,t){var i=s.call(arguments,2),n=S.isFunction(t);return S.map(e,function(e){return(n?t:e[t]).apply(e,i)})},S.pluck=function(e,t){return S.map(e,function(e){return e[t]})},S.where=function(e,t,i){return S.isEmpty(t)?i?null:[]:S[i?"find":"filter"](e,function(e){for(var i in t)if(t[i]!==e[i])return!1;return!0})},S.findWhere=function(e,t){return S.where(e,t,!0)},S.max=function(e,t,i){if(!t&&S.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);if(!t&&S.isEmpty(e))return-1/0;var n={computed:-1/0,value:-1/0};return T(e,function(e,a,r){var o=t?t.call(i,e,a,r):e;o>=n.computed&&(n={value:e,computed:o})}),n.value},S.min=function(e,t,i){if(!t&&S.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);if(!t&&S.isEmpty(e))return 1/0;var n={computed:1/0,value:1/0};return T(e,function(e,a,r){var o=t?t.call(i,e,a,r):e;o<n.computed&&(n={value:e,computed:o})}),n.value},S.shuffle=function(e){var t,i=0,n=[];return T(e,function(e){t=S.random(i++),n[i-1]=n[t],n[t]=e}),n};var P=function(e){return S.isFunction(e)?e:function(t){return t[e]}};S.sortBy=function(e,t,i){var n=P(t);return S.pluck(S.map(e,function(e,t,a){return{value:e,index:t,criteria:n.call(i,e,t,a)}}).sort(function(e,t){var i=e.criteria,n=t.criteria;if(i!==n){if(i>n||void 0===i)return 1;if(n>i||void 0===n)return-1}return e.index<t.index?-1:1}),"value")};var D=function(e,t,i,n){var a={},r=P(t||S.identity);return T(e,function(t,o){var s=r.call(i,t,o,e);n(a,s,t)}),a};S.groupBy=function(e,t,i){return D(e,t,i,function(e,t,i){(S.has(e,t)?e[t]:e[t]=[]).push(i)})},S.countBy=function(e,t,i){return D(e,t,i,function(e,t){S.has(e,t)||(e[t]=0),e[t]++})},S.sortedIndex=function(e,t,i,n){i=null==i?S.identity:P(i);for(var a=i.call(n,t),r=0,o=e.length;o>r;){var s=r+o>>>1;i.call(n,e[s])<a?r=s+1:o=s}return r},S.toArray=function(e){return e?S.isArray(e)?s.call(e):e.length===+e.length?S.map(e,S.identity):S.values(e):[]},S.size=function(e){return null==e?0:e.length===+e.length?e.length:S.keys(e).length},S.first=S.head=S.take=function(e,t,i){return null==e?void 0:null==t||i?e[0]:s.call(e,0,t)},S.initial=function(e,t,i){return s.call(e,0,e.length-(null==t||i?1:t))},S.last=function(e,t,i){return null==e?void 0:null==t||i?e[e.length-1]:s.call(e,Math.max(e.length-t,0))},S.rest=S.tail=S.drop=function(e,t,i){return s.call(e,null==t||i?1:t)},S.compact=function(e){return S.filter(e,S.identity)};var $=function(e,t,i){return T(e,function(e){S.isArray(e)?t?o.apply(i,e):$(e,t,i):i.push(e)}),i};S.flatten=function(e,t){return $(e,t,[])},S.without=function(e){return S.difference(e,s.call(arguments,1))},S.uniq=S.unique=function(e,t,i,n){S.isFunction(t)&&(n=i,i=t,t=!1);var a=i?S.map(e,i,n):e,r=[],o=[];return T(a,function(i,n){(t?n&&o[o.length-1]===i:S.contains(o,i))||(o.push(i),r.push(e[n]))}),r},S.union=function(){return S.uniq(l.apply(n,arguments))},S.intersection=function(e){var t=s.call(arguments,1);return S.filter(S.uniq(e),function(e){return S.every(t,function(t){return S.indexOf(t,e)>=0})})},S.difference=function(e){var t=l.apply(n,s.call(arguments,1));return S.filter(e,function(e){return!S.contains(t,e)})},S.zip=function(){for(var e=s.call(arguments),t=S.max(S.pluck(e,"length")),i=new Array(t),n=0;t>n;n++)i[n]=S.pluck(e,""+n);return i},S.object=function(e,t){if(null==e)return{};for(var i={},n=0,a=e.length;a>n;n++)t?i[e[n]]=t[n]:i[e[n][0]]=e[n][1];return i},S.indexOf=function(e,t,i){if(null==e)return-1;var n=0,a=e.length;if(i){if("number"!=typeof i)return n=S.sortedIndex(e,t),e[n]===t?n:-1;n=0>i?Math.max(0,a+i):i}if(_&&e.indexOf===_)return e.indexOf(t,i);for(;a>n;n++)if(e[n]===t)return n;return-1},S.lastIndexOf=function(e,t,i){if(null==e)return-1;var n=null!=i;if(w&&e.lastIndexOf===w)return n?e.lastIndexOf(t,i):e.lastIndexOf(t);for(var a=n?i:e.length;a--;)if(e[a]===t)return a;return-1},S.range=function(e,t,i){arguments.length<=1&&(t=e||0,e=0),i=arguments[2]||1;for(var n=Math.max(Math.ceil((t-e)/i),0),a=0,r=new Array(n);n>a;)r[a++]=e,e+=i;return r},S.bind=function(e,t){if(e.bind===x&&x)return x.apply(e,s.call(arguments,1));var i=s.call(arguments,2);return function(){return e.apply(t,i.concat(s.call(arguments)))}},S.partial=function(e){var t=s.call(arguments,1);return function(){return e.apply(this,t.concat(s.call(arguments)))}},S.bindAll=function(e){var t=s.call(arguments,1);return 0===t.length&&(t=S.functions(e)),T(t,function(t){e[t]=S.bind(e[t],e)}),e},S.memoize=function(e,t){var i={};return t||(t=S.identity),function(){var n=t.apply(this,arguments);return S.has(i,n)?i[n]:i[n]=e.apply(this,arguments)}},S.delay=function(e,t){var i=s.call(arguments,2);return setTimeout(function(){return e.apply(null,i)},t)},S.defer=function(e){return S.delay.apply(S,[e,1].concat(s.call(arguments,1)))},S.throttle=function(e,t){var i,n,a,r,o=0,s=function(){o=new Date,a=null,r=e.apply(i,n)};return function(){var l=new Date,c=t-(l-o);return i=this,n=arguments,0>=c?(clearTimeout(a),a=null,o=l,r=e.apply(i,n)):a||(a=setTimeout(s,c)),r}},S.debounce=function(e,t,i){var n,a;return function(){var r=this,o=arguments,s=function(){n=null,i||(a=e.apply(r,o))},l=i&&!n;return clearTimeout(n),n=setTimeout(s,t),l&&(a=e.apply(r,o)),a}},S.once=function(e){var t,i=!1;return function(){return i?t:(i=!0,t=e.apply(this,arguments),e=null,t)}},S.wrap=function(e,t){return function(){var i=[e];return o.apply(i,arguments),t.apply(this,i)}},S.compose=function(){var e=arguments;return function(){for(var t=arguments,i=e.length-1;i>=0;i--)t=[e[i].apply(this,t)];return t[0]}},S.after=function(e,t){return 0>=e?t():function(){return--e<1?t.apply(this,arguments):void 0}},S.keys=b||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var i in e)S.has(e,i)&&(t[t.length]=i);return t},S.values=function(e){var t=[];for(var i in e)S.has(e,i)&&t.push(e[i]);return t},S.pairs=function(e){var t=[];for(var i in e)S.has(e,i)&&t.push([i,e[i]]);return t},S.invert=function(e){var t={};for(var i in e)S.has(e,i)&&(t[e[i]]=i);return t},S.functions=S.methods=function(e){var t=[];for(var i in e)S.isFunction(e[i])&&t.push(i);return t.sort()},S.extend=function(e){return T(s.call(arguments,1),function(t){if(t)for(var i in t)e[i]=t[i]}),e},S.pick=function(e){var t={},i=l.apply(n,s.call(arguments,1));return T(i,function(i){i in e&&(t[i]=e[i])}),t},S.omit=function(e){var t={},i=l.apply(n,s.call(arguments,1));for(var a in e)S.contains(i,a)||(t[a]=e[a]);return t},S.defaults=function(e){return T(s.call(arguments,1),function(t){if(t)for(var i in t)null==e[i]&&(e[i]=t[i])}),e},S.clone=function(e){return S.isObject(e)?S.isArray(e)?e.slice():S.extend({},e):e},S.tap=function(e,t){return t(e),e};var E=function(e,t,i,n){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return e===t;e instanceof S&&(e=e._wrapped),t instanceof S&&(t=t._wrapped);var a=c.call(e);if(a!=c.call(t))return!1;switch(a){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if("object"!=typeof e||"object"!=typeof t)return!1;for(var r=i.length;r--;)if(i[r]==e)return n[r]==t;i.push(e),n.push(t);var o=0,s=!0;if("[object Array]"==a){if(o=e.length,s=o==t.length)for(;o--&&(s=E(e[o],t[o],i,n)););}else{var l=e.constructor,d=t.constructor;if(l!==d&&!(S.isFunction(l)&&l instanceof l&&S.isFunction(d)&&d instanceof d))return!1;for(var h in e)if(S.has(e,h)&&(o++,!(s=S.has(t,h)&&E(e[h],t[h],i,n))))break;if(s){for(h in t)if(S.has(t,h)&&!o--)break;s=!o}}return i.pop(),n.pop(),s};S.isEqual=function(e,t){return E(e,t,[],[])},S.isEmpty=function(e){if(null==e)return!0;if(S.isArray(e)||S.isString(e))return 0===e.length;for(var t in e)if(S.has(e,t))return!1;return!0},S.isElement=function(e){return!(!e||1!==e.nodeType)},S.isArray=y||function(e){return"[object Array]"==c.call(e)},S.isObject=function(e){return e===Object(e)},T(["Arguments","Function","String","Number","Date","RegExp"],function(e){S["is"+e]=function(t){return c.call(t)=="[object "+e+"]"}}),S.isArguments(arguments)||(S.isArguments=function(e){return!(!e||!S.has(e,"callee"))}),"function"!=typeof/./&&(S.isFunction=function(e){return"function"==typeof e}),S.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},S.isNaN=function(e){return S.isNumber(e)&&e!=+e},S.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"==c.call(e)},S.isNull=function(e){return null===e},S.isUndefined=function(e){return void 0===e},S.has=function(e,t){return d.call(e,t)},S.noConflict=function(){return e._=t,this},S.identity=function(e){return e},S.times=function(e,t,i){for(var n=Array(e),a=0;e>a;a++)n[a]=t.call(i,a);return n},S.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))};var O={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};O.unescape=S.invert(O.escape);var I={escape:new RegExp("["+S.keys(O.escape).join("")+"]","g"),unescape:new RegExp("("+S.keys(O.unescape).join("|")+")","g")};S.each(["escape","unescape"],function(e){S[e]=function(t){return null==t?"":(""+t).replace(I[e],function(t){return O[e][t]})}}),S.result=function(e,t){if(null==e)return null;var i=e[t];return S.isFunction(i)?i.call(e):i},S.mixin=function(e){T(S.functions(e),function(t){var i=S[t]=e[t];S.prototype[t]=function(){var e=[this._wrapped];return o.apply(e,arguments),z.call(this,i.apply(S,e))}})};var A=0;S.uniqueId=function(e){var t=++A+"";return e?e+t:t},S.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var N=/(.)^/,R={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},M=/\\|'|\r|\n|\t|\u2028|\u2029/g;S.template=function(e,t,i){if(S.isFunction(e))return t?e(t):e;var n;i=S.defaults({},i,S.templateSettings);var a=new RegExp([(i.escape||N).source,(i.interpolate||N).source,(i.evaluate||N).source].join("|")+"|$","g"),r=0,o="__p+='",s=e;e.replace(a,function(t,i,n,a,s){return o+=e.slice(r,s).replace(M,function(e){return"\\"+R[e]}),i&&(o+="'+\n((__t=("+i+"))==null?'':_.escape(__t))+\n'"),n&&(o+="'+\n((__t=("+n+"))==null?'':__t)+\n'"),a&&(o+="';\n"+a+"\n__p+='"),r=s+t.length,t}),o+="';\n",i.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{n=new Function(i.variable||"obj","_",o)}catch(l){throw l.source=o,l}if(t)return n(t,S);var c=function(e){return n.call(this,e,S)};return c.source="function("+(i.variable||"obj")+"){\n"+o+"}",c.textsource=s,c},S.chain=function(e){return S(e).chain()};var z=function(e){return this._chain?S(e).chain():e};S.mixin(S),T(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=n[e];S.prototype[e]=function(){var i=this._wrapped;return t.apply(i,arguments),"shift"!=e&&"splice"!=e||0!==i.length||delete i[0],z.call(this,i)}}),T(["concat","join","slice"],function(e){var t=n[e];S.prototype[e]=function(){return z.call(this,t.apply(this._wrapped,arguments))}}),S.extend(S.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(this),define("underscore",function(e){return function(){var t;return t||e._}}(this)),function(){var e,t=this,i=t.Backbone,n=[],a=n.push,r=n.slice,o=n.splice;e="undefined"!=typeof exports?exports:t.Backbone={},e.VERSION="0.9.10";var s=t._;!s&&"undefined"!=typeof require&&(s=require("underscore")),e.$=t.jQuery||t.Zepto||t.ender,e.noConflict=function(){return t.Backbone=i,this},e.emulateHTTP=!1,e.emulateJSON=!1;var l=/\s+/,c=function(e,t,i,n){if(!i)return!0;if("object"==typeof i)for(var a in i)e[t].apply(e,[a,i[a]].concat(n));else{if(!l.test(i))return!0;i=i.split(l),a=0;for(var r=i.length;r>a;a++)e[t].apply(e,[i[a]].concat(n))}},d=function(e,t){var i,n=-1,a=e.length;switch(t.length){case 0:for(;++n<a;)(i=e[n]).callback.call(i.ctx);break;case 1:for(;++n<a;)(i=e[n]).callback.call(i.ctx,t[0]);break;case 2:for(;++n<a;)(i=e[n]).callback.call(i.ctx,t[0],t[1]);break;case 3:for(;++n<a;)(i=e[n]).callback.call(i.ctx,t[0],t[1],t[2]);break;default:for(;++n<a;)(i=e[n]).callback.apply(i.ctx,t)}},n=e.Events={on:function(e,t,i){return c(this,"on",e,[t,i])&&t?(this._events||(this._events={}),(this._events[e]||(this._events[e]=[])).push({callback:t,context:i,ctx:i||this}),this):this},once:function(e,t,i){if(!c(this,"once",e,[t,i])||!t)return this;var n=this,a=s.once(function(){n.off(e,a),t.apply(this,arguments)});return a._callback=t,this.on(e,a,i),this},off:function(e,t,i){var n,a,r,o,l,d,h,u;if(!this._events||!c(this,"off",e,[t,i]))return this;if(!e&&!t&&!i)return this._events={},this;for(o=e?[e]:s.keys(this._events),l=0,d=o.length;d>l;l++)if(e=o[l],n=this._events[e]){if(r=[],t||i)for(h=0,u=n.length;u>h;h++)a=n[h],(t&&t!==a.callback&&t!==a.callback._callback||i&&i!==a.context)&&r.push(a);this._events[e]=r}return this},trigger:function(e){if(!this._events)return this;var t=r.call(arguments,1);if(!c(this,"trigger",e,t))return this;var i=this._events[e],n=this._events.all;return i&&d(i,t),n&&d(n,arguments),this},listenTo:function(e,t,i){var n=this._listeners||(this._listeners={}),a=e._listenerId||(e._listenerId=s.uniqueId("l"));return n[a]=e,e.on(t,"object"==typeof t?this:i,this),this},stopListening:function(e,t,i){var n=this._listeners;if(n){if(e)e.off(t,"object"==typeof t?this:i,this),!t&&!i&&delete n[e._listenerId];else{"object"==typeof t&&(i=this);for(var a in n)n[a].off(t,i,this);this._listeners={}}return this}}};n.bind=n.on,n.unbind=n.off,s.extend(e,n);var h=e.Model=function(e,t){var i,n=e||{};this.cid=s.uniqueId("c"),this.attributes={},t&&t.collection&&(this.collection=t.collection),t&&t.parse&&(n=this.parse(n,t)||{}),(i=s.result(this,"defaults"))&&(n=s.defaults({},n,i)),this.set(n,t),this.changed={},this.initialize.apply(this,arguments)};s.extend(h.prototype,n,{changed:null,idAttribute:"id",initialize:function(){},toJSON:function(){return s.clone(this.attributes)},sync:function(){return e.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return s.escape(this.get(e))},has:function(e){return null!=this.get(e)},set:function(e,t,i){var n,a,r,o,l,c,d;if(null==e)return this;if("object"==typeof e?(a=e,i=t):(a={})[e]=t,i||(i={}),!this._validate(a,i))return!1;r=i.unset,o=i.silent,e=[],l=this._changing,this._changing=!0,l||(this._previousAttributes=s.clone(this.attributes),this.changed={}),d=this.attributes,c=this._previousAttributes,this.idAttribute in a&&(this.id=a[this.idAttribute]);for(n in a)t=a[n],s.isEqual(d[n],t)||e.push(n),s.isEqual(c[n],t)?delete this.changed[n]:this.changed[n]=t,r?delete d[n]:d[n]=t;if(!o)for(e.length&&(this._pending=!0),t=0,n=e.length;n>t;t++)this.trigger("change:"+e[t],this,d[e[t]],i);if(l)return this;if(!o)for(;this._pending;)this._pending=!1,this.trigger("change",this,i);return this._changing=this._pending=!1,this},unset:function(e,t){return this.set(e,void 0,s.extend({},t,{unset:!0}))},clear:function(e){var t,i={};for(t in this.attributes)i[t]=void 0;return this.set(i,s.extend({},e,{unset:!0}))},hasChanged:function(e){return null==e?!s.isEmpty(this.changed):s.has(this.changed,e)},changedAttributes:function(e){if(!e)return this.hasChanged()?s.clone(this.changed):!1;var t,i,n=!1,a=this._changing?this._previousAttributes:this.attributes;for(i in e)s.isEqual(a[i],t=e[i])||((n||(n={}))[i]=t);return n},previous:function(e){return null!=e&&this._previousAttributes?this._previousAttributes[e]:null},previousAttributes:function(){return s.clone(this._previousAttributes)},fetch:function(e){e=e?s.clone(e):{},void 0===e.parse&&(e.parse=!0);var t=e.success;return e.success=function(e,i,n){return e.set(e.parse(i,n),n)?void(t&&t(e,i,n)):!1},this.sync("read",this,e)},save:function(e,t,i){var n,a,r=this.attributes;return null==e||"object"==typeof e?(n=e,i=t):(n={})[e]=t,!n||i&&i.wait||this.set(n,i)?(i=s.extend({validate:!0},i),this._validate(n,i)?(n&&i.wait&&(this.attributes=s.extend({},r,n)),void 0===i.parse&&(i.parse=!0),a=i.success,i.success=function(e,t,i){e.attributes=r;var o=e.parse(t,i);return i.wait&&(o=s.extend(n||{},o)),s.isObject(o)&&!e.set(o,i)?!1:void(a&&a(e,t,i))},e=this.isNew()?"create":i.patch?"patch":"update","patch"===e&&(i.attrs=n),e=this.sync(e,this,i),n&&i.wait&&(this.attributes=r),e):!1):!1},destroy:function(e){e=e?s.clone(e):{};var t=this,i=e.success,n=function(){t.trigger("destroy",t,t.collection,e)};if(e.success=function(e,t,a){(a.wait||e.isNew())&&n(),i&&i(e,t,a)},this.isNew())return e.success(this,null,e),!1;var a=this.sync("delete",this,e);return e.wait||n(),a},url:function(){var e=s.result(this,"urlRoot")||s.result(this.collection,"url")||P();return this.isNew()?e:e+("/"===e.charAt(e.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(e){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},isValid:function(e){return!this.validate||!this.validate(this.attributes,e)},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=s.extend({},this.attributes,e);var i=this.validationError=this.validate(e,t)||null;return i?(this.trigger("invalid",this,i,t||{}),!1):!0}});var u=e.Collection=function(e,t){t||(t={}),t.model&&(this.model=t.model),void 0!==t.comparator&&(this.comparator=t.comparator),this.models=[],this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,s.extend({silent:!0},t))};s.extend(u.prototype,n,{model:h,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return e.sync.apply(this,arguments)},add:function(e,t){e=s.isArray(e)?e.slice():[e],t||(t={});var i,n,r,l,c,d,h,u,p,v;for(h=[],u=t.at,p=this.comparator&&null==u&&0!=t.sort,v=s.isString(this.comparator)?this.comparator:null,i=0,n=e.length;n>i;i++)(r=this._prepareModel(l=e[i],t))?(c=this.get(r))?t.merge&&(c.set(l===r?r.attributes:l,t),p&&!d&&c.hasChanged(v)&&(d=!0)):(h.push(r),r.on("all",this._onModelEvent,this),this._byId[r.cid]=r,null!=r.id&&(this._byId[r.id]=r)):this.trigger("invalid",this,l,t);if(h.length&&(p&&(d=!0),this.length+=h.length,null!=u?o.apply(this.models,[u,0].concat(h)):a.apply(this.models,h)),d&&this.sort({silent:!0}),t.silent)return this;for(i=0,n=h.length;n>i;i++)(r=h[i]).trigger("add",r,this,t);return d&&this.trigger("sort",this,t),this},remove:function(e,t){e=s.isArray(e)?e.slice():[e],t||(t={});var i,n,a,r;for(i=0,n=e.length;n>i;i++)(r=this.get(e[i]))&&(delete this._byId[r.id],delete this._byId[r.cid],a=this.indexOf(r),this.models.splice(a,1),this.length--,t.silent||(t.index=a,r.trigger("remove",r,this,t)),this._removeReference(r));return this},push:function(e,t){return e=this._prepareModel(e,t),this.add(e,s.extend({at:this.length},t)),e},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return e=this._prepareModel(e,t),this.add(e,s.extend({at:0},t)),e},shift:function(e){var t=this.at(0);return this.remove(t,e),t},slice:function(e,t){return this.models.slice(e,t)},get:function(e){return null!=e?(this._idAttr||(this._idAttr=this.model.prototype.idAttribute),this._byId[e.id||e.cid||e[this._idAttr]||e]):void 0},at:function(e){return this.models[e]},where:function(e){return s.isEmpty(e)?[]:this.filter(function(t){for(var i in e)if(e[i]!==t.get(i))return!1;return!0})},sort:function(e){if(!this.comparator)throw Error("Cannot sort a set without a comparator");return e||(e={}),s.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(s.bind(this.comparator,this)),e.silent||this.trigger("sort",this,e),this},pluck:function(e){return s.invoke(this.models,"get",e)},update:function(e,t){t=s.extend({add:!0,merge:!0,remove:!0},t),t.parse&&(e=this.parse(e,t));var i,n,a,r,o=[],l=[],c={};if(s.isArray(e)||(e=e?[e]:[]),t.add&&!t.remove)return this.add(e,t);for(n=0,a=e.length;a>n;n++)i=e[n],r=this.get(i),t.remove&&r&&(c[r.cid]=!0),(t.add&&!r||t.merge&&r)&&o.push(i);if(t.remove)for(n=0,a=this.models.length;a>n;n++)i=this.models[n],c[i.cid]||l.push(i);return l.length&&this.remove(l,t),o.length&&this.add(o,t),this},reset:function(e,t){t||(t={}),t.parse&&(e=this.parse(e,t));for(var i=0,n=this.models.length;n>i;i++)this._removeReference(this.models[i]);return t.previousModels=this.models.slice(),this._reset(),e&&this.add(e,s.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),this},fetch:function(e){e=e?s.clone(e):{},void 0===e.parse&&(e.parse=!0);var t=e.success;return e.success=function(e,i,n){e[n.update?"update":"reset"](i,n),t&&t(e,i,n)},this.sync("read",this,e)},create:function(e,t){if(t=t?s.clone(t):{},!(e=this._prepareModel(e,t)))return!1;t.wait||this.add(e,t);var i=this,n=t.success;return t.success=function(e,t,a){a.wait&&i.add(e,a),n&&n(e,t,a)},e.save(null,t),e},parse:function(e){return e},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models.length=0,this._byId={}},_prepareModel:function(e,t){if(e instanceof h)return e.collection||(e.collection=this),e;t||(t={}),t.collection=this;var i=new this.model(e,t);return i._validate(e,t)?i:!1},_removeReference:function(e){this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,i,n){("add"===e||"remove"===e)&&i!==this||("destroy"===e&&this.remove(t,n),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],null!=t.id&&(this._byId[t.id]=t)),this.trigger.apply(this,arguments))},sortedIndex:function(e,t,i){t||(t=this.comparator);var n=s.isFunction(t)?t:function(e){return e.get(t)};return s.sortedIndex(this.models,e,n,i)}}),s.each("forEach each map collect reduce foldl inject reduceRight foldr find detect filter select reject every all some any include contains invoke max min toArray size first head take initial rest tail drop last without indexOf shuffle lastIndexOf isEmpty chain".split(" "),function(e){u.prototype[e]=function(){var t=r.call(arguments);return t.unshift(this.models),s[e].apply(s,t)}}),s.each(["groupBy","countBy","sortBy"],function(e){u.prototype[e]=function(t,i){var n=s.isFunction(t)?t:function(e){return e.get(t)};return s[e](this.models,n,i)}});var p=e.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},v=/\((.*?)\)/g,g=/(\(\?)?:\w+/g,f=/\*\w+/g,m=/[\-{}\[\]+?.,\\\^$|#\s]/g;s.extend(p.prototype,n,{initialize:function(){},route:function(t,i,n){return s.isRegExp(t)||(t=this._routeToRegExp(t)),n||(n=this[i]),e.history.route(t,s.bind(function(a){a=this._extractParameters(t,a),n&&n.apply(this,a),this.trigger.apply(this,["route:"+i].concat(a)),this.trigger("route",i,a),e.history.trigger("route",this,i,a)},this)),this},navigate:function(t,i){return e.history.navigate(t,i),this},_bindRoutes:function(){if(this.routes)for(var e,t=s.keys(this.routes);null!=(e=t.pop());)this.route(e,this.routes[e])},_routeToRegExp:function(e){return e=e.replace(m,"\\$&").replace(v,"(?:$1)?").replace(g,function(e,t){return t?e:"([^/]+)"}).replace(f,"(.*?)"),RegExp("^"+e+"$")},_extractParameters:function(e,t){return e.exec(t).slice(1)}});var _=e.History=function(){this.handlers=[],s.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},w=/^[#\/]|\s+$/g,y=/^\/+|\/+$/g,b=/msie [\w.]+/,x=/\/$/;_.started=!1,s.extend(_.prototype,n,{interval:50,getHash:function(e){return(e=(e||this).location.href.match(/#(.*)$/))?e[1]:""},getFragment:function(e,t){if(null==e)if(this._hasPushState||!this._wantsHashChange||t){e=this.location.pathname;var i=this.root.replace(x,"");e.indexOf(i)||(e=e.substr(i.length))}else e=this.getHash();return e.replace(w,"")},start:function(t){if(_.started)throw Error("Backbone.history has already been started");_.started=!0,this.options=s.extend({},{root:"/"},this.options,t),this.root=this.options.root,this._wantsHashChange=!1!==this.options.hashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!(!this.options.pushState||!this.history||!this.history.pushState),t=this.getFragment();var i=document.documentMode,i=b.exec(navigator.userAgent.toLowerCase())&&(!i||7>=i);return this.root=("/"+this.root+"/").replace(y,"/"),i&&this._wantsHashChange&&(this.iframe=e.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(t)),this._hasPushState?e.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!i?e.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=t,t=this.location,i=t.pathname.replace(/[^\/]$/,"$&/")===this.root,this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!i?(this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0):(this._wantsPushState&&this._hasPushState&&i&&t.hash&&(this.fragment=this.getHash().replace(w,""),this.history.replaceState({},document.title,this.root+this.fragment+t.search)),this.options.silent?void 0:this.loadUrl())},stop:function(){e.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),_.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(){var e=this.getFragment();return e===this.fragment&&this.iframe&&(e=this.getFragment(this.getHash(this.iframe))),e===this.fragment?!1:(this.iframe&&this.navigate(e),void(this.loadUrl()||this.loadUrl(this.getHash())))},loadUrl:function(e){var t=this.fragment=this.getFragment(e);return s.any(this.handlers,function(e){return e.route.test(t)?(e.callback(t),!0):void 0})},navigate:function(e,t){if(!_.started)return!1;if(t&&!0!==t||(t={trigger:t}),e=this.getFragment(e||""),this.fragment!==e){this.fragment=e;var i=this.root+e;if(this._hasPushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,i);else{if(!this._wantsHashChange)return this.location.assign(i);this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,e,t.replace))}t.trigger&&this.loadUrl(e)}},_updateHash:function(e,t,i){i?(i=e.href.replace(/(javascript:|#).*$/,""),e.replace(i+"#"+t)):e.hash="#"+t}}),e.history=new _;var S=e.View=function(e){this.cid=s.uniqueId("view"),this._configure(e||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},T=/^(\S+)\s*(.*)$/,k="model collection el id attributes className tagName events".split(" ");s.extend(S.prototype,n,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(t,i){return this.$el&&this.undelegateEvents(),this.$el=t instanceof e.$?t:e.$(t),this.el=this.$el[0],!1!==i&&this.delegateEvents(),this},delegateEvents:function(e){if(e||(e=s.result(this,"events"))){this.undelegateEvents();for(var t in e){var i=e[t];if(s.isFunction(i)||(i=this[e[t]]),!i)throw Error('Method "'+e[t]+'" does not exist');var n=t.match(T),a=n[1],n=n[2],i=s.bind(i,this),a=a+(".delegateEvents"+this.cid);""===n?this.$el.on(a,i):this.$el.on(a,n,i)}}},undelegateEvents:function(){this.$el.off(".delegateEvents"+this.cid)},_configure:function(e){this.options&&(e=s.extend({},s.result(this,"options"),e)),s.extend(this,s.pick(e,k)),this.options=e},_ensureElement:function(){if(this.el)this.setElement(s.result(this,"el"),!1);else{var t=s.extend({},s.result(this,"attributes"));this.id&&(t.id=s.result(this,"id")),this.className&&(t["class"]=s.result(this,"className")),t=e.$("<"+s.result(this,"tagName")+">").attr(t),this.setElement(t,!1)}}});var C={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};e.sync=function(t,i,n){var a=C[t];s.defaults(n||(n={}),{emulateHTTP:e.emulateHTTP,emulateJSON:e.emulateJSON});var r={type:a,dataType:"json"};if(n.url||(r.url=s.result(i,"url")||P()),null!=n.data||!i||"create"!==t&&"update"!==t&&"patch"!==t||(r.contentType="application/json",r.data=JSON.stringify(n.attrs||i.toJSON(n))),n.emulateJSON&&(r.contentType="application/x-www-form-urlencoded",r.data=r.data?{model:r.data}:{}),n.emulateHTTP&&("PUT"===a||"DELETE"===a||"PATCH"===a)){r.type="POST",n.emulateJSON&&(r.data._method=a);var o=n.beforeSend;n.beforeSend=function(e){return e.setRequestHeader("X-HTTP-Method-Override",a),o?o.apply(this,arguments):void 0}}"GET"!==r.type&&!n.emulateJSON&&(r.processData=!1);var l=n.success;n.success=function(e){l&&l(i,e,n),i.trigger("sync",i,e,n)};var c=n.error;return n.error=function(e){c&&c(i,e,n),i.trigger("error",i,e,n)},t=n.xhr=e.ajax(s.extend(r,n)),i.trigger("request",i,t,n),t},e.ajax=function(){return e.$.ajax.apply(e.$,arguments)},h.extend=u.extend=p.extend=S.extend=_.extend=function(e,t){var i,n=this;i=e&&s.has(e,"constructor")?e.constructor:function(){return n.apply(this,arguments)},s.extend(i,n,t);var a=function(){this.constructor=i};return a.prototype=n.prototype,i.prototype=new a,e&&s.extend(i.prototype,e),i.__super__=n.prototype,i};var P=function(){throw Error('A "url" property or function must be specified')}}.call(this),define("backbone",["underscore","jquery"],function(e){return function(){var t;return t||e.Backbone}}(this)),define("text",["module"],function(e){var t,i,n,a,r=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],o=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,s=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,l="undefined"!=typeof location&&location.href,c=l&&location.protocol&&location.protocol.replace(/\:/,""),d=l&&location.hostname,h=l&&(location.port||void 0),u=[],p=e.config&&e.config()||{};
return t={version:"2.0.5+",strip:function(e){if(e){e=e.replace(o,"");var t=e.match(s);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:p.createXhr||function(){var e,t,i;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(t=0;3>t;t+=1){i=r[t];try{e=new ActiveXObject(i)}catch(n){}if(e){r=[i];break}}return e},parseName:function(e){var t,i,n,a=!1,r=e.indexOf("."),o=0===e.indexOf("./")||0===e.indexOf("../");return-1!==r&&(!o||r>1)?(t=e.substring(0,r),i=e.substring(r+1,e.length)):t=e,n=i||t,r=n.indexOf("!"),-1!==r&&(a="strip"===n.substring(r+1),n=n.substring(0,r),i?i=n:t=n),{moduleName:t,ext:i,strip:a}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,i,n,a){var r,o,s,l=t.xdRegExp.exec(e);return l?(r=l[2],o=l[3],o=o.split(":"),s=o[1],o=o[0],!(r&&r!==i||o&&o.toLowerCase()!==n.toLowerCase()||(s||o)&&s!==a)):!0},finishLoad:function(e,i,n,a){n=i?t.strip(n):n,p.isBuild&&(u[e]=n),a(n)},load:function(e,i,n,a){if(a.isBuild&&!a.inlineText)return void n();p.isBuild=a.isBuild;var r=t.parseName(e),o=r.moduleName+(r.ext?"."+r.ext:""),s=i.toUrl(o),u=p.useXhr||t.useXhr;!l||u(s,c,d,h)?t.get(s,function(i){t.finishLoad(e,r.strip,i,n)},function(e){n.error&&n.error(e)}):i([o],function(e){t.finishLoad(r.moduleName+"."+r.ext,r.strip,e,n)})},write:function(e,i,n){if(u.hasOwnProperty(i)){var a=t.jsEscape(u[i]);n.asModule(e+"!"+i,"define(function () { return '"+a+"';});\n")}},writeFile:function(e,i,n,a,r){var o=t.parseName(i),s=o.ext?"."+o.ext:"",l=o.moduleName+s,c=n.toUrl(o.moduleName+s)+".js";t.load(l,n,function(){var i=function(e){return a(c,e)};i.asModule=function(e,t){return a.asModule(e,c,t)},t.write(e,l,i,r)},r)}},"node"===p.env||!p.env&&"undefined"!=typeof process&&process.versions&&process.versions.node?(i=require.nodeRequire("fs"),t.get=function(e,t){var n=i.readFileSync(e,"utf8");0===n.indexOf("ï»¿")&&(n=n.substring(1)),t(n)}):"xhr"===p.env||!p.env&&t.createXhr()?t.get=function(e,i,n,a){var r,o=t.createXhr();if(o.open("GET",e,!0),a)for(r in a)a.hasOwnProperty(r)&&o.setRequestHeader(r.toLowerCase(),a[r]);p.onXhr&&p.onXhr(o,e),o.onreadystatechange=function(){var t,a;4===o.readyState&&(t=o.status,t>399&&600>t?(a=new Error(e+" HTTP status: "+t),a.xhr=o,n(a)):i(o.responseText))},o.send(null)}:"rhino"===p.env||!p.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java?t.get=function(e,t){var i,n,a="utf-8",r=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),s=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(r),a)),l="";try{for(i=new java.lang.StringBuffer,n=s.readLine(),n&&n.length()&&65279===n.charAt(0)&&(n=n.substring(1)),i.append(n);null!==(n=s.readLine());)i.append(o),i.append(n);l=String(i.toString())}finally{s.close()}t(l)}:("xpconnect"===p.env||!p.env&&"undefined"!=typeof Components&&Components.classes&&Components.interfaces)&&(n=Components.classes,a=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),t.get=function(e,t){var i,r,o={},s=new FileUtils.File(e);try{i=n["@mozilla.org/network/file-input-stream;1"].createInstance(a.nsIFileInputStream),i.init(s,1,0,!1),r=n["@mozilla.org/intl/converter-input-stream;1"].createInstance(a.nsIConverterInputStream),r.init(i,"utf-8",i.available(),a.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),r.readString(i.available(),o),r.close(),i.close(),t(o.value)}catch(l){throw new Error((s&&s.path||"")+": "+l)}}),t}),define("text!interaction_view/template/message.js",[],function(){return'<div class="status <%=type%>">\n<p><%=msg%></p>\n<a href="#" class="close">Close</a>\n</div>'}),define("text!interaction_view/template/slidenumber.js",[],function(){return'<%if(slidelength>1){%>\n<% if(iDetail.slideno_horizontal){%>\n<nav class="iView nav-horizen slidenumber" data-id="<%=id%>" style="left:<%=iDetail.slideno_horizontal_data.x%>px;top:<%=iDetail.slideno_horizontal_data.y%>px;" data-x="<%=iDetail.slideno_horizontal_data.x%>" data-y="<%=iDetail.slideno_horizontal_data.y%>">\n    <%for(i=0;i<slidelength;i++){%><li class="<%=0==i?"active":""%>"><a href="#" data-index="<%=i%>"></a></li><% } %>\n</nav>\n<% } %>\n<% if(iDetail.slideno_vertical){%>\n<nav class="iView nav-vertical slidenumber" data-id="<%=id%>" style="left:<%=iDetail.slideno_vertical_data.x%>px;top:<%=iDetail.slideno_vertical_data.y%>px;" data-x="<%=iDetail.slideno_vertical_data.x%>" data-y="<%=iDetail.slideno_vertical_data.y%>">\n    <%for(i=0;i<slidelength;i++){%><li class="<%=0==i?"active":""%>"><a href="#" data-index="<%=i%>"></a></li><% } %>\n</nav>\n<% } %>\n<% } %>\n'}),define("text!interaction_view/template/imgpreview.js",[],function(){return'<div class="btn-group action-control" style="position: absolute;left: 0;top: 0;z-index: 100001;background: transparent;width: 100%;height: 100%;">\n    <button class="btn preview-left enabled" href="#" rel="tooltip" data-original-title="PREV" style="color: #FFF;position: absolute;left: 0;top: 50%;background-color: transparent;background: none;">\n        <i class="icon-chevron-left icon-2x"></i>\n    </button>\n    <button class="btn preview-right enabled" href="#" rel="tooltip" data-original-title="NEXT" style="color: #FFF;background: transparent;position: absolute;right: 0px;top: 50%;">\n        <i class="icon-chevron-right icon-2x"></i>\n    </button>\n</div>'}),function(){var e={uuid:function(e){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}if(e){for(var i="";e--;)i+=t();return i}return t()+t()+t()+t()+t()+t()+t()+t()},changeURLPar:function(e,t,i){var n,a=e.split("#")[0];if(-1!=a.indexOf("?")){var r="";r=a.substr(a.indexOf("?")+1);var o,s="",l="",c="0";if(-1!=r.indexOf("&")){o=r.split("&");for(var d=0;d<o.length;d++){if(o[d].split("=")[0]==t){if(""==i)continue;l=i,c="1"}else l=o[d].split("=")[1];s=s+o[d].split("=")[0]+"="+l+"&"}s=s.substr(0,s.length-1),"0"==c&&""!=i&&s==r&&(s=s+"&"+t+"="+i)}else-1!=r.indexOf("=")?(o=r.split("="),o[0]==t?(l=i,c="1"):l=o[1],""!=l&&(s=o[0]+"="+l),"0"==c&&s==r&&""!=i&&(s=s+"&"+t+"="+i)):""!=i&&(s=t+"="+i);n=a.substr(0,a.indexOf("?")),""!=s&&(n=n+"?"+s)}else n=""!=i?a+"?"+t+"="+i:a;return e.indexOf("#")>0&&(n=n+"#"+e.split("#")[1]),n},getUrlParameterByName:function(e,t){var i=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),n=new RegExp("([\\?&]"+i+"=([^&#]*))+"),a=n.exec("undefined"!=typeof t&&t||location.search);return null==a?null:decodeURIComponent(a[a.length-1].replace(/\+/g," "))},replaceUrlParameterByName:function(e,t,i){var n=t.split("=")[1];return this.changeURLPar(i,e,n)},getHashParameterByName:function(e){var t=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),i=new RegExp("[\\#&]"+t+"=([^&#]*)"),n=i.exec(location.hash);return null==n?null:decodeURIComponent(n[1].replace(/\+/g," "))},replaceHashParameterByName:function(e,t){var i=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),n=new RegExp("[\\#&]"+i+"=([^&#]*)"),a=n.exec(location.hash);return location.hash.replace(a[0].substr(1),t)},parseTemplate:function(e){var t=null;return"function"==typeof e&&(t=e),"string"==typeof e&&(t=_.template(e)),t},renderT:function(e,t,i,n,a){if(!e)return!1;t||(t={});var r=n||null,o=$.extend(!0,{},t);if(r&&"undefined"!=typeof _gDebug&&_gDebug&&_g.debug&&_g.debug.enabled&&_g.debug.query_user_template(r)&&!a&&(e=_g.debug.query_user_template(r)),i){var s={};s[i]=o,o=s}var l=_g.parseTemplate(e);r&&_g.debug&&_g.debug.enabled&&(_g.debug.template[r]={data:o,template:"string"==typeof e?e:e.textsource,debug:!0});var c=$(l(o));return r&&_g.debug&&_g.debug.enabled&&(_g.debug.template[r].el=c),_g.generator&&(_g.generator.autoWidget(c),(c.hasClass("c-slimscroll")||c.find(".c-slimscroll").length)&&_g.generator.autoScroll(c)),c.find("[data-toggle=tooltip],.c-tooltip-btn").each(function(){var e=$(this),t=$(this).data().template;t?require(["text!"+t],function(){var i=require("text!"+t);e.tooltip({template:i})}):$(this).tooltip()}),c},domExist:function(e,t){return t||(t=document),"string"==typeof e&&(e=$(e)),$.contains(t.documentElement,e[0])},browserSupport:function(e){var t=!1,i={msie:1,chrome:1,mozilla:1,safari:1,opera:1,success:null,fail:null};e=e?$.extend(!0,{},i,e):$.extend(!0,{},i);var n=parseInt($.browser.version,10);return $.browser.msie&&1==e.msie||$.browser.chrome&&1==e.chrome||$.browser.mozilla&&1==e.mozilla||$.browser.safari&&1==e.safrai&&$.browser.opera&&1==e.opera?t=!0:$.browser.msie&&0==e.msie||$.browser.chrome&&0==e.chrome||$.browser.mozilla&&0==e.mozilla||$.browser.safari&&0==e.safrai&&$.browser.opera&&0==e.opera?t=!1:($.browser.msie&&(t=n>=e.msie),$.browser.chrome&&(t=n>=e.chrome),$.browser.mozilla&&(t=n>=e.mozilla),$.browser.opera&&(t=n>=e.opera),$.browser.safari&&(t=n>=e.safari)),t?e.success&&e.success():e.fail&&e.fail(),t},array:{moveup:function(e,t){var i=e.indexOf(t);return i>0&&(e=_g.array.swap(e,i,i-1)),e},movedown:function(e,t){var i=e.indexOf(t);return i<e.length&&(e=_g.array.swap(e,i,i+1)),e},swap:function(e,t,i){return e[t]=e.splice(i,1,e[t])[0],e},move2first:function(e,t){var n=[];for(n.push(t),i=0;i<e.length;i++)e[i]!=t&&n.push(e[i]);return n},move2last:function(e,t){var n=[];for(i=0;i<e.length;i++)e[i]!=t&&n.push(e[i]);return n.push(t),n},randomPick:function(e){return e[Math.floor(Math.random()*e.length)]},maptree:function(e){var t={treesource:null,mapdata:null,idAttribute:"id"};if(e=e?$.extend(!0,{},t,e):$.extend(!0,{},t),!e.treesource||!e.mapdata)return[];var i=[];return _.each(e.treesource,function(t){t.children&&(t.children=_g.array.maptree({treesource:t.children,mapdata:e.mapdata,idAttribute:e.idAttribute}));var n=_.find(e.mapdata,function(i){return i[e.idAttribute]==t[e.idAttribute]});n&&(t=$.extend(!0,t,n)),i.push(t)}),i},toDict:function(e,t){var n,a={};for(i=0;i<e.length;i++)n=e[i][t],a[n]=e[i];return a},treeToList:function(e,t,i){var n={childrenKey:"children",parentKey:"parent",idAttribute:"id"};if(t=t?$.extend(!0,{},n,t):$.extend(!0,{},n),!e)return[];var a=[];return _.each(e,function(n){if(n[t.childrenKey].length){var r=_g.array.toTreeList(n[t.childrenKey],t,i?i:e);for(j=0;j<r.length;j++)a.push(r[j]);n.children=_.pluck(n.children,"id")}else delete n.children;a.push(n)}),a},listToTree:function(e,t,i){var n={childrenKey:"children",parentKey:"parent",idAttribute:"id"};t=t?$.extend(!0,{},n,t):$.extend(!0,{},n);var a=[];return i&&(e=_.map(e,function(e){return"string"==typeof e&&(e=_.find(i,function(i){return i[t.idAttribute]==e})),e})),_.each(e,function(n){var r=$.extend(!0,{},n);i||r[t.parentKey],r[t.childrenKey]&&r[t.childrenKey].length?(r[t.childrenKey]=_g.array.listToTree(r[t.childrenKey],t,i?i:e),a.push(r)):a.push(r)}),a}},object:{jsonparse:function(e){if(!e)return null;try{return a=JSON.parse(e)}catch(t){return e}},equal:function(){},treeToArray:function(){},getKeyByValue:function(e,t){try{var i=_.keys(e)[_.values(e).indexOf(t)];return i}catch(n){return void 0}}},string:{randomGenerate:function(e){e=e?e:10;for(var t="",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz1234567890",n=0;e>n;n++)t+=i.charAt(Math.floor(Math.random()*i.length));return t},getUrlExt:function(e){return e.match(/(.[^.]+|)$/)[0]},getUrlNameWithOutExt:function(e){return e.substr(0,e.lastIndexOf("."))||e},getFileNameByPath:function(e){return e.replace(/^.*[\\\/]/,"")},string2boolean:function(e){return"true"==e?!0:!1},capitalize:function(e){return e=e.substring(0,1).toUpperCase()+e.substring(1)},rmfirst:function(e){return e.replace(/^.(\s+)?/,"")},rmlast:function(e){return e.replace(/(\s+)?.$/,"")},isPureEng:function(e){var t=e;if(""==t)return!0;for(var i=0;i<t.length;i++)if(!(t.charCodeAt(i)>=48&&t.charCodeAt(i)<=57||t.charCodeAt(i)>=65&&t.charCodeAt(i)<=90||t.charCodeAt(i)>=97&&t.charCodeAt(i)<=122))return!1;return!0},isEng:function(e){var t=e;if(""==t)return!0;for(var i=0;i<t.length;i++)if(!(32==t.charCodeAt(i)||t.charCodeAt(i)>=48&&t.charCodeAt(i)<=57||t.charCodeAt(i)>=65&&t.charCodeAt(i)<=90||t.charCodeAt(i)>=97&&t.charCodeAt(i)<=122))return!1;return!0},isPureChi:function(e){var t=e;if(""==t)return!0;for(var i=0;i<t.length;i++)if(!(t.charCodeAt(i)>=19968&&t.charCodeAt(i)<=64041))return!1;return!0},isChi:function(e){var t=e;if(""==t)return!0;for(var i=0;i<t.length;i++)if(!(32==t.charCodeAt(i)||t.charCodeAt(i)>=19968&&t.charCodeAt(i)<=64041))return!1;return!0},autoName:function(e,t,i,n){e||(e=""),i||(i=""),n||(n=1);var a=e+n+i;return-1!=t.indexOf(a)?_g.string.autoName(e,t,i,n+1):a}},"boolean":{randomPick:function(){return!!Math.round(1*Math.random())}},number:{random:function(e,t){return"undefined"==typeof e&&(e=0),"undefined"==typeof t&&(t=100),Math.random()*(t-e)+e},randomInt:function(e,t){return"undefined"==typeof e&&(e=0),"undefined"==typeof t&&(t=100),Math.floor(Math.random()*(t-e+1))+e},round:function(e,t){var i=e;void 0==typeof t&&(t=.5);var n=parseInt(e),a=e-n;i=t>a?n:n+1},rgbToHex:function(e,t,i){return"#"+((1<<24)+(e<<16)+(t<<8)+i).toString(16).slice(1)},hexToRgb:function(e){var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(t,function(e,t,i,n){return t+t+i+i+n+n});var i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return i?{r:parseInt(i[1],16),g:parseInt(i[2],16),b:parseInt(i[3],16)}:null},decimal:function(e,t){return Number(e.toFixed(t))}},hasTouch:function(){try{return document.createEvent("TouchEvent"),!0}catch(e){return!1}}(),inIframe:function(){try{return window.self!==window.top}catch(e){return!0}},supportFlash:function(){return"undefined"!=typeof swfobject&&0!==swfobject.getFlashPlayerVersion().major?!0:!1},isMSIE11:function(){return!!navigator.userAgent.match(/Trident\/7\./)},getRGBA:function(e,t){if(t=void 0!=t?Number(t):1,!e)return"transparent";if(-1!=e.indexOf("rgb("))var i=e.replace(/rgb\((.*)\)/,"$1").split(","),n="rgba("+i[0]+","+i[1]+","+i[2]+","+t+")";else{var i=_g.number.hexToRgb(e);if(i)var n="rgba("+i.r+","+i.g+","+i.b+","+t+")";else n="rgba(255,255,255,1)"}return n},weixinShare:function(){if("undefined"!=typeof wx_permissions&&wx_permissions.onMenuShareTimeline){var e=message_link+(message_link.indexOf("disableHistoryStart=0")>=0?"#page/"+interaction_view.currentPage:""),t=shareTitle==bookTitle?descContent:shareTitle;wx.onMenuShareAppMessage({title:bookTitle,desc:t,link:e,imgUrl:imgUrl,trigger:function(){_gaq.push(["_trackEvent","weixin","share","appmessage","click"])},success:function(){_gaq.push(["_trackSocial","Wechat","appmessage",ga_opt_target,ga_opt_pagePath])},cancel:function(){_gaq.push(["_trackEvent","weixin","share","appmessage","cancel"])},fail:function(e){_gaq.push(["_trackEvent","error","weixinjsapi","appmessage",JSON.stringify(e)])}}),wx.onMenuShareTimeline({title:shareTitle,link:e,imgUrl:imgUrl,trigger:function(){_gaq.push(["_trackEvent","weixin","share","timeline","click"])},success:function(){_gaq.push(["_trackSocial","Wechat","timeline",ga_opt_target,ga_opt_pagePath])},cancel:function(){_gaq.push(["_trackEvent","weixin","share","timeline","cancel"])},fail:function(e){_gaq.push(["_trackEvent","error","weixinjsapi","timeline",JSON.stringify(e)])}}),wx.onMenuShareQQ({title:bookTitle,desc:t,link:e,imgUrl:imgUrl,trigger:function(){_gaq.push(["_trackEvent","weixin","share","QQ","click"])},complete:function(){_gaq.push(["_trackEvent","weixin","share","QQ","complete"])},success:function(){_gaq.push(["_trackSocial","Wechat","QQ",ga_opt_target,ga_opt_pagePath])},cancel:function(){_gaq.push(["_trackEvent","weixin","share","QQ","cancel"])},fail:function(e){_gaq.push(["_trackEvent","error","weixinjsapi","QQ",JSON.stringify(e)])}}),wx.onMenuShareWeibo({title:shareTitle,desc:descContent,link:message_link,imgUrl:imgUrl,trigger:function(){_gaq.push(["_trackEvent","weixin","share","Weibo","click"])},complete:function(){_gaq.push(["_trackEvent","weixin","share","Weibo","complete"])},success:function(){_gaq.push(["_trackSocial","Wechat","Weibo",ga_opt_target,ga_opt_pagePath])},cancel:function(){_gaq.push(["_trackEvent","weixin","share","Weibo","cancel"])},fail:function(e){_gaq.push(["_trackEvent","error","weixinjsapi","Weibo",JSON.stringify(e)])}})}}};"undefined"==typeof require?(window._g||(window._g={}),window._g=$.extend(!0,{},window._g,e),e=void 0):define("_g/base",["jquery","backbone"],function(){return window._g||(window._g={}),window._g=$.extend(!0,{},window._g,e),e=void 0,window._g})}(window),function(){var e={log:function(e){console.log(e)},serverError:function(e){$(document).trigger("serverError"),_g.error[e]&&_g.error[e]()}};"undefined"==typeof require?(window._g||(window._g={}),window._g.error=e):define("_g/error",["_g/base"],function(){return window._g.error=e,window._g.error})}(window),function(){var e={buttonGroupT:['<div class="_g_btn_group <%=opts.className||""%>">',"</div>"].join(""),buttonT:'   <button class="btn _g_btn _g_btn_confirm <%=opts.className||""%>" type="button" data-name="<%=opts.name%>"><%=opts.name%></button>',buttonGroupList:[],scale:function(e,t){$(e).css("zoom",t).css("-moz-transform","scale("+t+")").css("-o-transform","scale("+t+")")},center:function(e){var t={containment:null};return e="string"==typeof e?{containments:null,Item:e}:e?$.extend({},t,e):t,e.Item?void $(e.Item).css({left:"50%",top:"50%","margin-top":function(){return-($(this).height()/2+50)},"margin-left":function(){return-($(this).width()/2)}}):!1},centerImage:function(e){var t={containment:null,parentWidth:null,parentHeight:null,width:null,height:null,setParent:!0};if(e=e?$.extend({},t,e):t,!e.Item||!e.containment)return!1;var i=0;return e.setParent&&$(e.containment).css({"line-height":e.parentHeight+"px","text-align":"center"}),e.width/e.height>=e.parentWidth/e.parentHeight?($(e.Item).css({width:"100%",height:"auto","verticle-align":"middle"}),i=e.parentWidth,height=e.parentWidth/(e.width/e.height)):($(e.Item).css({width:"auto",height:"100%","verticle-align":"middle"}),height=e.parentHeight,i=e.parentHeight*(e.width/e.height)),{width:i,height:height}},fitImage:function(e){if(!e)return!1;if(e.fit||(e.fit=0),e.containment)switch($(e.containment).css({"background-repeat":"no-repeat","background-position":"50% 50%"}),e.fit){case 0:$(e.containment).css({"background-size":"100%"});break;case 1:$(e.containment).css({"background-size":"contain"});break;case 2:$(e.containment).css({"background-size":"cover"})}else e.items&&$(e.items).each(function(){var t=$(this);void 0==e.width&&(e.width=$(this).width()),void 0==e.height&&(e.height=$(this).height());var i=e.width,n=e.height,a=$(this).parent();if(e.parentHeight=e.parentHeight||a.height(),e.parentWidth=e.parentWidth||a.width(),0==e.fit&&(t.css({width:"100%",height:"100%",top:"",left:""}),t.addClass("fullsize bk_full"),t.removeClass("bk_contain bk_cover"),i=e.parentWidth,n=e.parentHeight),1==e.fit)if(a.css({"line-height":e.parentHeight-(e.borderH||0)+"px"}),e.useMargin||(a.css("text-align","center"),a.removeClass("bk_cover bk_full"),a.addClass("aligncenter bk_contain")),e.width/e.height>=e.parentWidth/e.parentHeight){if(i=e.parentWidth,n=e.parentWidth/(e.width/e.height),t.css({width:"100%",height:"auto","vertical-align":"middle",left:"",top:"",display:"inline-block",position:"relative"}),e.useMargin){var r=e.parentWidth/(e.width/e.height);t.css("margin-top",(e.parentHeight-r)/2+"px"),t.css("margin-bottom",(e.parentHeight-r)/2+"px"),t.css({"margin-left":0,"margin-right":0}),t.css("position","absolute")}}else if(n=e.parentHeight,i=e.parentHeight*(e.width/e.height),t.css({width:"auto",height:"100%","vertical-align":"top",left:"",top:"",display:"inline-block",position:"relative"}),e.useMargin){var o=e.parentHeight*(e.width/e.height);t.css("margin-left",(e.parentWidth-o)/2+"px"),t.css("margin-right",(e.parentWidth-o)/2+"px"),t.css({"margin-top":0,"margin-bottom":0}),t.css("position","absolute")}2==e.fit&&(a.css({"line-height":e.parentHeight+"px","text-align":"center",overflow:"hidden"}),a.removeClass("bK_full bk_contain"),a.addClass("aligncenter overflowhidden bk_cover"),e.width/e.height>=e.parentWidth/e.parentHeight?(t.css({width:e.parentHeight*e.width/e.height+"px",height:e.parentHeight+"px","verticle-align":"middle",position:"absolute",left:"-"+(e.parentHeight*e.width/e.height-e.parentWidth)/2+"px",top:0,"max-width":"none"}),e.useMargin&&(t.css("left",""),t.css("margin-left","-"+(e.parentHeight*e.width/e.height-e.parentWidth)/2+"px"))):(t.css({position:"absolute",width:e.parentWidth+"px",height:e.parentWidth/(e.width/e.height)+"px","verticle-align":"middle",top:"-"+(e.parentWidth/(e.width/e.height)-e.parentHeight)/2+"px",left:0,"max-height":"none"}),e.useMargin&&(t.css("top",""),t.css("margin-top","-"+(e.parentWidth/(e.width/e.height)-e.parentHeight)/2+"px")))),e.explicitSize&&t.css({width:i,height:n})})},opacity:function(){},addShade:function(e){var t={name:"_g_shadow",zindex:99999,color:"#000000",opacity:.8,containment:"body"};e=e?$.extend({},t,e):t,$(containment).append('<div id="'+e.name+'" style="z-index:'+e.zindex+";background:"+e.color+";opacity:"+e.opacity+';"></div>')},addButtonGroup:function(e){var t={containment:null,position:0,name:"_g_button"+_g.uuid(),className:null,confirmButton:{name:"ç¡®è®¤",enable:!0,className:"btn-small btn-primary",onClick:null},cancelButton:{name:"å–æ¶ˆ",enable:!0,className:"btn-small",onClick:null},remove:function(){e.$el&&e.$el.remove()},getButton:function(t){return e.$el.find('[data-name="'+t+'"]')},addButton:function(t){var i={name:null,className:null,onClick:null};return t=t?$.extend(!0,{},i,t):i,t.name?(e.$el.append(_.template(_g.ui.buttonT,{opts:t})),void(t.onClick&&e.getButton(t.name).on("click",function(){t.onClick()}))):!1},removeButton:function(t){t&&e.$el.find('[data-name="'+t+'"]').remove()}};return e=e?$.extend(!0,{},t,e):$.extend(!0,{},t),e.containment?(0==e.position?($(e.containment).append(_.template(_g.ui.buttonGroupT,{opts:e})),e.$el=$(e.containment).children("._g_btn_group")):($(_.template(_g.ui.buttonGroupT,{opts:e})).insertAfter($(e.containment)),e.$el=$(e.containment).next("._g_btn_group")),e.confirmButton.enable&&e.addButton(e.confirmButton),e.cancelButton.enable&&e.addButton(e.cancelButton),e):!1},contenteditable:function(e){var t={eventType:0,mutiple:0,element:null,callback:null,type:0,enableControl:!1};return e=e?$.extend(!0,{},t,e):$.extend(!0,{},t),e.onKeyDown=function(t){var i=t.keyCode?t.keyCode:t.which;13==i&&0==e.mutiple&&(e.enableClose=!0,e.$this.blur(),$(document).off("keydown",e.onKeyDown),e.result())},e.result=function(){if(e.$this.data("before")!==e.$this.html()){e.$this.data("before",e.$this.html());var t=0==e.type?e.$this.text():e.$this.html();e.callback&&e.callback(t)}},e.enableEdit=!1,e.element?void(e.element&&(e.$this=$(e.element),e.$this.addClass("_g_contenteditable"),0==e.eventType&&$(e.element).attr("contenteditable","true"),1==e.eventType&&($(e.element).attr("contenteditable","false"),$(e.element).on("dblclick",function(){$(this).attr("contenteditable","true"),$(this).focus()})),$(e.element).on("focus",function(){return e.focus?!1:(e.focus=!0,e.$this.data("before",e.$this.html()),$(document).on("keydown",e.onKeyDown),e.enableControl&&(e.buttonGroup=_g.ui.addButtonGroup({containment:e.$this,position:1,confirmButton:{onClick:function(){e.enableClose=!0,e.$this.blur()}},cancelButton:{onClick:function(){e.enableClose=!0,e.$this.html(e.$this.data("before")),e.$this.blur()}}})),e.$this)}).on("blur",function(){if(e.enableControl){if(!e.enableClose)return e.$this.focus(),!1;e.enableClose=!1,e.buttonGroup.remove()}return e.focus=!1,$(document).off("keydown",e.onKeyDown),1==e.eventType&&$(e.element).attr("contenteditable","false"),e.result(),!1}))):!1},sortByIds:function(e){var t={containment:null,items:"li",ids:null};e=e?$.extend({},t,e):t,e.containment&&e.ids&&_.each(e.ids,function(t){if($(e.containment).children(e.items+'[id="'+t+'"]').length>0){var i=$(e.containment).children(e.items+'[id="'+t+'"]').detach();$(e.containment).append(i)}})},sortTreeByIds:function(e,t){var i={containment:null,items:"li",ids:null,childrenKey:"children",wrap:"ul",wrapClass:null};e=e?$.extend({},i,e):i,e.containment&&e.ids&&(e.root=t||e.containment,_.each(e.ids,function(i){if($(e.root).find(e.items+'[id="'+i.id+'"]').length>0){var n=$(e.root).find(e.items+'[id="'+i.id+'"]').detach();$(e.containment).is(e.wrap)||$(e.containment).children(e.wrap).length||($(e.containment).append(document.createElement(e.wrap)),e.containment=$(e.containment).children(e.wrap)),e.wrapClass&&$(e.containment).addClass(e.wrapClass),$(e.containment).append(n)}i[e.childrenKey]&&_g.ui.sortTreeByIds({containment:$(e.containment).find(e.items+'[id="'+i.id+'"]'),items:e.items,ids:i[e.childrenKey],childrenKey:e.childrenKey,wrapClass:e.wrapClass},t?t:e.containment)}))},findById:function(e){var t={containment:null,id:null};return e=e?$.extend({},t,e):t,e.containment&&e.id?$(e.containment).find('[id="'+e.id+'"],[data-id="'+e.id+'"]').first():[]},moveTo:function(e){var t={containment:null,sourceId:null,targetId:null,wrap:null,wrapClass:null,position:0};if(e=e?$.extend({},t,e):t,!e.containment)return!1;var i=_g.ui.findById({containment:e.containment,id:e.sourceId}),n=_g.ui.findById({containment:e.containment,id:e.targetId});e.wrap&&(0==n.has(e.wrap).length?(n.append(document.createElement(e.wrap)),n=n.children(e.wrap),e.wrapClass&&n.addClass(e.wrapClass)):n=n.children(e.wrap));var a=i.detach();0==e.position?n.prepend(a):n.append(a)},getTreeIds:function(e){var t={containment:null,items:null,idAttribute:"id",wrap:"ul"};e=e?$.extend({},t,e):t;var i=[];if(!e.containment||!e.items)return!1;if(e.wrap)if($(e.containment).is(e.wrap));else{if(!($(e.containment).children("ul").length>0))return[];e.containment=$(e.containment).children("ul")}return $(e.containment).children(e.items).each(function(){var t={};t.id=$(this).attr(e.idAttribute),t.children=_g.ui.getTreeIds({containment:$(this),items:e.items,idAttribute:e.idAttribute,wrap:e.wrap}),i.push(t)}),i},dialog:function(){},createDomMask:function(e){var t={containment:null,item:null,x:null,y:null,height:null,width:null,moveTo:function(t){e.offsetX=0-t.x,e.offsetY=0-t.y,$(e.item).css("left",e.offsetX),$(e.item).css("top",e.offsetY)},resize:function(t){$(e.containment).width(t.w),$(e.containment).height(t.h)}};return e=e?$.extend({},t,e):t,e.containment&&e.item?($(e.containment).css("overflow","hidden"),e.moveTo({x:e.x,y:e.y}),e.resize({w:e.width,h:e.height}),e):!1},clearSelection:function(){if(document.selection&&document.selection.empty)document.selection.empty();else if(window.getSelection){var e=window.getSelection();e.removeAllRanges()}},isOverflowed:function(e){var t={x:!1,y:!1},i=0;return $.zoom&&1!=$.zoom&&(i=2),$(e)[0].offsetHeight+i<$(e)[0].scrollHeight&&(t.y=$(e)[0].scrollHeight||1),$(e)[0].offsetWidth+i<$(e)[0].scrollWidth&&(t.x=$(e)[0].scrollWidth||1),t}};"undefined"==typeof require?(window._g||(window._g={}),window._g.ui=e):define("_g/ui",["jquery","_g/base","_g/error"],function(){return window._g.ui=e,window._g.ui})}(window),function(){var e={getValueByType:function(e,t){switch(t=t?t.toLowerCase():t){case"number":return Number(e);case"boolean":return"false"==e?!1:"true"==e?!0:Boolean(e);case"numberboolean":return"false"==e?0:"true"==e?1:Boolean(e)?1:0;case"string":return String(e);case"object":return _g.object.jsonparse(e);default:return e}},bindPopOver:function(e){var t={containment:null,trigger:"click",getData:null,callback:null,onChange:null};return e=e?$.extend(!0,{},t,e):t,e.containment?void $(e.containment).find(".c-popover-btn").on(e.trigger,function(){var t=$(this).data();if(e.getData){var i=require("text!"+t.template),n=e.getData(this);t.content=_g.renderT(i,n,"data","text!"+t.template)}t.container=t.container?$(t.container):$(this).closest(".c-popover-containment")[0],t.container||(t.container="body"),t.viewport={selector:$(this).closest(".c-popover-viewport")[0],padding:t.padding||0},t.viewport.selector||(t.viewport.selector="body"),t.elm=$(this),t.callback=e.callback,t.beforeClose=e.beforeClose,t.onChange=e.onChange,t.onShow=e.onShow,t.onClose=e.onClose,t.getContent=function(){var t=e.getData(this);return _g.renderT(i,t,"data")};_g.form.popover(t);return!1}):!1},bindListAction:function(e){var t={containment:null,listClass:".c-list",callback:null};if(e=e?$.extend(!0,{},t,e):t,!e.containment)return!1;if(!e.containment.hasClass(e.listClass)&&!e.containment.find(e.listClass).length)return!1;var i=e.containment.hasClass(e.listClass)?e.containment.data():e.containment.find(e.listClass).first().data();e.containment.find(".c-list-add").on("click",function(t){if(e.callback){var n=_g.util.serializeValue({containment:e.containment});e.callback("add",i.target,n,t.currentTarget)}return!1}),e.containment.find(".c-list-remove").on("click",function(t){return e.callback&&callback("remove",i.target,t.currentTarget),!1})},bindFormChange:function(e){var t={containment:null,$item:null,callback:null,silentDisplay:!1};if(e=e?$.extend(!0,{},t,e):t,!e.containment)return!1;$(e.containment).find(".slider").each(function(){var t=$(this).find("input"),i=t.data();if(i.target){var n=$(e.containment).find('[name="'+i.target+'"]');n.on("change",function(){var e=t.slider("getValue");e!=Number($(this).val())&&t.slider("setValue",Number($(this).val()))}),t.on("slide",function(e){var t=Number(n.val());t!=e.value&&(n.closest(".spinner").spinner("value",e.value),n.trigger("change"))})}}),$(e.containment).find("[rel=form]").each(function(){var t=$(this).data();if(void 0!=t.value)if($(this).find("[data-value]").removeClass("active"),t.mutiple||t.multiple){var n=t.value.split(",");for(i=0;i<n.length;i++)$(this).find('[data-value="'+n[i]+'"]').addClass("active")}else $(this).find('[data-value="'+t.value+'"]').addClass("active");var a=$(this);$(this).find("[data-value]").on("click",function(){var i=!1,n=$(this).data("value");if(t.silentdisplay||a.find("[data-show]").text($(this).text()||n),t.multiple||t.mutiple){$(this).hasClass("active")?$(this).removeClass("active"):t.silentdisplay||$(this).addClass("active");var r=[];a.find("[data-value]").each(function(){var e=$(this).data("value");$(this).hasClass("active")&&r.push(_g.util.getValueByType(e,t.type))}),r=r.join(","),console.log(r),a.data("value",r),t.value=r,i=!0}else $(this).hasClass("active")||(n=_g.util.getValueByType(n,t.type),a.data("value",n),$(this).addClass("active"),$(this).siblings().length?$(this).siblings().removeClass("active"):$(this).parent().siblings().children().removeClass("active"),t.value=n,i=!0);e.callback&&i&&e.callback(a,e,t)})});var n=e.$item?e.$item:"input,textarea,select";$(e.containment).find(n).on("change",function(){var t=$(this).data();t.name=$(this).attr("name")||$(this).attr("id"),e.callback&&e.callback($(this),e,t)}),e.createIndex&&_g.util.createFormIndex({containment:e.containment})},serializeValue:function(e){var t={containment:null,typeAttr:"data-type",attrAttr:"data-attr",allowEmpty:!0};if(e=e?$.extend({},t,e):t,!e.containment)return!1;var i=e.containment,n={},a=function(t,i){if("disabled"!=t.attr("disabled")){var a=t.attr("name")||t.attr("id"),r=(t.attr(e.typeAttr),t.attr(e.attrAttr));a&&(r?("object"!=typeof n[r]&&(n[r]={}),n[r][a]=i):n[a]=i)}},r=function(e,t){if("disabled"!=e.attr("disabled")){var i=e.data(),a=i.name,r=(i.type,i.attr);a&&(r?("object"!=typeof n[r]&&(n[r]={}),n[r][a]=t):n[a]=t)}};return $(i).find('input[type="text"],input[type="email"],input[type="tel"],input[type="hidden"],textarea').each(function(){var t=($(this).attr("name")||$(this).attr("id"),$(this).attr(e.typeAttr)),i=($(this).attr(e.attrAttr),_g.util.getValueByType($(this).val(),t));a($(this),i)}),$(i).find('input[type="checkbox"]').each(function(){var t=$(this).attr("name")||$(this).attr("id"),i=$(this).attr(e.typeAttr),r=$(this).attr(e.attrAttr);r&&"object"!=typeof n[r]&&(n[r]={});var o=r?n[r][t]?n[r][t]:[]:n[t]?n[t]:[];"checked"==$(this).attr("checked")?"boolean"==i||"numberboolean"==i?o=_g.util.getValueByType($(this).attr("data-reverse")?!1:!0,i):o.push(_g.util.getValueByType($(this).val(),i)):("boolean"==i||"numberboolean"==i)&&(o=_g.util.getValueByType($(this).attr("data-reverse")?!0:!1,i)),a($(this),o)
}),$(i).find('input[type="radio"]:checked').each(function(){var t=($(this).attr("name")||$(this).attr("id"),$(this).attr(e.typeAttr)),i=($(this).attr(e.attrAttr),_g.util.getValueByType($(this).val(),t));a($(this),i)}),$(i).find("select").each(function(){var t,i=$(this).attr("name")||$(this).attr("id"),r=$(this).attr(e.typeAttr),o=$(this).attr(e.attrAttr),s=Boolean($(this).attr("data-mutiple"));s?(o&&"object"!=typeof n[o]&&(n[o]={}),t=o?n[o][i]?n[o][i]:[]:n[i]?n[i]:[],t.push($(this).val())):t=_g.util.getValueByType($(this).val(),r),a($(this),t)}),$(i).find("[rel=form]").each(function(){var e=$(this).data();if(e.mutiple||e.multiple)if(void 0!=e.value)var t=e.value;else var t="";else var t=_g.util.getValueByType(e.value,e.type);r($(this),t)}),n},createFormIndex:function(e){var t={containment:null,typeAttr:"data-type",attrAttr:"data-attr"};if(e=e?$.extend({},t,e):t,!e.containment)return!1;var i=e.containment;if(!$(i).data().formindex&&!e.force){var n={},a=function(e,t,i,a,r){t&&(e?(n[e]||(n[e]={}),n[e][t]?"radio"==r||"checkbox"==r&&"boolean"!=a?n[e][t].els.push(i):n[e][t].el=i:n[e][t]={el:i,els:[i],type:a,tag:i[0].tagName,_type:i[0].type}):n[t]?"radio"==r||"checkbox"==r&&"boolean"!=a?n[t].els.push(i):n[t].el=i:n[t]={el:i,els:[i],type:a,tag:i[0].tagName,_type:i[0].type})},r=function(e,t,i,a,r){t&&(e?(n[e]||(n[e]={}),n[e][t]?n[e][t].el=i:n[e][t]={el:i,els:[i],type:a,tag:i[0].tagName,_type:i[0].type,rel:!0,multiple:r}):n[t]?n[t].el=i:n[t]={el:i,els:[i],type:a,tag:i[0].tagName,_type:i[0].type,rel:!0,multiple:r})},o=function(e,t,i){t&&(e?(n[e]||(n[e]={}),n[e][t]?n[e][t].slider=i:n[e][t]={slider:i}):n[t]?n[t].slider=i:n[t]={slider:i})},s=function(e,t,i){t&&(e?(n[e]||(n[e]={}),n[e][t]?n[e][t].colorpicker=i:n[e][t]={colorpicker:i}):n[t]?n[t].colorpicker=i:n[t]={colorpicker:i})},l=function(e,t,i){t&&(e?(n[e]||(n[e]={}),n[e][t]?n[e][t].spinner=i:n[e][t]={spinner:i}):n[t]?n[t].spinner=i:n[t]={spinner:i})};$(i).find("input,textarea,select").each(function(){var t=$(this).attr("name")||$(this).attr("id"),i=$(this).attr(e.typeAttr),n=$(this).attr(e.attrAttr);a(n,t,$(this),i,this.type)}),$(i).find("[rel=form]").each(function(){var e=$(this).data();r(e.attr,e.name,$(this),e.type,e.multiple||e.mutiple)}),$(i).find(".slider").each(function(){var t=$(this).find("input"),i=t.data();if(i.target){var n=i.target,a=$(e.containment).find('[name="'+i.target+'"]');o(a.attr("data-attr"),n,$(this).find("input"))}}),$(i).find(".c_color_el").each(function(){var e=$(this).data();if(e.colorpicker){var t=$(this).find("input");s(t.attr("data-attr"),t.attr("name"),e.colorpicker)}}),$(i).find(".spinner").each(function(){var e=$(this).data();if(e.spinner){var t=$(this).find("input");l(t.attr("data-attr"),t.attr("name"),e.spinner)}}),$(i).data("formindex",n)}return n},renderFormInfo:function(e){if(!e.containment)return!1;var t=$(e.containment).data().formindex;if(t){e.keys||(e.keys=["value"]);for(var i=0;i<e.keys.length;i++)_.each(e[e.keys[i]],function(n,a){"value"==e.keys[i]?_.isObject(n)?t[a]&&_.each(n,function(e,i){t[a][i]&&(_g.util.setFormItemValue(t[a][i],e),t[a][i].slider&&t[a][i].slider.slider("setValue",e))}):t[a]&&(_g.util.setFormItemValue(t[a],n),t[a].slider&&t[a].slider.slider("setValue",n)):"name"==e.keys[i]&&(_.isObject(n)?t[a]&&_.each(n,function(e,i){t[a][i]&&_g.util.setFormItemName(t[a][i],e)}):t[a]&&_g.util.setFormItemName(t[a],n))})}},setFormItemValue:function(e,t){if(e||(e={}),e.colorpicker)return void e.colorpicker.setValue(t,{silent:!0});if(e.spinner)return void e.spinner.value(t);if(e.rel){if(e.multiple){e.el.find("[data-value]").removeClass("active");for(var i=0;i<t.length;i++)e.el.find('[data-value="'+t[i]+'"]').addClass("active")}else e.el.find('[data-value="'+t+'"]').addClass("active").siblings().removeClass("active"),e.el.find("[data-show]").html(e.el.find('[data-value="'+t+'"]').html());return void e.el.data("value",t)}if("number"==e.type&&(t=Number(t)),"INPUT"==e.tag)if("checkbox"==e._type)if("boolean"==e.type)t?e.el.attr("checked","checked"):e.el.removeAttr("checked");else for(var i=0;i<e.els.length;i++)_.include(t,"number"==e.type?Number(e.els[i].val()):e.els[i].val())?e.els[i].attr("checked","checked"):e.els[i].removeAttr("checked");else if("radio"==e._type)if("boolean"==e.type)t?e.el.attr("checked","checked"):e.el.removeAttr("checked");else for(var i=0;i<e.els.length;i++)t==("number"==e.type?Number(e.els[i].val()):e.els[i].val())?e.els[i].attr("checked","checked"):e.els[i].removeAttr("checked");else e.el.val(t);else"TEXTAREA"==e.tagName?e.el.html(t):e.el.val(t)},setFormItemName:function(e,t){if(e||(e={}),e.els.length>1)for(var i=0;i<e.els.length;i++)e.els[i].attr("name",t);else{if(e.rel)return e.el.attr("data-name",t),void e.el.data("name",t);e.el.attr("name",t)}},disableLink:function(e){var t={containment:null,linkitem:"a",enabled:!0},i=e.linkitem||t.linkitem;return e=e?$.extend(!0,{},t,e):t,e.linkitem=i,e.containment?(e.func=function(){return!1},e.enable=function(){$(e.containment).find(e.linkitem).each(function(){$(this).on("click",e.func),e.enabled=!0})},e.disable=function(){$(e.containment).find(e.linkitem).each(function(){$(this).off("click",e.func),e.enabled=!1})},e.enable(),e):!1},domExist:function(e,t){return t||(t=document),"string"==typeof e&&(e=$(e)),$.contains(t.documentElement,e[0])},getImageSizeBySrc:function(e,t,i){var n=new Image;n.onload=function(){if(i&&(this.width>i||this.height>i)){var e=this.width/this.height;e>1?(this.width=i,this.height=this.width/e):(this.height=i,this.width=this.height*e)}t&&t(this.width,this.height)},n.src=e},htmlspecialchars:function(e){function t(e,t,i){for(var n=e.length,a=0;n>a;a++)re=new RegExp(e[a],"ig"),i=i.replace(re,"string"==typeof t?t:t[a]?t[a]:t[0]);return i}return"string"!=typeof e?e:t(["&","<",">",'"',"&lt;br&gt;"],["&amp;","&lt;","&gt;","&quot;","<br>"],e)},toggleActive:function(e){$(e).css("-moz-transition","all 0.5s").css("-webkit-transition","all 0.5s").css("-ms-transition","all 0.5s").css("-o-transition","all 0.5s").css("transition","all 0.5s"),$(e).css("opacity","0.5").css("background-color","#f80"),setTimeout(function(){$(e).css("opacity","1").css("background-color","#fff")},500)}};"undefined"==typeof require?(window._g||(window._g={}),window._g.util=e,e=void 0):define("_g/util",["jquery","_g/base"],function(){return window._g.util=e,e=void 0,window._g.util})}(window),function(){var _g_mvc={saveHandle:function(e,t){200==e.code?t("success","æˆåŠŸ"):t("error",e.msg)},_loadTemplate:function(){},_CollectionforSaveAll:function(){var e=Backbone.Model.extend({initialize:function(){this.set("id","GlobalSave")},sync:function(e,t,i){var n=this.data;this.attributes=n,"create"!=e&&("update"==e&&(i.url=this.url),"delete"!=e&&"read"!=e&&(Backbone.emulateHTTP=!0,Backbone.emulateJSON=!0,Backbone.sync(e,t,i)))}});return new e},createModel:function(opts){var defaults={defaults:{},autoIndex:!0,autoUpdate:!0,autoRemove:!0,enableSync:!0,createUrl:null,updateUrl:null,removeUrl:null,fetchUrl:null,staticFetchUrl:null,staticRemoveUrl:null,staticCreateUrl:null,staticUpdateUrl:null,fetchUrlName:null,removeUrlName:null,createUrlName:null,updateUrlName:null,restful:!1,debug:!1,bindChange:null,bindRemove:null,callback:null,initView:null,patchKeys:null,initialize:function(){if(this.iViewlist=[],this.iCollectionlist=[],this.get("id"))this.preset();else if(this.set("isNew",!0),this.autoIndex){var prefix=this.get("type")||this.get("iType")||"M";this.set("id",prefix+"_"+_g.uuid(4)),this.preset()}else this.save({},{wait:!0,success:function(model,response){var returned=eval(response);("Success"==returned.Status||200==returned.code)&&model.set("id",returned.ID.toString()),model.preset()}})},patchSave:function(callback,opts){if(opts||(opts={}),this.patchKeys&&this.patchKeys.length){var values=_.pick(this.toJSON(),this.patchKeys);this.save(values,{wait:!0,silent:opts.silent,patch:!0,success:function(model,response){if(callback){var returned=eval(response);callback(returned)}},error:function(e){_g.error.serverError("save_"+e.name),opts.onError&&opts.onError()}})}else this.save()},sync:function(e,t,i){var n,a="undefined"!=typeof _gDebug&&_gDebug||this.debug;if(!this.enableSync)return!1;if("create"==e){var r=this.createUrlName||this.createUrl;if(_g.debug&&_g.debug.enabled&&(_g.debug.data[r]={}),n=a?_g.debug&&_g.debug.query_user_data(r)?_g.debug.query_user_data(r):this.staticCreateUrl||this.createUrl:this.createUrl,!n)return;i.url=n}if("update"==e||"patch"==e){var r=this.updateUrlName||this.updateUrl;if(_g.debug&&_g.debug.enabled&&(_g.debug.data[r]={}),n=a?_g.debug&&_g.debug.query_user_data(r)?_g.debug.query_user_data(r):this.staticUpdateUrl||this.updateUrl:this.updateUrl,!n)return;i.url=n}if("delete"==e){var r=this.removeUrlName||this.removeUrl;if(_g.debug&&_g.debug.enabled&&(_g.debug.data[r]={}),n=a?_g.debug&&_g.debug.query_user_data(r)?_g.debug.query_user_data(r):this.staticRemoveUrl||this.removeUrl:this.removeUrl,!n)return;i.url=n}if("read"==e){var r=this.fetchUrlName||this.fetchUrl;if(n=a?this.staticFetchUrl:this.fetchUrl,_g.debug&&_g.debug.enabled&&(_g.debug.data[r]={}),n=a?_g.debug&&_g.debug.query_user_data(r)?_g.debug.query_user_data(r):this.staticFetchUrl||this.fetchUrl:this.fetchUrl,!n)return;i.url=n}i.url="string"==typeof i.url?i.url:i.url(t.attributes),this.restful||(Backbone.emulateHTTP=!0,Backbone.emulateJSON=!0),Backbone.sync(e,t,i)},addView:function(e,t){if("function"==typeof t&&(this[e]=new t({model:this})),"object"==typeof t){var i=_g.mvc.createView(t);this[e]=new i({model:this})}this[e]&&this.iViewlist.push(this[e])},addCollection:function(e,t){if("function"==typeof t&&(this[e]=new t),"object"==typeof view){var i=_g.mvc.createCollection(t);this[e]=new i}this[e]&&this.iCollectionlist.push(this[e])},preset:function(){this.callback&&this.callback(this);var e=this;this.autoUpdate&&this.on("change",function(){e.updateAllViews()}),this.autoRemove&&this.on("destroy",function(e,t,i){e.removeAllViews(),e.bindRemove&&e.bindRemove(e,i)}),this.bindChange&&this.bindChange(),this.initView&&this.addView("iview",this.initView)},updateAllViews:function(){_.each(this.iViewlist,function(e){e.$el&&e.update()})},removeView:function(e){this[e]&&(this[e].remove(),this.iViewlist=_.reject(this.iViewlist,function(t){return t==this[e]}),this[e]=null)},removeAllViews:function(e){_.each(this.iViewlist,function(t){t.$el&&(e?t.undelegateEvents():t.remove())})}};opts=opts?$.extend(!0,{},defaults,opts):defaults;var Model=Backbone.Model.extend(opts);return Model},createView:function(e){var t={template:null,className:null,containment:null,wrap:null,wrapClassName:null,autoRender:!0,position:1,parseData:null,callback:null,bindChange:null,parseTemplate:null,templateKey:null,templateName:null,afterRender:null,afterUpdate:null,initialize:function(){_.bindAll(this),this.autoRender&&this.render(),this.callback&&this.callback(this)},createEl:function(){var e,t=this.model.toJSON();return this.parseData&&(t=this.parseData()),e=this.parseTemplate?this.parseTemplate(this.template):this.template,_g.renderT(e,t,this.templateKey,this.templateName)},render:function(e,t){if(!this.model||!this.template)return!1;if(!_g.util.domExist(this.$el)){if(!e&&!this.containment)return!1;e||(e=$(this.containment)),t||(t=this.position),this.wrap&&!$(this.containment).is(this.wrap)&&(0==$(this.containment).children(this.wrap).length&&$(this.containment).append(document.createElement(this.wrap)),e=$(this.containment).children(this.wrap),this.containment&&this.wrapClassName&&e.addClass(this.wrapClassName));var i=this.createEl(),n=i;return this.setElement(n),1==t?e.append(n):e.prepend(n),this.className&&this.$el.addClass(this.className),this.afterRender&&this.afterRender(this),this}var i=this.createEl(),n=i;this.undelegateEvents(),this.$el.replaceWith(n),this.setElement(n),this.afterUpdate&&this.afterUpdate(this)},update:function(){this.render()},afterUpdate:function(){this.afterRender&&this.afterRender(this)},events:{}};e=e?$.extend(!0,{},t,e):t;var i=Backbone.View.extend(e);return i},createCollection:function(e){var t={enableSync:!1,fetchUrl:null,staticFetchUrl:null,saveUrl:null,staticSaveUrl:null,debug:!1,bindRemove:!1,bindReset:!0,bindAdd:null,callback:null,patchKeys:null,name:null,initialize:function(){var e=this;this.bindRemove&&this.on("remove",function(t){"function"==typeof e.bindRemove?e.bindRemove(t):t.removeAllViews()}),this.bindReset&&this.on("reset",function(t,i){"function"==typeof e.bindReset?e.bindReset(t,i):_.each(i.previousModels,function(e){e.removeAllViews()}),e.afterReset&&e.afterReset(t,i)}),this.bindAdd&&this.on("add",function(){e.bindAdd()}),this.callback&&this.callback(this)},sortByIds:function(e){var t=this;this.reset(_.map(e,function(e){return t.get(e)}),{silent:!0})},sync:function(e,t,i){var n="undefined"!=typeof _gDebug&&_gDebug||this.debug;if(!this.enableSync)return!1;if("read"==e){var a=n?this.staticFetchUrl?this.staticFetchUrl:this.fetchUrl:this.fetchUrl?this.fetchUrl:this.staticFetchUrl;if(!a)return;i.url=a}return i.url?(i.url="string"==typeof i.url?i.url:i.url(t.toJSON()),this.resetful||(Backbone.emulateHTTP=!0,Backbone.emulateJSON=!0),void Backbone.sync(e,t,i)):!1},getAll:function(e){var t=this;this.fetch({success:function(t,i){e&&e(i)},error:function(){_g.error.serverError("get_"+t.name)}})},saveAll:function(e){var t=this,i="undefined"!=typeof _gDebug&&_gDebug||this.debug,n=i?this.staticSaveUrl?this.staticSaveUrl:this.saveUrl:this.saveUrl?this.saveUrl:this.staticSaveUrl;if(!n)return!1;var a=_g.mvc._CollectionforSaveAll();a.data=this.patchKeys&&this.patchKeys.length?_.map(this.toJSON(),function(e){var i=$.extend(!0,{},e);return i=_.pick(i,t.patchKeys)}):this.toJSON(),a.url=n,a.save({},{wait:!0,success:function(t,i){e&&e(i)},error:function(){_g.error.serverError("save_"+t.name)}})},refreshView:function(e){var t={containment:null,viewname:null};e=e?$.extend({},t,e):t,this.length>0&&(_.each(this.at(0).iViewlist,function(t){containment=e.containment||t.containment,containment&&(t.wrap&&!$(containment).is(t.wrap)?$(containment).children(t.wrap).empty():$(containment).empty())}),this.each(function(t){e.containment&&(t.iview.containment=e.containment),e.viewname?t[viewname].update():t.iview.update()}))},removeAllViews:function(e){this.each(function(t){t.removeAllViews(e)})}};e=e?$.extend(!0,{},t,e):t;var i=Backbone.Collection.extend(e);return i},createTreeByData:function(e){var t,i={collection:null,data:null,treeLevel:0,parent:null},n=e.parent;if(e=e?$.extend(!0,{},i,e):i,e.parent=n,!e.collection||!e.data)return null;var a=$.extend(!0,[],e.data);if("function"==typeof e.collection)t=new e.collection;else{var r=_g.mvc.createCollection(e.collection);t=new r}return t.parent=n,t.refreshTreeView=function(e){this.refreshView(e),this.each(function(t){t.icollection.refreshTreeView({containment:t.iview.$el,viewname:e?e.viewname:null})})},t.getModels=function(){var e=_g.mvc.getTreeModels(t);return e},t.getModelsJSON=function(){var e=t.getModels();return e=_.map(e,function(e){return e.toJSON()})},t.getModel=function(e){return _g.mvc.getTreeModel(t,e)},t.on("add",function(i){i.treeLevel=e.treeLevel,i.icollection=_g.mvc.createTreeByData({collection:e.collection,data:[],treeLevel:e.treeLevel+1}),t.parent&&(t.View="object"==typeof t.View?$.extend(!0,{},t.View,{containment:t.parent.iview.$el}):t.View.extend({containment:t.parent.iview.$el})),i.addView("iview",t.View),_g.ui.sortByIds({containment:i.iview.wrap?i.iview.$el.parent(i.iview.wrap):i.iview.$el.parent(),ids:t.pluck("id")}),i.icollection.parent=i,i.icollection.View=t.View}),t.saveAll=function(e){var t="undefined"!=typeof _gDebug&&_gDebug||this.debug,i=t&&this.staticSaveUrl?this.staticSaveUrl:this.saveUrl;if(!i)return!1;var n=_g.mvc._CollectionforSaveAll();n.data=_g.mvc.getTreeData(this),n.url=i,n.save({},{wait:!0,success:function(t,i){e&&e(i)},error:function(){}})},_.each(a,function(i){var n;n=i.children?$.extend(!0,[],i.children):[],delete i.children,t.add(i,{silent:!0});var a=t.at(t.length-1);a.treeLevel=e.treeLevel,console.log(n),a.icollection=_g.mvc.createTreeByData({collection:e.collection,data:n,treeLevel:e.treeLevel+1,parent:a})}),t},createTreeView:function(e){var t={collection:null,view:null,containment:null,wrap:null,wrapClassName:null,template:null,className:null,parseTemplate:null,templateKey:null,templateName:null,update:function(){if(!this.model||!this.template||!this.containment)return!1;if(_g.util.domExist(this.$el)){var e=this.createEl(),t=null;this.wrap&&(t=this.$el.children(this.wrap).detach()),this.undelegateEvents(),this.$el.replaceWith(e),this.setElement(e)}else this.render();this.afterUpdate&&this.afterUpdate(this)}},i=e.collection;e=e?$.extend(!0,{},t,e):t;var n={};if(e.collection=i,!e.collection||!e.view)return!1;e.containment&&(n.containment=e.containment),e.wrap&&(n.wrap=e.wrap),e.template&&(n.template=e.template),e.templateKey&&(n.templateKey=e.templateKey),e.templateName&&(n.templateName=e.templateName),e.parseTemplate&&(n.parseTemplate=e.parseTemplate),e.parseData&&(n.parseData=e.parseData),e.callback&&(n.callback=e.callback),e.wrapClassName&&(n.wrapClassName=e.wrapClassName),e.className&&(n.className=e.className),n.update=e.update;var a="function"==typeof e.view?e.view.extend(n):$.extend(!0,e.view,n);e.collection.View=a,e.collection.each(function(t){if(t.addView("iview",a),t.icollection){if(e.useJquerySel){var i=e.containment.children('[id="'+t.id+'"]');if(e.wrap)if(i.children(e.wrap+e.wrapClassName?"."+e.wrapClassName:"").length)i=i.children(e.wrap+e.wrapClassName?"."+e.wrapClassName:"");else{var n=$(document.createElement(e.wrap));i.append(n),e.wrapClassName&&n.addClass(e.wrapClassName),i=n}}else{"string"!=typeof e.containment&&(e.containment=e.containment.selector);var i=e.containment+(e.wrap?" >"+e.wrap:"")+' >[id="'+t.id+'"]'}_g.mvc.createTreeView({collection:t.icollection,view:e.view,wrapClassName:e.wrapClassName,containment:i,wrap:e.wrap||null,template:e.template||null,useJquerySel:e.useJquerySel})}})},sortTreeByIds:function(e){var t=function(i,n,r){return i?(i.reset([],{silent:e.silent}),_.each(n,function(n){n.children=n.children||[];var o=a.get(n.id);o.treeLevel=r,o.icollection=t(o.icollection,n.children,r+1),i.add(o,{silent:e.silent}),o.collection=i}),i):null},i={collection:null,ids:null,treeLevel:0,silent:!0},n=e.collection;if(e=e?$.extend(!0,{},i,e):i,e.collection=n,!e.collection||!e.ids)return!1;var a=new Backbone.Collection;a.add(_g.mvc.getTreeModels(e.collection));var r=t(e.collection,e.ids,e.treeLevel);return r},getTreeModels:function(e){var t=[];return e.each(function(e){if(t.push(e),e.icollection)for(var i=_g.mvc.getTreeModels(e.icollection),n=0;n<i.length;n++)t.push(i[n])}),t},getTreeModel:function(e,t){if(!e||!t)return!1;var i=_g.mvc.getTreeModels(e);return _.find(i,function(e){return e.id==t})},getTreeData:function(e,t){var i=[];return e.each(function(e){var n=$.extend(!0,{},e.toJSON());t&&t.filter&&(n=_.pick(n,t.filter)),e.icollection&&(n.children=_g.mvc.getTreeData(e.icollection,t)),i.push(n)}),i},moveTo:function(e){void 0==e.silent&&(e.silent=!0);var t=null;if(void 0!=e.fromIndex&&void 0!=e.toIndex)t=e.collection.at(e.fromIndex),e.collection.remove(t,{silent:e.silent}),e.collection.add(t,{at:e.toIndex,silent:e.silent});else if(void 0!=e.sourceId&&void 0!=e.targetId&&void 0!=e.position){t=e.collection.get(e.sourceId),e.collection.remove(t,{silent:e.silent});var i=e.collection.get(e.targetId),n=e.collection.indexOf(i);if(-1==e.position)var a=n;else var a=n+1;e.collection.add(t,{at:a,silent:e.silent})}}};"undefined"==typeof require?(window._g||(window._g={}),window._g.mvc=_g_mvc,_g_mvc=void 0):define("_g/mvc",["jquery","backbone","_g/base","_g/ui","_g/util"],function(){return window._g.mvc=_g_mvc,_g_mvc=void 0,window._g.mvc})}(window),define("text!interaction_view/template/page.js",[],function(){return'<section class="Presentation" id="<%=id%>">\n    <div class="interaction-area typo">\n      <div class="interaction-view"></div>\n   </div>\n</section>'}),define("text!interaction_view/template/pagegroup.js",[],function(){return'<section class="group" id="<%=id%>"></section>'}),define("interaction_view/view/page",["_g/mvc","text!interaction_view/template/page.js","text!interaction_view/template/pagegroup.js"],function(){var e={template:require("text!interaction_view/template/page.js"),className:null,containment:"div.slides",wrap:null,wrapClassName:null,autoRender:!0,position:1,parseData:null,callback:function(){"page_group"!=this.model.get("type")&&(this.overlays=this.model.get("overlays"),this.animations=this.model.get("animations"),this.actions=this.model.get("actions")),("page"==this.model.get("type")||"config"==this.model.get("type"))&&this.renderbg()},bindChange:null,parseTemplate:function(){var e=this.model.get("type");return _g.parseTemplate("page_group"==e?require("text!interaction_view/template/pagegroup.js"):require("text!interaction_view/template/page.js"))},render:function(e,t){if(!this.model||!this.template)return!1;if(!$.contains(document.documentElement,this.$el[0])){if(interaction_view.foredit){if(!e&&!this.containment)return!1;e||(e=$(this.containment)),t||(t=this.position),this.wrap&&!$(this.containment).is(this.wrap)&&(0==$(this.containment).children(this.wrap).length&&$(this.containment).append(document.createElement(this.wrap)),e=$(this.containment).children(this.wrap),this.containment&&this.wrapClassName&&e.addClass(this.wrapClassName))}var i,n;return $("section#"+this.model.id).length>0?(i=$("section#"+this.model.id)[0],n=i,this.setElement(n)):interaction_view.foredit&&(i=this.createEl(),n=i,this.setElement(n),1==t?e.append(n):e.prepend(n)),this.afterRender&&this.afterRender(this),this}var i=this.createEl(),n=i;this.$el.replaceWith(n),this.setElement(n),this.afterUpdate&&this.afterUpdate(this)},renderbg:function(){var e=this.$el;if(2==interaction_view.screen_mode&&(e=this.$el.children()),this.model.get("picture")&&e.css({"background-image":"url("+this.model.get("picture")+")","background-size":"contain","background-position":"center center","background-repeat":"no-repeat"}),interaction_view.forpreview){var t=this.model.get("bg_color"),i=this.model.get("bg_opacity"),n=-1==t.indexOf("rgba")?_g.getRGBA(t,i):t;this.$el.css({"background-color":n})}},prepareLoad:function(){for(var e=this,t=[],i=0;i<e.animations.length;i++){var n=$.extend(!0,{},e.animations[i]);n.pageid=e.model.id,e.isMaster&&(n.pagetype="master"),e.isBackground&&(n.pagetype="background"),e.isConfig&&(n.pagetype="config"),t.push(n)}e.model.iAnimationlist.reset(t);for(var a=[],i=0;i<e.overlays.length;i++){var n=$.extend(!0,{},e.overlays[i]);interaction_view.model[n.iType]&&(n.pageid=e.model.id,n.zIndex=i,e.isMaster?(n.pagetype="master","Audio"==n.iType&&n.iDetail.iAutoplay&&!interaction_view.hasbgsound&&(interaction_view.hasbgsound=!0,n.isBgsound=!0)):e.isConfig&&(n.pagetype="config"),a.push(new interaction_view.model[n.iType](n)))}e.model.iOverlaylist.reset(a),e.model.iOverlaylist.each(function(e){e.iview.setZindex()});for(var r=[],i=0;i<e.actions.length;i++){var n=$.extend(!0,{},e.actions[i]);n.pageid=e.model.id,e.isMaster&&(n.pagetype="master"),e.isConfig&&(n.pagetype="config"),r.push(n)}e.model.iActionlist.reset(r)},startLoad:function(){0==this.model.ipreloadlist.length?interaction_view.finishPagePreload(this.model.id,this.model):this.model.ipreloadlist.preload()},afterpreload:function(){var e=this;e.model.iOverlaylist.each(function(e){e.iview.preloaded||e.iview.afterpreload()}),e.hasRenderActionlist?e.model.iActionlist.each(function(e){e.iview&&_.include([0,1,2,4,6,7,14,15,20,21,99],e.get("iType"))&&e.iview.render({init:!1})}):(e.hasRenderActionlist={},e.model.iActionlist.each(function(e){e.iview&&e.iview.render({init:!0})}))},clearPageLoad:function(){if(this.model.get("loaded")){var e=this.$el.find(".interaction-view");e.empty(),this.model.iAnimationlist&&this.model.iAnimationlist.timeline&&this.model.iAnimationlist.timeline.kill(),this.model.isStartLoad=!1,this.model.playFinished=!1,this.ipreloadlist=new interaction_view.collection.Preload,interaction_view.events.clearRelatedEvents(this.model.id),this.model.unset("loaded",{silent:!0}),this.model.iview.$el.hasClass("dragConnector")&&connector.removeDragController(this.model.iview.$el)}presentation.pageClearCenter(this.model.id)}};return e}),define("interaction_view/view/subcontainer",["interaction_view/view/page"],function(){var e=require("interaction_view/view/page"),t=$.extend({},e,{template:null,className:null,containment:null,wrap:null,wrapClassName:null,autoRender:!1,position:1,parseData:null,afterload:function(){var e=this;overlays=_.filter(e.model.suboverlays,function(t){return t.path=e.model.iOverlaylist.path,t.isSubOverlay=!0,interaction_view.model[t.iType]}),overlays=_.map(overlays,function(e){return new interaction_view.model[e.iType](e)}),e.model.iOverlaylist.reset(overlays),e.startSubLoad()},startSubLoad:function(){var e=this;0==e.model.ipreloadlist.length?e.model.iview.afterSubOverlayPreload():e.model.ipreloadlist.preload()}});return t});var _eT={RichText:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iText nanoscrollbar Element" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;overflow-y:hidden;padding:0;margin:0;">',"<% if(iDetail.iStaticImage&&iDetail.iImg&&iDetail.iImg[0]){%>",'<img class="el_wrap" src="<%=iDetail.iImg[0].picture%>" style="width:100%;height:auto;"/>',"<% }else{%>",'<div class="el_wrap" style="position:absolute;width:100%;height:100%;<%=iDetail.iStyle%>"><%=iDetail.iText%></div>',"<% } %>","</div>","</div>"].join(""),Paragraph:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iParagraph Element" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;padding:0;margin:0;line-height:1.5;">',"<% if(iDetail.iStaticImage&&iDetail.iImg&&iDetail.iImg[0]){%>",'<div class="paragraph nanoscrollbar el_wrap" style="position:absolute;left:0; top: 0 ;background-color:transparent;width:100%;height:100%;padding:0;margin:0;overflow:hidden;">','<img src="<%=iDetail.iImg[0].picture%>" style="width:100%;height:auto;"/>',"</div>","<% }else{%>",'<div class="paragraph nanoscrollbar el_wrap" style="position:absolute;left:0; top: 0 ;background-color:transparent;width:100%;height:100%;padding:0;margin:0;overflow:hidden;<%=iDetail.iStyle||""%>">','<div style="text-align:inherit;width:100%;height:100%;font-size: inherit;color: inherit;font-family: inherit;font-weight:inherit;" class="iText"><%=iDetail.iText%></div>',"</div>","<% } %>","</div>","</div>"].join(""),TextLabel:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iTextLabel nanoscrollbar Element" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;overflow-y:hidden;<%=iDetail.iStyle%>">',"<% if(iDetail.iStaticImage&&iDetail.iImg&&iDetail.iImg[0]){%>",'<img src="<%=iDetail.iImg[0].picture%>" style="width:100%;height:auto;"/>',"<% }else{%>",'<div style="position:absolute;width:100%;height:100%;<%=iDetail.iStyle%>"><%=iDetail.iText%></div>',"<% } %>","</div>","</div>"].join(""),Image:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iImage Element" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;<%=iDetail.iMask?"overflow:hidden;":""%>">',"<%if(iDetail.iImg&&iDetail.iImg[0]){%>","<% if(iDetail.iMask){%>",'<div class="image_wrap el_wrap" style="position:absolute;left:0;top:0;width:100%;height:100%;overflow:hidden;position:absolute;<%=iDetail.iStyle%>">','<img draggable="false" class="Context" style="width:<%=iDetail.iMask_data.width%>px;height:<%=iDetail.iMask_data.height%>px;position:absolute;max-width:none;" src="<%=iDetail.iImg&&iDetail.iImg[0]&&iDetail.iImg[0].picture%>">',"</div>","<%}else if(iDetail.iEraser||iDetail.iEditable||iDetail.iQrcode){%>",'<div class="image_wrap el_wrap" style="position:absolute;left:0;top:0;width:100%;height:100%;overflow:hidden;position:absolute;<%=iDetail.iStyle%>">','<img draggable="false" class="Context" style="width:100%;height:100%;position:absolute;max-width:none;" src="<%=iDetail.iImg&&iDetail.iImg[0]&&iDetail.iImg[0].picture%>">',"</div>","<%}else{%>",'<div class="image_wrap el_wrap bk_full" style="position:absolute;left:0;top:0;width:100%;height:100%;position:absolute;background-image:url(<%=iDetail.iImg&&iDetail.iImg[0]&&iDetail.iImg[0].picture%>);<%=iDetail.iStyle%>">',"<% } %>","<%}%>","</div>","</div>"].join(""),ImageBlock:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iImageBlock Element" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;">',"<%if(iDetail.iImg&&iDetail.iImg[0]){%>","<% if(iDetail.iMask){%>",'<div class="image_wrap el_wrap" style="position:absolute;left:0;top:0;width:100%;height:100%;overflow:hidden;position:absolute;<%=iDetail.iStyle%>">','<img draggable="false" class="Context" style="width:<%=iDetail.iMask_data.width%>px;height:<%=iDetail.iMask_data.height%>px;position:absolute;max-width:none;" src="<%=iDetail.iImg&&iDetail.iImg[0]&&iDetail.iImg[0].picture%>">',"</div>","<%}else if(iDetail.iEraser||iDetail.iEditable||iDetail.iQrcode){%>",'<div class="image_wrap el_wrap" style="position:absolute;left:0;top:0;width:100%;height:100%;overflow:hidden;position:absolute;<%=iDetail.iStyle%>">','<img draggable="false" class="Context" style="width:100%;height:100%;position:absolute;max-width:none;" src="<%=iDetail.iImg&&iDetail.iImg[0]&&iDetail.iImg[0].picture%>">',"</div>","<%}else{%>",'<div class="image_wrap el_wrap bk_full" style="position:absolute;left:0;top:0;width:100%;height:100%;position:absolute;background-image:url(<%=iDetail.iImg&&iDetail.iImg[0]&&iDetail.iImg[0].picture%>);<%=iDetail.iStyle%>">',"<% } %>","<%}%>","</div>","</div>"].join(""),Link:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iLink Element" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;<%=iDetail.iStyle%>"></div>',"</div>"].join(""),SearchInput:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iSearchInput Element" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;<%=iDetail.iStyle%>">','<form class="search" style="position:relative; cursor:default;">','<input type="text" autofocus placeholder="è¾“å…¥å…³é”®å­—" class="input-medium search-query" style="cursor:default; width:<%=iCommon[iPageDirection].iWidth-14%>px; height:<%=iCommon[iPageDirection].iHeight-2%>px; line-height:<%=iCommon[iPageDirection].iHeight-2%>px; border-radius:8px; border-color:<%=iDetail.border_color%>; color:<%=iDetail.text_color%>; background-color:transparent;">','<button class="btn" type="submit" style="cursor:default; position:absolute; top:0; right:0; display:block; width:30px; height:<%=iCommon[iPageDirection].iHeight-2%>px; line-height:30px; background:none; border:none; margin:0 0 0 -30px; padding:0; text-shadow:none; color:#ccc;">','<i class="icon-search"></i>',"</button>","</form>","</div>","</div>"].join(""),Input:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iInput Element" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;">','<input type="<%=iDetail.iKind%>"  value="<%=iDetail.initial%>"  <% if(iDetail.required == "on"){ %> required <%}%>   placeholder="<%=iDetail.placeholder%>" class="input-medium search-query c-input" style=" width:<%=iCommon[iPageDirection].iWidth%>px; height:<%=iCommon[iPageDirection].iHeight%>px; line-height:<%=iCommon[iPageDirection].iHeight%>px;<%=iDetail.iStyle%>"> ',"</div>","</div>"].join(""),Textarea:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iTextarea Element" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;">','<textarea <% if(iDetail.required == "on"){ %> required <%}%>  placeholder="<%=iDetail.placeholder%>"   style="cursor:default; width:<%=iCommon[iPageDirection].iWidth%>px; height:<%=iCommon[iPageDirection].iHeight%>px;<%=iDetail.iStyle%>"><%=iDetail.initial%></textarea>	 ',"</div>","</div>"].join(""),Select:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iInput Element" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;">','<select class="input-medium search-query c-select" style="cursor:default; width:<%=iCommon[iPageDirection].iWidth%>px; height:<%=iCommon[iPageDirection].iHeight%>px; line-height:<%=iCommon[iPageDirection].iHeight%>px;<%=iDetail.iStyle%>">			',"<option></option>","</select>","</div>","</div>"].join(""),SelectBox:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iSelectBox Element" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;">','<input type="<%=iDetail.type%>" class="input-medium search-query" style="','vertical-align:"middle";','padding:0px;margin:0;" id="<%=id+"box"%>"> <label for="<%=id+"box"%>" ><span style="display:inline;<%=iDetail.iStyle%>"><%=iDetail.label%></span></label>',"</div>","</div>"].join(""),Tree:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iTree Element" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;<%=iDetail.iStyle%>">		 ',"</div>","</div>"].join(""),Grid:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iGrid Element" style="overflow:hidden;position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;<%=iDetail.iStyle%>">',"</div>","</div>"].join(""),Gallery:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iGallery Element nanoscrollbar" style="overflow:hidden;position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;overflow:hidden;<%=iDetail.iStyle%>">',"</div>","</div>"].join(""),PageIndex:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iPageIndex Element nanoscrollbar" style="overflow:hidden;position:absolute;left: -<%=parseInt(iCommon[iPageDirection].iWidth/2,10)-0.5%>px; top: -<%=parseInt(iCommon[iPageDirection].iHeight/2,10)-0.5%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;<%=iDetail.iStyle%>">',"</div>","</div>"].join(""),Cell:['<div class="iView static hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="position:absolute; left: <%=iCommon[iPageDirection].iStartx%>px; top: <%=iCommon[iPageDirection].iStarty%>px;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iCell Element" style="overflow:hidden;position:absolute;left: 0px; top:0px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;overflow:hidden;<%=iDetail.iStyle%>">',"		</div>","</div>"].join(""),TabBar:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iTabBar Element" style="overflow:hidden;position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;overflow:hidden;<%=iDetail.iStyle%>">',"</div>","</div>"].join(""),WebContent:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="i<%=iType%> nanoscrollbar Element iMouseWheel disableMouseWheelY disableMouseWheelX disableDragX disableDragY" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;-webkit-overflow-scrolling:touch;overflow:auto;<%=iDetail.iStyle%>">','<iframe style="position:absolute;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;min-height:<%=iCommon[iPageDirection].iHeight%>px;height:100%;border:none;overflow:visible;"></iframe>',"</div>","</div>"].join(""),Slide:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iSlide Element" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;">','<div class="slidecontent overflowhidden" style="position:absolute;width:100%;height:100%;line-height:<%=iCommon[iPageDirection].iHeight%>px;<%=iDetail.iStyle%>">',"<%if(iDetail.iImg){%>","<%_.each(iDetail.iImg,function(i,index){%>",'<%if(_g.getUrlParameterByName("-playmode")=="1"){%>','<img data-index="<%=index%>" id="<%=preload_id[index]%>" class="Context" style="width:100%;height:100%;position:absolute;margin:auto;display:inline;verticle-align:middle;">',"<%}else{ %>",'<img data-index="<%=index%>" id="<%=preload_id[index]%>" class="Context" style="width:100%;height:100%;position:absolute;margin:auto;display:inline;verticle-align:middle;">',"<%}%>","<%})%>","<%}%>","</div>","</div>","</div>"].join(""),CycleImage:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iCycleImage Element" style="overflow:hidden;position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;">','<div class="slidecontent overflowhidden" style="position:absolute;width:100%;height:100%;line-height:<%=iCommon[iPageDirection].iHeight%>px;<%=iDetail.iStyle%>">',"</div>","</div>","</div>"].join(""),Video:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iVideo Element" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;<%=iDetail.iStyle%>">',"</div>","</div>"].join(""),Audio:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iAudio Element" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;<%=iDetail.iStyle%>">',"</div>","</div>"].join(""),Button:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iButton Element" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;">','<div class="image_wrap el_wrap" style="position:absolute;left:0;top:0;width:100%;height:100%;overflow:hidden;position:absolute;<%=iDetail.iStyle%>">',"<%if(iDetail.iconNormal&&iDetail.iconNormal[0]){%>",'<img class="Context iconNormal" id="<%=preload_id[0]%>" style="width:100%;height:100%;position:absolute;">',"<%}%>","<%if(iDetail.iconActive&&iDetail.iconActive[0]){%>",'<img class="Context iconActive" id="<%=preload_id[1]%>" style="width:100%;height:100%;position:absolute;display:none;">',"<%}%>","</div>","</div>","</div>"].join(""),Map:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iMap nanoscrollbar Element" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;<%=iDetail.iStyle%>">','<iframe style="width: 100%; height: 100%;" src="<%=interaction_view.getMapUrl(iDetail.iText) + "&view=view"%>" frameborder="0" scrolling="no" marginheight="0" marginwidth="0"></iframe>',"</div>","</div>"].join(""),LayerRef:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iLayerRef Element" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;">','<div class="layer-mask" style="position:absolute;width:100%;height:100%;overflow:hidden;<%=iDetail.iStyle%>">',"<%if(iDetail.layer_ids&&iDetail.layer_ids.length>0){%>",'<div class="layer-content" style="position:absolute;width:100%;height:100%;">',"<% _.each(iDetail.layer_ids,function(layerid){ %>","<% if(interaction_view.ilayerlist.get(layerid)){ %>",'<div class="layer-item" data-index="<%=iDetail.layer_ids.indexOf(layerid)%>" data-id="<%=layerid%>" style="position:absolute;opacity:0;width:<%=interaction_view.ilayerlist.get(layerid).toJSON().layer_width%>px;height:<%=interaction_view.ilayerlist.get(layerid).toJSON().layer_height%>px;left:0px;right:0px;">','<div href="" class="layer-bg" style="position:absolute;width:100%;height:100%;text-align:center;line-height:<%=interaction_view.ilayerlist.get(layerid).toJSON().layer_height%>px;background-color:<%=interaction_view.ilayerlist.get(layerid).toJSON().bg_color%>;opacity:<%=interaction_view.ilayerlist.get(layerid).toJSON().bg_opacity%>">','<% if(interaction_view.ilayerlist.get(layerid).get("picture")){ %>','<img src="<%=interaction_view.ilayerlist.get(layerid).get("picture")%>" style="<%=(interaction_view.ilayerlist.get(layerid).toJSON().layer_width>=interaction_view.ilayerlist.get(layerid).toJSON().layer_height)?"width:auto;height:100%;":"width:100%;height:auto;"%>margin:auto">',"<% } %>","</div>","</div>","<% } %>","<% }) %>","</div>","<% } %>","</div>  ","</div>	","</div>"].join(""),ComponentRef:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iLayerRef Element" style="position:absolute;left: 0px; top: 0px;background-color:transparent;width:100%;height:100%;">',"<%if(iDetail.layer_ids&&iDetail.layer_ids.length>0){%>",'<div class="layer-content" style="position:absolute;width:100%;height:100%;">',"<% _.each(iDetail.layer_ids,function(layerid){ %>","<% if(interaction_view.iComponentlist.get(layerid)){ %>","<% var _layer=interaction_view.iComponentlist.get(layerid).toJSON(); %>",'<div class="layer-item" data-index="<%=iDetail.layer_ids.indexOf(layerid)%>" data-id="<%=layerid%>" style="position:absolute;opacity:0;width:100%;height:100%;left:0px;right:0px;">',"</div>","<% } %>","<% }) %>","</div>","<% } %>","</div>","</div>"].join(""),Shape:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<% if (_g.device.svg()){%><div class="iShape nanoscrollbar Element" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;">','<div class="image_wrap el_wrap" style="position:absolute;left:0;top:0;width:100%;height:100%;position:absolute;<%=iDetail.iStyle%>">',"<%=iDetail.iSvg%>","</div>","</div><% }else{ %>",'<div class="iImage Element" style="position:absolute;left: <%=-iCommon[iPageDirection].iWidth/2%>px; top: <%=-iCommon[iPageDirection].iHeight/2%>px;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;<%=iDetail.iStyle%>">','<img draggable="false" class="Context" style="width:100%;height:100%;position:absolute;" src="<%=iDetail.iImg[0].picture%>">  ',"</div><% } %>","</div>"].join(""),DragDrop:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iDragDrop Element" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;">','<div class="image_wrap el_wrap" style="position:absolute;left:0;top:0;width:100%;height:100%;overflow:hidden;position:absolute;<%=iDetail.iStyle%>">',"<%if(iDetail.iconNormal&&iDetail.iconNormal[0]){%>",'<img class="Context iconNormal" id="<%=preload_id[0]%>" style="width:100%;height:100%;position:absolute;">',"<%}%>","<%if(iDetail.iconActive&&iDetail.iconActive[0]){%>",'<img class="Context iconActive" id="<%=preload_id[1]%>" style="width:100%;height:100%;position:absolute;display:none;">',"<%}%>","</div>","</div>","</div>"].join(""),Variable:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iVariable nanoscrollbar Element" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;<%=iDetail.iStyle%>">',"<%=iDetail.initial%>","</div>","</div>"].join(""),Timer:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iTimer nanoscrollbar Element" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;<%=iDetail.iStyle%>">',"<%=iDetail.formatTime%>","</div>","</div>"].join(""),InfoList:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iInfoList Element" style="overflow:hidden;position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;">','<div class="info-content iMouseWheel disableMouseWheelY disableDragY" style="min-width:100%;<%=iDetail.iStyle%>">','<div style="margin-top: -38px;height: 38px;color:#999;">','<div style="text-align: center; font-size: 12px;height:19px;">E<% if (typeof epub360!="undefined"&&epub360.settings&& ["USER_FREE","USER_BASIC"].indexOf(epub360.settings.billing_type) >=0 ){ %>Epub360æŠ€æœ¯æ”¯æŒ<% } %></div>','<div class="pullDown" style="text-align: center;font-size: 12px;">ä¸‹æ‹‰åˆ·æ–°</div>',"</div>",'<div class="lists"></div>','<div class="pullUp" style="display:none;text-align: center;font-size: 12px; color:#999;">ä¸Šæ‹‰åŠ è½½æ›´å¤š</div>',"</div>","</div>","</div>"].join(""),ChartList:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iChartList Element" style="overflow:hidden;position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;">','<div class="info-content iMouseWheel disableMouseWheelY disableDragY" style="min-width:100%;<%=iDetail.iStyle%>">','<div style="margin-top: -38px;height: 38px;color:#999;">','<div style="text-align: center; font-size: 12px;height:19px;"><% if (typeof epub360!="undefined"&&epub360.settings&& ["USER_FREE","USER_BASIC"].indexOf(epub360.settings.billing_type) >=0 ){ %>Epub360æŠ€æœ¯æ”¯æŒ<% } %></div>','<div class="pullDown" style="text-align: center;font-size: 12px;">ä¸‹æ‹‰åˆ·æ–°</div>',"</div>",'<div class="lists"></div>',"</div>","</div>","</div>"].join(""),UserSVG:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iUserSVG Element" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;<%=iDetail.iStyle%>">',"<%=iDetail.iSvg%>","</div>","</div>"].join(""),FormView:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="i<%=iType%> nanoscrollbar Element iMouseWheel disableMouseWheelY disableMouseWheelX disableDragX disableDragY" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;-webkit-overflow-scrolling:touch;overflow:auto;<%=iDetail.iStyle%>">',"<% if(interaction_view.getWebContentSrc(iDetail)&&interaction_view.getWebContentSrc(iDetail).src){%>",'<iframe src="<%=interaction_view.getWebContentSrc(iDetail).src||""%>" style="position:absolute;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;min-height:<%=iCommon[iPageDirection].iHeight%>px;height:100%;border:none;overflow:visible;"></iframe>',"<% } %>","<% if(interaction_view.getWebContentSrc(iDetail)&&interaction_view.getWebContentSrc(iDetail).content){%>",'<iframe style="position:absolute;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;min-height:<%=iCommon[iPageDirection].iHeight%>px;height:100%;border:none;overflow:visible;"></iframe>',"<% } %>","</div>","</div>"].join(""),Avatar:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iAvatar Element" style="visibility: hidden; position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;">',"<%if(iDetail.iconNormal&&iDetail.iconNormal[0]){%>",'	<div class="thumb" style="width:<%=(iCommon[iPageDirection].iWidth-iDetail.borderW)%>px;height:<%=(iCommon[iPageDirection].iHeight-iDetail.borderH)%>px;overflow:hidden;position:absolute;<%=iDetail.iStyle%> background-image:url(<%=iDetail.iconNormal[0].picture%>);"></div>',"<%}%>","</div>","</div>"].join(""),AvatarList:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iAvatarList Element nanoscrollbar" style="visibility: hidden; position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;overflow:hidden;<%=iDetail.iStyle%>">','<div class="info-content iMouseWheel disableMouseWheelY disableDragY">','<div style="margin-top: -38px;height: 38px;color:#999;">','<div style="text-align: center; font-size: 12px;height:19px;">E<% if (typeof epub360!="undefined"&&epub360.settings&& ["USER_FREE","USER_BASIC"].indexOf(epub360.settings.billing_type) >=0 ){ %>Epub360æŠ€æœ¯æ”¯æŒ<% } %></div>','<div class="pullDown" style="text-align: center;font-size: 12px;">ä¸‹æ‹‰åˆ·æ–°</div>',"</div>",'<div class="lists">',"<% for(i=0;i<18;i++){ %>",'	<div class="avatar" style="text-align:center; padding:5px; float:left;">','		<div class="thumb" style="width: 36px; height: 36px; border-radius: 18px; background: #999 url(http://qty83k.creatby.com/materials/origin/9691dee74ea33a01f494c7e085956c8c_origin.jpg) no-repeat 50% 50%;background-size: cover;"></div>','		<div class="title" style="font-size: 12px;width: 100%; overflow: hidden; word-wrap: normal;">Jason</div>',"	</div>","<% } %>","</div>",'<div class="pullUp" style="display:none;text-align: center;font-size: 12px; color:#999;">ä¸Šæ‹‰åŠ è½½æ›´å¤š</div>',"</div>",'<% if(!interaction_view.forpreview){ %><div class="info-template" style="opacity: 0;">','	<div class="avatar" style="text-align:center; padding:5px; float:left;">','		<div class="thumb" style="width: 36px; height: 36px; border-radius: 18px; background: #999 url(http://qty83k.creatby.com/materials/origin/9691dee74ea33a01f494c7e085956c8c_origin.jpg) no-repeat 50% 50%;background-size: cover;"></div>','		<div class="title" style="font-size: 12px;width: 100%; overflow: hidden; word-wrap: normal;">Jason</div>',"	</div>","</div><% } %>","</div>","</div>"].join(""),Plugin:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="i<%=iType%> nanoscrollbar Element" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;background-color:transparent;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;-webkit-overflow-scrolling:touch;overflow:auto;">',"</div>","</div>"].join(""),Container:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="Element" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;">','<div class="el_wrap bk_full" style="position:absolute;left:0;top:0;width:100%;height:100%;position:absolute;overflow: hidden;<%=iDetail.iStyle%>">',"</div>","</div>","</div>"].join("")};
_eT.TextButton=_eT.Paragraph,_eT.BookButton=_eT.TextLabel,_eT.Vote=_eT.SelectButton=_eT.SubmitButton=_eT.WeixinCamera=_eT.WeixinVoice=_eT.Button,_eT.LayerSlide=_eT.LayerRef,_eT.InitButton=_eT.Button,_eT.QQVideo=_eT.Video,_eT.others=['<div class="iView dynamic hide empty_view <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px;">',"</div>"].join(""),window.funcT={};for(i in _eT){var key=i,value=_eT[i];funcT["_"+key]=_.template(value)}define("interaction_view/template/t_for_v2",function(){}),define("interaction_view/model/base",["jquery","backbone","text!interaction_view/template/message.js","text!interaction_view/template/slidenumber.js","text!interaction_view/template/imgpreview.js","interaction_view/view/subcontainer","interaction_view/template/t_for_v2"],function(){var e=(require("text!interaction_view/template/message.js"),require("text!interaction_view/template/slidenumber.js")),t=require("text!interaction_view/template/imgpreview.js");window.interaction_view={model:{Base:Backbone.Model.extend({defaults:{iType:"iBasetype",iCommon:null,iDetail:null,iPage:null,iParentModel:null,template:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,callback:null},initialize:function(){this.id?(this.setcollection(),this.setmodel()):(this.set("id","e_"+this.cid),this.setcollection(),this.setmodel())},savemodel:function(){},setmodel:function(){this.onInitialize&&this.onInitialize(),this.page=interaction_view.ipagelist.getPage(this.get("pageid"))||interaction_view.imasterlist.get(this.get("pageid"))||interaction_view.ibackgroundlist.get(this.get("pageid")),this.setlist(),this.setview(),this.setsyncmodel()},createPath:function(){var e=interaction_view.createPath({path:this.get("path"),isSubOverlay:this.get("isSubOverlay"),page_id:this.get("pageid"),model:this});return e},setSubOverlays:function(){var e=this;e.suboverlays=this.getSubOverlays(),e.iOverlaylist=new interaction_view.collection.list,e.iAnimationlist=new interaction_view.collection.Animation,e.iActionlist=new interaction_view.collection.Action,e.ipreloadlist=new interaction_view.collection.Preload,e.subcontainer=e.ipreloadlist.subcontainer=e.iOverlaylist.subcontainer=e.iAnimationlist.subcontainer=e.iActionlist.subcontainer=!0,e.ipreloadlist.path=e.iOverlaylist.path=e.iAnimationlist.path=e.iActionlist.path=this.createPath(),e.ipreloadlist.pagetype=e.iOverlaylist.pagetype=e.iAnimationlist.pagetype=e.iActionlist.pagetype="sub"},getSubOverlays:function(){return this.get("suboverlays")},setlist:function(){},setresourcesmodel:function(){},setsyncmodel:function(){},setcollection:function(){},setview:function(){},url:function(){},sync:function(){}})},collection:{Base:Backbone.Collection.extend({iSync:!1,initialize:function(){this.setonadd(),this.setonremove()},setonadd:function(){},setonremove:function(){},url:"",sync:function(){},parse:function(){},resetViewStatus:function(){this.each(function(e){e.iview.resetStatus()})}}),list:Backbone.Collection.extend({iSync:!0,url:"",setonadd:function(){this.on("add",function(){})},setonremove:function(){},sync:function(e,t,i){"read"==e&&(i.url=context_url+"/overlayinit.json"),Backbone.emulateHTTP=!0,Backbone.emulateJSON=!0,Backbone.sync(e,t,i)},parse:function(){},resetViewStatus:function(){this.each(function(e){e.iview.resetStatus()})},resetBindings:function(){this.each(function(e){"Binding"==e.get("iType")&&e.iview.resetBindingStatus()})}})},view:{Base:Backbone.View.extend({initialize:function(){_.bindAll(this),this.initstart()},initstart:function(){this.preload(),this.renderDynamicElement(),this.render()},events:{},options:{},change:function(){},bindImageSwitch:function(e,t){if($("body > #imagepreview").find("button.preview-left").on("click",function(){return e.iview.preview_left(t),!1}),$("body > #imagepreview").find("button.preview-right").on("click",function(){return e.iview.preview_right(t),!1}),interaction_view.ismobile){var i=this;$("body > #imagepreview").hammer().on("dragleft",function(e){return i.dragimage="left",e.gesture.preventDefault(),!1}),$("body > #imagepreview").hammer().on("dragright",function(e){return i.dragimage="right",e.gesture.preventDefault(),!1}),$("body > #imagepreview").hammer().on("dragend",function(n){return"right"==i.dragimage&&e.iview.preview_left(t),"left"==i.dragimage&&e.iview.preview_right(t),i.dragimage=null,n.gesture.preventDefault(),!1})}},initPage:function(){var e=this.model.get("pageid");if(this.model.iPageId=e,this.model.set("isMasterOverlay",!1),this.model.set("isBackgroundOverlay",!1),this.model.set("isConfigOverlay",!1),this.pagetype=this.model.get("pagetype"),this.iType=this.model.get("iType"),"LayerRef"==this.pagetype){var t=this.model.get("parentpageid"),i=this.model.get("layerid"),n=interaction_view.getParentpage(t);this.model.page=n.iOverlaylist.get(e).layer[i];var a=n.iOverlaylist.get(e);this.container=a.iview.$el.find(".layer-content").children(".layer-item[data-id="+i+"]"),this.model.iPageId=t,this.model.layer_id=i}else if("master"==this.pagetype)this.container=interaction_view.touchview?$(".reveal"):$('.Presentation[id="'+interaction_view.currentPage+'"]').find(".interaction-view"),this.model.set("isMasterOverlay",!0),this.model.isMasterOverlay=!0;else if("background"==this.pagetype)this.container=interaction_view.touchview?$(".reveal"):$('.Presentation[id="'+interaction_view.currentPage+'"]').find(".interaction-view"),this.model.set("isBackgroundOverlay",!0),this.model.isBackgroundOverlay=!0;else if("config"==this.pagetype)this.container=$(".config_wrap").find(".interaction-view"),this.model.set("isConfigOverlay",!0),this.model.isConfigOverlay=!0,this.model.page=interaction_view.iconfiglist.at(0);else if(this.model.get("isSubOverlay")){this.path=this.model.get("path");var r=interaction_view.getContainerModelByPath(this.path);this.container=r.iview.$el.children(".Element"),this.model.page=interaction_view.getContainerModelByPath(this.path)}else this.container=e?$('.Presentation[id="'+this.model.get("pageid")+'"]').find(".interaction-view"):$(".interaction-view")},renderStaticElement:function(){},renderDynamicElement:function(){this.initPage();var e=this.iType,t=this.model.toJSON();this.detail=t.iDetail,this.zIndex=t.zIndex,this.iSlideNumber=t.iSlideNumber,this.isStatic=t.isStatic;var i=funcT["_"+e]?funcT["_"+e](this.model.toJSON()):funcT._others(t);this.container.append(i),this.setElement(this.container.find('div.iView[id="'+this.model.id+'"]').first()),interaction_view.LOCAL_DEBUG&&(this.$el.find("img").each(function(){this.src&&(this.src=this.src.replace("qn","os"))}),this.$el.find(".el_wrap").each(function(){if($(this).css("background-image")){var e=$(this).css("background-image");$(this).css("background-image",e.replace("qn","os"))}}));var n=this.common=this.getcommon();this.x=n.iStartx+n.iWidth/2,this.y=n.iStarty+n.iHeight/2,this.staticX=n.iStartx,this.staticY=n.iStarty,this.originWidth=n.iWidth,this.originHeight=n.iHeight,this.setSizeAdapt(),this.setScreenAdapt(),this.isStatic||-1==this.$el[0].className.indexOf("empty_view")&&interaction_view.setPos(this.$el[0],{x:this.x,y:this.y}),"master"==this.pagetype&&this.$el.addClass("master masterhide"),"background"==this.pagetype&&this.$el.addClass("background"),("CycleImage"==e||"Slide"==e||"Button"==e)&&this.setRatiofixxed(),this.iSlideNumber&&this.renderSlideNumber()},setSizeAdapt:function(){if(!("undefined"!=typeof Reveal&&Reveal.adapt||this.detail.isConfigOverlay))return!1;var e=this.detail||{};if(e.iSizeAdapt&&_.isObject(e.iSizeAdapt_data)&&_.keys(e.iSizeAdapt_data).length){var t=!1,i=null;if(e.iScreenAdapt&&(t=!0),e.iSizeAdapt&&(e.iScreenAdapt=!0,this.model.set("iDetail",e,{silent:!0})),t)switch(e.iScreenAdapt_data){case 1:e.iSizeAdapt_data.left=!0,e.iSizeAdapt_data.top=!0;break;case 2:e.iSizeAdapt_data.top=!0;break;case 3:e.iSizeAdapt_data.top=!0,e.iSizeAdapt_data.right=!0;break;case 4:e.iSizeAdapt_data.left=!0;break;case 5:break;case 6:e.iSizeAdapt_data.right=!0;break;case 7:e.iSizeAdapt_data.left=!0,e.iSizeAdapt_data.bottom=!0;break;case 8:e.iSizeAdapt_data.bottom=!0;break;case 9:e.iSizeAdapt_data.bottom=!0,e.iSizeAdapt_data.right=!0}e.iSizeAdapt_data.left&&e.iSizeAdapt_data.right&&e.iSizeAdapt_data.top&&e.iSizeAdapt_data.bottom?i=12:e.iSizeAdapt_data.top&&e.iSizeAdapt_data.bottom&&e.iSizeAdapt_data.left?i=15:e.iSizeAdapt_data.top&&e.iSizeAdapt_data.bottom&&e.iSizeAdapt_data.right?i=16:e.iSizeAdapt_data.bottom&&e.iSizeAdapt_data.right&&e.iSizeAdapt_data.left?i=13:e.iSizeAdapt_data.top&&e.iSizeAdapt_data.right&&e.iSizeAdapt_data.left?i=14:e.iSizeAdapt_data.left&&e.iSizeAdapt_data.right?i=10:e.iSizeAdapt_data.top&&e.iSizeAdapt_data.bottom?i=11:(e.iSizeAdapt_data.top&&(i=17),e.iSizeAdapt_data.left&&(i=20),e.iSizeAdapt_data.right&&(i=18),e.iSizeAdapt_data.bottom&&(i=19)),i&&(e.iScreenAdapt_data=i,this.model.set("iDetail",e,{silent:!0}))}},setScreenAdapt:function(){if(!("undefined"!=typeof Reveal&&Reveal.adapt||this.detail.isConfigOverlay))return!1;var e=this.detail||{};if(!this.model.isMasterOverlay&&!this.model.isBackgroundOverlay&&!e.iScreenAdapt)return!1;if(this.model.isMasterOverlay||this.model.isBackgroundOverlay?(this.$el.addClass("fixed"),this.model.get("isStatic")||this.$el.css({left:0,top:0})):this.model.get("isStatic")||this.$el.css({left:0,top:0}),e.iScreenAdapt){var t=e.iScreenAdapt_data;1!=t&&interaction_view.adapt.elements.push({model:this.model,view:this,type:interaction_view.getPageType2(this.model),adapt:t}),interaction_view.adapt.adjustElement({model:this.model,view:this,type:interaction_view.getPageType2(this.model),adapt:t})}else t=e.iScreenAdapt?e.iScreenAdapt_data:null,interaction_view.adapt.elements.push({model:this.model,view:this,type:interaction_view.getPageType2(this.model),adapt:t}),interaction_view.adapt.adjustElement({model:this.model,view:this,type:interaction_view.getPageType2(this.model),adapt:t});interaction_view.adapt.excute({view:this,adapt:t,type:interaction_view.getPageType2(this.model),model:this.model})},renderSlideNumber:function(){if(this.model.get("iSlideNumber")){{this.getdetail()}if(this.$el.parent().find('nav.slidenumber[data-id="'+this.model.id+'"]').remove(),this.getSlideLength()>1){var t=this.model.toJSON();t.slidelength=this.getSlideLength(),this.$el.parent().append(_.template(e,t)),this.hasSlideNumber=!0,this.setSlideNumberPosition()}}},renderBackGroud:function(){var e=this.getdetail(),t=e.bg_color,i=void 0!=e.bg_opacity?Number(e.bg_opacity):1;if(t){var n=_g.number.hexToRgb(t);t="rgba("+n.r+","+n.g+","+n.b+","+i+")"}else t="transparent";this.$el.children(".Element").css({background:t})},setSlideNumberPosition:function(){this.$el.parent().find('nav.slidenumber[data-id="'+this.model.id+'"]').each(function(){var e=$(this).actual?$(this).actual("outerWidth",{includeMargin:!0}):$(this).width(),t=$(this).actual?$(this).actual("outerHeight",{includeMargin:!0}):$(this).height();$(this).css({left:$(this).attr("data-x")-e/2,top:$(this).attr("data-y")-t/2})})},setSlideNumberDisplay:function(){this.getSlideLength()>1&&(this.$el.children(".Element").is(":hidden")?this.$el.parent().find('nav.slidenumber[data-id="'+this.model.id+'"]').hide():this.$el.parent().find('nav.slidenumber[data-id="'+this.model.id+'"]').show())},setFullView:function(e){var i=this;$("body").children("#imagepreview").remove(),$("body").append('<div id="imagepreview" style="z-index:10000;width:100%;height:100%;position:absolute;left:0;top:0;background:#000;"><button type="button" class="close" style="display:block;position: absolute; top: 10px; right: 10px; z-index: 9999; width: 32px; height: 32px; line-height: 32px; margin: 0; padding: 0; font-size: 32px; color: #ddd; box-shadow: 0; text-shadow: 0 1px 0 white; text-align: center; filter: alpha(opacity=100); -khtml-opacity: 1; opacity: 1;">Ã—</button><img src="'+e.picture+'"</div>'),i.isFullSwitch()&&($("body > #imagepreview").append(t),i.bindImageSwitch(e.model,e.index)),_g.ui.fitImage({fit:1,items:"#imagepreview > img",width:e.width,height:e.height}),$("#imagepreview").on("click",function(){$(this).remove()}).css("line-height","initial"),$("#imagepreview button.close").on("click",function(){$(this).remove()})},fullviewIndex:function(e){var t=this,i=this.getdetail();if("undefined"!=typeof wx_permissions&&wx_permissions.previewImage)wx.previewImage({current:i.iImg[e].picture,urls:_.map(i.iImg,function(e){return e.picture})});else{var n={picture:i.iImg[e].picture,width:i.iImg[e].width,height:i.iImg[e].height,model:t.model,index:e};t.setFullView(n)}},preload:function(){},afterpreload:function(){this.setZindex(),this.setElementDisplay(),this.model.get("iSlideNumber")&&this.setSlideNumberDisplay(),this.setOtherDisplay(),this.copyelstyle=this.$el.attr("style"),this.copyelementstyle=this.$el.children(".Element").attr("style"),this.preloaded=!0},setSlideImageDisplay:function(){var e=this,t=this.getdetail();if(this.imageDisplay=t.iDisplay,t.iImg&&0!=t.iImg.length){if(!this.imageDisplay)return!1;var i=this.getcommon();_.each(t.iImg,function(n){_g.ui.fitImage({items:e.$el.find(".slidecontent").children()[t.iImg.indexOf(n)],parentWidth:i.iWidth,parentHeight:i.iHeight,width:n.width,height:n.height,fit:e.imageDisplay,useMargin:!0})})}},setRatiofixxed:function(){var e=this,t=this.getdetail();if(t.ratiofixxed&&t.iImg&&0!=t.iImg.length){var i=this.getcommon();_.each(t.iImg,function(n){var a=_g.ui.centerImage({containment:e.$el.find(".slidecontent"),Item:e.$el.find(".slidecontent").children()[t.iImg.indexOf(n)],parentWidth:i.iWidth,parentHeight:i.iHeight,width:n.width,height:n.height,setParent:!1});a.width<i.iWidth&&(e.$el.find(".slidecontent").children("[data-index="+t.iImg.indexOf(n)+"]").css("margin-left",(i.iWidth-a.width)/2+"px"),e.$el.find(".slidecontent").children("[data-index="+t.iImg.indexOf(n)+"]").css("margin-right",(i.iWidth-a.width)/2+"px")),a.height<i.iHeight&&(e.$el.find(".slidecontent").children("[data-index="+t.iImg.indexOf(n)+"]").css("margin-top",(i.iHeight-a.height)/2+"px"),e.$el.find(".slidecontent").children("[data-index="+t.iImg.indexOf(n)+"]").css("margin-bottom",(i.iHeight-a.height)/2+"px"))})}},setElementDisplay:function(){this.$el.children(".Element").length>0&&interaction_view.setPos(this.$el.children(".Element")[0],{scale:1});var e=this.model.toJSON().iDetail,t=e.iHidden||!1;if("LayerRef"!=this.model.attributes.iType&&this.$el.children(".Element").find(".el_wrap").length&&(this.wrap_el=this.$el.children(".Element").find(".el_wrap").first()),!_.isNaN(Number(e.init_opacity))){var i=Number(e.init_opacity);1>=i&&i>=0&&(this.$el[0].style.opacity=Number(e.init_opacity))}e.init_rotation=Number(e.init_rotation)||Number(e.rotate),_.isNaN(e.init_rotation)&&(e.init_rotation=0);var n=this.wrap_el?this.wrap_el[0]:this.$el.children(".Element")[0];n&&"undefined"!=typeof TweenMax&&interaction_view.transform.update(e,n,!0);var a=this.model.page.iAnimationlist.where({overlay_id:this.model.id}),r=!1;if(a&&a[0]&&a[0].toJSON().iType>=20&&a[0].toJSON().iType<=60)this.$el.addClass("hide");else if(a&&a[0]&&_.include([101,102,103,104,601,701],a[0].toJSON().iType)||r){var o=a&&a[0]&&_.include([101,102,103,104,601,701],a[0].toJSON().iType)?a[0]:r[0],s=-9999,l=-9999;if(o._animation&&o._animation.css&&(s=o._animation.css.x,l=o._animation.css.y),101==o.toJSON().iType){t&&this.$el.addClass("hide");{this.getcommon().iWidth,this.getcommon().iHeight}interaction_view.ismobile||_g.browserSupport({msie:9})?interaction_view.setPos(this.$el[0],{x:s,y:l}):$(this.$el[0]).css("margin",s+"px 0px 0px "+l+"px").removeClass("hide").show()}102==o.toJSON().iType&&(interaction_view.ismobile||_g.browserSupport({msie:9}))&&(t&&this.$el.addClass("hide"),interaction_view.setPos(this.$el.children(".Element")[0],{scale:0})),103==o.toJSON().iType&&(t&&this.$el.addClass("hide"),this.$el[0].style.opacity=0),104==o.toJSON().iType&&this.$el.addClass("hide"),601==o.toJSON().iType&&this.$el.addClass("hide"),701==a[0].toJSON().iType&&(t&&this.$el.addClass("hide"),"undefined"!=typeof TweenMax&&TweenMax.set(this.$el.find("svg").find("rect, circle, ellipse, polyline, path, line, polygon"),{drawSVG:"0%",force3D:interaction_view.force3D}))}else t?this.$el.addClass("hide"):"Video"!=this.model.get("iType")&&this.$el.removeClass("hide");e.init_classname&&this.$el.children(".Element").addClass(e.init_classname),this.hideClass=this.$el.hasClass("hide")},setOtherDisplay:function(){},setZindex:function(){if("Binding"==this.iType||"DragDropGroup"==this.iType)return!1;if("Audio"==this.iType&&!this.detail.iControl)return!1;var e=this.zIndex;"master"==this.pagetype?e+=2e3:"background"!=this.pagetype&&(e+=1e3),this.detail&&this.detail.isConfigOverlay&&(e+=500),this.$el&&this.$el.css("z-index",e),this.iSlideNumber&&this.$el.parent().children('nav.slidenumber[data-id="'+this.model.id+'"]').css("z-index",e)},setMaskSlipable:function(e){var t=this,i=this.getMoveRange();if(i.x&&e.containment.addClass("iMouseWheel disableMouseWheelX disableDragX"),i.y&&e.containment.addClass("iMouseWheel disableMouseWheelY disableDragY"),i.x||i.y){var n=0,a=0;this.scrollview=new _g.scrollview({containment:e.containment,contentel:e.contentel,mask_width:this.$el.children(".Element").width(),mask_height:this.$el.children(".Element").height(),content_width:this.getLayerContentSize().width,content_height:this.getLayerContentSize().height,content_x:e.content_x,content_y:e.content_y,scrollX:i.x>0?!0:!1,scrollY:i.y>0?!0:!1,onScrollStart:function(){n=t.scrollview._getCurrentPosition().x,a=t.scrollview._getCurrentPosition().y,$("section#"+interaction_view.currentPage).children().data("is_scrollPage")&&interaction_view.ipagelist.getPage(interaction_view.currentPage).iview.scrollview.iScroll.disable(),e.onScrollStart&&e.onScrollStart()},onScrolling:function(r){var o,s;if(i.x>0){t.scrollstart=r.controller?!0:!1;var l=r.deltaX-n;(Math.abs(r.deltaX)>i.x+30||r.deltaX>30)&&e.containment.addClass("is_exceededX");var c=Math.abs(r.deltaX)/i.x;t.onBindingChangeTo({type:0,delta:l,deltarate:c,cdirection:0}),o=r.deltaX}if(i.y>0){var d=r.deltaY-a;(Math.abs(r.deltaY)>i.y+30||r.deltaY>30)&&e.containment.addClass("is_exceededY");var c=Math.abs(r.deltaY)/i.y;t.onBindingChangeTo({type:0,delta:d,deltarate:c,cdirection:1}),s=r.deltaY}e.onScrolling&&e.onScrolling(e.containment,r,o,s)},onScrollend:function(){t.scrollstart=!1,e.containment.removeClass("is_exceededY"),e.containment.removeClass("is_exceededX"),$("section#"+interaction_view.currentPage).children().data("is_scrollPage")&&interaction_view.ipagelist.getPage(interaction_view.currentPage).iview.scrollview.iScroll.enable(),e.onScrollEnd&&e.onScrollEnd()}}),this.getdetail().iGravity&&_e.orientation&&_e.orientation.orientationEvents.push({scrollX:i.x>0?!0:!1,scrollY:i.y>0?!0:!1,speed:i.y?i.y/1200:i.x/1200,func:function(e,n){if(interaction_view.currentPage==t.model.iPageId||"background"==t.model.get("pagetype")){if(t.scrollstart)return;if(e&&(t.scrollview.iScroll.x+e>0&&(e=-t.scrollview.iScroll.x),t.scrollview.iScroll.x+e<-i.x&&(e=-t.scrollview.iScroll.x-i.x)),n&&(t.scrollview.iScroll.y+n>0&&(n=-t.scrollview.iScroll.y),t.scrollview.iScroll.y+n<-i.y&&(n=-t.scrollview.iScroll.y-i.y)),i.x>0){var a=Math.abs(t.scrollview.iScroll.x+e)/i.x;t.onBindingChangeTo({type:0,delta:e,deltarate:a,cdirection:0})}if(i.y>0){var a=Math.abs(t.scrollview.iScroll.y+n)/i.y;t.onBindingChangeTo({type:0,delta:n,deltarate:a,cdirection:1})}t.scrollview.iScroll.scrollBy(e,n)}}}),this.$el.addClass("hascontrols")}},getMoveRange:function(){var e=this.getLayerContentSize(),t=e.width,i=e.height,n=this.getcommon();return{x:t-n.iWidth,y:i-n.iHeight}},checkMaskPos:function(e,t){var i=(this.getdetail(),!0),n=this.getLayerContentSize(),a=n.width,r=n.height;return e.left>0&&(e.left=0,i=!1),e.top>0&&(e.top=0,i=!1),Math.abs(e.left)+t.width>a&&(e.left=-(a-t.width),i=!1),Math.abs(e.top)+t.height>r&&(e.top=-(r-t.height),i=!1),i?null:{left:e.left,top:e.top}},render:function(){},renderCentrolPos:function(e){document.getElementById(this.model.id).style.left=e.x-100+"px",document.getElementById(this.model.id).style.top=e.x-100+"px"},destroy:function(){},getAnimations:function(){var e=this.model.page.iAnimationlist.where({overlay_id:this.model.id});return e.length?e:null},getcommon:function(){var e=null;return e=this.model.get("iCommon")[iPageDirection]},getdetail:function(){return this.model.get("iDetail")},resetStatus:function(){this.$el.attr("style",this.copyelstyle),this.$el.children(".Element").attr("style",this.copyelementstyle),this.hideClass?this.$el.addClass("hide"):this.$el.removeClass("hide"),this.model.get("iSlideNumber")&&this.setSlideNumberDisplay(),this.resetOtherStatus&&this.resetOtherStatus()},sendToPreload:function(e){var t=$.extend({},{parentpageid:this.model.get("parentpageid"),overlay_id:this.model.id,elementtype:this.model.get("iType"),pageid:this.model.get("pageid"),pagetype:this.model.get("pagetype"),layerid:this.model.get("layerid")},e),i=new interaction_view.model.Preload(t);return this.preloadmodel=i,i},playTimeline:function(){if(this.autoplay){if(this.timeline){if(this.$el.children(".Element").is(":hidden"))return;this.repeat||this.timeline.time()!=this.timeline.duration()?this.timeline.play(null,!1):this.timeline.play(0,!1)}}else if(this.autoplay=!0,this.useIndex)this._setCanvasLoopSwitch(),this.timeline.play();else{if(this.timeline&&this.timeline.kill(),this.timeline=new TimelineMax({paused:!0,repeat:this.repeat,onComplete:this.setRewind}),this.setTimeline(),this.setSlideDisplayAll(),this.$el.children(".Element").is(":hidden"))return;this.timeline&&this.timeline.play(null,!1)}},pauseTimeline:function(){this.timeline&&this.timeline.pause()},stopTimeline:function(){this.autoplay=!1,this.useIndex?(this.timeline.pause(),this.currentIndex=this._start,this.ctx.clearRect(0,0,this.canvas_width,this.canvas_height),this.drawCanvas(this.img_src[this._start],this._start)):(this.timeline.kill(),this.timeline=new TimelineMax({paused:!0,repeat:this.repeat}),this.setTimeline(),this.timeline.pause(1e-5),this.setSlideElementsDisplay&&this.setSlideElementsDisplay())},setRewind:function(){if(!this.timeline)return!1;var e=this,t=this.getdetail(),i=this.delay,n=function(){setTimeout(function(){e.useIndex?(e.timeline.pause(),e.currentIndex=e._start,e.drawCanvas(e.img_src[e.currentIndex],e.currentIndex)):(e.timeline.pause(1e-5),e.currentIndex=0)},1e3*i)},a=t.iRepeat?-1:0,r=t.iRewind;return this.model.onAnimationStart&&(interaction_view.events.onAnimationEnd(this.model.onAnimationStart),this.model.onAnimationStart=null),a||!r?null:void n()},_setCanvasLoopSwitch:function(e){var t=this,i=this.delay,n=this.getdetail();this.autoplay||(i=2);var a=this._start;return!this.direction&&this.currentIndex>this._start&&this.currentIndex<this._end?a=this.currentIndex:this.direction&&this.currentIndex<this._start&&this.currentIndex>this._end&&(a=this.currentIndex),e&&this.timeline&&(this.timeline.kill(),this.timeline=null),this.timeline=interaction_view.createLoop({delay:i,paused:!0,repeat:this.repeat,onComplete:this.setRewind,duration:this.repeat?this.slidelength*i:(this.slidelength+1)*i,callback:function(){var e=n.iImg[a].picture;return t.drawCanvas(e,a),t.onTimelineUpdate(a),t.onChangeSlideTo(a),a!=t._end||t.repeat?void(a=t.direction?a-1>=t._end?a-1:t._start:a+1<=t._end?a+1:t._start):(t.timeline.pause(),void t.setRewind())},time:function(){}}),a},setNone:function(){var e=this,t=0,n=this.delay;for(this.autoplay||(n=.5),i=0;i<this.slidelength;i++){if(i==this.slidelength-1&&!this.repeat)return;var a=this.slideel.children('[data-index="'+i+'"]');this.timeline.add(TweenMax.to(a,1e-5,{css:{opacity:1}}),t),this.timeline.add(TweenMax.to(a,1e-5,{css:{opacity:0},onUpdateParams:[i+1<this.slidelength?i+1:0],onUpdate:this.onTimelineUpdate}),t+1e-5+n);var r=this.slideel.children('[data-index="'+(i+1<this.slidelength?i+1:0)+'"]');this.timeline.add(TweenMax.to(r,1e-5,{css:{opacity:0}}),t),this.timeline.add(TweenMax.to(r,1e-5,{css:{opacity:1},onCompleteParams:[i+1<this.slidelength?i+1:0],onComplete:e.onChangeSlideTo}),t+1e-5+n),i==this.slidelength-1&&this.timeline.add(TweenMax.to(a,1e-5,{css:{opacity:0}}),t+1e-5+n),t+=n+2e-5}},setFade:function(){var e,t,n=this,a=0,r=this.delay;for(this.autoplay||(r=0),i=0;i<this.slidelength;i++)if(0==i&&(e=this.slideel.children('[data-index="'+i+'"]'),this.timeline.add(TweenMax.to(e,0,{css:{opacity:1},onCompleteParams:[0],onComplete:n.onChangeSlideTo}),a),a+=r),i==this.slidelength-1){if(!this.repeat)break;e=this.slideel.children('[data-index="'+i+'"]'),this.timeline.add(TweenMax.to(e,1e-5,{css:{opacity:1}}),a),this.timeline.add(TweenMax.fromTo(e,.5,{opacity:1},{opacity:0,onUpdateParams:[i+1<this.slidelength?i+1:0],onUpdate:this.onTimelineUpdate,ease:"Linear.easeNone",immediateRender:!1}),a+1e-5),this.timeline.add(TweenMax.to(e,1e-5,{css:{opacity:0}}),a+.50001),t=this.slideel.children('[data-index="'+(i+1<this.slidelength?i+1:0)+'"]'),this.timeline.add(TweenMax.to(t,1e-5,{css:{opacity:1}}),a),this.timeline.add(TweenMax.fromTo(t,.5,{opacity:1},{opacity:1,ease:"Linear.easeNone",immediateRender:!1}),a+1e-5),this.timeline.add(TweenMax.to(t,1e-5,{css:{opacity:1},onCompleteParams:[i+1<this.slidelength?i+1:0],onComplete:n.onChangeSlideTo}),a+.50001),a+=r+.50002}else e=this.slideel.children('[data-index="'+i+'"]'),this.timeline.add(TweenMax.to(e,1e-5,{css:{opacity:1}}),a),this.timeline.add(TweenMax.fromTo(e,.5,{opacity:1},{opacity:1,onUpdateParams:[i+1<this.slidelength?i+1:0],onUpdate:this.onTimelineUpdate,ease:"Linear.easeNone",immediateRender:!1}),a+1e-5),this.timeline.add(TweenMax.to(e,1e-5,{css:{opacity:0}}),a+.50001),t=this.slideel.children('[data-index="'+(i+1<this.slidelength?i+1:0)+'"]'),this.timeline.add(TweenMax.to(t,1e-5,{css:{opacity:0}}),a),this.timeline.add(TweenMax.fromTo(t,.5,{opacity:0},{opacity:1,ease:"Linear.easeNone",immediateRender:!1}),a+1e-5),this.timeline.add(TweenMax.to(t,1e-5,{css:{opacity:1},onCompleteParams:[i+1<this.slidelength?i+1:0],onComplete:n.onChangeSlideTo}),a+.50001),a+=r+.50002},setSlip:function(){var e,t,n=this,a=0,r=this.delay;for(this.autoplay||(r=0),i=0;i<this.slidelength&&(i!=this.slidelength-1||this.repeat);i++){var o=this.getParamsForSlide(i).param,s=this.getParamsForSlide(i+1<this.slidelength?i+1:0).param1;o.onUpdateParams=[i+1<this.slidelength?i+1:0],o.onUpdate=this.onTimelineUpdate,o.immediateRender=!1,s.immediateRender=!1;var l=_g.number.decimal(a,5);0==i&&(e=this.slideel.children('[data-index="'+i+'"]'),this.timeline.add(TweenMax.to(e,0,{css:{opacity:1},immediateRender:!1,onCompleteParams:[0],onComplete:n.onChangeSlideTo}),l),a+=r);var l=_g.number.decimal(a,5),c=_g.number.decimal(a+1e-5,5),d=_g.number.decimal(a+.50001,5);e=this.slideel.children('[data-index="'+i+'"]'),this.timeline.add(TweenMax.to(e,1e-5,{css:{opacity:1}}),l),this.timeline.add(TweenMax.fromTo(e,.5,{css:{left:"0%",top:"0%",ease:"Linear.easeNone"},immediateRender:!1},_.clone(o)),c),this.timeline.add(TweenMax.to(e,1e-5,{css:{opacity:0}}),d),t=this.slideel.children('[data-index="'+(i+1<this.slidelength?i+1:0)+'"]'),this.timeline.add(TweenMax.to(t,1e-5,{css:{opacity:1}}),l),this.timeline.add(TweenMax.fromTo(t,.5,_.clone(s),{top:"0%",left:"0%",ease:"Linear.easeNone",immediateRender:!1}),c),this.timeline.add(TweenMax.to(t,1e-5,{css:{opacity:1},onCompleteParams:[i+1<this.slidelength?i+1:0,i],onComplete:n.onChangeSlideTo}),d),i==this.slidelength-1&&this.timeline.add(TweenMax.to(e,1e-5,{css:{opacity:0}}),d),a+=r+.50002}},setFlip:function(){var e,t,n,a=this,r=0,o=this.delay,s=this.getdetail(),l=s.iSlidetype?s.iSlidetype:0,c=180;for("æ¨ªå‘"==l||0==Number(l)?(l=0,n={rotationY:0},TweenLite.set(this.slideel,{rotationY:0})):(l=1,n={rotationX:0},TweenLite.set(this.slideel,{rotationX:0})),this.autoplay||(o=0),TweenLite.set(this.$el.children(".Element"),{perspective:800}),TweenLite.set(this.slideel,{transformStyle:"preserve-3d"}),TweenLite.set(this.slideel.children(),{backfaceVisibility:"hidden"}),i=0;i<this.slidelength&&(i!=this.slidelength-1||this.repeat);i++){n.onUpdateParams=[i+1<this.slidelength?i+1:0],n.onUpdate=this.onTimelineUpdate,l?n.rotationX="+=180cw":n.rotationY="-=180cw",0==i&&(e=this.slideel.children('[data-index="'+i+'"]'),l?this.timeline.add(TweenMax.to(e,0,{rotationX:180==c?0:180,opacity:1,onCompleteParams:[0],onComplete:a.onChangeSlideTo}),r):this.timeline.add(TweenMax.to(e,0,{rotationY:180==c?0:180,opacity:1,onCompleteParams:[0],onComplete:a.onChangeSlideTo}),r),r+=o);var d=_g.number.decimal(r,5),h=_g.number.decimal(r+1e-5,5),u=_g.number.decimal(r+.50001,5);e=this.slideel.children('[data-index="'+i+'"]'),t=this.slideel.children('[data-index="'+(i+1<this.slidelength?i+1:0)+'"]'),l?this.timeline.add(TweenMax.to(e,1e-5,{rotationX:180==c?0:180,opacity:1}),d):this.timeline.add(TweenMax.to(e,1e-5,{rotationY:180==c?0:180,opacity:1}),d),this.timeline.add(TweenMax.to(this.slideel,.5,_.clone(n)),h),this.timeline.add(TweenMax.to(e,1e-5,{css:{opacity:0}}),u),l?this.timeline.add(TweenMax.to(t,1e-5,{css:{rotationX:c,opacity:1}}),d):this.timeline.add(TweenMax.to(t,1e-5,{css:{rotationY:c,opacity:1}}),d),this.timeline.add(TweenMax.to(t,1e-5,{onCompleteParams:[i+1<this.slidelength?i+1:0],onComplete:a.onChangeSlideTo}),u),i==this.slidelength-1&&this.timeline.add(TweenMax.to(e,1e-5,{css:{opacity:0}}),u),r+=o+.50002,c=180==c?0:180}},setFlow:function(){function e(e){t.onTimelineUpdate(e),t.setElementTo(e),!t.getdetail().iRepeat&&t.getdetail().iRewind&&e>=t.slidelength-1&&TweenMax.to(t.slideel.find('[data-index="'+e+'"]'),.3,{opacity:1,onComplete:function(){t.CoverFlow.coverflow("select",0)}})}var t=this,n=0,a=this.delay;for(this.autoplay||(a=0),i=0;i<this.slidelength&&(i!=this.slidelength-1||this.repeat);i++){0==i&&(n+=a);var r=this.slideel.find('[data-index="'+i+'"]');this.timeline.add(TweenMax.to(r,.3,{opacity:1,onUpdateParams:[i+1<t.slidelength?i+1:0],onUpdate:e}),n),n+=a+.3}},onBindingChangeTo:function(e){interaction_view.events.onBingChangeTo({type:e.type,page_id:this.model.page.id?this.model.page.id:this.model.get("layerid"),id:this.model.id,delta:e.delta,deltarate:e.deltarate,cdirection:e.cdirection})},onTimelineUpdate:function(){var e=this.timeline.time();interaction_view.events.onBingChangeTo({type:0,page_id:this.model.page.id?this.model.page.id:this.model.get("layerid"),id:this.model.id,delta:-1,deltarate:e/this.timeline.duration(),cdirection:null})},onChangeSlideTo:function(e){this.currentIndex=e,this.model.trigger("slideTo",e),this.model.get("iSlideNumber")&&this.changeSlideNumber()},changeSlideNumber:function(){var e=this.$el.parent().children('nav.slidenumber[data-id="'+this.model.id+'"]').children(":nth-child("+(this.currentIndex+1)+")");e.each(function(){$(this).addClass("active").siblings().removeClass("active")})},onExecuteBinding:function(e){if("LayerRef"==this.model.get("iType"))return void this.onExecuteBindingForLayerRef(e);var t=this;if(this.slideel&&this.slidelength>1&&this.timeline){var i=this.timeline.duration();if(singletime=this.repeat?i/this.slidelength:i/(this.slidelength-1),0==e.type){t.useIndex||t.setSlideDisplayAll(),a=e.deltarate*i;var n=parseInt(a/singletime,10);t.slideChangePatch(e.delta,n),t.onChangeSlideTo(n),t.useIndex?(t.indexTime=a,t.drawCanvas(t.img_src[n],n),t.autoplay&&(t.autoplay=!1,t.timeline.pause(a))):t.timeline.seek(a)}else{if(t.useIndex)var a=t.indexTime;else var a=t.timeline.time();console.log("stop at delta"+e.delta),"CycleImage"!=t.model.get("iType")&&(a/singletime-parseInt(a/singletime,10)<.2?(a=parseInt(a/singletime,10)*singletime,n=parseInt(a/singletime,10)):a/singletime-parseInt(a/singletime,10)>.8?(a=(parseInt(a/singletime,10)+1)*singletime,n=parseInt(a/singletime,10)):(a=parseInt(a/singletime,10)*singletime,n=parseInt(a/singletime,10),e.delta<0&&i>a&&(a+=singletime,n=parseInt(a/singletime,10)))),console.log(a),(0==a||1e-5==a)&&(a=1e-5,e.reset&&e.revert&&(a=t.repeat?1e-5:t.timeline.duration(),n=parseInt(a/singletime,10))),n>t.slidelength-1&&(n=0),t.useIndex?(t.indexTime=a,void 0!=n&&t.drawCanvas(t.img_src[n],n)):t.timeline.seek(a),t.useIndex||t.setSlideDisplay(n),t.onChangeSlideTo(n)}}},setSlideDisplay:function(e,t){this.autoplay||(this.slideel.children('[data-index="'+e+'"]').css({display:"block",opacity:1}),t&&this.slideel.children('[data-index="'+e+'"]').css("opacity",1),"LayerSlide"==this.model.get("iType")&&(this.onShow(e),this.onBeforeHide(e)),this.slideel.children('[data-index="'+e+'"]').siblings().hide(),t&&this.slideel.children('[data-index="'+e+'"]').siblings().css("opacity",0),"LayerSlide"==this.model.get("iType")&&this.onHide(e))
},setSlideDisplayAll:function(){this.slideel.children().css("display","block")},setElementTo:function(e){var t=this,i=this.getdetail();if("Flow"==i.iFade){var n=t.CoverFlow.children(".ui-state-active").index(),a=i.iImg.length-1;return"prev"==e?e=0>=n?a:n-1:"next"==e?e=n>=a?0:n+1:"first"==e?e=0:"last"==e&&(e=a),0>e&&(e=0),e>a&&(e=a),void t.CoverFlow.coverflow("select",e)}if(_.include(["first","last","prev","next"],e));else{if(0/0==Number(e)||this.currentIndex==Number(e))return;e=Number(e)}var r,o=i.iRepeat,s=!1,l=null;if(this.slidelength&&!(e>=this.slidelength)){var c=_g.number.decimal(this.timeline.duration(),5);if(r=o?_g.number.decimal(c/this.slidelength,5):_g.number.decimal(c/(this.slidelength-1),5),"first"==e)l=1e-5;else if("last"==e)l=(this.slidelength-1)*r;else if("prev"==e){s=!0;var d=!0;if(!o&&0==this.currentIndex)return!1;var h=0==this.currentIndex?this.slidelength-1:this.currentIndex-1;l=h*r,1e-5==l&&(l=0)}else if("next"==e){s=!0;var u=!0;if(!o&&this.currentIndex==this.slidelength-1)return!1;var h=this.currentIndex==this.slidelength-1?0:this.currentIndex+1;l=h*r,1e-5==l&&(l=0)}else{if(!(Number(e)>=0&&Number(e)<this.slidelength))return!1;l=r*parseInt(e,10)+1e-5}if(console.log(l),0==l&&(l=1e-5),e=parseInt(l/r,10),e>this.slidelength-1&&(e=0),"None"!=this.iFade&&"LoopSwitch"!=this.iFade&&s){if(t.setSlideDisplayAll(),u)var p=1e-5==l?c:l;if(d){var v=_g.number.decimal(t.timeline.time(),5);(0==v||1e-5==v)&&t.timeline.seek(c);var p=l}this.timeline.tweenTo(p,{onComplete:function(){u&&1e-5==l&&t.timeline.seek(1e-5),console.log("stop at "+t.timeline.time()),t.setSlideDisplay(e),t.onChangeSlideTo(e),t.onBindingChangeTo({type:1,delta:0})}})}else{t.useIndex?(t.indexTime=l,t.drawCanvas(t.img_src[e],e),t.autoplay&&(t.autoplay=!1,t.timeline.pause(l))):t.timeline.seek(l,!1);{Math.abs(this.timeline.time()/this.timeline.duration())}t.useIndex||this.setSlideDisplay(e),this.onChangeSlideTo(e),this.onBindingChangeTo({type:1,delta:0})}}},slideChangePatch:function(e,t){var n=this;if(e>0)for(i=n.currentIndex;i>t;i--)0>i&&(i=n.slidelength-1),i!=n.currentIndex&&n.onChangeSlideTo(i);if(0>e)for(i=n.currentIndex;t>i;i++)i>n.slidelength-1&&(i=0),i!=n.currentIndex&&n.onChangeSlideTo(i)},addControlClass:function(){var e=this.getdetail(),t=e.iSlidetype?e.iSlidetype:0;this.$el.children(".Element").addClass("iMouseWheel"),this.$el.children(".Element").addClass("æ¨ªå‘"==t||0==Number(t)?"enableMouseWheelX disableDragX":"enableMouseWheelY disableDragY")},removeControlClass:function(){this.$el.children(".Element").removeClass("iMouseWheel").removeClass("enableMouseWheelX disableDragX").removeClass("enableMouseWheelY disableDragY")},control:function(){if(this.controled)return void(this.canSlip?this.addControlClass():this.removeControlClass());var e=(_g.touch.support,"touchstart"),t="touchmove",i="touchend";eCancel="touchcancel";var n,a=this,r=this.getdetail(),o=0,s=0;this.indexTime=0;var l,c=0,d=0,h=0,u=0,p=!1,v=!1,g=null,f=null,m=null,_=this.$el.children(".Element").width(),w=r.iSlidetype?r.iSlidetype:0,y=this.timeline.duration(),b="æ¨ªå‘"==w||0==Number(w)?0:1;n=this.singletime=this.repeat?y/this.slidelength:y/(this.slidelength-1);var x=this.repeat,S=function(){("Slide"!=a.model.get("iType")||a.canSlip)&&(l=0,u=0,a.autoplay&&(a.indexTime=a.timeline.time()),o=a.useIndex?a.indexTime:a.timeline.time(),p=!0,m=a.slideel.children(":visible").first().index(),console.log("control start"))},T=function(e,t,i){if("Slide"!=a.model.get("iType")||a.canSlip){a.useIndex||a.setSlideDisplayAll(),e>y&&(x?e-=y:(u+=1,u>5&&a.model.get("iSlideNumber")&&a.$el.children(".Element").addClass(0==b?"is_exceededX":"is_exceededY"),e=y)),0>e&&(x?e=y+e:(u+=1,console.log(y-e),u>5&&a.model.get("iSlideNumber")&&a.$el.children(".Element").addClass(0==b?"is_exceededX":"is_exceededY"),e=1e-5));var r=e/y;if(a.onBindingChangeTo({type:0,delta:t,deltarate:r,cdirection:b}),"CycleImage"==a.model.get("iType")){var s=parseInt(e/n);if(s>a.slidelength-1&&(s=0),s==a.currentIndex)return e;i||a.slideChangePatch(t,s),a.onChangeSlideTo(s)}return console.log(e),a.useIndex?(a.indexTime=e,a.drawCanvas(a.img_src[s],s),a.autoplay&&(a.autoplay=!1,a.timeline.pause(o))):a.timeline.seek(e),e}},k=function(e){if(("Slide"!=a.model.get("iType")||a.canSlip)&&"CycleImage"!=a.model.get("iType")){var t;o=a.useIndex?a.indexTime:a.timeline.time(),"CycleImage"!=a.model.get("iType")?(1e-5==o&&(o=0),o/n-parseInt(o/n,10)<.2?(o=parseInt(o/n,10)*n,t=parseInt(o/n,10)):o/n-parseInt(o/n,10)>.8?(o=(parseInt(o/n,10)+1)*n,t=parseInt(o/n,10)):(o=parseInt(o/n,10)*n,t=parseInt(o/n,10),0>e&&y>o&&(o+=n,t+=1)),o=Math.round(o/n)*n+1e-5):t=parseInt(o/n,10),console.log("final time is"+o),0==o&&(o=1e-5),t>a.slidelength-1&&(t=0),a.useIndex?(a.drawCanvas(a.img_src[t],t),a.onChangeSlideTo(t),a.onBindingChangeTo({type:1,delta:e})):a.timeline.tweenTo(o,{onComplete:function(){a.useIndex||a.setSlideDisplay(t),a.onChangeSlideTo(t),a.onBindingChangeTo({type:1,delta:e})}})}};if(_g.touch.support){var C,P,D;this.$el.children(".Element").on(e,function(e){if(e=e.originalEvent.touches[0],!a.testControl(e.target))return!1;if(!$(this).hasClass("is_exceededX")&&!$(this).hasClass("is_exceededY")){g=c=e.pageX,f=d=e.pageY,C=e.pageX,P=e.pageY,D=!0;var t=e.target;s=0,S(),setTimeout(function(){C!==c||D||P!==d||$(t).trigger("click")},200)}}),this.$el.children(".Element").on(t,function(e){if(e=e.originalEvent.touches[0],$(this).hasClass("is_exceededX")||$(this).hasClass("is_exceededY"))return void(p=!1);if(p&&null!=g){if(l="æ¨ªå‘"==w||0==Number(w)?e.pageX-g:e.pageY-f,h="æ¨ªå‘"==w||0==Number(w)?e.pageX-c:e.pageY-d,moveOppositeDirection="æ¨ªå‘"==w||0==Number(w)?e.pageY-d:e.pageX-c,console.log("direction"+h),console.log("oppsite"+moveOppositeDirection),Math.abs(h)<=2&&Math.abs(moveOppositeDirection)>12){var t="æ¨ªå‘"==w||0==Number(w)?"is_exceededX":"is_exceededY";return void $(this).addClass(t)}if(c=e.pageX,d=e.pageY,0==l)return;return s="CycleImage"==a.model.get("iType")?o-l/_*y:o-l/_*n,T(s,h),!1}}),this.$el.children(".Element").on(i,function(e){return e=e.originalEvent.touches[0],D=!1,p?(0!=l?(k(l),$(Reveal.options.containment).hammer("reset")):(a.setSlideDisplay(m),interaction_view.ismobile&&a.$el.children(".Element").trigger("click"),$(Reveal.options.containment).hammer("reset")),p=!1,console.log("control stop"),$(Reveal.options.containment).hammer().trigger("dragend"),!1):($(this).removeClass("is_exceededX"),$(this).removeClass("is_exceededY"),void(u=0))}),this.$el.children(".Element").on(eCancel,function(e){return e=e.originalEvent.touches[0],p?(0!=l?(k(l),$(Reveal.options.containment).hammer("reset")):a.setSlideDisplay(m),p=!1,console.log("control cancel"),!1):($(this).removeClass("is_exceededX"),$(this).removeClass("is_exceededY"),void(u=0))})}if(this.$el.children(".Element").on("mousedown",function(e){return a.testControl(e.target)?void($(this).hasClass("is_exceededX")||$(this).hasClass("is_exceededY")||(s=0,g=c=e.pageX,f=d=e.pageY,S())):!1}),this.$el.children(".Element").on("mousemove",function(e){if($(this).hasClass("is_exceededX")||$(this).hasClass("is_exceededY"))return void(p=!1);if(p&&null!=g){if(l="æ¨ªå‘"==w||0==Number(w)?e.pageX-g:e.pageY-f,h="æ¨ªå‘"==w||0==Number(w)?e.pageX-c:e.pageY-d,c=e.pageX,d=e.pageY,0==l)return;return s="CycleImage"==a.model.get("iType")?o-l/_*y:o-l/_*n,T(s,h),e.preventDefault(),!1}}),this.$el.children(".Element").on("mouseup",function(e){return p?(0!=l?(k(l),e.preventDefault(),e.stopPropagation(),$(Reveal.options.containment).hammer("reset")):(a.setSlideDisplay(m),$(e.currentTarget).trigger("click"),$(Reveal.options.containment).hammer("reset")),p=!1,console.log("control stop"),!1):($(this).removeClass("is_exceededX"),$(this).removeClass("is_exceededY"),void(u=0))}),this.$el.children(".Element").on("mouseleave",function(e){return p?(0!=l?(k(l),e.preventDefault(),$(Reveal.options.containment).hammer("reset")):a.setSlideDisplay(m),p=!1,console.log("control cancel"),!1):($(this).removeClass("is_exceededX"),$(this).removeClass("is_exceededY"),void(u=0))}),this.$el.children(".Element").on("wheelstart",function(e){$(e.target).is(this)&&(s=0,g=c=0,f=d=0,l=0,o=a.useIndex?a.indexTime:a.timeline.time(),m=a.slideel.children(":visible").first().index(),v=!0,console.log("control start"))}),this.$el.children(".Element").on("wheelmove",function(e,t){if($(e.target).is(this)){if(!v)return!1;var i=_g.mousewheel.getMouseWheel(t),r=i.x,u=i.y;if(void 0!=r||void 0!=u){var p=Math.max(-1,Math.min(1,r)),g=Math.max(-1,Math.min(1,u)),f=30;console.log("before currentX is "+c),c+=p*f,d+=g*f,console.log("after currentX is "+c),console.log("wheelX is"+p),l="æ¨ªå‘"==w||0==Number(w)?p:g,console.log("control moving");var m=1;if(l){h="æ¨ªå‘"==w||0==Number(w)?p:g;var _="æ¨ªå‘"==w||0==Number(w)?c:d;if(_){"CycleImage"==a.model.get("iType")&&(m=a.slidelength>50?a.slidelength/50:1);var b="æ¨ªå‘"==w||0==Number(w)?m*$(this).width():m*$(this).height();_>b&&(_=b),-b>_&&(_=-b),"æ¨ªå‘"==w||0==Number(w)?c=_:d=_,s="CycleImage"==a.model.get("iType")?o-_/b*y:o-_/$(this).width()*n,T(s,h)}}}}}),this.$el.children(".Element").on("wheelend",function(){if(!v)return!1;var e="æ¨ªå‘"==w||0==Number(w)?c:d;k(e),console.log("control end"),c=d=0,v=!1}),"CycleImage"==a.model.get("iType")&&r.iGravity){var E=a.slidelength>50?a.slidelength/50:1;_e.orientation&&_e.orientation.orientationEvents.push({scrollX:"æ¨ªå‘"==w||0==Number(w),scrollY:!("æ¨ªå‘"==w||0==Number(w)),page_id:a.model.iPageId,speed:1,func:function(e,t){if(interaction_view.currentPage==a.model.iPageId){var i=a.$el.children(".Element"),n="æ¨ªå‘"==w||0==Number(w)?e:t;if(!n)return;n=parseInt(n),deltaend=-n;var r="æ¨ªå‘"==w||0==Number(w)?E*i.width():E*i.height();s=o-deltaend/r*y,console.log(s),a.indexTime=o=T(s,n,!0)}}})}this.controled=!0},getParamsForFade:function(){param.opacity=1,param1.opacity=0},getParamsForSlide:function(e){var t=this.getdetail(),i=t.iSlidetype?t.iSlidetype:0,n=this.slideel.children('[data-index="'+e+'"]');_.include(["Slide","Gallery","CycleImage"],this.model.get("iType"))&&(n=this.slideel);var a={ease:"Linear.easeNone"},r={ease:"Linear.easeNone"};return"æ¨ªå‘"==i||0==Number(i)?(a.opacity=1,a.left="-100%",r.left="100%",r.opacity=1):(a.opacity=1,a.top="-"+n.css("height"),r.top=n.css("height"),r.opacity=1),{param:a,param1:r}},getParamsForSlip:function(){return param},getSlideDuration:function(){{var e;this.getdetail()}return 0==this.slidelength?0:e="CycleImage"!=this.model.get("iType")?(this.delay+.50002)*this.slidelength:(this.delay+2e-5)*this.slidelength},onShow:function(){this.model.get("iSlideNumber")&&this.setSlideNumberDisplay(),_.include(["Slide","LayerSlide"],this.model.get("iType"))&&this.autoplay&&this.playTimeline(),_.include(["PageIndex","Gallery","Grid"],this.model.get("iType"))&&this.resetOtherStatus(),this.otherOnShow&&this.otherOnShow()},onBeforeHide:function(){_.include(["Slide","LayerSlide"],this.model.get("iType"))&&this.timeline&&(this.timeline.paused()||this.timeline.pause())},onHide:function(){this.model.get("iSlideNumber")&&this.setSlideNumberDisplay(),this.otherOnHide&&this.otherOnHide()},loadSubOverlay:function(e){var t=require("interaction_view/view/subcontainer");t=_g.mvc.createView(t),this.subview=new t({model:this.model}),this.preloadmodel=e,this.subview.afterload()},clearPreload:function(){this.$el.children(".Element").length&&this.$el.children(".Element").find("img").each(function(){$(this).attr("src","")})}})}},window.iOverlaylist=new interaction_view.collection.Base,interaction_view.iOverlaylist=new interaction_view.collection.list,interaction_view.currentPage=null}),define("interaction_view/model/action",["interaction_view/model/base"],function(){interaction_view.model.Action=interaction_view.model.Base.extend({defaults:{page_id:null,ref_id:null,index:null,layer_id:null,overlay_id:null},setcollection:function(){},setview:function(){if(this.pageid=this.get("pageid"),this.parentpageid=this.get("parentpageid"),this.iPage_id=this.pageid,this.app_id=this.get("app_id"),"LayerRef"==this.get("pagetype")){var e=this.get("parentpageid"),t=this.get("layerid"),i=interaction_view.getParentpage(e);this.parentpage=i,this.page=i.iOverlaylist.get(this.pageid).layer[t],this.iPage_id=e}else this.get("path")?(this.path=this.get("path"),this.page=interaction_view.getContainerModelByPath(this.path)):this.page=interaction_view.getParentpage(this.pageid);this.iview=new interaction_view.view.Action({model:this})},setsyncmodel:function(){},actionpatch:function(){var e=this,t=this.get("iDetail");"LayerRef"==this.get("pagetype")&&(this.get("layer_id")||this.set("layer_id",this.get("layerid"))),5!=t.results[0].iAction&&t.results[0].iAction<7&&(6==t.results[0].iAction&&"string"==typeof t.results[0].values&&(t.results[0].values=[{id:t.results[0].values,page_id:e.pageid}]),t.results[0].values=_.map(t.results[0].values,function(t){return"object"!=typeof t?{id:t,page_id:e.pageid}:t})),this.set("iDetail",t)}}),interaction_view.collection.Action=interaction_view.collection.Base.extend({initialize:function(){this.setonadd(),this.setonremove()},model:interaction_view.model.Action,setonadd:function(){this.on("add",function(){})},onSingleComplete:function(){},onUpdate:function(){},onTotalComplete:function(){},resetStatus:function(){this.each(function(e){e.iview.resetStatus()})}}),interaction_view.view.Action=interaction_view.view.Base.extend({initstart:function(){},renderanimations:function(){this.timeline&&this.timeline.kill()&&this.timeline.clear(!0);var e=this,t=(this.model.toJSON(),this.values);t&&t.length&&(e.timeline=animateTimeline.generateTimeline({onStart:null,ids:t,iPage_id:this.model.iPage_id,page:this.model.page,paused:!0,foraction:!0}),e.timeline&&e.timeline.play(0))},onComplete:function(){},events:{},renderDynamicElement:function(){},getClassification:function(){if(!this.ref_id){if(_.isNumber(this.index)&&this.overlaymodel)return 4;if(this.animation_id)return 5;if(!_.isNumber(this.index)&&this.overlaymodel)return 1;if(!this.overlaymodel){if(this.overlay_id==this.model.page.id)return 2;if(interaction_view.ilayerlist.get(this.overlay_id)||interaction_view.iComponentlist.get(this.overlay_id))return 3}}if(this.ref_id&&"LayerRef"==this.model.get("pagetype")&&this.model.pageid==this.ref_id&&this.model.parentpageid==this.page_id){if(_.isNumber(this.index)&&this.overlaymodel)return 4;if(this.animation_id)return 5;if(!_.isNumber(this.index)&&this.overlaymodel)return 1;if(!this.overlaymodel){if(this.overlay_id==this.model.page.id)return 2;if(interaction_view.ilayerlist.get(this.overlay_id)||interaction_view.iComponentlist.get(this.overlay_id))return 3}}return 0},render:function(e){e||(e={});var t=this.model.toJSON();this.actionCate="ç»„ä»¶",this.app_id=t.app_id,this.iType=t.iType,this.overlay_id=t.overlay_id,this.page_id=t.page_id,this.ref_id=t.ref_id,this.index=t.index,this.animation_id=t.animation_id,this.layer_id=t.layer_id;var i=t.iDetail;if(i&&i.results){var n=this;if(this.actiontype=i.results[0].iAction,this.values=i.results[0].values,this.app_id){this.actionCate="åº”ç”¨",this.renderforapplication();var a=i.results[0].iActionDetail?i.results[0].iActionDetail.actions||[]:[];return void(a&&interaction_view.PluginManage.ActionExecutes[this.actiontype]&&interaction_view.PluginManage.ActionExecutes[n.actiontype].setExecuteActions&&interaction_view.PluginManage.ActionExecutes[n.actiontype].setExecuteActions(n,a,e))}if(120!=this.iType&&150!=this.iType&&151!=this.iType){if(this.overlaymodel=this.model.page?this.model.page.iOverlaylist.get(this.overlay_id):null,99==this.iType)if(this.customType=i.customType,this.customType&&interaction_view.PluginManage.Actions[this.customType]){var r={type:this.customType,view:this,func:function(e,t){n.executeAction(n,e,t)}};interaction_view.PluginManage.Actions[this.customType](r,e)}else this.renderforoverlay(e);else{var o=this.getClassification();if(!o)return;switch(o){case 1:this.renderforoverlay(e);break;case 2:this.actionCate="é¡µé¢",this.renderforpage();break;case 3:this.actionCate="Layer",this.renderforlayer();break;case 4:this.actionCate="å¹»ç¯",this.renderforslideindex();break;case 5:this.actionCate="åŠ¨ç”»",this.renderforanimationaction()}}var a=i.results[0].iActionDetail?i.results[0].iActionDetail.actions||[]:[];if(a&&interaction_view.PluginManage.ActionExecutes[this.actiontype]&&interaction_view.PluginManage.ActionExecutes[n.actiontype].setExecuteActions&&interaction_view.PluginManage.ActionExecutes[n.actiontype].setExecuteActions(n,a,e),this.preloadactions=[],101==this.actiontype&&(this.preloadactions=i.results[0].iActionDetail?i.results[0].iActionDetail.actions||[]:[],this.preloadactions.length&&(this.preload_hash="pre_"+_g.uuid(3),_e.preloadpage.renderActions(this.preloadactions,this.preload_hash))),102==this.actiontype){var s=[],l=this.model.toJSON().id,c=this.page_id;s=i.results[0].iActionDetail?i.results[0].iActionDetail.actions||[]:[];for(var d=0;d<s.length;d++){var h=$.extend(!0,{},s[d]),u=new interaction_view.model.Action(h);u.iview.render(),function(e){var t={userdatasave_hash:c+"_"+l,func:function(t){e.iview.executeAction(e.iview,t)}};interaction_view.events.userdataSaveEvents.push(t)}(u)}}if(82==this.actiontype){var p=[],l=this.model.toJSON().id;p=i.results[0].iActionDetail?i.results[0].iActionDetail.actions||[]:[];for(var d=0;d<p.length;d++){var h=$.extend(!0,{},p[d]),u=new interaction_view.model.Action(h);u.iview.render(),function(e){var t={sharedatasave_hash:l,func:function(t){e.iview.executeAction(e.iview,t)}};interaction_view.events.sharedataSaveEvents.push(t)}(u)}}}}},renderforoverlay:function(){var e=this,t={type:this.iType,page_id:this.page_id,overlay_id:this.overlay_id,layer_id:this.layer_id,func:function(t){e.executeAction(e,t)}};switch(this.layer_id&&(t.iPage_id=this.model.iPage_id),this.iType){case 8:case 9:case 10:case 11:case 12:t.drop_type=this.iType,t.path=this.path,_.include([11,12],this.iType)?(t.type="dragdropgroup",interaction_view.events.dragDropGroupEvents.push(t)):(t.type="dragdrop",interaction_view.events.dragDropEvents.push(t));break;case 18:case 19:case 16:case 17:t.condition=String(this.model.attributes.condition),interaction_view.events.timerEvents.push(t);break;case 22:t.condition=String(this.model.attributes.condition),interaction_view.events.variableEvents.push(t);break;case 23:interaction_view.events.voteEvents.push(t);break;case 54:interaction_view.events.paragraphEvents.push(t);break;case 41:interaction_view.events.eraserEvents.push(t);break;case 71:case 72:interaction_view.events.WeixinCameraEvents.push(t);break;case 73:interaction_view.events.collisionEvents.push(t);break;case 74:case 75:case 76:case 77:case 78:case 79:case 80:case 81:interaction_view.events.userListEvents.push(t);break;case 82:case 83:interaction_view.events.contactFormEvents.push(t);break;case 100:case 101:case 102:case 103:case 104:case 105:case 110:case 111:case 140:case 141:case 130:case 131:interaction_view.events.systemVariableEvents.push(t);break;case 99:break;default:var i="tap",n=this.overlaymodel.iview.$el;if(20==this.iType?i="mouseenter":21==this.iType?i="mouseleave":(14==this.iType||15==this.iType)&&(i="hold"),this.overlaymodel.iview.$el.css("cursor","pointer"),this.overlaymodel.iview.$el.addClass("hasaction"),_.include(["Slide","LayerSlide","CycleImage","Vote"],this.overlaymodel.iview.iType)&&(n=n.children(".Element")),_.include(["Button"],this.overlaymodel.iview.iType)&&console.log("button"),1==this.iType&&(n=this.overlaymodel.iview.$el.find("img.iconNormal")),2==this.iType&&(n=this.overlaymodel.iview.$el.find("img.iconActive")),this.model.attributes.iDetail.dom_id)return void n.hammer().on(i,"[es-id="+this.model.attributes.iDetail.dom_id+"]",function(){e.executeAction(e,null,{$dom:$(this).parents(".contentGridRow:first")})});if(!n)return;if(!n.hammer)return;n.hammer().on(i,function(t){if(0==e.iType&&_.include(["Paragraph"],e.overlaymodel.iview.iType)&&interaction_view.environment.Paragraph.state()&&!e.overlaymodel.attributes.iDetail.iStaticImage)return!1;if(_.include(["Slide","LayerSlide","CycleImage","Button","Vote"],e.overlaymodel.iview.iType)&&e.overlaymodel.iview.slipable&&!$(t.target).is(t.currentTarget))return!1;if(15==e.iType){var n=!1;$(document).one("mouseup touchend touchcancel",function(){!n&&e.executeAction(e)&&(n=!0)})}else e.executeAction(e);return"hold"==i?(t.gesture.preventDefault(),!1):void 0})}},renderforanimationaction:function(){var e=this,t=this.model.page.iAnimationlist.get(this.animation_id);if(t){var i={type:"animation",page_id:this.page_id,overlay_id:this.overlay_id,animation_id:this.animation_id,path:this.path,layer_id:this.layer_id,func:function(t){e.executeAction(e,t)}};this.layer_id&&(i.iPage_id=this.model.iPage_id),6==this.iType&&interaction_view.events.animationStartEvents.push(i),7==this.iType&&interaction_view.events.animationEndEvents.push(i)}},renderforlayer:function(){var e=this,t=this.model.get("layerid"),i=this.model.parentpage.iOverlaylist.get(this.model.get("pageid")).toJSON().iDetail.layer_ids.indexOf(t);return-1==i?!1:(0==this.iType&&this.model.parentpage&&this.model.parentpage.iOverlaylist.get(this.model.get("pageid")).iview.$el.children(".Element").on("click",function(t){return!$(t.target).is(t.currentTarget)&&$(t.currentTarget).find(".layer-content").first().children().length>1?!1:void(e.model.parentpage.iOverlaylist.get(e.model.get("pageid")).iview.currentIndex==i&&e.testControlforLayer(t)&&e.executeAction(e))}),3==this.iType&&interaction_view.events.pageStartEvents.push({type:"page",page_id:e.model.pageid,layer_id:this.model.get("layerid"),func:function(t){e.executeAction(e,t)}}),void(4==this.iType&&this.model.parentpage&&(this.model.parentpage.iOverlaylist.get(this.model.get("pageid")).iview.$el.addClass("hasDblClick"),this.model.parentpage.iOverlaylist.get(this.model.get("pageid")).iview.$el.children(".Element").on("dblclick",function(t){$(t.target).closest(".layer-item").index()==e.model.parentpage.iOverlaylist.get(e.model.get("pageid")).iview.currentIndex&&e.model.parentpage.iOverlaylist.get(e.model.get("pageid")).iview.currentIndex==i&&e.testControlforLayer(t)&&e.executeAction(e)}),interaction_view.touchview&&this.model.parentpage.iOverlaylist.get(this.model.get("pageid")).iview.$el.children(".Element").hammer().on("doubletap",function(t){$(t.target).closest(".layer-item").index()==e.model.parentpage.iOverlaylist.get(e.model.get("pageid")).iview.currentIndex&&e.model.parentpage.iOverlaylist.get(e.model.get("pageid")).iview.currentIndex==i&&e.testControlforLayer(t)&&e.executeAction(e)}))))},renderforpage:function(){var e=this;0==this.iType?interaction_view.events.pageClickEvents.push({type:interaction_view.getPageType(e),page_id:e.model.page.id,func:function(t){e.executeAction(e,t)}}):3==this.iType?interaction_view.events.pageStartEvents.push({type:"page",page_id:e.model.page.id,func:function(t){e.executeAction(e,t)}}):4==this.iType?interaction_view.events.pageDblClickEvents.push({type:interaction_view.getPageType(e),page_id:e.model.page.id,func:function(t){e.executeAction(e,t)}}):51==this.iType?interaction_view.events.pageWXShareSuccessEvents.push({type:interaction_view.getPageType(e),page_id:e.model.page.id,func:function(t){e.executeAction(e,t)}}):_.include([36,37,38,39],this.iType)?(interaction_view.events.pageSwipeEvents.push({type:interaction_view.imasterlist.length&&e.model.page.id==interaction_view.imasterlist.at(0).id?"master":"page",page_id:e.model.page.id,func:function(t){e.executeAction(e,t)},swipeType:this.iType}),(36==this.iType||37==this.iType)&&$(Reveal.getSlideItemById(e.model.page.id)).addClass("has_swipe")):_.include([40],this.iType)?interaction_view.events.pageShakeEvents.push({type:interaction_view.imasterlist.length&&e.model.page.id==interaction_view.imasterlist.at(0).id?"master":"page",page_id:e.model.page.id,func:function(t){e.executeAction(e,t)}}):80==this.iType&&"undefined"!=typeof configpage&&configpage.actions.push({func:function(t){e.executeAction(e,t)}})},renderforslideindex:function(){if("CycleImage"!=this.overlaymodel.iview.iType&&"Slide"!=this.overlaymodel.iview.iType,!(this.overlaymodel.iview.slideel&&this.overlaymodel.iview.slidelength>0&&this.overlaymodel.iview.slidelength>this.index))return!1;var e=this;0==this.iType&&(this.overlaymodel.iview.slideel.find('[data-index="'+this.index+'"]').addClass("hasaction"),this.overlaymodel.iview.useIndex&&this.overlaymodel.iview.$el.children(".Element").addClass("hasaction"),"Flow"==this.overlaymodel.iview.detail.iFade?this.overlaymodel.iview.slideel.find('[data-index="'+this.index+'"]').hammer().on("tap",function(){e.overlaymodel.iview.currentIndex!=e.index||e.overlaymodel.iview.CoverFlow.data("CoverFlowDisableClick")||setTimeout(function(){e.executeAction(e)},300)}):this.overlaymodel.iview.$el.children(".Element").on("click",function(t){return e.overlaymodel.iview.slipable&&!$(t.target).is(t.currentTarget)?!1:void(e.overlaymodel.iview.currentIndex==e.index&&setTimeout(function(){e.executeAction(e)},300))})),5==this.iType&&interaction_view.events.elementChangeToEvents.push({type:"slide",page_id:e.model.pageid,overlay_id:this.overlaymodel.id,index:this.index,func:function(t){e.executeAction(e,t)}}),4==this.iType&&(this.overlaymodel.iview.$el.addClass("hasDblClick"),this.overlaymodel.iview.useIndex?(this.overlaymodel.iview.$el.children(".Element").on("dblclick",function(){e.overlaymodel.iview.currentIndex==e.index&&e.executeAction(e)}),interaction_view.ismobile&&this.overlaymodel.iview.$el.children(".Element").hammer().on("doubletap",function(){e.overlaymodel.iview.currentIndex==e.index&&e.executeAction(e)})):(this.overlaymodel.iview.slideel.find('[data-index="'+this.index+'"]').on("dblclick",function(){e.executeAction(e)}),interaction_view.ismobile&&this.overlaymodel.iview.slideel.find('[data-index="'+this.index+'"]').hammer().on("doubletap",function(){e.executeAction(e)})))},renderforapplication:function(){var e=this;70==this.iType&&interaction_view.events.formSubmitEvents.push({type:70,id:this.app_id,func:function(t){e.executeAction(e,t)}})},executeAction:function(e,t,i){if("undefined"!=typeof Reveal&&Reveal&&Reveal.isOverview()&&3!=e.iType)return!1;if(!e.model||!e.model.iPage_id||-1==Reveal.slideIdsArray.indexOf(e.model.iPage_id)||e.model.iPage_id==interaction_view.currentPage){var n;if(interaction_view.DEBUG&&(n={iType:99==this.iType?this.customType:this.iType,actionType:this.actiontype,page_id:e.model.pageid,overlay_id:this.overlaymodel?this.overlaymodel.id:"",animation_id:this.animation_id,layer_id:this.layer_id,app_id:this.app_id,index:this.index,category:this.actionCate}),t||(t=interaction_view.queue),e.model.attributes.layer_id&&(interaction_view.expression.InsideLayerRange=e.model.page),0==e.actiontype&&t.immediate(e.renderanimations,null,{debug:n}),1==e.actiontype&&t.immediate(e.rendershow,null,{debug:n}),2==e.actiontype&&t.immediate(e.renderhide,null,{debug:n}),6==e.actiontype&&t.immediate(e.setElementTo,null,{debug:n}),5==e.actiontype&&(interaction_view.foredit?global.message("warning","è¯·ä½¿ç”¨é¢„è§ˆå…¨éƒ¨æ¨¡å¼é¢„è§ˆè¯¥åŠŸèƒ½"):t.immediate(e.renderpage,null,{debug:n})),7==e.actiontype&&(interaction_view.foredit?global.message("warning","è¯·ä½¿ç”¨é¢„è§ˆå…¨éƒ¨æ¨¡å¼é¢„è§ˆè¯¥åŠŸèƒ½"):t.immediate(e.renderoverview,null,{debug:n})),8==e.actiontype&&(interaction_view.foredit?global.message("warning","è¯·ä½¿ç”¨é¢„è§ˆå…¨éƒ¨æ¨¡å¼é¢„è§ˆè¯¥åŠŸèƒ½"):t.immediate(e.rendershare,null,{debug:n})),10==e.actiontype&&(interaction_view.foredit?global.message("warning","è¯·ä½¿ç”¨é¢„è§ˆå…¨éƒ¨æ¨¡å¼é¢„è§ˆè¯¥åŠŸèƒ½"):t.immediate(e.renderurl,null,{debug:n})),16==e.actiontype&&(interaction_view.foredit?global.message("warning","è¯·ä½¿ç”¨é¢„è§ˆå…¨éƒ¨æ¨¡å¼é¢„è§ˆè¯¥åŠŸèƒ½"):t.immediate(e.rendertel,null,{debug:n})),15==e.actiontype&&_g.device.android()&&window.collecting&&window.collecting.startFunction){var a=function(){var e=interaction_view.currentPage,t=interaction_view.ipagelist.getPage(e);if(t){var i=t.toJSON().nav&&t.toJSON().nav.thumbnail?t.toJSON().nav.thumbnail:null,n=interaction_view.doc.toJSON().title;window.collecting.startFunction(n,i,e)}};t.immediate(a,null,{debug:n})}if(this.overlaymodel&&"Button"==this.overlaymodel.toJSON().iType&&this.overlaymodel.get("isTabBarButton")&&t.immediate(e.syncTabButtons,null,{debug:n}),_.include([17,18,19,20,21,52,53,60,72,73,100],e.actiontype))if(20==e.actiontype){var a=function(){e.renderNormal(e.actiontype,this)};t.add(a,null,{debug:n})}else t.immediate(function(){e.renderNormal(e.actiontype,null,{debug:n})});if(_.include([50],e.actiontype)&&t.immediate(e.renderWXShareImg,null,{debug:n}),_.include([51],e.actiontype)&&t.immediate(function(){e.renderWXShare(e.actiontype,null,{debug:n})}),_.include([56,57],e.actiontype)&&t.immediate(function(){e.renderParagraph(e.actiontype,null,{debug:n})}),_.include([58],e.actiontype)&&t.immediate(function(){e.setButtonToActive(e.actiontype,null,{debug:n})}),70==e.actiontype&&t.immediate(function(){window.setTimeout(function(){e.submitForm(e.actiontype,null,{debug:n})},500)}),71==e.actiontype){var a=function(){e.setFormValue(this)};t.add(a)}_.include([59],e.actiontype)&&t.immediate(e.renderreplaceresource,null,{debug:n}),61==e.actiontype&&e.playElementTo(),80==e.actiontype&&(interaction_view.foredit?interaction.message("warning","è¯·ä½¿ç”¨é¢„è§ˆå…¨éƒ¨æ¨¡å¼é¢„è§ˆè¯¥åŠŸèƒ½"):t.immediate(e.renderSharePage,null,{debug:n})),81==e.actiontype&&(interaction_view.foredit?interaction.message("warning","è¯·ä½¿ç”¨é¢„è§ˆå…¨éƒ¨æ¨¡å¼é¢„è§ˆè¯¥åŠŸèƒ½"):t.immediate(function(){e.renderShareMode(e.actiontype,null,{debug:n})})),82==e.actiontype&&(interaction_view.foredit?interaction.message("warning","è¯·ä½¿ç”¨é¢„è§ˆå…¨éƒ¨æ¨¡å¼é¢„è§ˆè¯¥åŠŸèƒ½"):t.immediate(e.renderSharedataSubmit,null,{debug:n})),90==e.actiontype&&(interaction_view.foredit?interaction.message("warning","è¯·ä½¿ç”¨é¢„è§ˆå…¨éƒ¨æ¨¡å¼é¢„è§ˆè¯¥åŠŸèƒ½"):t.immediate(e.renderEvents,null,{debug:n})),110==e.actiontype&&(interaction_view.foredit?interaction.message("warning","è¯·ä½¿ç”¨é¢„è§ˆå…¨éƒ¨æ¨¡å¼é¢„è§ˆè¯¥åŠŸèƒ½"):t.immediate(e.renderJS,null,{debug:n})),101==e.actiontype&&(interaction_view.foredit?interaction.message("warning","è¯·ä½¿ç”¨é¢„è§ˆå…¨éƒ¨æ¨¡å¼é¢„è§ˆè¯¥åŠŸèƒ½"):t.immediate(e.renderPreloadPages,null,{debug:n})),102==e.actiontype&&(interaction_view.foredit?interaction.message("warning","è¯·ä½¿ç”¨é¢„è§ˆå…¨éƒ¨æ¨¡å¼é¢„è§ˆè¯¥åŠŸèƒ½"):t.immediate(e.renderUserdataSubmit,null,{debug:n})),interaction_view.PluginManage.ActionExecutes[e.actiontype]&&interaction_view.PluginManage.ActionExecutes[e.actiontype].exec&&interaction_view.PluginManage.ActionExecutes[e.actiontype].exec(e,t,n,i)}},rendershare:function(){interaction_view.ismobile||share(interaction_view.doc.toJSON().title,context_url+"/player")},renderoverview:function(){Reveal.toggleOverview(!0)},renderclick:function(){},rendershow:function(){var e=this,t=this.values;t&&_.each(t,function(t){var i=t.page_id,n=interaction_view.getAnimationPage(i,e.model.page),a=n.iOverlaylist.get(t.id);a&&a.iview&&a.iview.$el&&(a.iview.onBeforeShow&&a.iview.onBeforeShow(),a.iview.$el.removeClass("hide"),a.iview.onShow&&a.iview.onShow())})},renderhide:function(){var e=this,t=this.values;t&&_.each(t,function(t){var i=t.page_id,n=interaction_view.getAnimationPage(i,e.model.page),a=n.iOverlaylist.get(t.id);a&&a.iview&&a.iview.$el&&(a.iview.onBeforeHide&&a.iview.onBeforeHide(),a.iview.$el.addClass("hide"),a.iview.onHide&&a.iview.onHide())})},renderpage:function(){var e=this.model.toJSON().iDetail,t=this.values,i=e.results[0].iActionDetail?e.results[0].iActionDetail.transition:0,i=e.results[0].iActionDetail&&e.results[0].iActionDetail.transition?e.results[0].iActionDetail.transition:0,n=interaction_view.getVarsOp(interaction_view.currentPage,[0,2]);if(n.beginWithAT(t)){var a=interaction_view.ipagelist.getPages().length;t=Math.round(n.var2val(t)),0>t&&(t=0),t>a-1&&(t=a-1),t=interaction_view.ipagelist.getPages()[t]?interaction_view.ipagelist.getPages()[t].id:null}t&&presentation.gotopagebyargs(t,i)},renderSharePage:function(){var e=(this.model.toJSON().iDetail,this.values),t=e||"first";("current"==t||interaction_view.share_page_id!=t)&&(interaction_view.share_page_id=t,interaction_view.weixin.share())},renderShareMode:function(e){switch(e){case 81:interaction_view.environment.Sharedata.reset()}},renderurl:function(){function e(){if(interaction_view.ismobile){var e=window.location.href;e=_g.changeURLPar(e,"pageid",interaction_view.currentPage),window.history.pushState({},"",e),window.location.href=i}else window.open(i,"_blank")}if(0!=this.values.length&&!_.isEmpty(this.values[0].url)){var t,i=this.values[0].url;
if(t=i.match(/(http:\/\/|https:\/\/)([\w.:]+)/),0==i.indexOf("@"))return void window.open(i,"_blank");if(["/","."].indexOf(i[0])>-1)return void(window.location.href=i);if(t&&t.length>2&&t[2]==window.location.host)return void(window.location.href=i);if(-1==i.indexOf("://")&&(i="http://"+i),window.location.href.indexOf("query_string")>0&&(i+=i.indexOf("?")>=0&&"&"+window.location.search.replace("?","")||window.location.search),t=i.match(/\w+:\/\//),t&&-1==["https://","http://"].indexOf(i.match(/\w+:\/\//)[0]))return void(window.location.href=i);var n=interaction_view.evil_check(i);return 200!=n?414==n?void interaction_view.errorAlert('<div>è¯¥ç½‘å€è¢«è…¾è®¯ç”µè„‘ç®¡å®¶æ£€æµ‹ä¸ºå±é™©ï¼Œåœæ­¢è®¿é—®!</div><div class="url">'+i+"</div>"):void(wx_config.LOGO?interaction_view.confirmBox('<div>æ–°æ‰“å¼€ç½‘å€æ— æ³•ç¡®å®šæ˜¯å¦å®‰å…¨ï¼Œæ˜¯å¦ç»§ç»­è®¿é—®?</div><div class="url">'+i+"</div>",e):e()):void e()}},rendertel:function(){if(interaction_view.ismobile&&0!=this.values.length&&!_.isEmpty(this.values[0].url)){var e=new promise.Promise,t=this.values[0].url;return interaction_view.expression.id2values(t,function(t){window.location="tel:"+t,e.done()}),e}},renderVariable:function(e,t){var i=new promise.Promise;if(e&&e.iview)e.iview.setVariable?e.iview.setVariable(t.oper,t.value,null,function(){i.done()}):e.iview.updateText?interaction_view.expression.id2values(t.value,function(t){e.iview.updateText(t,addtourl=1),i.done()}):i.done();else if(e=interaction_view.globallist.get(t.id)){var n=e.attributes.iDetail,a=t.id;switch(oper=Number(t.oper)){case 0:interaction_view.expression.id2values(t.value,function(e){var t=e;interaction_view.expression.setGlobal(a,t),i.done()});break;case 1:interaction_view.expression.id2values(t.value,function(t){0==e.attributes.iDetail.iKind&&(_.isNaN(Number(e.attributes.iDetail.initial))||(e.attributes.iDetail.initial=Number(e.attributes.iDetail.initial)));var n=e.attributes.iDetail.initial+t;interaction_view.expression.setGlobal(a,n),i.done()});break;case 2:interaction_view.expression.id2values(t.value,function(t){0==e.attributes.iDetail.iKind&&(_.isNaN(Number(e.attributes.iDetail.initial))||(e.attributes.iDetail.initial=Number(e.attributes.iDetail.initial)));var n=e.attributes.iDetail.initial-t;interaction_view.expression.setGlobal(a,n),i.done()});break;case 3:var r=interaction_view.setRandom(n);interaction_view.expression.setGlobal(a,r),i.done()}}else i.done();return i},renderNormal:function(e,t){var i=this,n=this.values,a=[];n&&(_.each(n,function(t){var n=t.page_id,r=interaction_view.getAnimationPage(n,i.model.page),o=r.iOverlaylist.get(t.id);if(o&&o.iview)switch(e){case 17:o.iview.startTimer();break;case 18:o.iview.stopTimerSimple();break;case 19:o.iview.resetTimer();break;case 20:a.push(i.renderVariable(o,t));break;case 21:interaction_view.events.onVariableChanged(o.iview);break;case 52:interaction_view.media.play(o);break;case 53:interaction_view.media.pause(o);break;case 60:o.iview.activeEdit&&setTimeout(function(){o.iview.activeEdit(!0)},500);break;case 72:o.iview.getInfo();break;case 73:o.iview.postInfo();break;case 100:interaction_view.events.onSystemVariableChanged(o.iview)}else a.push(i.renderVariable(o,t))}),a.length?promise.join(a).then(function(){t&&t.done()}):t&&t.done())},renderWXShare:function(){var e=this.values;if(e){var t=(e.page_id,e.value);console.log("set sharing: "+t),(_g.device.mobile()||_g.device.tablet())&&(t=interaction_view.expression.id2values(t)),t=t.replace(/<br>+/g,"\n").replace(/"+/g,"'").replace(/<\/div><div>/g,"\n").replace(/<div>/g,"").replace(/<\/div>/g,"").replace(/'/g,""),shareTitle=t,msgContent=shareTitle,interaction_view.weixin.share()}},renderParagraph:function(e){switch(e){case 56:interaction_view.environment.Paragraph.enable();break;case 57:interaction_view.environment.Paragraph.disable()}},renderJS:function(){if(0!=this.values.length)if(this.values[0].api&&"undefined"!=typeof e_api)try{e_api.custom[this.values[0].api]&&e_api.custom[this.values[0].api]()}catch(e){console.log(e)}else if(!_.isEmpty(this.values[0].code)){var code=_.unescape(this.values[0].code);eval(code)}},setButtonToActive:function(){if(this.values&&0!=this.values.length){var e=this,t=(this.model.toJSON().iDetail,this.values[0].id),i=this.values[0].page_id,n=interaction_view.getAnimationPage(i,e.model.page);if(t){var a=n.iOverlaylist.get(t);a&&!a.iview.active&&a.iview.$el.find("img.iconNormal").length&&a.iview.$el.find("img.iconNormal").trigger("click")}}},renderreplaceresource:function(){if(this.values&&0!=this.values.length){var e,t=this,i=this.model.toJSON().iDetail;if(overlay_id=this.values[0]?this.values[0].id:"",pageid=this.values[0]?this.values[0].page_id:"",page=interaction_view.getAnimationPage(pageid,t.model.page),overlay_id&&(e=page.iOverlaylist.get(overlay_id))){var n=e.get("iType"),a=i.results[0].iActionDetail?i.results[0].iActionDetail.replace:null,r=i.results[0].iActionDetail?i.results[0].iActionDetail.url:null,o=e.attributes.iDetail.iEditable;if(a){if(1==a&&"ImageBlock"==n&&("undefined"!=typeof wx_permissions&&wx_permissions.chooseImage?interaction_view.localIds?setTimeout(function(){e.iview.setweixinimage(interaction_view.localIds[0])},100):interaction_view.weixin.chooseimage(function(t){t&&(interaction_view.localIds=t,e.iview.setweixinimage(t[0]))}):interaction_view.errorAlert(_g.device.isWeixin()?"å¼€å¯å¾®ä¿¡åŠŸèƒ½å¤±è´¥":"è¯·åœ¨å¾®ä¿¡ä¸­æ“ä½œ")),2==a&&"Audio"==n)if("undefined"!=typeof wx_permissions&&wx_permissions.startRecord){var s=function(){if(interaction_view.voicelocalId){var t=e.iview.getdetail();e.voicelocalId!=interaction_view.voicelocalId&&interaction_view.voiceUploader(interaction_view.voicelocalId,function(i){e.media&&(interaction_view.media.changeSrc(e,i),interaction_view.media.play(e)),e.voicelocalId=interaction_view.voicelocalId,e.voiceUrl=i,t.iFile[0].file=i,e.iview.addToUrl(i)})}};interaction_view.voicelocalId?s(interaction_view.voicelocalId):interaction_view.voiceEditor(function(){s()})}else interaction_view.errorAlert(_g.device.isWeixin()?"å¼€å¯å¾®ä¿¡åŠŸèƒ½å¤±è´¥":"è¯·åœ¨å¾®ä¿¡ä¸­æ“ä½œ");if(3==a||4==a){if(!r)return;interaction_view.expression.id2values(r,function(t){if("ImageBlock"==n){var i=(e.iview.$el.children(".Element").find("img"),e.iview.getdetail());"reset"==t?("undefined"!=typeof i.iImg[0].origin?(e.iview.replaceImg(i.iImg[0].origin),i.iImg[0].picture=i.iImg[0].origin):(e.iview.replaceImg(""),i.iImg[0].picture=""),o&&"undefined"!=typeof e.iview.removeFromUrl&&e.iview.removeFromUrl()):(e.iview.replaceImg(t),i.iImg[0].picture=t,o&&e.iview.addToUrl(t,0,0,1,0))}else if("Audio"==n){var i=e.iview.getdetail();e.media&&(interaction_view.media.changeSrc(e,t),interaction_view.media.play(e)),i.iFile[0].file=t,o&&e.iview.addToUrl(t)}})}if(5==a&&"ImageBlock"==n&&"undefined"!=typeof epub360_userinfo){var l=(e.iview.$el.children(".Element").find("img"),e.iview.getdetail()),r=epub360_userinfo.portrait;e.iview.replaceImg(r),l.iImg[0].picture=r,o&&e.iview.addToUrl(r,0,0,1,0)}}}}},renderWXShareImg:function(){var e=this,t=this.values;if(t){if("å¾®ä¿¡å¤´åƒ"==t[0].id)"undefined"!=typeof epub360_userinfo&&void 0!=epub360_userinfo.portrait&&(imgUrl=epub360_userinfo.portrait);else{var i=t[0].page_id,n=interaction_view.getAnimationPage(i,e.model.page),a=n.iOverlaylist.get(t[0].id);if(a&&a.iview&&a.iview.$el){var r=a.iview.$el.find("img");if(r.length>0){var o=r.attr("src");if(0==o.indexOf("http://"))imgUrl=o;else{var s=a.iview.getdetail();imgUrl=s.iImg[0].picture}}else if(r=a.iview.$el.find(".bk_full"),r.length>0){var l=r.css("background-image"),c=/\url\((\S+)\)/.exec(l);null!=c&&(imgUrl=c[1])}}}interaction_view.weixin.share()}},renderEvents:function(){var e=this.values,t="www.epub360.com";if(current_host=window.location.host,-1!=current_host.indexOf("tu960")&&(t=current_host),e.length&&e[0].opt_label&&interaction_view.book_id){var i=e[0].opt_label,n=e[0].opt_action,a="http://"+t+"/manage/book/"+interaction_view.book_id+"/event.gif?opt_category=custom&opt_action="+n+"&opt_label="+i+"&t="+_g.uuid(),r=document.createElement("img");r.src=a,r.onload=function(){}}},setElementTo:function(){if(this.values&&0!=this.values.length){var e=this,t=this.model.toJSON().iDetail,i=this.values[0].id,n=this.values[0].page_id,a=interaction_view.getAnimationPage(n,e.model.page),r=t.results[0].iActionDetail?t.results[0].iActionDetail.index:null,o=interaction_view.getVarsOp(n,[0,2]);if(o.beginWithAT(r)&&(r=o.var2val(r)),i){var s=a.iOverlaylist.get(i);s&&s.iview&&s.iview.setElementTo(r)}if(this.overlaymodel&&"Button"==this.overlaymodel.toJSON().iType){var l=this.syncbuttons(a,this.model.toJSON().overlay_id,this.values[0]);l>0&&(this.overlaymodel.iview.groupcontrol=!0)}}},playElementTo:function(){if(this.values&&0!=this.values.length){var e=this,t=this.model.toJSON().iDetail,i=this.values[0].id,n=this.values[0].page_id,a=interaction_view.getAnimationPage(n,e.model.page),r=t.results[0].iActionDetail?t.results[0].iActionDetail.mode:0,o=t.results[0].iActionDetail&&t.results[0].iActionDetail.repeat?-1:0,s=t.results[0].iActionDetail?t.results[0].iActionDetail.p_from:0,l=t.results[0].iActionDetail?t.results[0].iActionDetail.p_to:0;if(i){var c=a.iOverlaylist.get(i);if(c&&c.iview){if(4==r&&c.iview.timeline&&c.iview.timeline.pause(),0==r||1==r){var d=c.toJSON().iDetail.iImg.length;if(!d)return;0==r?(c.iview._start=0,c.iview._end=d-1,c.iview.direction=0):(c.iview.direction=1,c.iview._start=d-1,c.iview._end=0),c.iview.autoplay=!0,c.iview.repeat=o;var h=c.iview._setCanvasLoopSwitch(!0);c.iview.timeline.play(h)}if(2==r){c.iview._start=s,c.iview._end=l,c.iview.direction=s-l>0?1:0,c.iview.autoplay=!0,c.iview.repeat=o;var h=c.iview._setCanvasLoopSwitch(!0);c.iview.timeline.play(h)}if(3==r){c.iview.currentIndex||(c.iview.currentIndex=0),c.iview._start=c.iview.currentIndex,c.iview._end=l,c.iview.direction=c.iview.currentIndex-l>0?1:0,c.iview.autoplay=!0,c.iview.repeat=o;var h=c.iview._setCanvasLoopSwitch(!0);c.iview.timeline.play(h)}}}}},syncbuttons:function(e,t,i){var n=this,a=0,r=_.filter(this.model.page.iActionlist.toJSON(),function(e){return n.model.page.iOverlaylist.get(e.overlay_id)&&"Button"==n.model.page.iOverlaylist.get(e.overlay_id).get("iType")&&6==e.iDetail.results[0].iAction});return _.each(r,function(e){if(e.overlay_id!=t){var r=n.model.page.iOverlaylist.get(e.overlay_id);r&&r.toJSON().iDetail.isSwitch&&e.iDetail.results&&e.iDetail.results[0].values[0].id==i.id&&e.iDetail.results[0].values[0].page_id==i.page_id&&(a+=1,r.iview.resetButtonStatus())}}),a},syncTabButtons:function(){var e=this,t=this.overlaymodel.get("path"),i=interaction_view.getContainerModelByPath(t);i.iOverlaylist.each(function(t){t.id!=e.overlaymodel.id&&t.iview.resetButtonStatus()})},resetStatus:function(){this.overlaymodel.iview.$el.off("click")},testControlforLayer:function(e){var t=$(e.target).closest(".iView");if($(e.target).closest(".iView").hasClass("hasaction"))return!1;if(t){var i=t.attr("data-type");if(("Slide"==i||"CycleImage"==i)&&t.attr("data-iSlipable"))return!1}return!0},submitForm:function(){return this.values?void interaction_view.application.submitForm(this.values):!1},setFormValue:function(e){var t=this.model.toJSON().iDetail;if(!this.values)return e.done(),!1;var i=t.results[0].cid,n=t.results[0].vT,a=t.results[0].vV,r=this.values;interaction_view.expression.id2values(a,function(e){interaction_view.application.setFormData(r,i,Number(n),e)},{_promise:e})},renderPreloadPages:function(){if(this.values||this.values.length){{this.model.toJSON().iDetail}_e.preloadpage.preload(this.values,this.preload_hash)}},renderUserdataSubmit:function(){var e=this;if(interaction_view.environment.Userdata.share(),this.values&&this.values.length){for(var t=[],i=0;i<this.values.length;i++){var n=this.values[i].page_id,a=interaction_view.getAnimationPage(n,e.model.page),r=this.values[i].id;if(r){var o=a.iOverlaylist.get(r);o&&o.iview&&t.push(o.iview)}}interaction_view.environment.Userdata.setitems(t,function(){interaction_view.events.onUserdataSave(e)})}},renderSharedataSubmit:function(){var e=this;interaction_view.environment.Sharedata.setitems(function(){interaction_view.events.onSharedataSave(e)})}}),interaction_view.iActionlist=new interaction_view.collection.Action}),define("interaction_view/model/animation_view",["interaction_view/model/base"],function(){interaction_view.model.Animation=interaction_view.model.Base.extend({defaults:{},setcollection:function(){},setmodel:function(){}}),interaction_view.collection.Animation=interaction_view.collection.Base.extend({initialize:function(){},model:interaction_view.model.Animation,setonadd:function(){this.on("add",function(){})},setParams:function(){if(this.repeatTweens=[],0!=this.where({iKind:0}).length){var e=this;if(this.cssAnimations=[],this.Animations=[],this.each(function(t){t.tween=null;var i=t.toJSON();return i.iType>0&&i.iType<100?void e.cssAnimations.push(i):void((0!=i.iKind||e.page.iOverlaylist.get(i.overlay_id))&&"undefined"!=typeof animation&&(e.Animations.push(t),t._animation=new animation({collection:e,animation:t.toJSON()})))}),this.cssAnimations.length&&"undefined"!=typeof Animate){this.cssitems=[];for(var t=0;t<this.cssAnimations.length;t++){var i=e.page.iOverlaylist.get(this.cssAnimations[t].overlay_id);if(i){var n={el:i.iview.$el.children(".Element"),type:this.cssAnimations[t].iType,delay:this.cssAnimations[t].iTiming.delay,duration:this.cssAnimations[t].iTiming.duration,repeat:this.cssAnimations[t].iTiming.repeat,onShow:i.iview.onShow};this.cssitems.push(n)}}this.css_timeline=new Animate({items:this.cssitems})}}},setPlay:function(){if(this.Animations&&0!=this.Animations.length){var e=function(){};this.timeline=animateTimeline.generateTimeline({onStart:e,animations:this.Animations,iPage_id:this.iPage_id,page:this.page,paused:!0})}},play:function(){0!=this.length&&(this.setPlay(),this.timeline&&this.timeline.play(0))},playMain:function(){0!=this.length&&(this.setParams(),this.setPlay(),this.timeline&&this.timeline.play(0,!1),this.afterTimeLineCreated&&this.afterTimeLineCreated())},AddClickTween:function(e,t,i,n){interaction_view.SinglePreview||(e.pause(n),console.log(n),$('section[id="'+t+'"]').children(".interaction-view").css("cursor","pointer"),interaction_view.events.pageClickEvents.push({type:"waitaction",page_id:t,func:function(){console.log(i),_.include([101,102,103,104],i.attributes.iType)&&(i.attributes.iTiming.delay?_g.device.android()&&101==i.attributes.iType&&window.setTimeout(function(){i._animation.showelement()},i.attributes.iTiming.delay):i._animation.showelement()),$('section[id="'+t+'"]').children(".interaction-view").css("cursor","auto"),e.resume()}}))},AddPageSwipeTween:function(e,t,i,n,a){interaction_view.SinglePreview||(console.log(a),e.pause(a),$('section[id="'+t+'"]').children(".interaction-view").css("cursor","pointer"),interaction_view.events.pageSwipeEvents.push({type:"waitaction",page_id:t,func:function(){_.include([101,102,103,104],n.attributes.iType)&&(n.attributes.iTiming.delay?_g.device.android()&&101==n.attributes.iType&&window.setTimeout(function(){n._animation.showelement()},n.attributes.iTiming.delay):n._animation.showelement()),$('section[id="'+t+'"]').children(".interaction-view").css("cursor","auto"),e.resume()},swipeType:i+33}))},AddPageShakeTween:function(e,t,i,n,a){interaction_view.SinglePreview||(console.log(a),e.pause(a),interaction_view.events.pageShakeEvents.push({type:"waitaction",page_id:t,func:function(){_.include([101,102,103,104],n.attributes.iType)&&(n.attributes.iTiming.delay?_g.device.android()&&101==n.attributes.iType&&window.setTimeout(function(){n._animation.showelement()},n.attributes.iTiming.delay):n._animation.showelement()),$('section[id="'+t+'"]').children(".interaction-view").css("cursor","auto"),e.resume()}}))},AddRepeatClickTween:function(e,t,i,n){interaction_view.SinglePreview||($('section[id="'+t+'"]').children(".interaction-view").css("cursor","pointer"),interaction_view.events.pageClickEvents.push({type:"waitaction",page_id:t,func:function(){$('section[id="'+t+'"]').children(".interaction-view").css("cursor","auto"),i.pause(),n._animation.stop(i)}}))},AddMediaTween:function(e){var t=e.collection.page;if(interaction_view.SinglePreview){var i=t.iAnimationlist.timeline.getLabelTime(interaction_view.PreviewItemId+"_start"),n=t.iAnimationlist.timeline.getLabelTime(e.id+"_start");if(i>n)return}var a=t.iOverlaylist.get(e.get("overlay_id")),r=e.get("iType");a.onAnimationStart={overlay_id:e.get("overlay_id"),animation_id:e.id,page_id:t.id,layer_id:e.collection.layerid},interaction_view.events.onAnimationStart(a.onAnimationStart),501==r&&("Audio"==a.get("iType")||"Video"==a.get("iType")||"QQVideo"==a.get("iType")?interaction_view.media.play(a):a.iview.playTimeline()),502==r&&("Audio"==a.get("iType")||"Video"==a.get("iType")||"QQVideo"==a.get("iType")?a.loaded&&(interaction_view.media.pause(a),a.iview.slider&&a.iview.sliderstop()):a.iview.pauseTimeline()),503==r&&("Audio"==a.get("iType")||"Video"==a.get("iType")||"QQVideo"==a.get("iType")?a.loaded&&a.media&&(a.iview.resetOtherStatus(),a.iview.slider&&(a.iview.sliderstop(),a.iview.onSliderChange(0))):a.iview.stopTimeline()),(502==r||503==r)&&a.onAnimationStart&&(interaction_view.events.onAnimationEnd(a.onAnimationStart),a.onAnimationStart=null),t.iAnimationlist.onComplete(e.id)},getMediaTime:function(e){var t=0,i=e.collection.page.iOverlaylist.get(e.toJSON().overlay_id);return i.media?("Audio"==i.get("iType")||"Video"==i.get("iType"))&&(t=i.hls?i.media.getDuration():i.media.duration):_.include(["CycleImage","Slide","LayerSlide"],i.get("iType"))&&(t=i.iview.getSlideDuration()),t},onSingleComplete:function(){},onUpdate:function(){},onTotalComplete:function(){},onComplete:function(){},resetAnimationStatus:function(){_.each(this.repeatTweens,function(e){e.kill()}),this.repeatTweens=[],this.timeline&&this.timeline.pause(0)}}),interaction_view.view.Animation=interaction_view.view.Base.extend({initstart:function(){}})}),define("text!interaction_view/template/audiocontrol.js",[],function(){return'<div class="audiobar disableDragX disableDragY" style="height: 31px;width: 100%;position: absolute;">\n  <span class="audio-control status-play"></span>\n  <% if((iCommon[iPageDirection].iWidth-45)>0){%>\n  <span class="ui-slider-green ui-slider ui-slider-horizontal ui-widget ui-widget-content ui-corner-all" aria-disabled="false" style="width:<%=(iCommon[iPageDirection].iWidth-45)>0?(iCommon[iPageDirection].iWidth-45):0%>px;left: 45px;">\n    <div class="ui-slider-range ui-widget-header ui-corner-all ui-slider-range-min g-slider-range" style="width: 0%;background-color: #444444;">\n    </div>\n    <a class="ui-slider-handle ui-state-default ui-corner-all g-slider-handle" href="#" style="left: 0%;">\n    </a>\n  </span>\n  <% } %>\n</div>'}),define("interaction_view/model/audio",["interaction_view/model/base","text!interaction_view/template/audiocontrol.js"],function(){var e=require("text!interaction_view/template/audiocontrol.js");interaction_view.model.Audio=interaction_view.model.Base.extend({defaults:{iType:"Audio",iCommon:{portait:{iStartx:400,iStarty:200,iWidth:200,iHeight:200},landscape:{iStartx:400,iStarty:200,iWidth:200,iHeight:200}},iDetail:{iAdapt:!1,iFullview:!1,iImg:null,iAnimation:[]},iParent:"",iChild:"",iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0,callback:null},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(){this.iview=new interaction_view.view.Audio({model:this})},setsyncmodel:function(){}}),interaction_view.view.Audio=interaction_view.view.Base.extend({events:{},bindSliderControl:function(){var e=this;this.$el.find(".audio-control").css("cursor","pointer"),this.$el.find(".audio-control").on("click",function(){return $(this).hasClass("status-play")?e.model.media&&interaction_view.media.play(e.model):$(this).hasClass("status-pause")&&(e.model.media&&interaction_view.media.pause(e.model),e.sliderstop()),!1})},render:function(){var t=this.getdetail();t.iControl&&this.file&&(this.$el.children(".Element").append(_.template(e,this.model.toJSON())),this.$el.removeClass("hide"))},preload:function(){var e=this.getdetail();this.model.played=!1,this.model.time=0;var t;e.iFile&&e.iFile[0]&&(audio_url_src=this.getFromUrl(),t=""!=audio_url_src?audio_url_src:"undefined"!=typeof epub360&&epub360.settings&&epub360.settings.disable_stream_media?e.iFile[0].file:"undefined"==typeof cbt_data||interaction_view.forpreview?"1"==_g.getUrlParameterByName("-playmode")?(e.iFile[0].file||e.iFile[0].content)+"_audio.m3u8":"2"==_g.getUrlParameterByName("-playmode")?e.iFile[0].file||e.iFile[0].content+"?avthumb/mp3/ab/32k":e.iFile[0].file||e.iFile[0].content+"?avthumb/mp3/ab/32k":e.iFile[0].file||e.iFile[0].content,this.sendToPreload({file:t}),this.file=t)},setOtherDisplay:function(){var e=this.getdetail(),t=this;e.iControl&&this.file&&_g.slider&&(this.slider=new _g.slider({containment:this.$el,onChange:function(e){t.model.media&&interaction_view.media.seek(t.model,null,e)}}),this.bindSliderControl())},resetStatus:function(){this.resetOtherStatus()},resetOtherStatus:function(){return this.model.isBgsound?void this.$el.find(".status-play").addClass("status-pause").removeClass("status-play"):void(this.model.media&&(this.model.hls?interaction_view.media.audio.resetH(this.model):interaction_view.media.audio.reset(this.model),this.slider&&(this.sliderstop(),this.onSliderChange(0))))},sliderplay:function(){this.$el.find(".audio-control").addClass("status-pause").removeClass("status-play")},sliderstop:function(){this.$el.find(".audio-control").removeClass("status-pause").addClass("status-play")},onSliderChange:function(e){console.log("time change "+e),this.slider.change(e)},getFromUrl:function(){var e=_g.getUrlParameterByName(this.model.id,message_link);if(e||(e=_g.getHashParameterByName(this.model.id)),null==e&&"epub360"==epub360_domain&&""!=interaction_view.environment.Sharedata.id)if(1==interaction_view.environment.Sharedata.status)interaction_view.environment.Sharedata.addView(this);else{var t=this.model.get("pageid"),i=interaction_view.environment.Sharedata.getitem(t,this.model.id);i&&(e=i.value)}return decodeURI(e||"")},addToUrl:function(e){var t=this.getdetail();if(e==t.iFile[0].origin)return!1;var i=this.model.id+"="+encodeURI(e),n=_g.getUrlParameterByName(this.model.id,message_link),a=0,r=message_link;if(n)encodeURI(n)!=encodeURI(e)?r=_g.replaceUrlParameterByName(this.model.id,i,message_link):a=1;else{var o="?";message_link.indexOf("?")>=0&&(o="&"),r+=o+i}if("epub360"==epub360_domain&&!a&&this.model.id!=bgsound_id&&interaction_view.environment.Sharedata.enabled&&interaction_view.environment.Sharedata.setitem(this,{value:encodeURI(e)}),a||(message_link=r,interaction_view.weixin.share()),!interaction_view.forpreview){var s=_g.getHashParameterByName(this.model.id);s?encodeURI(s)!=encodeURI(e)?window.history.replaceState({},"",_g.replaceHashParameterByName(this.model.id,i)):a=1:window.history&&(document.location.hash?window.history.replaceState({},"",document.location.hash+="&"+i):window.history.replaceState({},"","#"+i))}return a?!1:!0}})}),define("interaction_view/model/cycleimage",["interaction_view/model/base","_g/base"],function(){interaction_view.model.CycleImage=interaction_view.model.Base.extend({defaults:{iType:"CycleImage",iLock:!0,iVisibility:!0,iCommon:{},iDetail:{},iSync:!1,isSlide:!0,iZindex:"-1",iUrl:null,callback:null},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(){this.loaded=[],this.loaded_index=0,this.iImgs=[],this.iview=new interaction_view.view.CycleImage({model:this})},setsyncmodel:function(){}}),interaction_view.view.CycleImage=interaction_view.view.Base.extend({events:{},render:function(){{var e=this;this.getdetail()}this.currentSlideIndex=null,this.model.on("slideTo",function(t){return null!=e.currentSlideIndex&&e.currentSlideIndex==t?!1:void(e.preloaded&&(interaction_view.events.onChangeTo(e.model.iPageId,e.model.id,t),e.currentSlideIndex=t))})},preload:function(){var e=this;this.preloaded=!1;var t,i=this.getdetail();this.img_src=[],this.img_loaded=[];if(i.iImg&&i.iImg.length){this.model._img_preload=!0;for(var n=0;n<i.iImg.length;n++)t=i.iImg[n].picture,e.img_src.push(t),e.img_loaded.push(!1);e.useIndex=!0}},afterpreload:function(){this.slideel=this.$el.children(".Element").find(".slidecontent").first(),this.setZindex(),this.setElementDisplay(),this.renderCanvas(),this.playAnimation(),this.copyelstyle=this.$el.attr("style"),this.copyelementstyle=this.$el.children(".iElement").attr("style"),this.preloaded=!0},playAnimation:function(){var e=this,t=this.detail,i=t.iSlidetype;null==i&&(i=0),this.delay=Number(t.iInterval)||.01,this.autoplay=t.iAutoplay;var n=t.iRepeat?-1:0;this.slidelength=t.iImg&&t.iImg.length||0,this.repeat=this.init_repeat=n,this.iRewind=t.iRewind,this.slipable=t.iSlipable,this.p_mode=t.p_mode||0,this.p_from=Number(t.p_from)||0,this.p_to=Number(t.p_to)||0,this.direction=this.init_direction=0,this.slidelength&&(this.p_to<0&&(this.p_to=0),this.p_from<0&&(this.p_from=0),this.p_to>this.slidelength-1&&(this.p_to=this.slidelength-1),this.p_from>this.slidelength-1&&(this.p_from=this.slidelength-1),this.p_mode||(this.p_from=0,this.p_to=this.slidelength-1),1==this.p_mode&&(this.direction=this.init_direction=1,this.p_from=this.slidelength-1,this.p_to=0),2==this.p_mode&&(this.direction=this.init_direction=this.p_from-this.p_to>0?1:0),this._start=this.p_from,this._end=this.p_to,this.setTimeline(),this.autoplay&&(this.model._autoplay=!0),this.img_preload(20,null,function(){e.drawCanvas(e.img_src[e.p_from],e.p_from),e.img_preload()}),this.onChangeSlideTo(this.p_from),this.slipable&&(this.control(),this.autoplay||this.$el.attr("data-iSlipable",!0)),this.model._reset=!0)},_autoplay:function(){this.timeline&&(this.$el.children(".Element").is(":hidden")||this.timeline.play())},exeutePlay:function(){},setTimeline:function(){this.iFade="LoopSwitch",this._setCanvasLoopSwitch()},testControl:function(){return!0},resetOtherStatus:function(){if(this.slideel){var e=this.getdetail();this.autoplay=e.iAutoplay,this.repeat=this.init_repeat,this.direction=this.init_direction,this._start=this.p_from,this._end=this.p_to,this.currentIndex=this.p_from,this.useIndex&&(this.indexTime=this.p_from),this.timeline&&(this._setCanvasLoopSwitch(!0),this.ctx.clearRect(0,0,this.canvas_width,this.canvas_height),this.drawCanvas(this.img_src[this.p_from],this.p_from))}},renderCanvas:function(){var e=this.getcommon();this.canvasId="canvas_"+_g.uuid(),this.slideel.append('<canvas id="'+this.canvasId+'" width="'+2*e.iWidth+'" height="'+2*e.iHeight+'" style="pointer-events:none;width:'+e.iWidth+"px;height:"+e.iHeight+'px;"></canvas>'),this.canvas=document.getElementById(this.canvasId),this.canvas_width=e.iWidth,this.canvas_height=e.iHeight,this.canvas&&(this.ctx=this.canvas.getContext("2d")),this.useIndex&&this.slideel.children("img").hide()},drawCanvas:function(e,t){if(e&&""!=e){var i=this;if(this.ctx||(this.ctx=this.canvas.getContext("2d")),!this.ctx)return!1;ctx=this.ctx,interaction_view.drawImg(i,e,t,ctx)}},otherOnShow:function(){this.img_src.length&&(this._setCanvasLoopSwitch(!0),this.drawCanvas(this.img_src[this.currentIndex],this.currentIndex),this.autoplay&&this.timeline.play())},img_preload:function(e,t,i){var n=this;if(n.slidelength){var a=n.model.loaded_index,r=1;1==n.slidelength&&(r=0);if(a>n.slidelength-1)return void(n.model.loaded_all=!0);var o=n.slidelength-a>=20?a+20-1:n.slidelength-1;n.model.loaded_index=o+1;for(var s=0,l=o-a+1;o>=a;a++)interaction_view.iImgs[n.img_src[a]]?(n.model.iImgs[a]=interaction_view.iImgs[n.img_src[a]],n.model.loaded[a]=!0,i&&s==r&&i(),++s>=l&&(t&&t(),e||n.img_preload())):(n.model.iImgs[a]=new Image,n.model.iImgs[a].onload=function(){n.model.loaded[a]=!0,interaction_view.iImgs[this.src]=this,i&&s==r&&i(),++s>=l&&(e||n.img_preload())},n.model.iImgs[a].src=n.img_src[a])}}})}),define("text!interaction_view/template/imageitem.js",[],function(){return'<%if(iDetail.iImg&&iDetail.iImg[0]){%>\n    <%if(typeof isSubOverlay!="undefined"&&isSubOverlay&&(typeof isLayerOverlay=="undefined"||!isLayerOverlay)){%>\n        <% if(iDetail.iMask){%>\n            <img draggable="false" class="Context" src="<%=iDetail.iImg[0].thumbnail%>" style="width:<%=iDetail.iMask_data.width%>px;height:<%=iDetail.iMask_data.height%>px;position:absolute;max-width:none;">\n        <%}else{%>\n            <img draggable="false" class="Context" src="<%=iDetail.iImg[0].thumbnail%>" style="width:100%;height:100%;position:absolute;">\n        <% } %>\n    <%}else{ %>\n        <% if(iDetail.iMask){%>\n            <img draggable="false" class="Context" src="<%=iDetail.iImg[0].picture%>" style="width:<%=iDetail.iMask_data.width%>px;height:<%=iDetail.iMask_data.height%>px;position:absolute;max-width:none;">\n        <%}else{%>\n            <img draggable="false" class="Context" src="<%=iDetail.iImg[0].picture%>" style="width:100%;height:100%;position:absolute;">\n        <% } %>\n    <%}%>\n<%}%>'}),define("interaction_view/model/image",["interaction_view/model/base","text!interaction_view/template/imageitem.js"],function(){require("text!interaction_view/template/imageitem.js");interaction_view.model.Image=interaction_view.model.Base.extend({defaults:{iType:"Image",iLock:!0,iVisibility:!0,iCommon:null,iDetail:{iAdapt:!1,iFullview:!1,iImg:null,iAnimation:[]},iParentModel:null,iTemplate:null,iParentdiv:".interaction-view",iSync:!1,iZindex:"-1",callback:null},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(){this.iview=new interaction_view.view.Image({model:this})},setsyncmodel:function(){}}),interaction_view.view.Image=interaction_view.view.Base.extend({events:{},render:function(){this.renderMask(),this.renderDraggable(),this.firstRender=!0,this.isEraserSet=!1,this.detail.isMasterArrow&&this.$el.addClass("master_arrow_icon")},renderMask:function(){var e=this.getdetail();e.iMask&&(this.$el.children(".Element").find("img").first().css({translate:[e.iMask_data.x,e.iMask_data.y]}),this.iScrollview&&this.iScrollview.scrollTo(e.iMask_data.x,e.iMask_data.y))},preload:function(){},getLayerContentSize:function(){var e=this.getdetail(),t={};return e.iImg&&e.iImg.length>0?(t.width=e.iMask_data.width,t.height=e.iMask_data.height,t):null},setOtherDisplay:function(){var e=this.getdetail();e.iImg&&e.iImg.length>0&&e.iMask&&e.iMask_data.iSlipable&&(this.renderMask(),this.setMaskSlipable({items:this.$el.children(".Element").find("img").first(),containment:this.$el.children(".Element").children(),contentel:this.$el.children(".Element").find("img").first(),content_x:e.iMask_data.x,content_y:e.iMask_data.y})),e.iDisplay&&e.iImg&&e.iImg.length>0&&_g.ui.fitImage(this.$el.children(".Element").find("img").length?{fit:Number(e.iDisplay),width:e.iImg[0].width,height:e.iImg[0].height,items:this.$el.children(".Element").find("img"),parentHeight:parseInt(this.$el.children(".Element").css("height")),parentWidth:parseInt(this.$el.children(".Element").css("width"))}:{fit:Number(e.iDisplay),containment:this.$el.children(".Element").find(".image_wrap").first()}),e.iFullview&&this.fullview(),e.iEraser&&(this.model._reset=!0,this.el_str=this.$el.children(".Element").html(),this.setEraser())},resetOtherStatus:function(){this.$el.removeClass("invisible noevents"),this.resetEraser(),this.resetDragDrop()},fullview:function(){if("undefined"==typeof wx_permissions||!wx_permissions.previewImage){var e=this,t=this.getdetail();t.iImg&&t.iImg.length>0&&(this.$el.addClass("hasaction"),this.$el.children(".Element").on("click",function(){opts={picture:t.iImg[0].picture,width:t.iImg[0].width,height:t.iImg[0].height,model:e.getGalleryModel(),index:e.model.get("GalleryIndex")},e.setFullView(opts)}))}},setEraser:function(){var e=this.getdetail();if(e.iEraser){var t=this.getcommon();this.$el.children(".Element").css("cursor","pointer"),this.$el.children(".Element").addClass("disableDragX disableDragY"),this.$el.find("img").first().is(":hidden")?this.isEraserSet=!1:(_e.eraser&&_e.eraser.set(this.$el.find("img").first(),t.iWidth,t.iHeight,this),this.isEraserSet=!0)
}},resetEraser:function(){this.firstRender||this.onShow(),this.isEraserSet||this.setEraser(),this.firstRender=!1},isFullSwitch:function(){return null!=this.model.get("GalleryIndex")?!0:void 0},getGalleryModel:function(){var e=[];for(i=0;i<this.path.length;i++){if("Gallery"==this.path[i].type){e.push(this.path[i]);break}e.push(this.path[i])}var t=interaction_view.getContainerModelByPath(e);return t},repaint:function(){this.$el.children(".Element").html(this.el_str)},onShow:function(){var e=this.getdetail();e.iEraser&&(this.repaint(),this.setEraser())},getDragCopy:function(){var e=$("<div></div>").addClass("DragCopy").attr({id:this.model.id+"_drag_copy"}).css({position:"absolute",opacity:this.$el.css("opacity")});return e.html($("<div/>").attr({style:this.$el.children(".Element").attr("style")})),e.children().html(this.$el.children(".Element").children().clone()),e},getClientXY:function(e){return"ontouchend"in document?{x:e.clientX,y:e.clientY}:{x:e.gesture.center.pageX,y:e.gesture.center.pageY}},resetDragDrop:function(){if(this.getdetail().draggable){var e=this;"undefined"==typeof e.DragDrops&&(e.DragDrops=e.model.page.iOverlaylist.where({iType:"DragDrop"}),!e.DragDrops.length&&(e.DragDrops=!1)),e.DragDrops&&("undefined"==typeof e.MaxZindex&&(e.MaxZindex=e.model.page.iOverlaylist.models.length+1e3),e.Status=0,1==this.getdetail().dragend&&(e.Status=2)),e.Pos={left:e.x,top:e.y},e.Drag_opacity=.8999,e.$el.siblings(".DragCopy").remove()}},setDraggable:function(e,t,i,n){function a(){h&&(u=e.css("z-index"),h=!1),interaction_view.events.onDragStart(p),s=e.position(),l=e.css("opacity"),e.css({"z-index":c.MaxZindex+100,opacity:e.css("opacity")>=1?c.Drag_opacity:e.css("opacity")}),i(e),e.stop(!0,!0),c.resetDragDropStatus()}function r(t,i,n){if(s&&s.left){{var a,r=$.zoom?$.zoom:1,o=s.left+t/r,l=s.top+i/r,h=e.css("transform")||e.css("-webkit-transform");h.split(",")}a="vertical"==d.limit?{y:l}:"horizontal"==d.limit?{x:o}:{x:o,y:l},interaction_view.setPos(e,_.extend(a,{force3D:interaction_view.force3D})),interaction_view.events.onDragging(p),c.activeDragDrop(e,n)}}function o(){interaction_view.events.onDragEnd(p),e.css({"z-index":u,opacity:e.css("opacity")-c.Drag_opacity<1e-5?l:e.css("opacity")}),n(e)}var s,l,c=this,d=this.getdetail(),h=!0,u=e.css("z-index");e.data({Drop:t}).addClass("disableDragX disableDragY");var p={page_id:c.model.page.id,overlay_id:c.model.id,layer_id:c.model.get("layer_id")};if(c.model.page.id||(p.layer_id=c.model.page.iOverlaylist.layerid),"ontouchend"in document){var v=!1,g=0,f=0;e.on("touchstart",function(e){e=e.originalEvent.touches[0],v=!0,g=e.clientX,f=e.clientY,a()}).on("touchmove",function(e){return e=e.originalEvent.touches[0],r(e.clientX-g,e.clientY-f,e),!1}).on("touchend touchcancel",function(e){e=e.originalEvent.touches[0],v&&o(),v=!1})}else e.hammer().on("dragstart",a).on("drag",function(e){r(e.gesture.deltaX,e.gesture.deltaY,e)}).on("dragend",o)},activeDragDrop:function(e,t){if(this.DragDrops){var i=this,n=$.zoom?$.zoom:1,a=this.getClientXY(t);$.each(i.DragDrops,function(e,t){var r=t.iview.$el.children(".Element"),o={x:r.offset().left*n,y:r.offset().top*n},s={x:o.x+r.width()*n,y:o.y+r.height()*n};a.x>=o.x&&a.x<=s.x&&a.y>=o.y&&a.y<=s.y?(0!=i.$el.parent().children("#"+i.model.id+t.id).length||t.iview.active||i.trigger_dragin_event(t),t.iview.changeStatus(!1)):t.iview.changeStatus(!0)})}},getDropXY:function(e){var t,i=e.iview.getcommon(),n=e.iview.$el.children(".Element").offset();return t=e.iview.$el.parents(".iLayerRef:first").length?e.iview.$el.parents(".iLayerRef:first").offset():e.iview.$el.parents(".interaction-area:first").offset(),{x:n.left-t.left+i.iWidth/2,y:n.top-t.top+i.iHeight/2}},resetDragDropStatus:function(){var e=this;$.each(e.DragDrops,function(t,i){i.iview.Status=0;var n=e.$el.parent().children("[data-drop="+i.id+"]");if(n.length){i.iview.Status=2;var a=n.attr("data-drag");_.include(i.iview.getdetail().element_ids,a)&&(i.iview.Status=1)}})},renderDraggable:function(){function e(e){if(1==n.dragstart){var t=i.getDragCopy();e.before(t),TweenMax.to(t,0,{x:e.position().left,y:e.position().top,force3D:interaction_view.force3D})}0==i.Status&&(i.Pos=e.position())}function t(e){var t=0;$.each(i.DragDrops,function(a,r){if(r.iview.active){r.iview.changeStatus();var o=r.iview.getdetail(),s=i.$el.parent().children("#"+i.model.id+r.id);if(o.onlyright&&!_.include(o.element_ids,i.model.id)||0!=s.length)return t=1,0!=s.length&&0==n.dragin&&(t=3,e.css({"z-index":parseInt(r.iview.$el.css("z-index"))+1}),TweenMax.to(e,.4,i.getDropXY(r))),!1;t=2,0!=r.iview.Status&&i.old_transit_back(r),i.drag_dragin(r)}}),2>t&&i.drag_dragend(1==t?1:null)}var i=this,n=this.getdetail();n.draggable&&(this.model._reset=!0,i.setDraggable(i.$el,null,e,t))},drag_dragend:function(e){var t=this.$el,i=t.position(),n=t.parent().children("#"+this.model.id+"_drag_copy");1==this.Status&&(this.Status=0),this.lastCopy&&this.lastCopy.remove()&&(this.lastCopy=null),1==(e||parseInt(this.getdetail().dragend))?(i=this.Pos,TweenMax.to(t,.4,{x:i.left,y:i.top})):0==this.Status&&(this.Pos=t.position()),TweenMax.to(n,.4,{x:i.left,y:i.top,opacity:0,force3D:interaction_view.force3D,onComplete:function(){n.remove()}})},drag_dragin:function(e){var t=this,i=this.getdetail(),n=t.$el.parent().children("#"+t.model.id+"_drag_copy");switch(parseInt(i.dragin)){case 0:if(0==t.Status&&(t.Status=1),0==t.$el.parent().children("#"+t.model.id+e.id).length){t.lastCopy&&t.lastCopy.remove()&&t.resetDragDropStatus();var a=t.getDragCopy().attr({id:t.model.id+e.id,"data-drop":e.id,"data-drag":t.model.id}).hide();t.$el.before(a),t.lastCopy=a}t.$el.css("z-index",parseInt(e.iview.$el.css("z-index"))+1),TweenMax.to(t.$el,.4,_.extend(t.getDropXY(e),{force3D:interaction_view.force3D,onComplete:function(){t.trigger_drop_event(e)}})),1==i.dragstart&&TweenMax.to(n,.4,_.extend(t.getDropXY(e),{opacity:0,force3D:interaction_view.force3D,onComplete:function(){n.remove()}}));break;case 1:1!=i.dragstart&&(n=t.getDragCopy(),t.$el.before(n)),n.attr({id:t.model.id+e.id,"data-drop":e.id,"data-drag":t.model.id}).css({"z-index":parseInt(e.iview.$el.css("z-index"))+1,opacity:n.css("opacity")-t.Drag_opacity<1e-5?1:n.css("opacity")}),TweenMax.to(n,0,{x:t.$el.position().left,force3D:interaction_view.force3D,y:t.$el.position().top}),TweenMax.to(t.$el,.4,{x:t.Pos.left,y:t.Pos.top,force3D:interaction_view.force3D}),TweenMax.to(n,.4,_.extend(t.getDropXY(e),{force3D:interaction_view.force3D,onComplete:function(){t.trigger_drop_event(e),t.renderCopyDraggable(e,n)}}));break;case 2:n.remove(),n=t.getDragCopy().attr({id:t.model.id+e.id,"data-drop":e.id,"data-drag":t.model.id}).hide(),t.$el.before(n),TweenMax.to(t.$el,0,{x:t.Pos.left,y:t.Pos.top,force3D:interaction_view.force3D,onComplete:function(){t.trigger_drop_event(e)}})}},renderCopyDraggable:function(e,t){function i(){0==n.getdetail().dragstart&&n.$el.hide()}var n=this;this.setDraggable(t,e,i,n.copy_dragend)},copy_dragend:function(e){var t=this,i=this.getdetail(),n=e.data("Drop"),a=0;if($.each(t.DragDrops,function(i,r){if(r.id==n.id)r.iview.active&&(TweenMax.to(e,.4,t.getDropXY(n)),r.iview.changeStatus(),a=1);else if(r.iview.active){n.iview.Status=0,r.iview.changeStatus();var o=r.iview.getdetail();if(o.onlyright&&!_.include(o.element_ids,t.model.id))return a=1,t.old_transit_back(n,t.model.id),!1;0!=r.iview.Status&&t.old_transit_back(r),TweenMax.to(e,.4,t.getDropXY(r)),t.$el.siblings("#"+t.model.id+r.id).remove(),e.attr({id:t.model.id+r.id,"data-drop":r.id,"data-drag":t.model.id}).css("z-index",parseInt(r.iview.$el.css("z-index"))+1),e.data("Drop",r),a=1,t.trigger_drop_event(r)}}),0==i.dragstart&&t.$el.show(),0==a){var r=e.position();0==i.dragend&&1==i.dragstart?(TweenMax.to(e,.4,{opacity:0,force3D:interaction_view.force3D,onComplete:function(){e.remove()}}),TweenMax.to(t.$el,.4,{x:r.left,y:r.top,force3D:interaction_view.force3D})):(TweenMax.to(t.$el,0,{x:e.position().left,y:e.position().top,force3D:interaction_view.force3D}),1==i.dragend&&1==i.dragstart?TweenMax.to(e,0,{x:t.Pos.left,y:t.Pos.top,force3D:interaction_view.force3D,onComplete:function(){TweenMax.to(e,.4,{opacity:0,force3D:interaction_view.force3D,onComplete:function(){e.remove()}})}}):e.remove()),t.drag_dragend()}},old_transit_back:function(e,t){var i=e.iview.$el.parent().children("[data-drop="+e.id+"]"),t=t||i.attr("data-drag");i.attr("id",t+"_drag_copy"),this.model.page.iOverlaylist.where({id:t})[0].iview.drag_dragend(1)},trigger_dragin_event:function(e){interaction_view.events.onDragDrop(e,this.model,0)},trigger_drop_event:function(e){interaction_view.events.onDragDrop(e,this.model),interaction_view.events.onDragDropGroup(e)},replaceImg:function(e){var t=this.$el.children(".Element").find("img");t.length?t.attr("src",e):(t=this.$el.find(".image_wrap").first(),t.length&&(e?t.css("background-image","url("+e+")"):t.css("background-image","")));try{this.model.attributes.iDetail.iImgs[0].picture=e}catch(i){}}})}),define("interaction_view/model/page",["_g/mvc","interaction_view/view/page"],function(){var e={defaults:{iType:"Page",position:0,description:"",title:"untitled",picture:null,preview:'<img src="/staticfs/admin-epub360/img/thumb.png">',thumbnail:null,width:null,height:null,bg_color:"#FFFFFF",bg_opacity:1,show_master:!0},autoIndex:!0,callback:function(){"page_group"!=this.get("type")&&(this.iOverlaylist=new interaction_view.collection.list,this.iAnimationlist=new interaction_view.collection.Animation,this.iActionlist=new interaction_view.collection.Action,this.ipreloadlist=new interaction_view.collection.Preload,this.ipreloadlist.pageid=this.iOverlaylist.pageid=this.iAnimationlist.pageid=this.iActionlist.pageid=this.id,this.iAnimationlist.iPage_id=this.id,this.iAnimationlist.page=this)},overlays:[],actions:[],animations:[]};return _g.mvc.createModel(e)}),define("interaction_view/collection/page",["_g/mvc","interaction_view/model/page"],function(){var e={enableSync:!1,model:require("interaction_view/model/page"),getTreeModels:function(e){var t=[];return e.each(function(e){if(t.push(e),e.icollection)for(var i=_g.mvc.getTreeModels(e.icollection),n=0;n<i.length;n++)t.push(i[n])}),t},getPageModels:function(){return this.pagemodels?this.pagemodels:(this.pagemodels=this.getTreeModels(this),this.pagemodels)},getPages:function(){var e=this.getPageModels();return e=_.reject(e,function(e){return"page_group"==e.toJSON().type})},getPagesJSON:function(){var e=this.getPageModels();return e=_.reject(e,function(e){return"page_group"==e.toJSON().type}),e=_.map(e,function(e){return e.toJSON()})},getPage:function(e){var t=this.getPageModels();return _.find(t,function(t){return t.id==e})},getIndexPages:function(){var e=this.getPages();return _.filter(e,function(e){return e.get("is_index")})},getElement:function(e,t,i){if(interaction_view.ipagelist.getPage(t)||interaction_view.imasterlist.get(t)){var n=interaction_view.ipagelist.getPage(t)||interaction_view.imasterlist.get(t);return n.iOverlaylist.get(i)}return e.iOverlaylist.get(i)}};return _g.mvc.createCollection(e)}),define("interaction_view/view/layer",["interaction_view/view/page"],function(){var e=require("interaction_view/view/page"),t=$.extend({},e,{template:null,className:null,containment:null,wrap:null,wrapClassName:null,autoRender:!1,position:1,parseData:null,afterload:function(){var e=this,t=this.model.get("iDetail").layer_ids,i=this.model.offset?this.model.offset:{x:0,y:0};t&&0!=t.length&&(_.each(t,function(t){var n=interaction_view.ilayerlist.get(t)||interaction_view.iComponentlist.get(t);n&&(e.animations=_.map(n.animations,function(i){return i.pageid=e.model.id,i.parentpageid=e.model.get("pageid"),i.pagetype="LayerRef",i.layerid=t,i}),e.model.layer[t].iAnimationlist.reset(e.animations),overlays=_.filter(n.overlays,function(e){return interaction_view.model[e.iType]}),overlays=_.map(overlays,function(n){var a=$.extend(!0,{},n);return a.pageid=e.model.id,a.parentpageid=e.model.get("pageid"),a.pagetype="LayerRef",a.layerid=t,a.path=e.model.layer[t].iOverlaylist.path,a.isSubOverlay=!0,a.isLayerOverlay=!0,i.x&&(a._offset_x=i.x),i.y&&(a._offset_y=i.y),a.iCommon.landscape.iStarty=a.iCommon.landscape.iStarty+i.y,a.iCommon.landscape.iStartx=a.iCommon.landscape.iStartx+i.x,new interaction_view.model[n.iType](a)}),e.model.layer[t].iOverlaylist.reset(overlays),e.model.layer[t].iOverlaylist.each(function(e){e.iview.setZindex()}),e.actions=_.map(n.actions,function(i){return i.pageid=e.model.id,i.parentpageid=e.model.get("pageid"),i.pagetype="LayerRef",i.layerid=t,i}),e.model.layer[t].iActionlist.reset(n.actions))}),e.startLayerLoad())},startLayerLoad:function(){var e=this;_.each(this.model.layer,function(t,i){0==t.ipreloadlist.length?e.model.iview.afterlayerload(i):t.ipreloadlist.preload()})}});return t}),define("interaction_view/model/layer",["interaction_view/model/page"],function(){var e=require("interaction_view/model/page"),t=e.extend({defaults:{iType:"Layer",position:0,description:"",title:"untitled",picture:null,preview:'<img src="/staticfs/admin-epub360/img/thumb.png">',thumbnail:null,width:null,height:null,layer_width:1024,layer_height:768,bg_color:"#FFFFFF",bg_opacity:1},callback:function(){this.actions=this.get("actions"),this.animations=this.get("animations"),this.overlays=this.get("overlays")}});return t}),define("interaction_view/collection/layer",["interaction_view/collection/page","interaction_view/model/layer"],function(){var e=require("interaction_view/collection/page"),t=e.extend({model:require("interaction_view/model/layer")});return t}),define("interaction_view/model/master",["interaction_view/model/page"],function(){var e=require("interaction_view/model/page"),t=e.extend({defaults:{iType:"Master",position:0,description:"",title:"untitled",picture:null,preview:'<img src="/staticfs/admin-epub360/img/thumb.png">',thumbnail:null,width:null,height:null,bg_color:"#FFFFFF",bg_opacity:1,pageno_horizontal:{show:!1,x:500,y:20},pageno_vertical:{show:!1,x:20,y:300}}});return t}),define("interaction_view/view/master",["interaction_view/view/page"],function(){var e=require("interaction_view/view/page"),t=$.extend({},e,{template:null,className:null,containment:null,wrap:null,wrapClassName:null,autoRender:!1,position:1,parseData:null,isMaster:!0});return t}),define("interaction_view/collection/master",["interaction_view/collection/page","interaction_view/model/master","interaction_view/view/master"],function(){var e=require("interaction_view/collection/page"),t=e.extend({model:require("interaction_view/model/master")});return t}),define("interaction_view/model/background",["interaction_view/model/page"],function(){var e=require("interaction_view/model/page"),t=e.extend({defaults:{iType:"Background",position:0,description:"",title:"untitled",picture:null,preview:'<img src="/staticfs/admin-epub360/img/thumb.png">',thumbnail:null,width:null,height:null,bg_color:"#FFFFFF",bg_opacity:1,pageno_horizontal:{show:!1,x:500,y:20},pageno_vertical:{show:!1,x:20,y:300}}});return t}),define("interaction_view/view/background",["interaction_view/view/page"],function(){var e=require("interaction_view/view/page"),t=$.extend({},e,{template:null,className:null,containment:null,wrap:null,wrapClassName:null,autoRender:!1,position:1,parseData:null,isBackground:!0,prepareLoad:function(){var e=this,t=this.model;t&&(e.animations=_.map(e.animations,function(t){return t.pageid=e.model.id,t.pagetype="background",t}),e.model.iAnimationlist.reset(e.animations),overlays=_.filter(e.overlays,function(t){return t.pageid=e.model.id,t.pagetype="background",interaction_view.model[t.iType]}),overlays=_.map(overlays,function(e){return new interaction_view.model[e.iType](e)}),e.model.iOverlaylist.reset(overlays),e.model.iOverlaylist.each(function(e){e.iview.setZindex()}),e.actions=_.map(e.actions,function(t){return t.pageid=e.model.id,t.pagetype="background",t}),e.model.iActionlist.reset(e.actions))}});return t}),define("interaction_view/collection/background",["interaction_view/collection/page","interaction_view/model/background","interaction_view/view/background"],function(){var e=require("interaction_view/collection/page"),t=e.extend({model:require("interaction_view/model/background")});return t}),define("interaction_view/model/component",["interaction_view/model/page"],function(){var e=require("interaction_view/model/page"),t=e.extend({defaults:{iType:"Component",bg_color:"#FFFFFF",bg_opacity:1},callback:function(){this.actions=this.get("actions"),this.animations=this.get("animations"),this.overlays=this.get("overlays")}});return t}),define("interaction_view/collection/component",["interaction_view/collection/page","interaction_view/model/component"],function(){var e=require("interaction_view/collection/page"),t=e.extend({model:require("interaction_view/model/component")});return t}),define("interaction_view/model/doc",["_g/mvc","interaction_view/collection/page","interaction_view/view/page","interaction_view/view/layer","interaction_view/collection/layer","interaction_view/collection/master","interaction_view/collection/background","interaction_view/collection/component"],function(){var e={defaults:{id:"doc",play_mode:0},autoUpdate:!1,fetchUrl:context_url+"index.json",staticFetchUrl:"/staticfs/common/js/interaction_view/data/index.json",parse:function(e){return console.log("fetch data:"+e),200==e.code?e.data?(interaction_view.size={x:e.data.width||1024,y:e.data.height||768},interaction_view.screen_mode=e.data.screen_mode,interaction_view.force3D=e.data.force_3d&&interaction_view.ismobile?"auto":!1,this.initShareApp(e),this.initEnvironment(),"undefined"!=typeof configpage&&configpage.init(e),this.initMasters(e),workEnd("-------- 1.1.1 touchinit 1 initMasters --------"),this.initBackgrounds(e),workEnd("-------- 1.1.2 touchinit 1 initBackgrounds --------"),this.initLayers(e),workEnd("-------- 1.1.3 touchinit 1 initLayers --------"),this.initPages(e),workEnd("-------- 1.1.4 touchinit 1 initPages --------"),this.initComponents(e),this.initApplications(e),"undefined"!=typeof e_api&&this.initApi(e),this.initDbs(e),this.initGlobals(e),workEnd("-------- 1.1.5 touchinit 1 initApplications --------"),interaction_view.ismobile||interaction_view.forpreview||(e.data.bg_color=void 0!=e.data.desktop_bg_color?e.data.desktop_bg_color:e.data.bg_color,e.data.bg_opacity=void 0!=e.data.desktop_bg_opacity?e.data.desktop_bg_opacity:e.data.bg_opacity,e.data.screen_mode=void 0!=e.data.desktop_screen_mode?e.data.desktop_screen_mode:e.data.screen_mode,e.data.show_excontent=void 0!=e.data.desktop_show_excontent?e.data.desktop_show_excontent:e.data.show_excontent,e.data.adapt=void 0!=e.data.desktop_adapt?e.data.desktop_adapt:e.data.adapt),_.omit(e.data,"layers","masters","chapter","organization","applications")):{}:void 0},initMasters:function(e){var t=require("interaction_view/collection/master");e.data.masters||(e.data.masters=[]),interaction_view.imasterlist=_g.mvc.createTreeByData({collection:t,data:e.data.masters})},initBackgrounds:function(e){var t=require("interaction_view/collection/master");e.data.backgrounds||(e.data.backgrounds=[]),interaction_view.ibackgroundlist=_g.mvc.createTreeByData({collection:t,data:e.data.backgrounds})},initLayers:function(e){var t=require("interaction_view/collection/layer");e.data.layers||(e.data.layers=[]),interaction_view.ilayerlist=_g.mvc.createTreeByData({collection:t,data:e.data.layers})},initComponents:function(e){var t=require("interaction_view/collection/component");e.data.components||(e.data.components=[]),interaction_view.iComponentlist=_g.mvc.createTreeByData({collection:t,data:e.data.components})},initPages:function(e){var t,i=require("interaction_view/collection/page");t=e.data.chapter,workEnd("-------- 1.1.4.2 touchinit pagedata parseOrgnization--------"),interaction_view.ipagelist=_g.mvc.createTreeByData({collection:i,data:t}),workEnd("-------- 1.1.4.3 touchinit interaction_view ipagelist--------"),_g.mvc.createTreeView({collection:interaction_view.ipagelist,view:require("interaction_view/view/page"),containment:"div.slides",wrap:null}),workEnd("-------- 1.1.4.4 touchinit interaction_view createTreeView--------")},initApplications:function(e){interaction_view.applications=e.data.applications,interaction_view.actionforapp={},interaction_view.application.buttons=[],interaction_view.application.buttonGroups=[],_.each(interaction_view.applications,function(e){"form"==e.type&&interaction_view.application.initForm(e),e.actions&&e.actions.length&&(interaction_view.actionforapp[e.id]=new interaction_view.collection.Action,interaction_view.actionforapp[e.id].add(e.actions),interaction_view.actionforapp[e.id].each(function(e){e.iview.render()}))})},initShareApp:function(e){interaction_view.shareapp={id:""},e.data.shareapp&&""!=e.data.shareapp.id&&(interaction_view.shareapp=e.data.shareapp,interaction_view.environment.Shareapp.init())},initEnvironment:function(){interaction_view.environment.Sharedata.init(),interaction_view.environment.Userdata.init()},initApi:function(e){e_api._initialize(e.data.api_data||[])},initDbs:function(e){var e=e.data.dbs,t=Backbone.Model.extend({defaults:{id:"",querys:[],sheet_id:"",fields:[]}}),i=Backbone.Collection.extend({model:t});interaction_view.dblist=new i,_.each(e,function(e){interaction_view.dblist.add({id:e.id,querys:e.iDetail.querys,sheet_id:e.iDetail.sheet_id,fields:e.iDetail.fields})});var n=new dboperate;n.query()},initGlobals:function(e){var e=e.data.globals;interaction_view.DEBUG&&(_.find(e,function(e){return"Debug"==e.iType})||e.push({id:"debug"+_g.uuid(3),iType:"Debug",iDetail:{}}));var t=Backbone.Model.extend({initialize:function(){interaction_view.view[this.get("iType")]&&(this.iview=new(interaction_view.view[this.get("iType")])({model:this}))}}),i=Backbone.Collection.extend({model:t});interaction_view.globallist=new i,_.each(e,function(e){interaction_view.globallist.add(e)}),_.each(interaction_view.globallist.models,function(e){2==e.attributes.iDetail.iKind&&(e.attributes.iDetail.initial=interaction_view.setRandom(e.attributes.iDetail))})},callback:function(){}};return _g.mvc.createModel(e)}),define("text!interaction_view/template/preload.js",[],function(){return'<img src="<%=file%>" width="1" height="1" id="<%=id%>"/>'}),define("interaction_view/model/preload",["interaction_view/model/base","text!interaction_view/template/preload.js"],function(){require("text!interaction_view/template/preload.js");interaction_view.model.Preload=interaction_view.model.Base.extend({defaults:{iType:"Preload",iCommon:null,iDetail:null,iParent:"",iChild:"",iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!0,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0,callback:null,loaded:!1},setcollection:function(){if(this.pageid=this.get("pageid"),"LayerRef"==this.get("pagetype")){var e=this.get("parentpageid"),t=this.get("layerid"),i=interaction_view.getParentpage(e);this.page=i.iOverlaylist.get(this.pageid).layer[t]}else this.get("isSubOverlay")?(this.path=this.get("path"),this.page=interaction_view.getContainerModelByPath(this.path)):this.page=interaction_view.getParentpage(this.pageid);this.page.ipreloadlist.get(this.id)||this.page.ipreloadlist.add(this)},setview:function(){if(this.pageid=this.get("pageid"),"LayerRef"==this.get("pagetype")){var e=this.get("parentpageid"),t=this.get("layerid"),i=interaction_view.getParentpage(e);this.page=i.iOverlaylist.get(this.pageid).layer[t]}else this.get("isSubOverlay")?(this.path=this.get("path"),this.page=interaction_view.getContainerModelByPath(this.path)):this.page=interaction_view.getParentpage(this.pageid);"master"==this.get("pagetype")&&(this.isMasterOverlay=!0),this.iview=new interaction_view.view.Preload({model:this})},setsyncmodel:function(){}}),interaction_view.collection.Preload=interaction_view.collection.Base.extend({preloadcheck:function(e,t,i){this.where({loaded:!0});if(interaction_view.ismobile||0!=t||console.log("file:"+e+" load failed!"),i.iview.afterpreload(e),0==this.where({loaded:!1}).length)if("LayerRef"==this.pagetype){var n=this.parentpageid,a=this.layerid,r=interaction_view.getParentpage(n);refmodel=r.iOverlaylist.get(this.pageid),refmodel.iview.afterlayerload(a)}else if(this.subcontainer){var o=interaction_view.getContainerModelByPath(this.path);o.iview.afterSubOverlayPreload()}else interaction_view.finishPagePreload(this.pageid)},preload:function(){this.each(function(e){e.get("loaded")||e.iview.render()})}}),interaction_view.view.Preload=interaction_view.view.Base.extend({events:{},initstart:function(){},renderDynamicElement:function(){},render:function(){var e=this,t=this.elementmodel=e.model.page.iOverlaylist.get(this.model.get("overlay_id")),i=this.model.get("elementtype");if("Audio"==i)console.info("Audio"),this.audioPreload();else if("Video"==i)this.videoPreload();else if("QQVideo"==i)this.qqVideoPreload();else if("LayerRef"==i||"LayerSlide"==i||"ComponentRef"==i)this.layerPreload(this.model);else if(this.model.get("subcontainer"))this.subcontainerPreload(this.model);else{var n=e.model.toJSON().file;$('img[id="'+this.model.id+'"]').length>0&&($('img[id="'+this.model.id+'"]')[0].onload=function(){interaction_view.iImgs[n]=this},$('img[id="'+this.model.id+'"]')[0].src=n),e.model.set("loaded",!0),workEnd("-------- 4 "+this.model.id+" = "+n),e.model.page.ipreloadlist.preloadcheck(e.model.toJSON().file,!0,t)}},audioPreload:function(){interaction_view.media.audio.init(this.model,this.elementmodel,this.model.isMasterOverlay)},videoPreload:function(){interaction_view.media.video.init(this.model,this.elementmodel,this.model.toJSON().file)},qqVideoPreload:function(){var e=this,t=this.model.toJSON().vid,i="http://h5vv.video.qq.com/getinfo?charge=0&otype=json&ehost=http%3A%2F%2Fv.qq.com&sphls=1&sb=1&nocache=0&_rnd=1474261459084&_qv_rmt=Uc82pmhDA17215iGZ=&_qv_rmt2=z7Bhn62F144649fOw=&sdtfrom=v5010";$.ajax({url:i,dataType:"jsonp",data:{callback:"tvp_request_getinfo_callback_865977",platform:11001,vids:t,defaultfmt:"auto"},jsonp:"callback",timeout:3e3,success:function(t){try{var i=t.vl.vi[0].ul.ui[0].url+t.vl.vi[0].fn+"?vkey="+t.vl.vi[0].fvkey;interaction_view.media.video.init(e.model,e.elementmodel,i)}catch(n){console.log(n),e.elementmodel.loaded=!0,e.model.set("loaded",!0),e.model.page.ipreloadlist.preloadcheck(e.elementmodel.toJSON().file,!0,e.elementmodel)}},error:function(t){console.log(t),e.elementmodel.loaded=!0,e.model.set("loaded",!0),e.model.page.ipreloadlist.preloadcheck(e.elementmodel.toJSON().file,!0,e.elementmodel)}})},layerPreload:function(){this.elementmodel.iview.loadLayer(this.model)},subcontainerPreload:function(){this.elementmodel.iview.loadSubOverlay(this.model)}}),interaction_view.ipreloadlist=new interaction_view.collection.Preload}),define("interaction_view/model/richtext",["interaction_view/model/base"],function(){interaction_view.model.RichText=interaction_view.model.Base.extend({defaults:{iType:"RichText",iLock:!0,iVisibility:!0,iCommon:{portait:{iStartx:400,iStarty:200,iWidth:200,iHeight:200},landscape:{iStartx:400,iStarty:200,iWidth:200,iHeight:200}},iDetail:{iAdapt:!1,iFullview:!1,iImg:null,iAnimation:[]},iParent:"",iChild:"",iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0,callback:null},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(){this.iview=new interaction_view.view.RichText({model:this})},setsyncmodel:function(){}}),interaction_view.view.RichText=interaction_view.view.Base.extend({events:{},render:function(){interaction_view.ismobile,this.scrollEl=this.$el.children(".Element"),this.model._reset=!0},resetOtherStatus:function(){var e=this;if(this.$el.children(".Element").find(".el_wrap").length){if(this.$el.children(".Element").find(".el_wrap").first().length&&_g.ui.isOverflowed(this.$el.children(".Element").find(".el_wrap").first()).y){if(!this.$el.children(".Element").hasClass("disableDragY")){var t=this.$el.find(".el_wrap").first(),i=t.height();t.wrapInner('<div class="iContent" style="font-size: inherit;color: inherit;font-family: inherit;font-weight:inherit;"></div>');var n=_g.ui.isOverflowed(t).y-i;this.scrollView=new IScroll(t[0],{mouseWheel:!0,click:!0,probeType:3,wrapperHeight:i,HWCompositing:!0}),this.scrollView.on("scroll",function(){n&&n>0&&(this.y>0?this.y>30&&e.scrollEl.addClass("is_exceededY"):Math.abs(this.y)-n>30&&e.scrollEl.addClass("is_exceededY"))}),this.scrollEl=this.$el.children(".Element"),this.$el.children(".Element").addClass("disableDragY iMouseWheel disableMouseWheelY")}this.$el.children(".Element").removeClass("is_exceededX"),this.$el.children(".Element").removeClass("is_exceededY")}}else if(_g.ui.isOverflowed(this.$el.children(".Element")).y){if(!this.$el.children(".Element").hasClass("disableDragY")){var i=this.$el.children(".Element").height();this.$el.children(".Element").wrapInner('<div class="iContent"></div>');var n=_g.ui.isOverflowed(this.$el.children(".Element")).y-i;this.scrollView=new IScroll(this.$el.children(".Element")[0],{mouseWheel:!0,click:!0,probeType:3,HWCompositing:!0}),this.scrollView.on("scroll",function(){n&&n>0&&(this.y>0?this.y>30&&e.scrollEl.addClass("is_exceededY"):Math.abs(this.y)-n>30&&e.scrollEl.addClass("is_exceededY"))}),this.scrollEl=this.$el.children(".Element"),this.$el.children(".Element").addClass("disableDragY iMouseWheel disableMouseWheelY")}this.$el.children(".Element").removeClass("is_exceededX"),this.$el.children(".Element").removeClass("is_exceededY")}},otherOnShow:function(){this.resetOtherStatus()}})}),define("interaction_view/model/slide",["interaction_view/model/base"],function(){interaction_view.model.Slide=interaction_view.model.Base.extend({defaults:{iType:"Slide",iCommon:{portait:{iStartx:400,iStarty:200,iWidth:200,iHeight:200},landscape:{iStartx:400,iStarty:200,iWidth:200,iHeight:200}},iDetail:{},iParent:"",iChild:"",iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSlideNumber:!0,isSlide:!0,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0,callback:null},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(){var e=this.get("iDetail");e.show_title&&this.setSubOverlays(),this.iview=new interaction_view.view.Slide({model:this})},setsyncmodel:function(){}}),interaction_view.view.Slide=interaction_view.view.Base.extend({events:{},render:function(){var e=this,t=this.getdetail();this.renderBackGroud(),this.currentSlideIndex=null,this.model.on("slideTo",function(i){return null!=e.currentSlideIndex&&e.currentSlideIndex==i?!1:(e.preloaded&&(interaction_view.events.onChangeTo(e.model.get("pageid"),e.model.id,i),e.currentSlideIndex=i,e.setTitle(i)),e.rmbLast=i,void(t.iRememberLast&&interaction_view.environment.Paragraph.state()&&e.addToUrl(i)))}),this.model._reset=!0},getSlideLength:function(){var e=this.getdetail();return e.iImg?e.iImg.length:0},preload:function(){var e,t=this,i=this.getdetail();this.checkImglist=_.pluck(i.iImg,"1"==_g.getUrlParameterByName("-playmode")?"thumbnail":"picture"),this.preloaded=!1;var n=[];i.iImg&&i.iImg.length&&(_.each(i.iImg,function(i){e="1"==_g.getUrlParameterByName("-playmode")?i.thumbnail:i.picture;var a=t.sendToPreload({file:e});n.push(a.id)}),i.show_title&&this.sendToPreload({file:null,subcontainer:!0,path:this.model.get("path"),isSubOverlay:this.model.get("isSubOverlay")})),this.model.set("preload_id",n)},checkImgload:function(e){return this.checkImglist=_.reject(this.checkImglist,function(t){return t==e}),0==this.checkImglist.length?!0:!1},afterpreload:function(e){if((!e||!this.preloaded)&&(e&&(this.preloaded=this.checkImgload(e)),this.preloaded)){var t=this,i=this.getdetail();if(i.show_title&&this.preloadmodel.get("loaded"))return;if(this.setZindex(),this.setElementDisplay(),this.setSlideImageDisplay(),this.slideel=this.$el.children(".Element").find(".slidecontent").first(),this.slidelength=this.getdetail().iImg.length,this.fullview(),this.playAnimation(),this.copyelstyle=this.$el.attr("style"),this.copyelementstyle=this.$el.children(".iElement").attr("style"),i.iRememberLast&&"Flow"!=i.iFade)return t.rmbLast=t.getFromUrl(),void t.setElementTo(t.rmbLast)
}},afterSubOverlayPreload:function(){this.preloadmodel&&(this.model.iOverlaylist.each(function(e){e.iview.preloaded||e.iview.afterpreload()}),this.model.iActionlist.each(function(e){e.iview.render()}),this.setTitle(0),this.preloadmodel.set("loaded",!0),this.preloadmodel.page.ipreloadlist.preloadcheck(null,!0,this.model))},playAnimation:function(){this.timeline&&this.timeline.clear();var e=this.getdetail(),t=(e.iSlidetype,!1);this.$el.children(".Element").is(":hidden")&&(t=!0),this.delay=Number(e.iInterval)||2,this.autoplay=e.iAutoplay;var i=e.iRepeat?-1:0;this.iFade=e.iFade||0,this.timeline=new TimelineMax({paused:!0,repeat:i,onComplete:this.setRewind}),this.repeat=i,this.iRewind=e.iRewind,this.slipable=e.iSlipable,this.canSlip=!0,this.iDisplay=e.iDisplay,this.setTimeline(),"Flow"!=e.iFade&&(this.autoplay?this.model._autoplay=!0:this.setSlideDisplay(0),this.onChangeSlideTo(0),this.slipable&&(this.control(),this.autoplay||this.$el.attr("data-iSlipable",!0)))},_autoplay:function(){var e=!1;this.$el.children(".Element").is(":hidden")&&(e=!0),this.timeline&&(!e||interaction_view.ismobile||this.model.isMasterOverlay)&&this.timeline.play(0)},setTimeline:function(){if("Fade"==this.iFade)this.setFade(),2==this.iDisplay&&this.slideel.find("img").css("left",0);else if("Slip"==this.iFade)this.slideel.css("overflow","hidden"),this.setSlip();else if("None"==this.iFade)this.setNone();else{if("Flip"!=this.iFade)return"Flow"==this.iFade?void this.setFlowAll():void 0;2==this.iDisplay&&(this.slideel.wrapInner('<div class="slidewrap" style="width:100%;height:100%;position:absolute;"></div>'),this.slideel=this.slideel.children(".slidewrap"),this.slideel.find("img").css("left",0)),this.slideel.hasClass("overflowhidden")&&(this.slideel.removeClass("overflowhidden"),this.slideel.parent().addClass("overflowhidden").css("border",this.slideel.css("border")).css("border-radius",this.slideel.css("border-radius")),this.slideel.css("border","none").css("border-radius","0")),this.setFlip()}this.slideel.children().first().css({opacity:1,left:0,top:0}).nextAll().css("opacity",0)},setFlowAll:function(){function e(e){var t=$(e).height()||o/e.width*e.height,i=$("<canvas></canvas>").attr({width:o,height:t}).css({"float":"left"});$(e).after(i),TweenMax.to(i,0,{transform:"matrix(1, 0, 0, -1, 0, 0)"});var n=i[0].getContext("2d");n.drawImage(e,0,0,o,t);var a=n.createLinearGradient(0,0,0,t);n.globalCompositeOperation="destination-in",a.addColorStop(1,"rgba(0,0,0,0.4)"),a.addColorStop(.6,"rgba(0,0,0,0)"),a.addColorStop(0,"rgba(0,0,0,0)"),n.fillStyle=a,n.fillRect(0,0,o,t)}function t(){if(c++,n.slidelength<=c){n.slideel.children().find("img").css({width:o}).each(function(t,i){e(i)}),n.slideel.children().animate({opacity:1});var t=n.slideel.parents("section.Presentation:first").attr("style");n.slideel.parents("section.Presentation:first").css({display:"block",visibility:"hidden"}),n.CoverFlow=n.slideel.children().coverflow({active:Math.floor((n.slidelength-1)/2),overlap:.3,perspectiveY:22,duration:300,beforeselect:function(e,t){n.model.trigger("slideTo",t.index)},select:function(e,t){n.currentIndex=t.index}}).width("+=100").height("100%"),n.slideel.children().children().each(function(e,t){var i=$(t).find("img").height();$(t).width(o),$(t).children().css({position:"absolute"}),$(t).find("img").css({bottom:.3*a+"px"}),$(t).find("canvas").css({bottom:.3*a-i+"px"})}),n.slideel.parents("section.Presentation:first").attr("style",t),n.setFlow(),i(),s.iRememberLast&&(n.rmbLast=n.getFromUrl(),n.setElementTo(n.rmbLast))}}function i(){if(n.slipable){var e=["mousedown","mousemove","mouseup"];n.isTouch()&&(e=["touchstart","touchmove","touchend touchcancel"]);var t=n.CoverFlow.parent().width();n.CoverFlow.on(e[0],function(i){function a(e){n.isTouch()&&(e=e.originalEvent.touches[0]);var i=(e.clientX-r)/t;return n.isTouch()&&(i*=2),i=Math.round(i*n.slidelength),i=s-i,0>i&&(i=0),i>=n.slidelength&&(i=n.slidelength-1),n.CoverFlow.coverflow("select",i),o=!0,!1}n.isTouch()&&(i=i.originalEvent.touches[0]);var r=i.clientX,o=!1,s=n.CoverFlow.children(".ui-state-active").index();return $(document).on(e[1],a),$(document).one(e[2],function(){function t(){n.CoverFlow.data("CoverFlowDisableClick",!1)}return $(document).off(e[1],a),o&&n.CoverFlow.data("CoverFlowDisableClick",!0)&&setTimeout(t,10),!1}),n.isTouch()&&!o&&n.CoverFlow.coverflow("select",$(i.target).parent().index()),n.isTouch()?void 0:!1});var i=n.getdetail().iSlidetype?n.getdetail().iSlidetype:0;n.$el.children(".Element").addClass("æ¨ªå‘"==i||0==Number(i)?"enableMouseWheelX disableDragX":"enableMouseWheelY disableDragY")}}var n=this,a=this.getcommon().iHeight,r=this.getcommon().iWidth,o=.7*r,s=this.getdetail();n.slideel.children().removeAttr("style").wrap("<div></div>"),n.slideel.wrapInner("<div></div>"),n.slideel.children().css({opacity:0});var l=_.pluck(s.iImg,"1"==_g.getUrlParameterByName("-playmode")?"thumbnail":"picture");_.each(l,function(e){var i=new Image;i.src=e,i.onload=function(){i.height/i.width*o>.7*a&&(o=.7*a/i.height*i.width),t()}});var c=0},isTouch:function(){return"ontouchstart"in document},testControl:function(){return!0},resetOtherStatus:function(){if(this.slideel){var e=this,t=this.getdetail();if("Flow"!=t.iFade&&this.slideel.children().first().css({opacity:1,left:0,top:0}),this.autoplay=t.iAutoplay,this.currentIndex=0,this.currentSlideIndex=null,this.hasSlideNumber&&(this.setSlideNumberPosition(),this.changeSlideNumber()),this.$el.children(".Element").removeClass("is_exceededX"),this.$el.children(".Element").removeClass("is_exceededY"),this.timeline){var i=Math.floor((this.slidelength-1)/2);if(this.timeline.pause(1e-5),t.iRememberLast)return e.rmbLast=e.getFromUrl(),void e.setElementTo(e.rmbLast);if("Flow"==t.iFade&&this.CoverFlow){this.currentIndex=i;try{this.CoverFlow.coverflow("select",i),this.currentIndex=i}catch(n){}}if(!this.autoplay||this.$el.children(".Element").is(":hidden")&&!interaction_view.ismobile)this.setSlideDisplay(0);else{if("Flow"==t.iFade)return void this.timeline.play(.3*(i-1)+i*this.delay);this.timeline.play(0)}}}},fullview:function(){var e=this,t=this.getdetail();if(t.iFullview&&t.iImg&&t.iImg.length){if(this.$el.addClass("hasaction"),"Flow"==t.iFade)return void(e.isTouch()?e.slideel.hammer().on("tap",".ui-state-active",function(){e.fullviewIndex($(this).index())}):e.slideel.on("click",".ui-state-active",function(){e.fullviewIndex($(this).index())}));this.$el.children(".Element").on("click",function(t){return e.stopFullviewByFlow?(e.stopFullviewByFlow=!1,!1):e.slipable&&!$(t.target).is(t.currentTarget)?!1:(null!=e.currentIndex&&"undefined"!=e.currentIndex&&e.fullviewIndex(e.currentIndex),!1)})}},isFullSwitch:function(){var e=this.getdetail();return e.iSlipable},preview_left:function(e){e>0&&this.fullviewIndex(e-1)},preview_right:function(e){var t=this.getdetail();e<t.iImg.length-1&&this.fullviewIndex(e+1)},setTitle:function(e){var t=this.getdetail();if(t.show_title&&t.iImg&&t.iImg.length&&t.iImg[e]){var i=this.model.get("suboverlays"),n=interaction_view.formatLabel({text:t.iImg[e].title,font_size:i[0].iDetail.font_size,text_color:i[0].iDetail.text_color,iPosition:i[0].iDetail.iPosition});this.$el.find(".iTextLabel.Element").html(n)}},getFromUrl:function(e){var t=_g.getUrlParameterByName(this.model.id,e);if(t||(t=_g.getHashParameterByName(this.model.id)),null==t&&"epub360"==epub360_domain&&""!=interaction_view.environment.Sharedata.id)if(1==interaction_view.environment.Sharedata.status)interaction_view.environment.Sharedata.addView(this);else{var i=this.model.get("pageid"),n=interaction_view.environment.Sharedata.getitem(i,this.model.id);n&&(t=n.value)}return t},addToUrl:function(e){var t=this.getdetail();if(!t.iRememberLast)return!1;"undefined"==typeof message_link&&(message_link=document.location.href,interaction_view.weixin.share()),"undefined"==typeof e&&(e=this.currentIndex);var i=this.model.id+"="+encodeURI(e),n=_g.getUrlParameterByName(this.model.id,message_link),a=0,r=message_link;if(n)encodeURI(n)!=encodeURI(e)?r=_g.replaceUrlParameterByName(this.model.id,i,message_link):a=1;else{var o="?";message_link.indexOf("?")>=0&&(o="&"),r+=o+i}if("epub360"==epub360_domain&&!a&&interaction_view.environment.Sharedata.enabled&&interaction_view.environment.Sharedata.setitem(this,{value:encodeURI(e)}),a||(message_link=r,interaction_view.weixin.share()),!interaction_view.forpreview){var s=_g.getHashParameterByName(this.model.id);s?encodeURI(s)!=encodeURI(e)?window.history.replaceState({},"",_g.replaceHashParameterByName(this.model.id,i)):a=1:window.history&&(document.location.hash?window.history.replaceState({},"",document.location.hash+="&"+i):window.history.replaceState({},"","#"+i))}return a?!1:!0},setControl:function(e){this.getdetail();this.addToUrl(),this.control(),this.canSlip=!0,e||this.slipable||(this.canSlip=!1)}})}),define("interaction_view/model/video",["interaction_view/model/base"],function(){interaction_view.model.Video=interaction_view.model.Base.extend({defaults:{iType:"Video",iLock:!0,iVisibility:!0,iCommon:{portait:{iStartx:400,iStarty:200,iWidth:200,iHeight:200},landscape:{iStartx:400,iStarty:200,iWidth:200,iHeight:200}},iDetail:{iAdapt:!1,iFullview:!1,iImg:null,iAnimation:[]},iParent:"",iChild:"",iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0,callback:null,iBackground:"rgba(62,189,255,0.5)",iResourcesProperties:[{id:"iImg",type:"single"}],iAnimationProperties:[{id:"iAnimation",type:"object"}]},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(){this.iview=new interaction_view.view.Video({model:this})},setsyncmodel:function(){},getFile:function(){var e=this.get("iDetail");return e.iFile&&e.iFile[0]?e.iFile[0].file:null}}),interaction_view.view.Video=interaction_view.view.Base.extend({events:{},render:function(){this.file,this.model._reset=!0},setOtherDisplay:function(){this.model.media&&interaction_view.media.pause(this.model)},preload:function(){var e,t=this.getdetail();t.iFile&&t.iFile[0]&&(e="undefined"!=typeof epub360&&epub360.settings&&epub360.settings.disable_stream_media?t.iFile[0].file:"undefined"==typeof cbt_data||interaction_view.forpreview?"1"==_g.getUrlParameterByName("-playmode")?(t.iFile[0].file||t.iFile[0].content)+"_video.m3u8":"2"==_g.getUrlParameterByName("-playmode")?(t.iFile[0].file||t.iFile[0].content)+"":interaction_view.ismobile?(t.iFile[0].file||t.iFile[0].content)+"_origin.mp4":(t.iFile[0].file||t.iFile[0].content)+"_videohd.m3u8":t.iFile[0].file||t.iFile[0].content,this.file=e),this.file&&(this.preloadmodel=this.sendToPreload({file:this.file}))},resetOtherStatus:function(){if(!this.model.hided&&this.model.media){this.model.hls?interaction_view.media.video.resetH(this.model,this):interaction_view.media.video.reset(this.model);var e=this.model.get("iDetail").iAutohide;if(null==e&&(e=!0),e){if(this.model.hls&&this.model.reseted)return;this.$el.addClass("hide")}else this.model.get("iDetail").iControl&&this.$el.find(".jwdisplayIcon").css({opacity:1})}}})}),define("interaction_view/model/button",["interaction_view/model/base"],function(){interaction_view.model.Button=interaction_view.model.Base.extend({defaults:{iType:"Button",iVisibility:!0,iCommon:null,iDetail:null,iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(){var e=this.get("iDetail");e.isSwitch&&(this.isSwitch=!0),this.iview=new interaction_view.view.Button({model:this})},setsyncmodel:function(){}}),interaction_view.view.Button=interaction_view.view.Base.extend({events:{},render:function(){this.model._reset=!0},preload:function(){this.preloaded=!1,this.checkImglist=[];var e=this.getdetail(),t=[null,null];if(e.iconNormal&&e.iconNormal[0]){this.checkImglist.push(e.iconNormal[0].picture);var i=this.sendToPreload({file:e.iconNormal[0].picture,path:this.model.get("path"),isSubOverlay:this.model.get("isSubOverlay")});t[0]=i.id}if(e.iconActive&&e.iconActive[0]){this.checkImglist.push(e.iconActive[0].picture);var i=this.sendToPreload({file:e.iconActive[0].picture,path:this.model.get("path"),isSubOverlay:this.model.get("isSubOverlay")});t[1]=i.id}this.model.set("preload_id",t)},checkImgload:function(e){return this.checkImglist=_.reject(this.checkImglist,function(t){return t==e}),0==this.checkImglist.length?!0:!1},afterpreload:function(e){e&&this.preloaded||(e&&!this.preloaded&&(this.preloaded=this.checkImgload(e)),this.preloaded&&(this.setZindex(),this.setElementDisplay(),this.setOtherDisplay(),this.copyelstyle=this.$el.attr("style"),this.copyelementstyle=this.$el.children(".iElement").attr("style")))},setOtherDisplay:function(){this.active=!1,this.buttonon=!1;var e=this;this.$el.css("cursor","pointer");var t=this.getdetail();if(t.isSwitch)t.isMasterAudio&&(this.$el.addClass("master_audio_icon"),this.$el.find(".iconNormal").addClass("animated infinite rotate c-time-20"),"undefined"!=typeof bgsound_autostart&&bgsound_autostart||interaction_view.forpreview||(this.init_reverse=!0)),this.$el.on("click",function(){e.changeStatus(),void 0!=t.linktype&&interaction_view.renderLink(t.linktype,t)});else{if(interaction_view.ismobile)var i="touchstart",n="touchend";else var i="mousedown",n="mouseup";this.$el.on(i,function(){e.buttonon=!0,e.changeStatus(),void 0!=t.linktype&&interaction_view.renderLink(t.linktype,t)}),this.$el.on(n,function(){e.buttonon&&(e.buttonon=!1,e.changeStatus())})}},changeStatus:function(){var e=this.getdetail(),t=this;if(t.active){if(t.groupcontrol&&e.isSwitch)return;if(t.model.get("isTabBarButton"))return;if(t.$el.find("img.iconActive").hide(),t.$el.find("img.iconNormal").show(),t.active=!1,e.isMasterAudio)try{var i=interaction_view.bgsound||interaction_view.imasterlist.at(0).iOverlaylist.where({iType:"Audio"})[0];interaction_view.media.play(i)}catch(n){console.log(n)}}else if(t.$el.find("img.iconActive").show(),t.$el.find("img.iconNormal").hide(),t.active=!0,e.isMasterAudio)try{var i=interaction_view.bgsound||interaction_view.imasterlist.at(0).iOverlaylist.where({iType:"Audio"})[0];interaction_view.media.pause(i)}catch(n){console.log(n)}},setActiveStatus:function(){var e=this;e.$el.find("img.iconActive").show(),e.$el.find("img.iconNormal").hide(),e.active=!0},resetOtherStatus:function(){this.resetButtonStatus()},resetButtonStatus:function(){this.init_reverse?(this.$el.find("img.iconActive").show(),this.$el.find("img.iconNormal").hide(),this.active=!0):(this.$el.find("img.iconActive").hide(),this.$el.find("img.iconNormal").show(),this.active=!1)}})}),define("interaction_view/model/pay",["interaction_view/model/base"],function(){interaction_view.model.Pay=interaction_view.model.Base.extend({defaults:{iType:"Pay",iLock:!0,iVisibility:!0,iCommon:{portait:{iStartx:400,iStarty:200,iWidth:200,iHeight:200},landscape:{iStartx:400,iStarty:200,iWidth:200,iHeight:200}},iDetail:{iAdapt:!1,iFullview:!1,iImg:null,iAnimation:[]},iParent:"",iChild:"",iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0,callback:null},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(){this.iview=new interaction_view.view.Pay({model:this})},setsyncmodel:function(){}}),interaction_view.view.Pay=interaction_view.view.Base.extend({events:{},render:function(){}})}),define("interaction_view/model/link",["interaction_view/model/base"],function(){interaction_view.model.Link=interaction_view.model.Base.extend({defaults:{iType:"Link",iLock:!0,iVisibility:!0,iCommon:{portait:{iStartx:400,iStarty:200,iWidth:200,iHeight:200},landscape:{iStartx:400,iStarty:200,iWidth:200,iHeight:200}},iDetail:{},iParent:"",iChild:"",iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0,callback:null},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(){this.iview=new interaction_view.view.Link({model:this})},setsyncmodel:function(){}}),interaction_view.view.Link=interaction_view.view.Base.extend({events:{},render:function(){var e=this.getdetail();this.$el.on("click",function(){void 0!=e.linktype&&interaction_view.renderLink(e.linktype,e)})}})}),define("interaction_view/model/binding",["interaction_view/model/base"],function(){interaction_view.model.Binding=interaction_view.model.Base.extend({defaults:{iType:"Binding",iCommon:{portait:{iStartx:400,iStarty:200,iWidth:200,iHeight:200},landscape:{iStartx:400,iStarty:200,iWidth:200,iHeight:200}},iDetail:{iAdapt:!1,iFullview:!1,iImg:null,iAnimation:[]},iParent:"",iChild:"",iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0,callback:null},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(){this.iview=new interaction_view.view.Binding({model:this})},setsyncmodel:function(){}}),interaction_view.view.Binding=interaction_view.view.Base.extend({events:{},renderDynamicElement:function(){this.detail=this.model.attributes.iDetail},render:function(){},preload:function(){},afterpreload:function(){if(this.model.pageid=this.model.get("pageid"),this.model.parentpageid=this.model.get("parentpageid"),"LayerRef"==this.model.get("pagetype")){var e=this.model.get("parentpageid"),t=this.model.get("layerid"),i=interaction_view.getParentpage(e);this.model.parentpage=i,this.model.page=i.iOverlaylist.get(this.model.pageid).layer[t]}else this.model.page=interaction_view.getParentpage(this.model.pageid);var n=this,a=this.getdetail();if(this.bindings=a.iBindings,this.bindings.length>1){{this.getControlBinding()}_.each(this.bindings,function(e){interaction_view.events.bindingEvents.push({id:e.id,page_id:e.page_id,direction:e.direction,func:function(e){n.executeBinding(n,e)}})})}this.preloaded=!0},getControlBinding:function(){return _.find(this.bindings,function(e){return e.isControl})?_.find(this.bindings,function(e){return e.isControl}):(this.bindings[0].isControl=!0,this.bindings[0])},getOperateBindings:function(){return _.reject(this.bindings,function(e){return e.isControl})},getBindingElement:function(e,t){var i;return i=interaction_view.getParentpage(e)?interaction_view.getParentpage(e):this.model.page,i.iOverlaylist.get(t)},getDirection:function(e,t){var i=this.getControlBinding();return t.id==i.id?e.direction?1:-1:e.id==i.id?t.direction?1:-1:t.direction==e.direction?1:-1},resetBindingStatus:function(){var e,t=this;_.each(this.bindings,function(i){var n=interaction_view.ipagelist.getElement(t.model.page,i.page_id,i.id);if(n)if(i.isControl)if("offset"==i.property){var a=n.iview.getCurrentPositionRate();interaction_view.events.onBingChangeTo({type:0,page_id:n.get("pageid"),id:n.id,delta:-1,deltarate:a.left,cdirection:0}),interaction_view.events.onBingChangeTo({type:0,page_id:n.get("pageid"),id:n.id,delta:-1,deltarate:a.top,cdirection:1})}else e=n.iview.singletime?n.iview.singletime:1e-5,interaction_view.events.onBingChangeTo({type:1,page_id:n.get("pageid"),id:n.id,delta:e/n.iview.timeline.duration(),reset:!0});else"offset"==i.property&&(n.bindingfixed=!0)})},executeBinding:function(e,t){_.each(this.bindings,function(i){if(i.id!=t.id){var n=e.getDirection(i,t),a=e.getBindingElement(i.page_id,i.id);if(a){var r=$.extend(!0,{},t);r.direction=n,r.delta=n*r.delta,r.deltarate=1==n?r.deltarate:e.getRevertRate(a,r.deltarate),r.revert=1==n?!1:!0,a.iview.onExecuteBinding(r)}}})},getRevertRate:function(e,t){if("LayerRef"==e.get("iType"))return 1-t;var i=(e.iview.slidelength,1-t);return i},resetStatus:function(){}})}),define("interaction_view/model/SubContainer",["interaction_view/model/base","interaction_view/view/subcontainer"],function(){interaction_view.model.SubContainer=interaction_view.model.Base.extend({defaults:{iType:"SubContainer",iCommon:{portait:{iStartx:400,iStarty:200,iWidth:200,iHeight:200},landscape:{iStartx:400,iStarty:200,iWidth:200,iHeight:200}},iDetail:{iAdapt:!1,iFullview:!1,iImg:null,iAnimation:[]},iParent:"",iChild:"",iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0,callback:null},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(){this.setSubOverlays(),this.patchGridSize(),this.setiview()},createPath:function(){var e=interaction_view.createPath({path:this.get("path"),isSubOverlay:this.get("isSubOverlay"),page_id:this.get("pageid"),model:this});return e},setiview:function(){this.iview=new interaction_view.view.SubContainer({model:this})},setsyncmodel:function(){},GridPatch:!0,patchGridSize:function(){if(this.GridPatch){var e=this.get("iCommon"),t=this.get("iDetail"),i=this.get("suboverlays");e[iPageDirection].iWidth=(t.iCols+1)*t.iColspace+i[0].iCommon[iPageDirection].iWidth*t.iCols,e[iPageDirection].iHeight=(t.iRows+1)*t.iRowspace+i[0].iCommon[iPageDirection].iHeight*t.iRows,this.set("iCommon",e)}},getSubOverlays:function(){var e=(this.get("iCommon"),this.get("iDetail")),t=[],n=this.get("suboverlays"),a=n[0],r=e.iRows,o=e.iCols;for(i=0;r>i;i++)for(j=0;o>j;j++)overlay=$.extend(!0,{},a),overlay.id=overlay.id+i+j,overlay.iCommon[iPageDirection].iStartx=e.iColspace*(j+1)+j*overlay.iCommon[iPageDirection].iWidth,overlay.iCommon[iPageDirection].iStarty=e.iRowspace*(i+1)+i*overlay.iCommon[iPageDirection].iHeight,t.push(overlay);return t},createImageSubOverlay:function(e){var t=(e.iFullview,{iType:"Image",iDetail:{iMask:!1,iFullview:e.iFullview,title:e.iImg[0].title,ratiofixxed:!1,iHidden:!1,iImg:e.iImg,iAdapt:!1,iDisplay:e.iDisplay||0},iCommon:{portait:{iWidth:e.iWidth,iHeight:e.iHeight,iStartx:e.iStartx,iStarty:e.iStarty},landscape:{iWidth:e.iWidth,iHeight:e.iHeight,iStartx:e.iStartx,iStarty:e.iStarty}},id:"Img"+_g.uuid(),iHidden:e.iHidden||!1,GalleryIndex:e.index});return t},GridReverse:function(){var e=this.get("iDetail");return e.iSlidetype?!1:!0},getOverlayPositionX:function(e,t,i,n){return this.GridReverse()?t*(i+1)+i*e.iCommon[iPageDirection].iWidth:t*(n+1)+n*e.iCommon[iPageDirection].iWidth},getOverlayPositionY:function(e,t,i,n){return this.GridReverse()?t*(n+1)+n*e.iCommon[iPageDirection].iHeight:t*(i+1)+i*e.iCommon[iPageDirection].iHeight}}),interaction_view.view.SubContainer=interaction_view.view.Base.extend({events:{},render:function(){this.renderBackGroud()},subPreLoadCheck:function(){},preload:function(){this.model.get("iDetail");this.sendToPreload({file:null,subcontainer:!0,path:this.model.get("path"),isSubOverlay:this.model.get("isSubOverlay")})},afterSubOverlayPreload:function(){console.log("preloadok"),this.preloadmodel&&(this.model.iOverlaylist.each(function(e){e.iview.preloaded||e.iview.afterpreload()}),this.model.iActionlist.each(function(e){e.iview.render()}),this.preloadmodel.set("loaded",!0),this.preloadmodel.page.ipreloadlist.preloadcheck(null,!0,this.model)),interaction_view.ismobile&&_g.ui.isOverflowed(this.$el.children(".Element")).y&&this.$el.children(".Element").addClass("iMouseWheel disableMouseWheelY disableDragY"),this.otherAfterSubOverlayPreload&&this.otherAfterSubOverlayPreload()},allowScroll:!0,resetOtherStatus:function(){return this.allowScroll?void 0:!1}})}),define("interaction_view/model/gallery",["interaction_view/model/SubContainer"],function(){interaction_view.model.Gallery=interaction_view.model.SubContainer.extend({defaults:{iType:"Gallery",iCommon:{portait:{iStartx:400,iStarty:200,iWidth:200,iHeight:200},landscape:{iStartx:400,iStarty:200,iWidth:200,iHeight:200}},iDetail:{iAdapt:!1,iFullview:!1,iImg:null,iAnimation:[]},iParent:"",iChild:"",iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSlideNumber:!0,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0,callback:null},setiview:function(){this.iview=new interaction_view.view.Gallery({model:this})},getSubOverlays:function(){var e=this.get("iDetail"),t=this.get("iCommon"),n=[],a=this.get("suboverlays"),r=a[0],o=e.iRows,s=e.iCols;if(e.iMode||(e.iSlidetype?o=100:s=100),this.GridReverse()){var l=o;o=s,s=l}var c=0,d=0;if(e.iImg&&e.iImg.length){for(i=0;!(c>=e.iImg.length);i++){for(i==o&&(i=0,d+=1),j=0;s>j&&!(c>=e.iImg.length);j++){overlay=$.extend(!0,{},r),overlay.id=overlay.id+i+j+c,overlay.parent_index=d,overlay.suboverlays[0].iDetail.iText=interaction_view.formatLabel({text:_g.string.getUrlNameWithOutExt(e.iImg[c].title),font_size:overlay.suboverlays[0].iDetail.font_size,text_color:overlay.suboverlays[0].iDetail.text_color,iPosition:overlay.suboverlays[0].iDetail.iPosition}),void 0==e.show_title||e.show_title||overlay.suboverlays.shift();var h=this.createImageSubOverlay({iImg:[e.iImg[c]],iFullview:e.iFullscreen,iWidth:r.iCommon[iPageDirection].iWidth,iHeight:r.iCommon[iPageDirection].iHeight,iStartx:0,iStarty:0,iDisplay:Number(e.iDisplay),index:e.iSlipable?c:null});overlay.suboverlays.unshift(h),overlay.iCommon[iPageDirection].iStartx=this.getOverlayPositionX(overlay,e.iColspace,i,j),overlay.iCommon[iPageDirection].iStarty=this.getOverlayPositionY(overlay,e.iRowspace,i,j),overlay.iCommon[iPageDirection].iStartx>t[iPageDirection].iWidth&&(e.overflow_x=!0),overlay.iCommon[iPageDirection].iStarty>t[iPageDirection].iHeight&&(e.overflow_y=!0),n.push(overlay),c+=1}e.overflow_length=i+1}e.overflow_x&&(e.overflow_x=r.iCommon[iPageDirection].iWidth*e.overflow_length+e.iColspace*(e.overflow_length+1)),e.overflow_y&&(e.overflow_y=r.iCommon[iPageDirection].iHeight*e.overflow_length+e.iRowspace*(e.overflow_length+1)),d+=1}return e.slidelength=d,this.set("iDetail",e),n},patchGridSize:function(){if(this.GridPatch){var e=this.get("iCommon"),t=this.get("iDetail"),i=this.get("suboverlays");(t.iMode||!t.iMode&&t.iSlidetype)&&(e[iPageDirection].iWidth=(t.iCols+1)*t.iColspace+i[0].iCommon[iPageDirection].iWidth*t.iCols),(t.iMode||!t.iMode&&!t.iSlidetype)&&(e[iPageDirection].iHeight=(t.iRows+1)*t.iRowspace+i[0].iCommon[iPageDirection].iHeight*t.iRows),this.set("iCommon",e)}}}),interaction_view.view.Gallery=interaction_view.view.SubContainer.extend({otherAfterSubOverlayPreload:function(){var e=this.getSlideLength(),t=this.getdetail(),n=t.iCols*t.iRows;if(t.iMode||(n=t.iImg?t.iImg.length:0),e){var a=this.$el.children(".Element").children().detach(),r=0;for(i=0;e>i;i++)for(this.$el.children(".Element").append('<div class="gallery-content" data-index="'+i+'"></div>'),j=0;n>j;j++){var o=this.$el.children(".Element").children().eq(i);o.append(a[r]),r+=1}this.setSlidePosition()}},getSlideLength:function(){var e=this.getdetail();return e.slidelength||0},setSlidePosition:function(){var e=this.getdetail(),t=this.getcommon();e.iMode?(this.$el.children(".Element").addClass("hasSlide"),this.$el.children(".Element").css({overflow:"hidden"}),this.$el.children(".Element").children().each(function(){$(this).index();$(this).css({position:"absolute",width:"100%",height:"100%"})}),this.playAnimation()):e.iSlidetype?(this.$el.children(".Element").css({overflow:"hidden"}),this.$el.children(".Element").children().each(function(){var e=$(this).index();$(this).css({position:"absolute",left:0,top:e*t.iHeight,width:"100%",height:"100%"})}),this.galleryFlow().y&&(this.$el.children(".Element").addClass("iMouseWheel disableMouseWheelY disableDragY"),this.scrollview=new IScroll(this.$el.children(".Element")[0],{mouseWheel:!0,probeType:3,scrollX:!1,scrollY:!0,click:!0,wrapperWidth:t.iWidth,wrapperHeight:t.iHeight,scrollerWidth:t.iWidth,scrollerHeight:e.overflow_y}))):(this.$el.children(".Element").css({overflow:"hidden"}),this.$el.children(".Element").children().each(function(){var e=$(this).index();$(this).css({position:"absolute",left:e*t.iWidth,top:0,width:"100%",height:"100%"})}),this.galleryFlow().x&&(this.$el.children(".Element").addClass("iMouseWheel disableMouseWheelX disableDragX"),this.scrollview=new IScroll(this.$el.children(".Element")[0],{mouseWheel:!0,probeType:3,scrollX:!0,scrollY:!1,click:!0,wrapperWidth:t.iWidth,wrapperHeight:t.iHeight,scrollerWidth:e.overflow_x,scrollerHeight:t.iHeight})))},playAnimation:function(){{var e=this,t=this.getdetail();t.iSlidetype}this.delay=Number(t.iInterval)||2,this.autoplay=t.iAutoplay,this.iFade="Slip";var i=0;this.timeline=new TimelineMax({paused:!0,repeat:i,onComplete:this.setRewind}),this.slideel=e.$el.children(".Element").first(),this.slidelength=this.getSlideLength(),this.repeat=i,this.iRewind=t.iRewind,this.slipable=!0,this.setTimeline(),this.autoplay?this.$el.children(".Element").is(":hidden")||this.timeline.play(0):this.setSlideDisplay(0),this.onChangeSlideTo(0),this.slipable&&(this.control(),this.autoplay||this.$el.attr("data-iSlipable",!0))},setTimeline:function(){if("Fade"==this.iFade)this.setFade();else if("Slip"==this.iFade)this.setSlip();else{if("None"!=this.iFade)return;this.setNone()}this.slideel.children().first().css({opacity:1,left:0,top:0}).nextAll().css("opacity",0)},testControl:function(){return!0},preview_left:function(e){e>0&&this.model.iOverlaylist.at(e-1).iOverlaylist.at(0).iview.$el.children(".Element").trigger("click")},preview_right:function(e){e<this.model.iOverlaylist.length-1&&this.model.iOverlaylist.at(e+1).iOverlaylist.at(0).iview.$el.children(".Element").trigger("click")},galleryFlow:function(){var e={x:!1,y:!1},t=(this.getcommon(),this.getdetail());return t.overflow_x&&(e.x=!0),t.overflow_y&&(e.y=!0),e},resetOtherStatus:function(){var e=this;return this.allowScroll?(this.$el.children(".Element").removeClass("is_exceededX"),this.$el.children(".Element").removeClass("is_exceededY"),void("undefined"!=typeof wx_permissions&&wx_permissions.previewImage&&e.$el.find(".iImage.Element").click(function(){var t=e.$el.find(".iImage.Element").index($(this));e.fullviewIndex(t)}))):!1}})}),define("interaction_view/model/Grid",["interaction_view/model/gallery"],function(){interaction_view.model.Grid=interaction_view.model.Gallery.extend({defaults:{iType:"Grid",iCommon:{portait:{iStartx:400,iStarty:200,iWidth:200,iHeight:200},landscape:{iStartx:400,iStarty:200,iWidth:200,iHeight:200}},iDetail:{iAdapt:!1,iFullview:!1,iImg:null,iAnimation:[]},iParent:"",iChild:"",iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0,callback:null},getSubOverlays:function(){var e=this.get("iDetail"),t=this.get("iCommon"),n=[],a=this.get("suboverlays"),r=a[0],o=e.iRows,s=e.iCols,l=0,c=0;for(i=0;o>i;i++)for(j=0;s>j;j++)overlay=$.extend(!0,{},r),overlay.id=overlay.id+i+j+l,overlay.parent_index=c,overlay.suboverlays=_.map(overlay.suboverlays,function(t){return("TextLabel"==t.iType||"BookButton"==t.iType)&&(t.iDetail.iText=interaction_view.formatLabel({text:t.iDetail.iText,font_size:t.iDetail.font_size,text_color:t.iDetail.text_color,iPosition:t.iDetail.iPosition,radius:t.iDetail.corner_radius,border_color:t.iDetail.border_color,bg_color:t.iDetail.bg_color,border_size:t.iDetail.border_size})),"Image"==t.iType&&(t.iDetail.iDisplay=e.iDisplay),t}),overlay.suboverlays=_.reject(overlay.suboverlays,function(t){return(e.show_title||"title"!=t.iDetail.iValue)&&(e.show_description||"description"!=t.iDetail.iValue)?void 0:!0}),overlay.iCommon[iPageDirection].iStartx=this.getOverlayPositionX(overlay,e.iColspace,i,j),overlay.iCommon[iPageDirection].iStarty=this.getOverlayPositionY(overlay,e.iRowspace,i,j),overlay.iCommon[iPageDirection].iStartx>t[iPageDirection].iWidth&&(e.overflow_x=!0),overlay.iCommon[iPageDirection].iStarty>t[iPageDirection].iHeight&&(e.overflow_y=!0),n.push(overlay),l+=1;
return e.slidelength=c,this.set("iDetail",e),n},setiview:function(){this.iview=new interaction_view.view.Grid({model:this})}}),interaction_view.view.Grid=interaction_view.view.Gallery.extend({allowScroll:!1})}),define("interaction_view/model/Cell",["interaction_view/model/SubContainer"],function(){interaction_view.model.Cell=interaction_view.model.SubContainer.extend({defaults:{iType:"Cell",iLock:!0,iVisibility:!0,iCommon:{portait:{iStartx:400,iStarty:200,iWidth:200,iHeight:200},landscape:{iStartx:400,iStarty:200,iWidth:200,iHeight:200}},iDetail:{},iParent:"",iChild:"",iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0,callback:null,isStatic:!0},setiview:function(){this.iview=new interaction_view.view.Cell({model:this})},GridPatch:!1,getSubOverlays:function(){var e=(this.get("iDetail"),this.get("suboverlays"));return e}}),interaction_view.view.Cell=interaction_view.view.SubContainer.extend({allowScroll:!1})}),define("interaction_view/model/TextLabel",["interaction_view/model/base"],function(){interaction_view.model.TextLabel=interaction_view.model.Base.extend({defaults:{iType:"TextLabel",iCommon:{portait:{iStartx:400,iStarty:200,iWidth:200,iHeight:200},landscape:{iStartx:400,iStarty:200,iWidth:200,iHeight:200}},iDetail:{iAdapt:!1,iFullview:!1,iImg:null,iAnimation:[]},iParent:"",iChild:"",iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0,callback:null},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(){this.iview=new interaction_view.view.TextLabel({model:this})},setsyncmodel:function(){}}),interaction_view.view.TextLabel=interaction_view.view.Base.extend({events:{},render:function(){this.model.get("iDetail")}})}),define("interaction_view/model/TabBar",["interaction_view/model/SubContainer"],function(){interaction_view.model.TabBar=interaction_view.model.SubContainer.extend({defaults:{iType:"TabBar",iCommon:{portait:{iStartx:400,iStarty:200,iWidth:200,iHeight:200},landscape:{iStartx:400,iStarty:200,iWidth:200,iHeight:200}},iDetail:{},iParent:"",iChild:"",iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0,callback:null},setiview:function(){this.iview=new interaction_view.view.TabBar({model:this})},GridPatch:!1,getSubOverlays:function(){var e=(this.get("iDetail"),this.get("suboverlays"));return e=_.map(e,function(e){return e.isTabBarButton=!0,e})}}),interaction_view.view.TabBar=interaction_view.view.SubContainer.extend({allowScroll:!1})}),define("interaction_view/model/SearchInput",["interaction_view/model/base"],function(){interaction_view.model.SearchInput=interaction_view.model.Base.extend({defaults:{iType:"SearchInput",iCommon:{portait:{iStartx:400,iStarty:200,iWidth:200,iHeight:200},landscape:{iStartx:400,iStarty:200,iWidth:200,iHeight:200}},iDetail:{},iParent:"",iChild:"",iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0,callback:null},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(){this.iview=new interaction_view.view.SearchInput({model:this})},setsyncmodel:function(){}}),interaction_view.view.SearchInput=interaction_view.view.Base.extend({events:{},render:function(){}})}),define("text!interaction_view/template/Tree_content.js",[],function(){return'<div class="treeview category-bookshelf inited">\n                <ul>\n                  <li>\n                    <div class="wraparea" style="border-bottom: 1px solid <%=iDetail.line_color%>;"><h4><a href="#" style="color:<%=iDetail.text_color%>;">æ‰€æœ‰</a></h4></div>\n                  </li>\n                  <li>\n                    <div class="wraparea" style="border-bottom: 1px solid <%=iDetail.line_color%>;"><h4><a href="#" style="color:<%=iDetail.text_color%>;">æœªåˆ†ç±»</a></h4></div>\n                  </li>\n                  <li class="hasmenu unfold">\n                    <div class="wraparea" style="border-bottom: 1px solid <%=iDetail.line_color%>;"><h4><a href="#" style="color:<%=iDetail.text_color%>;">åˆ†ç±» 1</a></h4><div class="hitarea"></div></div>\n                    <ul>\n                      <li class="active">\n                        <div class="wraparea" style="border-bottom: 1px solid <%=iDetail.line_color%>;background:<%=iDetail.selected_color%>;"><h4><a href="#" style="color:<%=iDetail.text_color%>;">åˆ†ç±» 1.1</a></h4></div>\n                      </li>\n                      <li>\n                        <div class="wraparea" style="border-bottom: 1px solid <%=iDetail.line_color%>;"><h4><a href="#" style="">åˆ†ç±» 1.2</a></h4></div>\n                      </li>\n                      <li>\n                        <div class="wraparea" style="border-bottom: 1px solid <%=iDetail.line_color%>;"><h4><a href="#" style="color:<%=iDetail.text_color%>;">åˆ†ç±» 1.3</a></h4></div>\n                      </li>\n                    </ul>\n                  </li>\n                  <li class="hasmenu unfold">\n                    <div class="wraparea" style="border-bottom: 1px solid <%=iDetail.line_color%>;"><h4><a href="#" style="color:<%=iDetail.text_color%>;">åˆ†ç±» 2</a></h4><div class="hitarea"></div></div>\n                    <ul>\n                      <li>\n                        <div class="wraparea" style="border-bottom: 1px solid <%=iDetail.line_color%>;"><h4><a href="#" style="color:<%=iDetail.text_color%>;">åˆ†ç±» 2.1</a></h4></div>\n                      </li>\n                      <li>\n                        <div class="wraparea" style="border-bottom: 1px solid <%=iDetail.line_color%>;"><h4><a href="#" style="color:<%=iDetail.text_color%>;">åˆ†ç±» 2.2</a></h4></div>\n                      </li>\n                    </ul>\n                  </li>\n                </ul>\n              </div>'}),define("interaction_view/model/Tree",["interaction_view/model/base","text!interaction_view/template/Tree_content.js"],function(){var e=require("text!interaction_view/template/Tree_content.js");interaction_view.model.Tree=interaction_view.model.Base.extend({defaults:{iType:"Tree",iCommon:{portait:{iStartx:400,iStarty:200,iWidth:200,iHeight:200},landscape:{iStartx:400,iStarty:200,iWidth:200,iHeight:200}},iDetail:{},iParent:"",iChild:"",iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0,callback:null},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(){this.iview=new interaction_view.view.Tree({model:this})},setsyncmodel:function(){}}),interaction_view.view.Tree=interaction_view.view.Base.extend({events:{},render:function(){var t=this.getdetail();if(t.is_expandable){var i='<img src="'+t.iImg+'" width="41px" height="38px"><img>';this.$el.children(".Element").html(i)}else this.$el.children(".Element").html(_.template(e,this.model.toJSON()))}})}),define("interaction_view/model/PageIndex",["interaction_view/model/SubContainer"],function(){interaction_view.model.PageIndex=interaction_view.model.SubContainer.extend({defaults:{iType:"PageIndex",iCommon:{portait:{iStartx:400,iStarty:200,iWidth:200,iHeight:200},landscape:{iStartx:400,iStarty:200,iWidth:200,iHeight:200}},iDetail:{iAdapt:!1,iFullview:!1,iImg:null,iAnimation:[]},iParent:"",iChild:"",iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0,callback:null},setiview:function(){this.iview=new interaction_view.view.PageIndex({model:this})},getSubOverlays:function(){var e=this.get("iDetail"),t=this.get("iCommon"),n=[],a=this.get("suboverlays"),r=a[0],o=(e.iRows,e.iCols),s=0;if(this.indexpages=interaction_view.foredit?iPagelist.getIndexPages():interaction_view.ipagelist.getIndexPages(),this.indexpages.length){for(i=0;!(s>=this.indexpages.length);i++)for(j=0;o>j&&!(s>=this.indexpages.length);j++){overlay=$.extend(!0,{},r),overlay.id=overlay.id+i+j,overlay.suboverlays[1].iDetail.iText=interaction_view.formatLabel({text:this.indexpages[s].get("title"),font_size:overlay.suboverlays[1].iDetail.font_size,text_color:overlay.suboverlays[1].iDetail.text_color,iPosition:overlay.suboverlays[0].iDetail.iPosition});var l=this.indexpages[s].get("nav");overlay.suboverlays[0].iDetail.iImg=l&&l.thumbnail?[l]:[],overlay.suboverlays[0].iDetail.iDisplay=1,this.get("iDetail").show_thumb||overlay.suboverlays.shift(),this.get("iDetail").show_title||overlay.suboverlays.shift(),overlay.iCommon[iPageDirection].iStartx=e.iColspace*(j+1)+j*overlay.iCommon[iPageDirection].iWidth,overlay.iCommon[iPageDirection].iStarty=e.iRowspace*(i+1)+i*overlay.iCommon[iPageDirection].iHeight,n.push(overlay),s+=1}e.overflow_y=(this.indexpages.length+1)*e.iRowspace+overlay.iCommon[iPageDirection].iHeight*this.indexpages.length,e.overflow_y=e.overflow_y>t[iPageDirection].iHeight?e.overflow_y:null,this.set("iDetail",e,{silent:!0})}return n},patchGridSize:function(){if(this.GridPatch){var e=this.get("iCommon"),t=this.get("iDetail");t.iRows=this.indexpages.length;var i=this.get("suboverlays");e[iPageDirection].iWidth=(t.iCols+1)*t.iColspace+i[0].iCommon[iPageDirection].iWidth*t.iCols;{(t.iRows+1)*t.iRowspace+i[0].iCommon[iPageDirection].iHeight*t.iRows}this.set("iCommon",e),this.set("iDetail",t)}}}),interaction_view.view.PageIndex=interaction_view.view.SubContainer.extend({otherAfterSubOverlayPreload:function(){var e=this.model.indexpages;this.$el.children(".Element").find("[data-type=Cell]").each(function(){var t=e[$(this).index()].id;$(this).children(".Element").css({cursor:"pointer"}),interaction_view.foredit||$(this).children(".Element").on("click",function(){presentation.gotopage(t,9)})});var t=this.getdetail(),i=this.getcommon();t.overflow_y&&(this.$el.children(".Element").addClass("iMouseWheel disableMouseWheelY disableDragY"),this.$el.children(".Element").wrapInner('<div class="iContent"></div>'),this.scrollview=new IScroll(this.$el.children(".Element")[0],{mouseWheel:!0,probeType:3,scrollX:!1,scrollY:!0,click:!0,wrapperWidth:i.iWidth,wrapperHeight:i.iHeight,scrollerWidth:i.iWidth,scrollerHeight:t.overflow_y}))}})}),define("text!interaction_view/template/offline_info.js",[],function(){return'<div class="offline-shadow" style="background: rgba(218,218,218,0.7);left:0;top:0;width:100%;height:100%;position:absolute;display: block;">\n <div class="offline-text" style="line-height:<%=iCommon[iPageDirection].iHeight%>px;text-align: center;">\n   <i class="icon-warning-sign icon-4x" style="display: inline-block;">\n    <br>\n    <span style="background: #444444;color: #FFFFFF;padding: 8px;font-size: 14px;">è¯·åœ¨è”ç½‘çš„çŠ¶æ€ä¸‹ä½¿ç”¨</span>\n   </i>\n </div>\n</div>\n '}),define("interaction_view/model/webcontent",["interaction_view/model/base","text!interaction_view/template/offline_info.js"],function(){var e=require("text!interaction_view/template/offline_info.js");interaction_view.model.WebContent=interaction_view.model.Base.extend({defaults:{iType:"WebContent",iCommon:{portait:{iStartx:400,iStarty:200,iWidth:200,iHeight:200},landscape:{iStartx:400,iStarty:200,iWidth:200,iHeight:200}},iDetail:{},iParent:"",iChild:"",iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0,callback:null},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(){this.iview=new interaction_view.view.WebContent({model:this})},setsyncmodel:function(){}}),interaction_view.view.WebContent=interaction_view.view.Base.extend({events:{},render:function(){this.model.renderWebContent=!0},renderWebContent:function(){var e=this,t=this.detail;if(!this.result){var i=this.result||interaction_view.getWebContentSrc(t);this.result=i}this.detail.iAsbg&&this.$el.children(".Element").removeClass("iMouseWheel disableMouseWheelY disableMouseWheelX disableDragX disableDragY"),this.result&&(this.result.src||this.result.content)&&(this.iframeStyle?(this.$el.children(".Element").html("<iframe></iframe>"),this.$el.children(".Element").find("iframe").first().attr("style",this.iframeStyle)):this.iframeStyle=this.$el.children(".Element").find("iframe").first().attr("style"),i=this.result,i&&i.src?this.$el.children(".Element").find("iframe").first()[0].src=i.src:i&&i.content&&(this.hasContent=i.content),t.iOnline&&(interaction_view.isOnline||(null==interaction_view.isOnline?_g.device.online("#",function(){interaction_view.isOnline=!0},function(){interaction_view.isOnline=!1,e.renderOfflineInfo()}):e.renderOfflineInfo())),this.detail.iAsbg&&(this.$el.find(".iframe_mask").length||$('<div class="iframe_mask absolutecenter"></div>').insertAfter(this.$el.find("iframe").first())))},renderOfflineInfo:function(){this.$el.children(".Element").append(_.template(e,this.model.toJSON()))},clearWebContent:function(){this.$el.children(".Element").find("iframe").first().remove()},otherOnShow:function(){},onPlay:function(){this.hasContent&&(this.$el.children(".Element").find("iframe").first()[0].contentWindow.document.write(this.hasContent),this.$el.children(".Element").find("iframe").first()[0].contentWindow.document.body&&(this.$el.children(".Element").find("iframe").first()[0].contentWindow.document.body.style.margin=0,this.$el.children(".Element").find("iframe").first()[0].contentWindow.document.body.style.padding=0),this.$el.children(".Element").find("iframe").data("content",this.hasContent))}})}),define("interaction_view/model/shape",["interaction_view/model/base"],function(){interaction_view.model.Shape=interaction_view.model.Base.extend({setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(){interaction_view.isAndroid&&interaction_view.isWeixin&&this.attributes.iDetail.iSvg&&(this.attributes.iDetail.iSvg=this.attributes.iDetail.iSvg.replace(/<filter.*<\/filter>/g,"")),this.iview=new interaction_view.view.Shape({model:this})},setsyncmodel:function(){}}),interaction_view.view.Shape=interaction_view.view.Base.extend({events:{},render:function(){var e=this.$el.find(".Element").width()+.5,t=this.$el.find(".Element").height()+.5;this.$el.find("svg").width(e),this.$el.find("svg").height(t)},resetOtherStatus:function(){},otherOnShow:function(){this.resetOtherStatus()}})}),define("interaction_view/model/BookButton",["interaction_view/model/TextLabel"],function(){interaction_view.model.BookButton=interaction_view.model.TextLabel.extend({defaults:{iType:"BookButton",iVisibility:!0,iCommon:null,iDetail:null,iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0},setiview:function(){this.iview=new interaction_view.view.BookButton({model:this})}}),interaction_view.view.BookButton=interaction_view.view.TextLabel.extend({allowScroll:!1})}),define("interaction_view/model/dragdrop",["interaction_view/model/base"],function(){interaction_view.model.DragDrop=interaction_view.model.Base.extend({defaults:{iType:"DragDrop",iVisibility:!0,iCommon:null,iDetail:null,iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(){this.iview=new interaction_view.view.DragDrop({model:this})},setsyncmodel:function(){}}),interaction_view.view.DragDrop=interaction_view.view.Base.extend({events:{},render:function(){this.model._reset=!0},preload:function(){this.preloaded=!1,this.checkImglist=[];var e=this.getdetail(),t=[null,null];if(e.iconNormal&&e.iconNormal[0]){this.checkImglist.push(e.iconNormal[0].picture);var i=this.sendToPreload({file:e.iconNormal[0].picture,path:this.model.get("path"),isSubOverlay:this.model.get("isSubOverlay")});t[0]=i.id}if(e.iconActive&&e.iconActive[0]){this.checkImglist.push(e.iconActive[0].picture);var i=this.sendToPreload({file:e.iconActive[0].picture,path:this.model.get("path"),isSubOverlay:this.model.get("isSubOverlay")});t[1]=i.id}this.model.set("preload_id",t)},checkImgload:function(e){return this.checkImglist=_.reject(this.checkImglist,function(t){return t==e}),0==this.checkImglist.length?!0:!1},afterpreload:function(e){e&&this.preloaded||(e&&!this.preloaded&&(this.preloaded=this.checkImgload(e)),this.preloaded&&(this.setZindex(),this.setElementDisplay(),this.setOtherDisplay(),this.copyelstyle=this.$el.attr("style"),this.copyelementstyle=this.$el.children(".iElement").attr("style")))},setOtherDisplay:function(){this.active=!1,this.Status=0},changeStatus:function(e){var t=(this.getdetail(),this);"undefined"!=typeof e&&(t.active=e),t.active?(t.$el.find("img.iconActive").hide(),t.$el.find("img.iconNormal").show(),t.active=!1):(t.$el.find("img.iconActive").show(),t.$el.find("img.iconNormal").hide(),t.active=!0)},resetOtherStatus:function(){var e=this;e.resetButtonStatus(),e.DragDropGroups=[],$.each(e.model.page.iOverlaylist.where({iType:"DragDropGroup"}),function(t,i){_.include(i.iview.getdetail().element_ids,e.model.id)&&e.DragDropGroups.push(i)})},resetButtonStatus:function(){this.$el.find("img.iconActive").hide(),this.$el.find("img.iconNormal").show(),this.active=!1}})}),define("interaction_view/model/dragdropgroup",["interaction_view/model/base"],function(){interaction_view.model.DragDropGroup=interaction_view.model.Base.extend({defaults:{iType:"DragDropGroup",iVisibility:!0,iCommon:null,iDetail:{iAdapt:!1,iFullview:!1,iImg:null,iAnimation:[]},iOptions:{createfocus:!0},iParentModel:null,iDraggable:!1,iResizable:!1,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(){this.iview=new interaction_view.view.DragDropGroup({model:this})},setsyncmodel:function(){}}),interaction_view.view.DragDropGroup=interaction_view.view.Base.extend({events:{},renderDynamicElement:function(){var e=this.model.toJSON();this.detail=e.iDetail},render:function(){this.model._reset=!0},preload:function(){},afterpreload:function(){if(this.model.pageid=this.model.get("pageid"),this.model.parentpageid=this.model.get("parentpageid"),"LayerRef"==this.model.get("pagetype")){var e=this.model.get("parentpageid"),t=this.model.get("layerid"),i=interaction_view.getParentpage(e);this.model.parentpage=i,this.model.page=i.iOverlaylist.get(this.model.pageid).layer[t]}else this.model.page=interaction_view.getParentpage(this.model.pageid);this.preloaded=!0}})}),define("interaction_view/model/variable",["interaction_view/model/base"],function(){interaction_view.model.Variable=interaction_view.model.Base.extend({defaults:{},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(){this.attributes.iDetail.initial=interaction_view.isEvilCode(this.attributes.iDetail.initial),this.iview=new interaction_view.view.Variable({model:this})},setsyncmodel:function(){}}),interaction_view.view.Variable=interaction_view.view.Base.extend({events:{},resetOtherStatus:function(){this.showRandom(),this.updateText(this.origin,addtourl=0)},updateText:function(e,t){var i=this.getdetail();if(e&&(i.initial=e),this.isKindNum())if(_.isNaN(Number(i.initial)))i.initial=i.initial;else{var n=Number(i.initial);n>0&&i.initial[0]&&"0"===i.initial[0]||(i.initial=(Number(i.initial)||0).toFixed(Number(i.precision)||0))}this.$el.find(".Element").html(i.initial),t&&this.addToUrl()},render:function(){var e=this.getdetail();this.iHorizontal=["left","center","right"],e.iEditable&&(e.initial=this.getFromUrl()),""!=$.trim(e.randlist)&&(e.randlist=_.compact(e.randlist.split(/[^0-9]/g))),this.isKindRandom()&&e.iRepeatable&&(this.Random={available:[],used:[]}),this.updateText("",addtourl=0),this.$el.find(".Element").css("font-size",e.font_size).css("color",e.font_color).css("text-align",this.iHorizontal[e.iPosition]),this.origin=e.initial,this.model._reset=!0},setVariable:function(e,t,i,n){var a=this,r=this.getdetail();if((!this.isKindText()||1!=e&&2!=e&&3!=e)&&!(this.isKindRandom()&&3!=e||!this.isKindRandom()&&3==e||this.isKindNum()&&"NaN"==Number(t).toString()&&!interaction_view.expression.isVar(t)))switch(e=Number(e),this.isKindNum()&&(r.initial=Number(r.initial)),e){case 0:interaction_view.expression.id2values(t,function(e){r.initial=e,a.updateText("",addtourl=0),a.triggerVarChange(),n&&n(e)},{_promise:i});break;case 1:interaction_view.expression.id2values(t,function(e){_.isNaN(Number(e))||(e=Number(e)),r.initial+=e,a.updateText("",addtourl=0),a.triggerVarChange(),n&&n(e)},{_promise:i});break;case 2:interaction_view.expression.id2values(t,function(e){_.isNaN(Number(e))||(e=Number(e)),r.initial-=e,a.updateText("",addtourl=0),a.triggerVarChange(),n&&n(e)},{_promise:i});break;case 3:var o=this.setRandom();a.updateText("",addtourl=0),a.triggerVarChange(),n&&n(o),i&&i.done()}},triggerVarChange:function(){var e=this.getdetail();1==e.immediate&&interaction_view.events.onVariableChanged(this)},isKindNum:function(){var e=this.getdetail();return 0==e.iKind},isKindText:function(){var e=this.getdetail();return 1==e.iKind},isKindRandom:function(){var e=this.getdetail();return 2==e.iKind},showRandom:function(){this.isKindRandom()&&(this.origin=this.setRandom())},setRandom:function(){var e=this.getdetail();if(e.iRepeatable){this.isUseup(e);var t;do t=this.getRandom(e);while(_.contains(this.Random.used,t));this.Random.used.push(t),e.initial=t}else e.initial=this.getRandom(e);return e.initial},isUseup:function(e){(!e.randlist&&this.Random.used.length>=e.range[1]-e.range[0]+1||e.randlist&&this.Random.used.length>=e.randlist.length)&&(this.Random.used=[])},getRandom:function(e){return e.randlist?e.randlist[_.random(0,e.randlist.length-1)]:_.random(e.range[0],e.range[1])},getFromUrl:function(e){var t=_g.getUrlParameterByName(this.model.id,e);if(t||0==t||(t=_g.getHashParameterByName(this.model.id)),t||0==t||(t=this.getdetail().initial),"epub360"==epub360_domain&&""!=interaction_view.environment.Userdata.id)if(1==interaction_view.environment.Userdata.status)interaction_view.environment.Userdata.addView(this);else{var i=this.model.get("pageid"),n=interaction_view.environment.Userdata.getitem(i,this.model.id);n&&(t=n.value)}return t},addToUrl:function(e){var t=this.getdetail();if(!t.iEditable)return!1;if("undefined"==typeof message_link&&(message_link=document.location.href,interaction_view.weixin.share()),"undefined"==typeof e&&(e=t.initial),"epub360"==epub360_domain&&""!=interaction_view.environment.Userdata.id){{this.model.get("pageid")}return interaction_view.environment.Userdata.setitem(this,{value:e}),!0}return exist?!1:!0}})}),define("interaction_view/model/timer",["interaction_view/model/base"],function(){interaction_view.model.Timer=interaction_view.model.Base.extend({defaults:{},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(){this.iview=new interaction_view.view.Timer({model:this})},setsyncmodel:function(){}}),interaction_view.view.Timer=interaction_view.view.Base.extend({events:{},render:function(){var e=this.getdetail();this.iHorizontal=["left","center","right"],this.$el.find(".Element").css("font-size",e.font_size).css("color",e.font_color).css("text-align",this.iHorizontal[e.iPosition]),this.updateTimerDom(e.formatTime),this.model._reset=!0},resetOtherStatus:function(){var e=this.getdetail();this.clearTimer(),this.Interval=!1,this.Status=-1,this.Suspend=!1,this.frame=0==e.format||2==e.format?1:.01},startTimer:function(){if(1!=this.Status&&3!=this.Status){if(-1==this.Status)return void(this.Suspend=!0);var e=this,t=this.getdetail(),i=function(){e.updateTimer(),e.Actions_16.length&&interaction_view.events.onTimerCountTo(e),e.currentTime!=t.initial&&e.Actions_18.length&&interaction_view.events.onTimerInterval(e,e.currentTime-t.initial)},n=function(){if(e.Interval){if(e.currentTime<=0)return e.currentTime=0,e.updateTimer(),void e.stopTimer();e.currentTime-=e.frame,o(n,e.frame),i()}},a=function(){e.Interval&&(e.currentTime+=e.frame,o(a,e.frame),i())},r=function(){e.Interval=!0,1==t.iKind?n():a()},o=function(e,t){setTimeout(e,1e3*t)};o(r,e.frame),e.Actions_16.length&&interaction_view.events.onTimerCountTo(e),interaction_view.events.onTimerStart(this),this.Status=1}},stopTimerSimple:function(){return 2==this.Status||3==this.Status||-1==this.Status?!1:(this.clearTimer(),this.Status=2,!0)},stopTimer:function(){this.stopTimerSimple()&&(interaction_view.events.onTimerStop(this),this.Status=3)},resetTimer:function(){function e(e,i){return e.overlay_id!=t.model.id||e.type!=i?!1:t.model.page.isLayer?e.layer_id==t.model.page.iOverlaylist.layerid:e.page_id==t.model.page.id}var t=this,i=this.getdetail();this.clearTimer(),this.currentTime=i.initial=Number(Number(i.initial).toFixed(2)),this.Status=0,this.updateTimer(),this.gotTimerActions||(this.Actions_16=_.filter(interaction_view.events.timerEvents,function(t){return e(t,16)&&t.condition>=0}),this.Actions_18=_.filter(interaction_view.events.timerEvents,function(t){return e(t,18)&&t.condition>0}),this.Actions_17=_.filter(interaction_view.events.timerEvents,function(t){return e(t,17)}),this.Actions_19=_.filter(interaction_view.events.timerEvents,function(t){return e(t,19)}),t.Actions_18.forEach(function(e){e.condition=Number(Number(e.condition).toFixed(2))}),this.gotTimerActions=!0),(i.iAutoStart||this.Suspend)&&this.startTimer(),this.Suspend=!1},updateTimer:function(){var e=this.getdetail();e.formatTime=this.getFormatTime(this.currentTime,e.format),this.updateTimerDom(e.formatTime)},updateTimerDom:function(e){this.$el.find(".Element").html(e)},clearTimer:function(){this.Interval=!1},getFormatTime:function(e,t){var i,n,a,r;switch(e=Number(Number(e).toFixed(2)),0>=e?i=n=a=r=0:(i=Math.floor(e/3600),n=Math.floor((e-3600*i)/60),a=Math.floor(e-3600*i-60*n)),Number(t)){case 0:return(10>n?"0"+n:n)+":"+(10>a?"0"+a:a);case 1:return r=Math.round(100*(e-Math.floor(e))),(10>n?"0"+n:n)+":"+(10>a?"0"+a:a)+":"+(10>r?"0"+r:r);case 2:return(10>i?"0"+i:i)+":"+(10>n?"0"+n:n)+":"+(10>a?"0"+a:a);case 3:return r=Math.round(100*(e-Math.floor(e))),(10>i?"0"+i:i)+":"+(10>n?"0"+n:n)+":"+(10>a?"0"+a:a)+":"+(10>r?"0"+r:r)}}})}),function(){var e={readCookie:function(e){for(var t=e+"=",i=document.cookie.split(";"),n=0;n<i.length;n++){for(var a=i[n];" "==a.charAt(0);)a=a.substring(1,a.length);if(0==a.indexOf(t))return a.substring(t.length,a.length)}return null},load:function(e,t){return _g.ajax.get(e,t)},get:function(e,t){var i={url:null,dataType:"JSON",staticUrl:null,callback:null,parseData:null,debug:!1,name:null,retry:!1,retrydelay:0};"string"==typeof e?(i.url=e,i.callback=t,e=i):e=e?$.extend(!0,{},i,e):$.extend(!0,{},i),_g.debug&&_g.debug.enabled&&(e.name||(e.name=e.url),_g.debug.data[e.name]={});var n="undefined"!=typeof _gDebug&&_gDebug||e.debug,a=n?_g.debug&&_g.debug.query_user_data(e.name)?_g.debug.query_user_data(e.name):e.staticUrl||e.url:e.url;if(!a)return!1;var r=$.ajax({url:a,type:"GET",data:"",dataType:e.dataType,beforeSend:e.beforeSend,success:function(t){_g.debug&&_g.debug.enabled&&(_g.debug.data[e.name].data=$.extend(!0,{},t)),n&&e.parseData&&(t=e.parseData(t)),e.callback&&e.callback(t)},error:function(){_g.error.serverError(),e.onError&&e.onError(0)},timeout:1e5});return r},post:function(e,t,i){var n={url:null,data:null,dataType:"JSON",staticUrl:null,callback:null,debug:!1,name:null,retry:!1,retrydelay:0,type:"POST"};"string"==typeof e?(n.url=e,n.callback=i,n.data=t,e=n):e=e?$.extend(!0,{},n,e):$.extend(!0,{},n),_g.debug&&_g.debug.enabled&&(e.name||(e.name=e.url),_g.debug.data[e.name]={}),e.type=e.type||"POST";var a="undefined"!=typeof _gDebug&&_gDebug||e.debug,r=a?_g.debug&&_g.debug.query_user_data(e.name)?_g.debug.query_user_data(e.name):e.staticUrl||e.url:e.url;if(!r)return!1;var o=$.ajax({url:r,type:a?"GET":e.type,data:e.data,dataType:e.dataType,traditional:e.traditional,beforeSend:e.beforeSend,success:function(t){_g.debug&&_g.debug.enabled&&(_g.debug.data[e.name].data=$.extend(!0,{},t)),e.callback&&e.callback(t)},error:function(){_g.error.serverError(e.name),e.onError&&e.onError(0)},timeout:1e5});return o},"delete":function(e,t){var i={url:null,data:null,dataType:"JSON",staticUrl:null,callback:null,debug:!1,name:null,retry:!1,retrydelay:0},n={};"string"==typeof e?(i.url=e,i.callback=t,i.data=n,e=i):e=e?$.extend(!0,{},i,e):$.extend(!0,{},i),_g.debug&&_g.debug.enabled&&(e.name||(e.name=e.url),_g.debug.data[e.name]={});var a="undefined"!=typeof _gDebug&&_gDebug||e.debug,r=a?_g.debug&&_g.debug.query_user_data(e.name)?_g.debug.query_user_data(e.name):e.staticUrl||e.url:e.url;if(!r)return!1;var o=$.ajax({url:r,type:"DELETE",data:e.data,dataType:e.dataType,traditional:e.traditional,beforeSend:e.beforeSend,success:function(t){_g.debug&&_g.debug.enabled&&(_g.debug.data[e.name].data=$.extend(!0,{},t)),e.callback&&e.callback(t)},error:function(){_g.error.serverError(e.name),e.onError&&e.onError(0)},timeout:1e5});return o},dataGenerate:function(e){var t={dataSource:null,map:null,key:null,count:0};if(e=e?$.extend(!0,{},t,e):$.extend(!0,{},t),!e.dataSource||!e.map)return e.dataSource;var n=e.key?e.dataSource[e.key]:e.dataSource;if(!n[0])return e.dataSource;for(i=0;i<e.count;i++){var a={},r=n[0];_.each(r,function(t,i){var n;if(e.map[i]){switch(e.map[i]){case"uuid":n=_g.uuid();break;case"randompick":n=_g.array.randomPick(r[i]);break;case"string":n=_g.string.randomGenerate(10);break;case"number":n=_g.number.randomInt();break;case"boolean":n=_g.boolean.randomPick();break;default:n=r[i]}a[i]=n}else a[i]=r[i]}),n.push(a)}return n.shift(),e.key?e.dataSource[e.key]=n:e.dataSource=n,e.dataSource},testSpeed:function(e){function t(){{var e=(a-n)/1e3,t=8*o,i=(t/e).toFixed(2),r=(i/1024).toFixed(2);(r/1024).toFixed(2)}}var i={file:null,fileSize:0,callback:null};if(e=e?$.extend(!0,{},i,e):$.extend(!0,{},i),!e.file)return!1;var n,a,r=e.file+"?n="+Math.random(),o=e.fileSize,s=new Image;s.onload=function(){a=(new Date).getTime(),t()},n=(new Date).getTime(),s.src=r}};"undefined"==typeof require?(window._g||(window._g={}),window._g.ajax=e,e=void 0):define("_g/ajax",["jquery","_g/base","_g/error"],function(){return window._g.ajax=e,e=void 0,window._g.ajax})}(window),define("interaction_view/model/vote",["_g/ajax","interaction_view/model/base"],function(){interaction_view.model.Vote=interaction_view.model.Base.extend({defaults:{iType:"Vote",iVisibility:!0,iCommon:null,iDetail:null,iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(){this.get("iDetail");this.setSubOverlays(),this.iview=new interaction_view.view.Vote({model:this})},setsyncmodel:function(){}}),interaction_view.view.Vote=interaction_view.view.Base.extend({events:{},getInitialValue:function(){return parseInt(this.model.get("iDetail").initial)||0},render:function(){var e=this;this.voteUrl||(this.voteUrl=encodeURI(context_url+this.model.iPageId+"/vote/"+e.model.id+"/")),this.noVoted()&&(this.waitForVoted=!0,this.$el.hide()),this.$el.addClass("hasaction"),this.resetOtherStatus(),interaction_view.environment.Votes.add(this.model)},preload:function(){this.preloaded=!1,this.checkImglist=[];var e=this.getdetail(),t=[null,null];
if(e.iconNormal&&e.iconNormal[0]){this.checkImglist.push(e.iconNormal[0].picture);var i=this.sendToPreload({file:e.iconNormal[0].picture,path:this.model.get("path"),isSubOverlay:this.model.get("isSubOverlay")});t[0]=i.id}if(e.iconActive&&e.iconActive[0]){this.checkImglist.push(e.iconActive[0].picture);var i=this.sendToPreload({file:e.iconActive[0].picture,path:this.model.get("path"),isSubOverlay:this.model.get("isSubOverlay")});t[1]=i.id}this.sendToPreload({file:null,subcontainer:!0,path:this.model.get("path"),isSubOverlay:this.model.get("isSubOverlay")}),this.model.set("preload_id",t)},checkImgload:function(e){return this.checkImglist=_.reject(this.checkImglist,function(t){return t==e}),0==this.checkImglist.length?!0:!1},afterpreload:function(e){e&&this.preloaded||(e&&!this.preloaded&&(this.preloaded=this.checkImgload(e)),this.preloaded&&(this.setZindex(),this.setElementDisplay(),this.setOtherDisplay(),this.copyelstyle=this.$el.attr("style"),this.copyelementstyle=this.$el.children(".iElement").attr("style")))},setOtherDisplay:function(){this.$el.css("cursor","pointer")},bindClick:function(){var e=this;e.vote||(e.vote=function(){e.model.get("suboverlays")[0].iDetail.iValue+=1,e.changeStatus(),_g.ajax.post({dataType:"JSON",url:e.voteUrl,data:{value:1},callback:function(t){var i=e.getInitialValue();t.num_votes&&(e.model.get("suboverlays")[0].iDetail.iValue=t.num_votes+i,interaction_view.environment.Votes.update(e.model),e.model.set("value",t.num_votes+i),e.model.set("voted",1),e.model.set("position",t.position+i),e.changeStatus())}})});var t="tap";this.isVoted()?this.$el.hammer().off(t,e.vote):(this.binded||this.$el.hammer().one(t,e.vote),this.binded=!0)},changeStatus:function(){this.waitForVoted||(this.$el.show(),this.isVoted()?(this.$el.find("img.iconActive").show(),this.$el.find("img.iconNormal").hide(),this.active=!0):(this.$el.find("img.iconActive").hide(),this.$el.find("img.iconNormal").show(),this.active=!1)),this.setTitle()},resetOtherStatus:function(){var e=this;this.isVoted()&&this.$el.show(),_g.ajax.get({dataType:"JSON",url:e.voteUrl,callback:function(t){e.waitForVoted=!1;var i=e.getInitialValue();t.num_votes?(e.model.get("suboverlays")[0].iDetail.iValue=t.num_votes+i,e.model.set("value",t.num_votes+i),e.model.set("voted",t.vote_value),e.model.set("position",t.position+i)):(e.model.get("suboverlays")[0].iDetail.iValue=i,e.model.set("value",i),e.model.set("voted",0),e.model.set("position",i)),e.bindClick(),e.changeStatus(),e.waitForVoted2&&(e.triggerVoted(),e.waitForVoted2=!1)}})},triggerVoted:function(){this.noVoted()?this.waitForVoted2=!0:this.isVoted()&&interaction_view.events.onVoted(this)},setTitle:function(){var e=(this.getdetail(),this.model.get("suboverlays")),t=e[0].iDetail.iValue,i=interaction_view.formatLabel({text:"Jason"==t?"Name":t,font_size:e[0].iDetail.font_size,text_color:e[0].iDetail.text_color,iPosition:e[0].iDetail.iPosition});this.$el.find(".iTextLabel.Element").html(i)},afterSubOverlayPreload:function(){this.preloadmodel&&(this.model.iOverlaylist.each(function(e){e.iview.preloaded||e.iview.afterpreload()}),this.model.iActionlist.each(function(e){e.iview.render()}),this.setTitle(),this.preloadmodel.set("loaded",!0),this.preloadmodel.page.ipreloadlist.preloadcheck(null,!0,this.model))},isVoted:function(){return this.model.get("voted")},noVoted:function(){return"undefined"==typeof this.model.get("voted")}})}),define("text!interaction_view/template/prompt.js",[],function(){return'<div class="<%=class_name%>" style="display:none;">\n	<div class="modalArea" style="position: fixed;top: 50%;left: 50%;z-index: 10003;background: white;box-shadow: 0 0 60px rgba(0, 0, 0, .25); width: 480px;height: 235px; margin-left: -240px;margin-top: -120px;text-align: center;">\n		<div class="alert" style="text-align:left; margin-bottom: 0px;">è¾“å…¥æ–‡å­— :</div>\n		<div style="padding: 10px 10px 10px;">\n			<textarea style="resize: none; width: 96%;height: 120px;border: 0px;" autofocus="autofocus"></textarea>\n			<div style="margin: 10px;">\n				<button type="button" style="margin-right: 40px;border-radius: 18px 18px;padding: 7px 28px;" class="btn btn-default cancel">å–æ¶ˆ</button>\n				<button type="button" style="border-radius: 18px 18px;padding: 7px 28px;" class="btn btn-danger ok">ç¡®è®¤</button>\n			</div>\n		</div>\n	</div>\n	<div class="modal-backdrop fade in" style="z-index: 10002;"></div>\n</div>'}),define("interaction_view/model/paragraph",["interaction_view/model/base","text!interaction_view/template/prompt.js"],function(){var e=require("text!interaction_view/template/prompt.js");interaction_view.model.Paragraph=interaction_view.model.Base.extend({defaults:{iType:"Paragraph",iLock:!0,iVisibility:!0,iCommon:{portait:{iStartx:400,iStarty:200,iWidth:200,iHeight:200},landscape:{iStartx:400,iStarty:200,iWidth:200,iHeight:200}},iDetail:{iAdapt:!1,iFullview:!1,iImg:null,iAnimation:[]},iParent:"",iChild:"",iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0,callback:null},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(){this.attributes.iDetail.iText=interaction_view.isEvilCode(this.attributes.iDetail.iText),this.iview=new interaction_view.view.Paragraph({model:this})},setsyncmodel:function(){}}),interaction_view.view.Paragraph=interaction_view.view.Base.extend({events:{},render:function(){if(this.scrollEl=this.$el.children(".Element"),this.textel=this.$el.find(".iText"),this.originContent=this.model.attributes.iDetail.iText,"undefined"==typeof this.userContent&&(this.userContent=this.originContent),"undefined"==typeof message_link&&(message_link=location.href,interaction_view.weixin.share()),this.model.attributes.iDetail.iEditable){var e=this.model.attributes.iDetail.iEditable?message_link:data_link,t=_g.getUrlParameterByName(this.model.id,e);if(null==t&&(t=_g.getHashParameterByName(this.model.id)),null==t&&"epub360"==epub360_domain&&""!=interaction_view.environment.Sharedata.id)if(1==interaction_view.environment.Sharedata.status)interaction_view.environment.Sharedata.addView(this);else{var i=this.model.get("pageid"),n=interaction_view.environment.Sharedata.getitem(i,this.model.id);n&&(t=n.iText)}t&&this.updateText(t,addtourl=0)}this.renderEdit(),this.model.attributes.iDetail.iEditable&&this.$el.find(".iParagraph").addClass("editable"),this.renderlink&&this.renderlink(),this.model._reset=!0},resetOtherStatus:function(){var e=this;if(this.$el.children(".Element").find(".paragraph").length){if(this.$el.children(".Element").find(".paragraph").first().children("div").length&&_g.ui.isOverflowed(this.$el.children(".Element").find(".paragraph").first().children("div")).y){if(!this.$el.children(".Element").hasClass("disableDragY")){var t=this.$el.find(".paragraph").first().children("div"),i=t.height();t.wrapInner('<div class="iContent" style="font-size: inherit;color: inherit;font-family: inherit;font-weight:inherit;"></div>');var n=_g.ui.isOverflowed(t).y-i;this.scrollView=new IScroll(t[0],{mouseWheel:!0,click:!0,probeType:3,wrapperHeight:i,HWCompositing:!0}),this.scrollView.on("scroll",function(){console.log(this.y),n&&n>0&&(this.y>0?this.y>30&&e.scrollEl.addClass("is_exceededY"):Math.abs(this.y)-n>30&&e.scrollEl.addClass("is_exceededY"))}),this.scrollEl=this.$el.children(".Element"),this.$el.children(".Element").addClass("disableDragY iMouseWheel disableMouseWheelY")}this.$el.children(".Element").removeClass("is_exceededX"),this.$el.children(".Element").removeClass("is_exceededY")}}else if(_g.ui.isOverflowed(this.$el.children(".Element")).y){if(!this.$el.children(".Element").hasClass("disableDragY")){var i=this.$el.children(".Element").height();this.$el.children(".Element").wrapInner('<div class="iContent"></div>');var n=_g.ui.isOverflowed(this.$el.children(".Element")).y-i;this.scrollView=new IScroll(this.$el.children(".Element")[0],{mouseWheel:!0,click:!0,probeType:3}),this.scrollView.on("scroll",function(){console.log(this.y),n&&n>0&&(this.y>0?this.y>30&&e.scrollEl.addClass("is_exceededY"):Math.abs(this.y)-n>30&&e.scrollEl.addClass("is_exceededY"))}),this.scrollEl=this.$el.children(".Element"),this.$el.children(".Element").addClass("disableDragY iMouseWheel disableMouseWheelY")}this.$el.children(".Element").removeClass("is_exceededX"),this.$el.children(".Element").removeClass("is_exceededY")}},otherOnShow:function(){this.resetOtherStatus()},renderEdit:function(){var t=this,i=this.getdetail();if(!i.iStaticImage&&i.iEditable){var n="ParagraphInput",a=_.template(e,{class_name:n});t.activeEdit=function(e){if(interaction_view.environment.Paragraph.state()||e){var i=$("."+n);i.length||(i=$(a).appendTo("body")),i.show().attr("paragraph-id",t.model.id);var r=i.find(".modalArea");interaction_view.ismobile&&r.width($(document).width()),_g.ui.center({Item:r}),i.find("button.cancel").one("click",function(){i.remove()}),i.find("button.ok").one("click",function(){i.attr("paragraph-id")==t.model.id&&(i.remove(),t.updateText("<div>"+i.find("textarea").val().replace(/\n/g,"</div><div>")+"</div>",addtourl=1))}),i.find("textarea").val(t.userContent.replace(/<br>/g,"\n").replace(/<\/div><div>/g,"\n").replace("<div>","").replace("</div>",""));var o=function(){i.find("textarea").focus().click(function(){$(this).focus()})};setTimeout(o,300)}},t.$el.on("click",function(){t.activeEdit()})}},updateText:function(e,t){if("undefined"!=typeof e){e&&e.match&&e.match(/\n/g)&&(e="<div>"+e.replace(/\n/g,"</div><div>")+"</div>"),e=""+e,this.userContent=e;var i=e.replace(/<div>/g,"(div)").replace(/<\/div>/g,"(/div)");i=_g.util.htmlspecialchars(i);var n=i.replace(/\(div\)/g,"<div>").replace(/\(\/div\)/g,"</div>");this.textel.html(n);var a=!1;t&&(this.addToUrl(e),a=!0),this.model.attributes.iDetail.iText=n,this.resetOtherStatus(),a&&interaction_view.events.onParagraphChanged(this)}},addToUrl:function(e){var t=this.model.id+"="+encodeURI(e),i=this.model.attributes.iDetail.iEditable?message_link:data_link,n=_g.getUrlParameterByName(this.model.id,i),a=0;if(n)encodeURI(n)!=encodeURI(e)?i=_g.replaceUrlParameterByName(this.model.id,t,i):a=1;else{var r="?";i.indexOf("?")>=0&&(r="&"),i+=r+t}if("epub360"==epub360_domain&&!a&&interaction_view.environment.Sharedata.enabled&&interaction_view.environment.Sharedata.setitem(this,{iText:e}),a||(this.model.attributes.iDetail.iEditable?(message_link=i,interaction_view.weixin.share()):data_link=i),!interaction_view.forpreview&&!interaction_view.weixin.shareable()&&this.model.attributes.iDetail.iEditable){var o=_g.getHashParameterByName(this.model.id);o?encodeURI(o)!=encodeURI(e)?window.history.replaceState({},"",_g.replaceHashParameterByName(this.model.id,t)):a=1:window.history&&(document.location.hash?window.history.replaceState({},"",document.location.hash+="&"+t):window.history.replaceState({},"","#"+t))}return a?!1:!0}})}),define("interaction_view/model/input",["interaction_view/model/base"],function(){interaction_view.model.Input=interaction_view.model.Base.extend({defaults:{iType:"Input",iCommon:{portait:{iStartx:400,iStarty:200,iWidth:200,iHeight:200},landscape:{iStartx:400,iStarty:200,iWidth:200,iHeight:200}},iDetail:{},iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",callback:null},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(){this.iview=new interaction_view.view.Input({model:this})},setsyncmodel:function(){}}),interaction_view.view.Input=interaction_view.view.Base.extend({events:{},render:function(){var e=this,t=/^(\w)+(\.\w+)*@(\w)+((\.\w+)+)$/,i=/^1[3|4|5|7|8]\d{9}$/;this.$el.find("input").on("input",function(){console.log($(this).val()),interaction_view.events.onFormEvent(e.model,$(this).val())});var n=interaction_view.events.onFormButtonRender(this.model);n.value&&this.$el.find("input").val(n.value),this.setFormFieldType(n.field),this.$el.find("input").on("blur",function(){var e=$(this).val(),n=$(this).attr("type");switch(n){case"email":if(""==e)return;t.test(e)||(interaction_view.errorAlert("è¯·è¾“å…¥æ­£ç¡®çš„ç”µå­é‚®ç®±åœ°å€!"),$(this).focus());break;case"tel":if(""==e)return;i.test(e)||(interaction_view.errorAlert("è¯·è¾“å…¥æ­£ç¡®çš„æ‰‹æœºå·ç !"),$(this).focus())}})},resetOtherStatus:function(){var e=interaction_view.events.onFormButtonRender(this.model);e.value&&this.$el.find("input").val(e.value)},setFormFieldType:function(e){if(e&&interaction_view.ismobile){var t="text";console.log(e);var i=e.i.field_type;"number"==i&&(t="number"),"email"==i&&(t="email"),"url"==i&&(t="url"),"text"!=t&&this.$el.find("input")[0].setAttribute("type",t)}},setVariable:function(e,t,i,n){var a=this;1!=e&&2!=e&&3!=e&&interaction_view.expression.id2values(t,function(e){a.$el.find("input").val(e),n&&n(e)},{_promise:i})}})}),define("interaction_view/model/textarea",["interaction_view/model/base"],function(){interaction_view.model.Textarea=interaction_view.model.Base.extend({defaults:{iType:"Textarea",iCommon:{portait:{iStartx:400,iStarty:200,iWidth:200,iHeight:200},landscape:{iStartx:400,iStarty:200,iWidth:200,iHeight:200}},iDetail:{},iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",callback:null},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(){this.iview=new interaction_view.view.Textarea({model:this})},setsyncmodel:function(){}}),interaction_view.view.Textarea=interaction_view.view.Base.extend({events:{},render:function(){var e=this;this.$el.find("textarea").on("input",function(){console.log($(this).val()),interaction_view.events.onFormEvent(e.model,$(this).val())});var t=interaction_view.events.onFormButtonRender(this.model);t.value&&this.$el.find("textarea").html(t),this.model._reset=!0},resetOtherStatus:function(){var e=interaction_view.events.onFormButtonRender(this.model);e.value&&this.$el.find("textarea").html(e)},setVariable:function(e,t,i,n){var a=this;1!=e&&2!=e&&3!=e&&interaction_view.expression.id2values(t,function(e){a.$el.find("textarea").val(e),n&&n(e)},{_promise:i})}})}),define("interaction_view/model/selectbutton",["interaction_view/model/button"],function(){interaction_view.model.SelectButton=interaction_view.model.Button.extend({defaults:{iType:"SelectButton",iVisibility:!0,iCommon:null,iDetail:null,iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0},setview:function(){var e=this.get("iDetail");e.isSwitch&&(this.isSwitch=!0),this.iview=new interaction_view.view.SelectButton({model:this})}}),interaction_view.view.SelectButton=interaction_view.view.Button.extend({events:{},render:function(){var e=interaction_view.events.onFormButtonRender(this.model);e.value&&this.setActiveStatus()},afterpreload:function(e){e&&this.preloaded||(e&&!this.preloaded&&(this.preloaded=this.checkImgload(e)),this.preloaded&&(this.setZindex(),this.setElementDisplay(),this.setOtherDisplay(),this.copyelstyle=this.$el.attr("style"),this.copyelementstyle=this.$el.children(".iElement").attr("style")))},setOtherDisplay:function(){this.active=!1,this.buttonon=!1;var e=this;this.$el.css("cursor","pointer");var t=this.getdetail();if(t.isSwitch)this.$el.on("click",function(){e.changeStatus()});else{if(interaction_view.ismobile)var i="touchstart",n="touchend";else var i="mousedown",n="mouseup";this.$el.on(i,function(){e.buttonon=!0,e.changeStatus()}),this.$el.on(n,function(){e.buttonon&&(e.buttonon=!1,e.changeStatus())})}},changeStatus:function(){var e=this.getdetail(),t=this;if(t.active){if(t.groupcontrol&&e.isSwitch)return;if(interaction_view.application.isBindingButton(t.model))return;if(t.model.get("isTabBarSelectButton"))return;t.$el.find("img.iconActive").hide(),t.$el.find("img.iconNormal").show(),t.active=!1,interaction_view.events.onFormEvent(t.model,t.active)}else t.$el.find("img.iconActive").show(),t.$el.find("img.iconNormal").hide(),t.active=!0,e.isSwitch&&interaction_view.events.onFormEvent(t.model,t.active)},resetOtherStatus:function(){this.resetButtonStatus()},resetButtonStatus:function(){this.$el.find("img.iconActive").hide(),this.$el.find("img.iconNormal").show(),this.active=!1;var e=interaction_view.events.onFormButtonRender(this.model);e.value&&this.setActiveStatus()}})}),define("interaction_view/model/submitbutton",["interaction_view/model/button"],function(){interaction_view.model.SubmitButton=interaction_view.model.Button.extend({defaults:{iType:"SubmitButton",iVisibility:!0,iCommon:null,iDetail:null,iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0},setview:function(){var e=this.get("iDetail");e.isSwitch&&(this.isSwitch=!0),this.iview=new interaction_view.view.SubmitButton({model:this})}}),interaction_view.view.SubmitButton=interaction_view.view.Button.extend({events:{},render:function(){},afterpreload:function(e){e&&this.preloaded||(e&&!this.preloaded&&(this.preloaded=this.checkImgload(e)),this.preloaded&&(this.setZindex(),this.setElementDisplay(),this.setOtherDisplay(),this.copyelstyle=this.$el.attr("style"),this.copyelementstyle=this.$el.children(".iElement").attr("style")))},setOtherDisplay:function(){this.active=!1,this.buttonon=!1;var e=this;this.$el.css("cursor","pointer");var t=this.getdetail();if(t.isSwitch)this.$el.on("click",function(){e.changeStatus(),interaction_view.events.onFormEvent(e.model)});else{if(interaction_view.ismobile)var i="touchstart",n="touchend";else var i="mousedown",n="mouseup";this.$el.on(i,function(){e.buttonon=!0,e.changeStatus()}),this.$el.on(n,function(){e.buttonon&&(e.buttonon=!1,e.changeStatus(),window.setTimeout(function(){interaction_view.events.onFormEvent(e.model)},500))})}},changeStatus:function(){var e=this.getdetail(),t=this;if(t.active){if(t.groupcontrol&&e.isSwitch)return;if(t.model.get("isTabBarSubmitButton"))return;t.$el.find("img.iconActive").hide(),t.$el.find("img.iconNormal").show(),t.active=!1}else t.$el.find("img.iconActive").show(),t.$el.find("img.iconNormal").hide(),t.active=!0},resetOtherStatus:function(){this.resetSubmitButtonStatus()},resetSubmitButtonStatus:function(){this.$el.find("img.iconActive").hide(),this.$el.find("img.iconNormal").show(),this.active=!1}})}),define("interaction_view/model/selectbox",["interaction_view/model/base"],function(){interaction_view.model.SelectBox=interaction_view.model.Base.extend({defaults:{iType:"SelectBox",iCommon:{portait:{iStartx:400,iStarty:200,iWidth:200,iHeight:200},landscape:{iStartx:400,iStarty:200,iWidth:200,iHeight:200}},iDetail:{},iParent:"",iChild:"",iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,iAutofocus:!1,iKeyscontrol:!0,callback:null},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(){this.iview=new interaction_view.view.SelectBox({model:this})},setsyncmodel:function(){}}),interaction_view.view.SelectBox=interaction_view.view.Base.extend({events:{},render:function(){var e=this;this.$el.find("input").on("change",function(){var t=$(this).is(":checked");if(interaction_view.events.onFormEvent(e.model,t),$(this).closest(".layer-mask").length){var i=this;setTimeout(function(){t?$(i).attr("checked","checked"):$(i).removeAttr("checked")},100)}});var t=interaction_view.events.onFormButtonRender(this.model);t.value&&this.$el.find("input").attr("checked","checked"),null!=t.field&&"radio"==t.field.i.field_type&&this.$el.find("input")[0].setAttribute("type","radio")},resetOtherStatus:function(){this.resetButtonStatus()},resetButtonStatus:function(){interaction_view.application.isBindingButton(this.model)&&(this.isRadio=!0,this.$el.find("input")[0].setAttribute("type","radio"));var e=interaction_view.events.onFormButtonRender(this.model);e.value?this.$el.find("input").attr("checked","checked"):this.$el.find("input").removeAttr("checked")}})}),define("interaction_view/model/imageblock",["interaction_view/model/image"],function(){interaction_view.model.ImageBlock=interaction_view.model.Base.extend({setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(){this.iview=new interaction_view.view.ImageBlock({model:this})},setsyncmodel:function(){}}),interaction_view.view.ImageBlock=interaction_view.view.Base.extend({render:function(){this.renderMask(),this.renderDraggable(),this.firstRender=!0,this.isEraserSet=!1,this.renderEdit();var e=this.$el.find(".Element");e.css("-moz-border-radius-topleft",e.css("border-top-left-radius")),e.css("-moz-border-radius-topright",e.css("border-top-right-radius")),e.css("-moz-border-radius-bottomleft",e.css("border-bottom-left-radius")),e.css("-moz-border-radius-bottomright",e.css("border-bottom-right-radius")),e.css("-webkit-border-top-left-radius",e.css("border-top-left-radius")),e.css("-webkit-border-top-right-radius",e.css("border-top-right-radius")),e.css("-webkit-border-bottom-left-radius",e.css("border-bottom-left-radius")),e.css("-webkit-border-bottom-right-radius",e.css("border-bottom-right-radius"));var t=this.getdetail();void 0!=t.linktype&&e.on("click",function(){interaction_view.renderLink(t.linktype,t)})},getArgs:function(){var e=this,t=this.getdetail();if(t.iEditable){var i=e.getFromUrl().split(",");if(i.length<5)return;t.iImg[0].picture=i[0]||t.iImg[0].picture,e.args=i,e.model._rotate=i[4],e.model._scale=i[3],e.model._x=i[1],e.model._y=i[2]}},preload:function(){this.getArgs()},setOtherDisplay:function(){var e=this.getdetail(),t=this.$el.children(".Element").find("img").first();if(this.args){this.$el.find("img").attr("src")!=this.args[0]&&this.$el.find("img").attr("src",this.args[0]);var i=this.args[4],n=this.args[3],a=this.args[1],r=this.args[2],o="rotate("+i+"deg) scale("+n+") skew(0deg) translate("+a+"px ,"+r+"px)";return t.css({"-webkit-transform":o,width:"100%",height:"auto"}),void t.parent().css({overflow:"hidden"})}var e=this.getdetail();e.iImg&&e.iImg.length>0&&e.iMask&&e.iMask_data.iSlipable&&(this.renderMask(),this.setMaskSlipable({items:this.$el.children(".Element").find("img").first(),containment:this.$el.children(".Element").children(),contentel:this.$el.children(".Element").find("img").first(),content_x:e.iMask_data.x,content_y:e.iMask_data.y})),e.iDisplay&&e.iImg&&e.iImg.length>0&&_g.ui.fitImage(this.$el.children(".Element").find("img").length?{fit:Number(e.iDisplay),width:e.iImg[0].width,height:e.iImg[0].height,items:this.$el.children(".Element").find("img"),parentHeight:parseInt(this.$el.children(".Element").css("height")),parentWidth:parseInt(this.$el.children(".Element").css("width"))}:{fit:Number(e.iDisplay),containment:this.$el.children(".Element").find(".image_wrap").first()}),e.iFullview&&this.fullview(),e.iEraser&&(this.model._reset=!0,this.el_str=this.$el.children(".Element").html(),this.setEraser())},getFromUrl:function(){var e=_g.getUrlParameterByName(this.model.id,message_link);if(e||(e=_g.getHashParameterByName(this.model.id)),null==e&&"epub360"==epub360_domain&&""!=interaction_view.environment.Sharedata.id)if(1==interaction_view.environment.Sharedata.status)interaction_view.environment.Sharedata.addView(this);else{var t=this.model.get("pageid"),i=interaction_view.environment.Sharedata.getitem(t,this.model.id);i&&(e=i.value)}return decodeURI(e||"")},removeFromUrl:function(){var e=_g.getUrlParameterByName(this.model.id,message_link);e&&(message_link=_g.replaceUrlParameterByName(this.model.id,"",message_link),message_link=message_link.replace("&&","&").replace("?&","?"),interaction_view.weixin.share());var t=_g.getHashParameterByName(this.model.id);if(t){var i=_g.replaceHashParameterByName(this.model.id,"");window.history.replaceState({},"",i.replace("#&","#").replace("&&","&"))}return e||t?!0:!1},addToUrl:function(e,t,i,n,a){var r=this.getdetail(),o=(e==r.iImg[0].origin?"":e)+","+t+","+i+","+n+","+a,s=this.model.id+"="+encodeURI(o),l=_g.getUrlParameterByName(this.model.id,message_link),c=0,d=message_link;if(l)encodeURI(l)!=encodeURI(s)?d=_g.replaceUrlParameterByName(this.model.id,s,message_link):c=1;else{var h="?";message_link.indexOf("?")>=0&&(h="&"),d+=h+s}if("epub360"==epub360_domain&&!c&&interaction_view.environment.Sharedata.enabled&&interaction_view.environment.Sharedata.setitem(this,{value:encodeURI(o)}),c||this.model.attributes.iDetail.iEditable&&(message_link=d,interaction_view.weixin.share()),!interaction_view.forpreview){var u=_g.getHashParameterByName(this.model.id);u?encodeURI(u)!=encodeURI(s)?window.history.replaceState({},"",_g.replaceHashParameterByName(this.model.id,s)):c=1:window.history&&(document.location.hash?window.history.replaceState({},"",document.location.hash+="&"+s):window.history.replaceState({},"","#"+s))}return c?!1:!0},renderMask:function(){var e=this.getdetail();e.iMask&&(this.$el.children(".Element").find("img").first().css({translate:[e.iMask_data.x,e.iMask_data.y]}),this.iScrollview&&this.iScrollview.scrollTo(e.iMask_data.x,e.iMask_data.y))},renderEdit:function(){var e=this,t=this.getdetail();t.iEditable&&(e.activeEdit=function(t){(interaction_view.environment.Paragraph.state()||t)&&"undefined"!=typeof wx_permissions&&wx_permissions.chooseImage&&(interaction_view.localIds?setTimeout(function(){e.setweixinimage(interaction_view.localIds[0])},100):interaction_view.weixin.chooseimage(function(t){t&&(interaction_view.localIds=t,e.setweixinimage(t[0]))}))},e.$el.children(".Element").on("click",function(){e.activeEdit(!0)}))},setweixinimage:function(e){var t=this,i=e;this.replaceImg(i);var n=this.getcommon(),a=n.iWidth,r=n.iHeight,o=this.model,s=o.attributes.iDetail.iEditable;interaction_view.imageEditor(this.model,a,r,i,function(e,n,a,r){return o._x=e,o._y=n,o._scale=a,o._rotate=r,t.model.localId&&t.model.localId==i?void(s&&t.addToUrl(t.model.pic,e,n,a,r)):(_g.device.ios()&&t.replaceImg(i),void interaction_view.imageUploader(i,function(o){t.replaceImg(o),t.model.localId=i,t.model.pic=o;var l=t.getdetail();l.iImg[0].picture=o,s&&t.addToUrl(o,e,n,a,r)}))},t.setweixinimage)},resetOtherStatus:interaction_view.view.Image.prototype.resetOtherStatus,fullview:interaction_view.view.Image.prototype.fullview,getLayerContentSize:interaction_view.view.Image.prototype.getLayerContentSize,setEraser:interaction_view.view.Image.prototype.setEraser,resetEraser:interaction_view.view.Image.prototype.resetEraser,isFullSwitch:interaction_view.view.Image.prototype.isFullSwitch,getGalleryModel:interaction_view.view.Image.prototype.getGalleryModel,repaint:interaction_view.view.Image.prototype.repaint,onShow:interaction_view.view.Image.prototype.onShow,getDragCopy:interaction_view.view.Image.prototype.getDragCopy,getClientXY:interaction_view.view.Image.prototype.getClientXY,resetDragDrop:interaction_view.view.Image.prototype.resetDragDrop,setDraggable:interaction_view.view.Image.prototype.setDraggable,activeDragDrop:interaction_view.view.Image.prototype.activeDragDrop,getDropXY:interaction_view.view.Image.prototype.getDropXY,resetDragDropStatus:interaction_view.view.Image.prototype.resetDragDropStatus,renderDraggable:interaction_view.view.Image.prototype.renderDraggable,drag_dragend:interaction_view.view.Image.prototype.drag_dragend,drag_dragin:interaction_view.view.Image.prototype.drag_dragin,renderCopyDraggable:interaction_view.view.Image.prototype.renderCopyDraggable,copy_dragend:interaction_view.view.Image.prototype.copy_dragend,old_transit_back:interaction_view.view.Image.prototype.old_transit_back,trigger_dragin_event:interaction_view.view.Image.prototype.trigger_dragin_event,trigger_drop_event:interaction_view.view.Image.prototype.trigger_drop_event,replaceImg:interaction_view.view.Image.prototype.replaceImg})}),define("interaction_view/model/weixincamera",["interaction_view/model/button"],function(){interaction_view.model.WeixinCamera=interaction_view.model.Button.extend({defaults:{iType:"WeixinCamera",iVisibility:!0,iCommon:null,iDetail:null,iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null},setview:function(){var e=this.get("iDetail");e.isSwitch&&(this.isSwitch=!0),this.iview=new interaction_view.view.WeixinCamera({model:this})}}),interaction_view.view.WeixinCamera=interaction_view.view.Button.extend({events:{},render:function(){},afterpreload:function(e){e&&this.preloaded||(e&&!this.preloaded&&(this.preloaded=this.checkImgload(e)),this.preloaded&&(this.setZindex(),this.setElementDisplay(),this.setOtherDisplay(),this.copyelstyle=this.$el.attr("style"),this.copyelementstyle=this.$el.children(".iElement").attr("style")))},setOtherDisplay:function(){this.active=!1,this.buttonon=!1;var e=this;this.$el.css("cursor","pointer");this.getdetail();if(interaction_view.ismobile)var t="touchstart",i="touchend";else var t="mousedown",i="mouseup";this.$el.on(t,function(){e.buttonon=!0,e.changeStatus()}),this.$el.on(i,function(){e.buttonon&&(e.buttonon=!1,e.changeStatus(),_g.device.isWeixin()?window.setTimeout(function(){interaction_view.weixin.chooseimage(function(t){t?(interaction_view.localIds=t,interaction_view.events.onWeixinEvent(e,71)):interaction_view.events.onWeixinEvent(e,72)})},500):interaction_view.errorAlert("è¯·åœ¨å¾®ä¿¡ä¸­æ“ä½œ"))})},changeStatus:function(){var e=(this.getdetail(),this);e.active?(e.$el.find("img.iconActive").hide(),e.$el.find("img.iconNormal").show(),e.active=!1):(e.$el.find("img.iconActive").show(),e.$el.find("img.iconNormal").hide(),e.active=!0)},resetOtherStatus:function(){this.resetWeixinCameraStatus()},resetWeixinCameraStatus:function(){this.$el.find("img.iconActive").hide(),this.$el.find("img.iconNormal").show(),this.active=!1}})}),define("interaction_view/model/weixinvoice",["interaction_view/model/button"],function(){interaction_view.model.WeixinVoice=interaction_view.model.Button.extend({defaults:{iType:"WeixinVoice",iVisibility:!0,iCommon:null,iDetail:null,iOptions:{createfocus:!0},iParentModel:null,iDraggable:!0,iResizable:!0,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null},setview:function(){var e=this.get("iDetail");e.isSwitch&&(this.isSwitch=!0),this.iview=new interaction_view.view.WeixinVoice({model:this})}}),interaction_view.view.WeixinVoice=interaction_view.view.Button.extend({events:{},render:function(){},afterpreload:function(e){e&&this.preloaded||(e&&!this.preloaded&&(this.preloaded=this.checkImgload(e)),this.preloaded&&(this.setZindex(),this.setElementDisplay(),this.setOtherDisplay(),this.copyelstyle=this.$el.attr("style"),this.copyelementstyle=this.$el.children(".iElement").attr("style")))},setOtherDisplay:function(){this.active=!1,this.buttonon=!1;var e=this;this.$el.css("cursor","pointer");this.getdetail();if(interaction_view.ismobile)var t="touchstart",i="touchend";else var t="mousedown",i="mouseup";this.$el.on(t,function(){e.buttonon=!0,e.changeStatus()}),this.$el.on(i,function(){e.buttonon&&(e.buttonon=!1,e.changeStatus(),_g.device.isWeixin()?window.setTimeout(function(){interaction_view.voiceEditor(function(t){t?(interaction_view.voicelocalId=t,interaction_view.events.onWeixinEvent(e,71)):interaction_view.events.onWeixinEvent(e,72)})},500):interaction_view.errorAlert("è¯·åœ¨å¾®ä¿¡ä¸­æ“ä½œ"))})},changeStatus:function(){var e=(this.getdetail(),this);e.active?(e.$el.find("img.iconActive").hide(),e.$el.find("img.iconNormal").show(),e.active=!1):(e.$el.find("img.iconActive").show(),e.$el.find("img.iconNormal").hide(),e.active=!0)},resetOtherStatus:function(){this.resetWeixinVoiceStatus()},resetWeixinVoiceStatus:function(){this.$el.find("img.iconActive").hide(),this.$el.find("img.iconNormal").show(),this.active=!1}})}),define("text!interaction/template/infoList_content.js",[],function(){return'<%\n	var position = ["left", "center", "right", "justify"],\n		strokeType = ["", "solid", "dotted", "dashed"],\n		boderStr;\n	if(iDetail.stroke_type == 0)\n		boderStr = "none";\n	else\n		boderStr = (iDetail.stroke_width>=0?iDetail.stroke_width:1)+"px "+strokeType[iDetail.stroke_type>=1?iDetail.stroke_type:1];\n	_.each(infolist, function(v,i){ %>\n<table style="margin: 0;<%=(page&&i==0)?"":"border-top:"+boderStr+";"%> <%=(infolist.length==i+1)?"border-bottom:"+boderStr+";":""%>border-color:<%=iDetail.stroke_color%>">\n	<tr>\n		<td style="width: 50px; vertical-align: top;<%=iDetail.iPortrait?"":"display:none"%>">\n			<div style="background-image: url(<%=v.portrait||"/staticfs/diazo/img/avatar.png"%>);width: 30px;height: 30px;margin: 10px;background-size: cover;	background-position: 50% 50%;border-radius: 40px;"></div>\n		</td>\n		<td style="vertical-align: top;padding: 5px;">\n			<p style="margin: 0;font-size: 13px;font-weight: bold;<%=iDetail.iNickname?"":"display:none;"%> color:<%=iDetail.nickname_color%>; min-height:21px;"><%=_g.util.htmlspecialchars(v.nickname||"")%></p>\n			<p style="color:<%=iDetail.font_color%>;font-size:<%=iDetail.font_size%>px;text-align:<%=position[iDetail.iPosition]%>;"><%=_g.util.htmlspecialchars(v[iDetail.iField])%></p>\n		</td>\n	</tr>\n</table>\n<%})%>'
}),define("interaction_view/model/infoList",["interaction_view/model/base","text!interaction/template/infoList_content.js","text!interaction_view/template/prompt.js"],function(){var e=require("text!interaction/template/infoList_content.js"),t=require("text!interaction_view/template/prompt.js");interaction_view.model.InfoList=interaction_view.model.Base.extend({setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(){this.iview=new interaction_view.view.InfoList({model:this})},setsyncmodel:function(){}}),interaction_view.view.InfoList=interaction_view.view.Base.extend({render:function(){this.totalInfoPage=0,this.currentPage=1,this.pullUpInfo=["ä¸Šæ‹‰åŠ è½½æ›´å¤š","é‡Šæ”¾æ›´æ–°"],this.model._reset=!0},resetOtherStatus:function(){this.getInfo()},renderUrl:function(e){var t=this.getdetail(),i=t.iAppUrl+"infolist.json";return i+="?iField="+t.iField,i+=this.currentPage>1&&!e?"&size="+t.size*this.currentPage:"&size="+t.size,i+="&sort_by="+t.sort_by,i+="&sort_order="+(t.sord_order?1:-1),1==t.sort_by&&(i+="&unique="+t.unique),e&&(i+="&page="+e),t.iKind&&2==t.iKind&&("undefined"!=typeof epub360_sourceinfo&&void 0!=epub360_sourceinfo.openid?i+="&source_openid="+epub360_sourceinfo.openid:"undefined"!=typeof epub360_userinfo&&void 0!=epub360_userinfo.openid&&(i+="&source_openid="+epub360_userinfo.openid)),i},getInfo:function(t){var i,n=this,a=this.getdetail(),r=!1;t?(this.currentPage<this.totalInfoPage?this.currentPage++:r=!0,i=n.renderUrl(this.currentPage)):i=n.renderUrl(),r||_g.ajax.get({dataType:"JSON",url:i,callback:function(i){if(200==i.code){n.totalInfoPage=Math.ceil(i.data.sum/a.size);var r=_.template(e,{infolist:i.data.results,iDetail:a,page:t}),o={x:0,y:0};t?(o=n.scrollview.iScroll.getComputedPosition(),n.$el.find(".info-content .lists").append(r)):n.$el.find(".info-content .lists").html(r),n.renderScroll(o),n.updatePullUpInfo()}else n.$el.find(".info-content .lists").html("ç©º")}})},postInfo:function(){console.log("postinfo");var e=this,i=this.getdetail(),n="InfoListInput",a=_.template(t,{class_name:n}),r=$("."+n);r.length||(r=$(a).appendTo("body")),r.show().attr("infolist-id",e.model.id);var o=r.find(".modalArea");interaction_view.ismobile&&o.width($(document).width()),_g.ui.center({Item:o}),r.find("textarea").val("");var s=function(){r.find("textarea").focus().click(function(){$(this).focus()})};r.find("button.cancel").one("click",function(){r.remove()}),r.find("button.ok").one("click",function(){if(r.attr("infolist-id")==e.model.id){r.remove();var t={};t[i.iField]=r.find("textarea").val(),_g.ajax.post({dataType:"JSON",url:i.iAppUrl+"?format=json",data:t,callback:function(t){200==t.code&&e.getInfo()}})}}),s(),setTimeout(s,500)},updatePullUpInfo:function(){this.pullUpInfo=this.currentPage>=this.totalInfoPage?["æ²¡æœ‰æ›´å¤šäº†","æ²¡æœ‰æ›´å¤šäº†"]:["ä¸Šæ‹‰åŠ è½½æ›´å¤š","é‡Šæ”¾æ›´æ–°"],this.$el.find(".info-content .pullUp").html(this.pullUpInfo[0]).text(this.pullUpInfo[0])},getLayerContentSize:function(){var e,t={width:0,height:0};return t.width=this.$el.find(".info-content .lists").width(),t.height=this.$el.find(".info-content .lists").height(),e=this.$el.find(".Element").height(),t.height<=e&&(t.height=e),t.height+=10,t},renderScroll:function(e){this.scrollview&&this.scrollview.iScroll.destroy();var t=this,i=this.getMoveRange(),n=this.$el.find(".Element"),a=0;this.scrollview=new _g.scrollview({containment:n,contentel:this.$el.find(".info-content"),mask_width:n.width(),mask_height:n.height(),content_width:this.getLayerContentSize().width,content_height:this.getLayerContentSize().height,content_x:0,content_y:e.y,scrollY:i.y>0?!0:!1,onScrolling:function(e){if(i.y>0){if(e.deltaY>0&&t.$el.find(".info-content .pullUp").hide(),e.deltaY<-5-i.y&&t.$el.find(".info-content .pullUp").show(),-e.deltaY>i.y+30)a=1,t.$el.find(".info-content .pullUp").html(t.pullUpInfo[1]).text(t.pullUpInfo[1]);else{if(!(e.deltaY>30))return t.$el.find(".info-content .pullUp").html(t.pullUpInfo[0]).text(t.pullUpInfo[0]),void t.$el.find(".info-content .pullDown").html("ä¸‹æ‹‰åˆ·æ–°").text("ä¸‹æ‹‰åˆ·æ–°");a=2,t.$el.find(".info-content .pullDown").html("é‡Šæ”¾æ›´æ–°").text("é‡Šæ”¾æ›´æ–°")}n.addClass("is_exceededY")}},onScrollend:function(){a>0&&t.getInfo(1==a),n.removeClass("is_exceededY"),t.$el.find(".info-content").find(".pullUp").hide()}}),this.$el.addClass("hascontrols")}})}),define("text!interaction/template/chartList_content.js",[],function(){return'<div style="color:<%=iDetail.font_color%>;font-size:<%=iDetail.font_size%>px;">\n   <p style="font-weight:bold;margin:2px;"><%=iDetail.label%></p>\n   <p style="text-align:right;margin:2px;">å‚ä¸Žäººæ•°ï¼š<span><%=infolist.sum%></span></p>\n   <%\n		var position = ["left", "center", "right", "justify"],\n			strokeType = ["", "solid", "dotted", "dashed"],\n			boderStr;\n		if(iDetail.stroke_type == 0)\n			boderStr = "none";\n		else\n			boderStr = (iDetail.stroke_width>=0?iDetail.stroke_width:1)+"px "+strokeType[iDetail.stroke_type>=1?iDetail.stroke_type:1];\n		_.each(infolist.items, function(v,i){ %>\n	<table style="width: 100%; margin: 0;border-top: <%=boderStr%>;<%=(infolist.length==i+1)?"border-bottom:"+boderStr+";":""%>border-color:<%=iDetail.stroke_color%>">\n		<tr>\n			<td style="width:20px;text-align:left;padding: 2px;"><%=i+1%>.</td>\n			<td style="text-align:<%=position[iDetail.iPosition]%>;font-size:<%=iDetail.font_size%>px;"><%=v.value%></td>\n		</tr>\n		<tr>\n			<td colspan="2">\n				<div style="width:100%;height:13px;background-color:#D9D9D9">\n					<div style="width: <%=(v.count/infolist.sum*100).toFixed(2)%>%;background-color:<%=Colors[i%10]%>;height:100%"></div>\n				</div>\n			</td>\n		</tr>\n		<tr><td colspan="2" style="text-align:right;padding: 2px;"><%=v.count%>äºº <%=(v.count/infolist.sum*100).toFixed(2)%>%</td></tr>\n	</table>\n   <%})%>\n</div>'}),define("interaction_view/model/chartList",["interaction_view/model/base","text!interaction/template/chartList_content.js"],function(){var e=require("text!interaction/template/chartList_content.js");interaction_view.model.ChartList=interaction_view.model.Base.extend({setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(){this.iview=new interaction_view.view.ChartList({model:this})},setsyncmodel:function(){}}),interaction_view.view.ChartList=interaction_view.view.Base.extend({render:function(){this.Colors=["#50d92b","#5dbc5e","#9fb5ef","#a5cbd6","#d743b3","#e2fea9","#fd7a99","#fce096","#e6f63b","#e7ab6d"],this.model._reset=!0},resetOtherStatus:function(){this.getInfo()},renderUrl:function(){var e=this.getdetail(),t=e.iAppUrl+"chartlist.json";return t+="?iField="+e.iField},getInfo:function(){var e=this,t=this.getdetail();_g.ajax.get({dataType:"JSON",url:e.renderUrl(),callback:function(i){if(200==i.code&&i.data.results.length>0){var n={sum:i.data.sum,items:i.data.results.length?i.data.results[0].items:[]};(t.sort_by=1)&&n.items.sort(function(e,i){return t.sord_order?parseInt(e.count)>parseInt(i.count):parseInt(e.count)<parseInt(i.count)}),e.renderChart(n),e.renderScroll()}else e.$el.find(".info-content .lists").html("ç©º")}})},renderChart:function(t){var i,n=this,a=this.getdetail();if(0==a.iKind)i=_.template(e,{infolist:t,iDetail:a,Colors:n.Colors}),n.$el.find(".info-content .lists").html(i);else{{var r=[];n.getcommon().iWidth,n.getcommon().iHeight}_.each(t.items,function(e){r.push([e.value,Number(e.count)])}),n.$el.find(".info-content .lists").highcharts({chart:{backgroundColor:null,plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},title:{text:a.label},credits:{enabled:!1},tooltip:{pointFormat:"{series.name}: <b>{point.percentage:.1f}%</b>"},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!1},showInLegend:!0}},legend:{itemStyle:{"font-size":a.font_size+"px",color:a.font_color}},series:[{type:"pie",name:"å æ¯”",data:r}]}),n.$el.find(".info-content .lists .highcharts-button").hide(),n.$el.find(".info-content .lists .highcharts-title").css("font-size",a.font_size)}},getLayerContentSize:function(){var e,t={width:0,height:0};return t.width=this.$el.find(".info-content .lists").width(),t.height=this.$el.find(".info-content .lists").height(),e=this.$el.find(".Element").height(),t.height<=e&&(t.height=e),t.height*=1.03,t},renderScroll:function(){this.scrollview&&this.scrollview.iScroll.destroy();var e=this,t=this.getMoveRange(),i=this.$el.find(".Element"),n=0;this.scrollview=new _g.scrollview({containment:i,contentel:this.$el.find(".info-content"),mask_width:i.width(),mask_height:i.height(),content_width:this.getLayerContentSize().width,content_height:this.getLayerContentSize().height,content_x:0,content_y:0,scrollY:t.y>0?!0:!1,onScrolling:function(a){if(t.y>0){if(!(a.deltaY>30))return void e.$el.find(".info-content .pullDown").html("ä¸‹æ‹‰åˆ·æ–°").text("ä¸‹æ‹‰åˆ·æ–°");n=1,e.$el.find(".info-content .pullDown").html("é‡Šæ”¾æ›´æ–°").text("é‡Šæ”¾æ›´æ–°"),i.addClass("is_exceededY")}},onScrollend:function(){n>0&&e.getInfo(),i.removeClass("is_exceededY")}}),this.$el.addClass("hascontrols")}})}),define("interaction_view/model/textbutton",["interaction_view/model/paragraph"],function(){interaction_view.model.TextButton=interaction_view.model.Paragraph.extend({defaults:{iType:"TextButton",iSync:!1},setview:function(){this.iview=new interaction_view.view.TextButton({model:this})}}),interaction_view.view.TextButton=interaction_view.view.Paragraph.extend({renderlink:function(){if(interaction_view.forpreview)return!1;var e=this.model.get("iDetail");this.$el.children(".Element").on("click",function(){void 0!=e.linktype&&interaction_view.renderLink(e.linktype,e)})},setOtherDisplay:function(){var e=this.getdetail();void 0!=e.isConfigConfirm&&this.$el.find(".iText").off("click").on("click",function(){configpage.saveConfig()}),void 0!=e.isConfigCancel&&this.$el.find(".iText").off("click").on("click",function(){window.close()})}})}),define("interaction_view/model/collision",["interaction_view/model/base"],function(){interaction_view.model.Collision=interaction_view.model.Base.extend({defaults:{},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(){this.iview=new interaction_view.view.Collision({model:this})},setsyncmodel:function(){}}),interaction_view.view.Collision=interaction_view.view.Base.extend({resetOtherStatus:function(){},render:function(){this.peers=this.getPeers(),this.bindHitDetect(),this.hitState={},this.cachePos={}},afterpreload:function(){if(this.model.pageid=this.model.get("pageid"),this.model.parentpageid=this.model.get("parentpageid"),"LayerRef"==this.model.get("pagetype")){var e=this.model.get("parentpageid"),t=this.model.get("layerid"),i=interaction_view.getParentpage(e);this.model.parentpage=i,this.model.page=i.iOverlaylist.get(this.model.pageid).layer[t],this.model.layer_id=t}else this.model.page=interaction_view.getParentpage(this.model.pageid);this.preloaded=!0},getPeers:function(){var e=this.getdetail(),t=[];return _.each(e.target_ids,function(i){_.each(e.source_ids,function(e){e!=i&&t.push([e,i])})}),t},bindHitDetect:function(){var e=this;_.each(e.peers,function(t){_.each(t,function(i){var n=e.model.page,a=n.iAnimationlist.where({overlay_id:i});_.each(a,function(n){var a=e.model.layer_id,r={type:"animation",page_id:e.model.page.id,overlay_id:i,animation_id:n.id,layer_id:a,_label:"collision"};a&&(r.iPage_id=e.model.iPage_id),r.func=function(){e.hitDetect(t[0],t[1],i)},interaction_view.events.animationUpdateEvents.push(r),r={type:"animation",page_id:e.model.page.id,overlay_id:i,animation_id:n.id,layer_id:a,_label:"collision"},r.func=function(){setTimeout(e.hitDetect(t[0],t[1],i),1)},interaction_view.events.animationEndEvents.push(r)});var r=e.model.layer_id,o=n.get&&n.get("overlays")||r&&interaction_view.ilayerlist.get(r).get("overlays"),s=o.filter(function(e){return e.id==i});if(s.length){var l={page_id:e.model.page.id,overlay_id:i,layer_id:r,_label:"collision"};r&&(l.iPage_id=e.model.iPage_id),l.func=function(){e.hitDetect(t[0],t[1],i)},interaction_view.events.draggingEvents.push(l)}})})},setHitState:function(e,t,i){this.hitState[e+t]=i,this.hitState[t+e]=i},getHitState:function(e,t){return this.hitState[e+t]},hitDetect:function(e,t,i){if(this.cachePos[i]=[!1,{}],this.isHit(e,t)){var n=this.getdetail(),a=!0;"once"==n.trigger&&this.getHitState(e,t)&&(a=!1),a&&(n.hide_source&&this.getModel(e).iview.$el.addClass("hide"),interaction_view.events.onCollision(this)),this.setHitState(e,t,!0)}else this.setHitState(e,t,!1)},isHit:function(e,t){var i=this,n=this.getdetail(),a=i.getModel(e),r=i.getModel(t);return a&&r?(a=a.iview.$el,r=r.iview.$el,0==a.css("opacity")||0==r.css("opacity")||"none"==a.css("display")||"none"==r.css("display")?!1:"center"==n.source_offset_type?"center"==n.target_offset_type?i.isHitCC(a,r):i.isHitCR(a,r):"center"==n.target_offset_type?i.isHitRC(a,r):i.isHitRR(a,r)):!1},getModel:function(e){return interaction_view.getParentpage(interaction_view.currentPage).iOverlaylist.where({id:e})[0]},isHitCC:function(e,t){var i=this,n=this.getdetail(),a=i.getCoord(e,"circle",n.source_offset),r=i.getCoord(t,"circle",n.target_offset);return i.isCircleHitCircle(a,r)},isHitCR:function(e,t){var i=this,n=this.getdetail(),a=i.getCoord(e,"circle",n.source_offset),r=i.getCoord(t,"rect",n.target_offset);return i.isCircleHitRect(a,r)},isHitRC:function(e,t){var i=this,n=this.getdetail(),a=i.getCoord(e,"rect",n.source_offset),r=i.getCoord(t,"circle",n.target_offset);return i.isCircleHitRect(r,a)},isHitRR:function(e,t){var i=this,n=this.getdetail(),a=i.getCoord(e,"rect",n.source_offset),r=i.getCoord(t,"rect",n.target_offset);return i.isRectHitRect(a,r)},getCoord:function(e,t,i){{var n=this;this.getdetail()}if(n.cachePos[e[0].id]&&n.cachePos[e[0].id][0])return n.cachePos[e[0].id][1];var a=n.getOffsetXY(e);e.hasClass("static")&&(a={x:a.x+e.children().width()/2,y:a.y+e.children().height()/2});var r;switch(t){case"circle":r={o:a,r:i};break;case"rect":var o=e.children().width(),s=e.children().height(),l=n.getDomRotation(e),c={x:a.x-o/2,y:a.y-s/2},d={x:c.x+o,y:c.y},h={x:c.x+o,y:c.y+s},u={x:c.x,y:c.y+s};c=n.getRotatedCoord(a,{x:c.x-i,y:c.y-i},l),d=n.getRotatedCoord(a,{x:d.x+i,y:d.y-i},l),h=n.getRotatedCoord(a,{x:h.x+i,y:h.y+i},l),u=n.getRotatedCoord(a,{x:u.x-i,y:u.y+i},l);var p=[c,d,h,u];r={o:a,vertex:p,w:o,h:s}}return n.cachePos[e[0].id]=[!0,r],r},getOffsetXY:function(e){var t=e.offset();return{x:t.left,y:t.top}},getDomRotation:function(e){function t(e,t){e=parseFloat(e),t=parseFloat(t);var i=(180*Math.asin(e)/Math.PI+360)%360;return e>=0&&t>=0?i:e>=0&&0>=t?180-i:0>=e&&t>=0?i:0>=e&&0>=t?540-i:void 0}function i(){var i,n=e.children().css("transform")||e.children().css("-webkit-transform");return n.split("(")[1]?(i=n.split("(")[1].split(","),t(i[1],i[0])):0}var n,a=e.children().css("transform")||e.children().css("-webkit-transform");if(a.split("(")[1]){var r=a.split("(")[1].split(",");n=t(r[1],r[0]),n||(n=i())}else n=i();return n},getRotatedCoord:function(e,t,i){var n=t;i=i/180*Math.PI;var a=(n.x-e.x)*Math.cos(i)-(n.y-e.y)*Math.sin(i)+e.x,r=(n.x-e.x)*Math.sin(i)+(n.y-e.y)*Math.cos(i)+e.y;return{x:a,y:r}},distPP:function(e,t){return Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y))},distPL:function(e,t,i){var n=i.y-t.y,a=t.x-i.x,r=i.x*t.y-t.x*i.y;return Math.abs(n*e.x+a*e.y+r)/Math.sqrt(n*n+a*a)},isCircleHitCircle:function(e,t){var i=this.distPP(e.o,t.o);return i<=e.r+t.r},isCircleHitRect:function(e,t){var i=t.w/2,n=t.h/2,a={x:(t.vertex[0].x+t.vertex[1].x)/2,y:(t.vertex[0].y+t.vertex[1].y)/2},r={x:(t.vertex[2].x+t.vertex[1].x)/2,y:(t.vertex[2].y+t.vertex[1].y)/2},o=this.distPL(e.o,t.o,a),s=this.distPL(e.o,t.o,r);return o>i+e.r?!1:s>n+e.r?!1:i>=o?!0:n>=s?!0:(o-i)*(o-i)+(s-n)*(s-n)<=e.r*e.r},isRectHitRect:function(e,t){var i=!0,n=[{x:e.vertex[0].x-e.vertex[3].x,y:e.vertex[0].y-e.vertex[3].y},{x:e.vertex[0].x-e.vertex[1].x,y:e.vertex[0].y-e.vertex[1].y},{x:t.vertex[0].x-t.vertex[3].x,y:t.vertex[0].y-t.vertex[3].y},{x:t.vertex[0].x-t.vertex[1].x,y:t.vertex[0].y-t.vertex[1].y}];return $.each(n,function(n,a){var r,o,s,l,c=[];return _.each(e.vertex,function(e){var t=e.x*a.x+e.y*a.y;c.push(t)}),r=_.min(c),o=_.max(c),c=[],_.each(t.vertex,function(e){var t=e.x*a.x+e.y*a.y;c.push(t)}),s=_.min(c),l=_.max(c),o>=s&&l>=r?void 0:(i=!1,!1)}),i}})}),define("interaction_view/model/usersvg",["interaction_view/model/base"],function(){interaction_view.model.UserSVG=interaction_view.model.Base.extend({defaults:{},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(){this.iview=new interaction_view.view.UserSVG({model:this})},setsyncmodel:function(){}}),interaction_view.view.UserSVG=interaction_view.view.Base.extend({resetOtherStatus:function(){},render:function(){var e=this.model.page.iAnimationlist.where({overlay_id:this.model.id,iType:702});if(e.length>0){if("undefined"==typeof TweenMax)return;TweenMax.set(this.$el.find("svg").find("path"),{display:"none"}),this.$el.find("svg").append("<g id='cloneArea' style='display:none;'></g>"),this.$el.find("svg #cloneArea").append(this.$el.find("svg").find("path").clone()),this.$el.find("svg #cloneArea path").each(function(e,t){t.id="clone_"+t.id,$(t).attr("data-attr","morphCloneElement")});var t=e[0].attributes.iDetail.pathIndex;if(!_.isEmpty(t)){if(t.find)var i=t.find(function(e){return null!=e.selected});else var i=_.find(t,function(e){return null!=e.selected});if(i){{i.id}TweenMax.set(this.$el.find("svg").find("path#"+i.id),{display:"block"})}}}}})}),define("interaction_view/model/avatarList",["_g/ajax","interaction_view/model/infoList"],function(){interaction_view.model.AvatarList=interaction_view.model.Base.extend({setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(){this.get("iDetail");this.iview=new interaction_view.view.AvatarList({model:this})},setsyncmodel:function(){}}),interaction_view.view.AvatarList=interaction_view.view.Base.extend({render:function(){var e=[30,40,50],t=["Hiragino Sans GB,Microsoft YaHei,SimHei,STHeiti","SimSun,å®‹ä½“,STSong","andale mono,times","arial,helvetica,sans-serif","arial black,avant garde","book antiqua,palatino","comic sans ms,sans-serif","courier new,courier","georgia,palatino","helvetica","impact,chicago","tahoma,arial,helvetica,sans-serif","terminal,monaco","times new roman,times","trebuchet ms,geneva","verdana,geneva"];this.$el.find(".avatar").css({width:e[this.model.attributes.iDetail.thumb_size]}),this.$el.find(".avatar .thumb").css({"border-radius":this.model.attributes.iDetail.cr+"px"}),this.$el.find(".avatar .title").css({color:this.model.attributes.iDetail.font_color,"font-size":this.model.attributes.iDetail.font_size+"px","font-family":t[this.model.attributes.iDetail.font_face]}),this.model.attributes.iDetail.show_title?this.$el.find(".avatar .title").show():this.$el.find(".avatar .title").hide(),this.$avatar=this.$el.find(".info-template .avatar").clone(),this.url="",this.totalInfoPage=0,this.currentPage=1,this.pullUpInfo=["ä¸Šæ‹‰åŠ è½½æ›´å¤š","é‡Šæ”¾æ›´æ–°"],this.model._reset=!0},resetOtherStatus:function(){this.delayShowel(),this.model.attributes.iDetail.RelationID||this.renderScroll()},delayShowel:function(){function e(){t.$el.find(".Element").css("visibility","visible")}var t=this;setTimeout(e,0)},renderScroll:function(){this.scrollview&&this.scrollview.iScroll.destroy();var e=this.getMoveRange(),t=this.$el.find(".Element");this.scrollview=new _g.scrollview({containment:t,contentel:this.$el.find(".info-content"),mask_width:t.width(),mask_height:t.height(),content_width:this.getLayerContentSize().width,content_height:this.getLayerContentSize().height,content_x:0,content_y:0,scrollY:e.y>0?!0:!1}),this.$el.addClass("hascontrols")},getLayerContentSize:function(){var e,t,i,n,a={width:0,height:0};i=this.$el.find(".Element").width(),n=this.$el.find(".Element").height();var r=2*parseInt(this.$el.find(".avatar:first").css("padding"));return e=this.$el.find(".avatar:first").width()+r,t=this.$el.find(".avatar:first").height(),0==t&&(this.$el.removeClass("hide"),t=this.$el.find(".avatar:first").height(),t>0?this.$el.addClass("hide"):t=60),t+=r,a.width=i,a.height=Math.ceil(this.$el.find(".avatar").size()/Math.floor(i/e))*t,this.$el.find(".info-content").css({width:a.width,height:a.height}),a.height<=t&&(a.height=t),a.height+=10,this.$el.find(".info-content .lists").height(a.height),a},updatePullUpInfo:interaction_view.view.InfoList.prototype.updatePullUpInfo,renderPagingScroll:interaction_view.view.InfoList.prototype.renderScroll,getInfo:function(e){var t=this,i=(this.getdetail(),this.url),n=!1;e&&(this.currentPage<this.totalInfoPage?this.currentPage++:n=!0,i+="&page="+this.currentPage),n||_g.ajax.get({dataType:"JSON",url:i,callback:function(i){if(200==i.code){t.totalInfoPage=i.data.numpages;var n={x:0,y:0},a=t.$el.find(".info-content .lists"),r=t.$el.find(".info-template .avatar .title").height();e?n=t.scrollview.iScroll.getComputedPosition():a.empty(),$.each(i.data.results,function(e,i){var n=t.$avatar.clone();n.find(".thumb").css("background-image","url("+i.portrait+")"),n.find(".title").html(i.nickname).attr("title",i.nickname),a.append(n)}),a.find(".avatar .title").height(r),t.renderPagingScroll(n),t.updatePullUpInfo()}else t.$el.find(".info-content .lists").html("ç©º")}})}})}),define("interaction_view/model/avatar",["_g/ajax","interaction_view/model/vote","interaction_view/model/avatarList"],function(){interaction_view.model.Avatar=interaction_view.model.Base.extend({setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(){this.get("iDetail");this.setSubOverlays(),this.iview=new interaction_view.view.Avatar({model:this})},setsyncmodel:function(){}}),interaction_view.view.Avatar=interaction_view.view.Base.extend({render:function(){this.model._reset=!0},resetOtherStatus:function(){if(this.delayShowel(),!this.model.attributes.iDetail.RelationID){var e,t;void 0!=this.model.attributes.iDetail.iKind&&1==this.model.attributes.iDetail.iKind?"undefined"!=typeof epub360_sourceinfo&&epub360_sourceinfo.portrait&&(e=epub360_sourceinfo.portrait,t=epub360_sourceinfo.nickname):"undefined"!=typeof epub360_userinfo&&void 0!=epub360_userinfo.portrait&&(e=epub360_userinfo.portrait,t=epub360_userinfo.nickname),e&&this.$el.find(".thumb").css({"background-image":"url("+e+")","background-size":"cover"}),t&&this.$el.find(".iTextLabel p").html(t)}this.model.attributes.iDetail.iNickname?this.$el.find(".iTextLabel").show():this.$el.find(".iTextLabel").hide()},delayShowel:interaction_view.view.AvatarList.prototype.delayShowel,preload:interaction_view.view.Vote.prototype.preload,checkImgload:interaction_view.view.Vote.prototype.checkImgload,afterpreload:interaction_view.view.Vote.prototype.afterpreload,setTitle:function(){if(this.model.attributes.iDetail.iNickname){var e=(this.getdetail(),this.model.get("suboverlays")),t=e[0].iDetail.iValue,i=interaction_view.formatLabel({text:"Jason"==t?"Name":t,font_size:e[0].iDetail.font_size,text_color:e[0].iDetail.text_color,iPosition:e[0].iDetail.iPosition});this.$el.find(".iTextLabel.Element").html(i)}},afterSubOverlayPreload:interaction_view.view.Vote.prototype.afterSubOverlayPreload})}),define("interaction_view/model/initButton",["interaction_view/model/button"],function(){interaction_view.model.InitButton=interaction_view.model.Button.extend({setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(){this.iview=new interaction_view.view.InitButton({model:this})},setsyncmodel:function(){}}),interaction_view.view.InitButton=interaction_view.view.Button.extend({render:function(){var e=this,t=interaction_view.environment.Shareapp.slug,i="tap";e.$el.find("img.iconNormal").hammer().on(i,function(){_g.ajax.post({dataType:"JSON",url:"/share/"+t+"/create",callback:function(t){if(200==t.code){var i=t.data.results[0].shareinfo.id;message_link=_g.replaceUrlParameterByName("shareid","shareid="+i,message_link),interaction_view.environment.Shareapp.shareinfo=t.data.results[0].shareinfo,interaction_view.environment.Shareapp.id=i,2!=interaction_view.environment.Shareapp.status&&(interaction_view.environment.Shareapp.status=2,interaction_view.environment.Shareapp.appinfo={target_num:0,help_rule:0}),epub360_userinfo.hasOwnProperty("openid")&&(interaction_view.environment.Shareapp.helperinfo=epub360_userinfo,interaction_view.environment.Shareapp.helperinfo.help_num=0,interaction_view.environment.Shareapp.helperinfo.help_num_today=0);var n=_.filter(interaction_view.getAnimationPage(interaction_view.currentPage).iOverlaylist.models,function(e){return"UserList"==e.attributes.iType});if(n.length>0){var a=t.data.results[0].shareinfo.nickname,r=t.data.results[0].shareinfo.portrait,o=n[0];0==o.iview.status?o.iview.resetOtherStatus():o.iview.setShareAppInfo(i,a,r)}interaction_view.weixin.share(),interaction_view.events.onUserList(e,78)}else interaction_view.events.onUserList(e,79)},onError:function(){interaction_view.events.onUserList(e,79)}})}),this.model._reset=!0}})}),define("interaction_view/model/userList",["interaction_view/model/base"],function(){interaction_view.model.UserList=interaction_view.model.Base.extend({setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(){this.iview=new interaction_view.view.UserList({model:this})},setsyncmodel:function(){}}),interaction_view.view.UserList=interaction_view.view.Base.extend({render:function(){this.model._reset=!0,this.binded=!1,this.status=0,interaction_view.environment.Shareapp.add(this)},afterpreload:function(){if(this.model.pageid=this.model.get("pageid"),this.model.parentpageid=this.model.get("parentpageid"),"LayerRef"==this.model.get("pagetype")){var e=this.model.get("parentpageid"),t=this.model.get("layerid"),i=interaction_view.getParentpage(e);this.model.parentpage=i,this.model.page=i.iOverlaylist.get(this.model.pageid).layer[t]}else this.model.page=interaction_view.getParentpage(this.model.pageid);this.preloaded=!0},resetOtherStatus:function(){var e=this;interaction_view.environment.Shareapp.status<2||(this.avatar=this.getRelationOverlay(0),this.avatarList=this.getRelationOverlay(1),this.button=this.getRelationOverlay(2),this.avatar&&this.avatarList&&this.button&&(2==interaction_view.environment.Shareapp.status?(e.getAvatar(),e.getAvatarList(),!e.binded&&e.bindSupportTrigger()):this.avatarList.renderScroll(),this.model._reset=!1,this.status=2,this.binded=!0))},getAvatar:function(){var e=this;2==interaction_view.environment.Shareapp.status&&(e.setAvatar(interaction_view.environment.Shareapp.shareinfo.nickname,interaction_view.environment.Shareapp.shareinfo.portrait),interaction_view.environment.Shareapp.shareinfo.total>=interaction_view.environment.Shareapp.appinfo.target_num&&("undefined"!=typeof epub360_userinfo&&epub360_userinfo.openid==interaction_view.environment.Shareapp.shareinfo.openid&&interaction_view.events.onUserList(e,74),interaction_view.environment.Shareapp.helperinfo&&interaction_view.environment.Shareapp.helperinfo.help_num>0&&interaction_view.events.onUserList(e,75)))},setShareAppInfo:function(e,t,i){var n=this;n.share_id=e,n.setAvatar(t,i),n.getAvatarList()},setAvatar:function(e,t){var i=this;i.avatar.$el.find(".thumb").css({"background-image":"url("+t+")","background-size":"cover"}),i.avatar.$el.find(".iTextLabel p").html(e)},getAvatarList:function(){var e=this;e.avatarList.url="/share/"+interaction_view.environment.Shareapp.slug+"/list?id="+interaction_view.environment.Shareapp.id,e.resetAvatarList(),e.avatarList.getInfo()},resetAvatarList:function(){var e=this,t=e.avatarList.$el.find(".info-content .lists");t.empty()},bindSupportTrigger:function(){var e=this,t=1,i="tap";e.button.$el.find("img.iconNormal").hammer().on(i,function(){if(interaction_view.environment.Shareapp.helperinfo&&interaction_view.environment.Shareapp.helperinfo.help_num>0)if(0==interaction_view.environment.Shareapp.appinfo.help_rule){if(interaction_view.environment.Shareapp.helperinfo&&interaction_view.environment.Shareapp.helperinfo.help_num>0)return void interaction_view.errorAlert("æ‚¨å·²ç»æ”¯æŒè¿‡ï¼Œè°¢è°¢!")}else if(interaction_view.environment.Shareapp.appinfo.help_rule<=interaction_view.environment.Shareapp.helperinfo.help_num_today)return void interaction_view.errorAlert("æ‚¨ä»Šå¤©çš„æ¬¡æ•°å·²ç»ç”¨å®Œ!");_g.ajax.post({dataType:"JSON",url:"/share/"+interaction_view.environment.Shareapp.slug+"/help",data:{share_id:interaction_view.environment.Shareapp.id,amount:t},callback:function(t){if(200==t.code){if("undefined"!=typeof epub360_userinfo&&void 0!=epub360_userinfo.portrait){var i=e.avatarList.$el.find(".info-content .lists"),n=e.avatarList.$avatar.clone();n.find(".thumb").css("background-image","url("+epub360_userinfo.portrait+")"),n.find(".title").html(epub360_userinfo.nickname).attr("title",epub360_userinfo.nickname),n.find(".title").css("height","18px"),i.prepend(n),interaction_view.environment.Shareapp.helperinfo=epub360_userinfo,interaction_view.environment.Shareapp.helperinfo.help_num=1,_g.ajax.get({dataType:"JSON",url:"/share/"+interaction_view.environment.Shareapp.slug+"/info?id="+interaction_view.environment.Shareapp.id,callback:function(t){200==t.code&&(interaction_view.environment.Shareapp.helperinfo=t.data.results[0].helperinfo,interaction_view.environment.Shareapp.shareinfo.total=interaction_view.environment.Shareapp.shareinfo.total+1,interaction_view.environment.Shareapp.shareinfo.total>=interaction_view.environment.Shareapp.appinfo.target_num&&interaction_view.events.onUserList(e,75))}})}interaction_view.events.onUserList(e.button,76)}else interaction_view.events.onUserList(e.button,77)},onError:function(){interaction_view.events.onUserList(e.button,77)}})})},getRelationOverlay:function(e){var t=this.model.get("iDetail").RelationID;t=t.replace(t.split("_")[0],"t"+e);var i=_.filter(interaction_view.getAnimationPage(interaction_view.currentPage).iOverlaylist.models,function(e){return e.id&&e.get("iDetail").RelationID&&e.get("iDetail").RelationID==t});return i.length>0?i[0].iview:null}})}),define("interaction_view/model/infoForm",["interaction_view/model/userList"],function(){interaction_view.model.InfoForm=interaction_view.model.Base.extend({setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(){this.iview=new interaction_view.view.InfoForm({model:this})},setsyncmodel:function(){}}),interaction_view.view.InfoForm=interaction_view.view.Base.extend({render:function(){this.model._reset=!0,this.binded=!1},afterpreload:function(){if(this.model.pageid=this.model.get("pageid"),this.model.parentpageid=this.model.get("parentpageid"),"LayerRef"==this.model.get("pagetype")){var e=this.model.get("parentpageid"),t=this.model.get("layerid"),i=interaction_view.getParentpage(e);this.model.parentpage=i,this.model.page=i.iOverlaylist.get(this.model.pageid).layer[t]}else this.model.page=interaction_view.getParentpage(this.model.pageid);this.preloaded=!0},getRelationOverlay:interaction_view.view.UserList.prototype.getRelationOverlay,resetOtherStatus:function(){if(!this.binded){var e=this,t=_g.getUrlParameterByName("shareid"),i=interaction_view.shareapp.id;this.input_fullname=this.getRelationOverlay(0),this.input_mobile=this.getRelationOverlay(1),this.input_address=this.getRelationOverlay(2),this.input_email=this.getRelationOverlay(3),this.input_memo=this.getRelationOverlay(4),this.button=this.getRelationOverlay(5),e.bindSubmitTrigger(t,i),this.model._reset=!1,this.binded=!0}},isValid:function(e,t,i,n){var a=this;if(!$.trim(e))return alert("è¯·è¾“å…¥å§“åï¼"),!1;if(!$.trim(t))return alert("è¯·è¾“å…¥æ‰‹æœºå·ç ï¼"),!1;var r=/^0?1[3|4|5|7|8][0-9]\d{8}$/;return r.test(t)?(t&&(epub360_userinfo=epub360_userinfo||{},epub360_userinfo.mobile=t),a.model.get("iDetail").show_address&&!$.trim(i)?(alert("è¯·è¾“å…¥åœ°å€ä¿¡æ¯ï¼"),!1):a.model.get("iDetail").show_email&&!$.trim(n)?(alert("è¯·è¾“å…¥ç”µå­é‚®ç®±ä¿¡æ¯ï¼"),!1):!0):(alert("è¯·è¾“å…¥æ­£ç¡®æ‰‹æœºå·ç ï¼"),!1)},bindSubmitTrigger:function(e,t){var i=this,n="tap";i.button.$el.find("img.iconNormal").hammer().on(n,function(){if(!t)return void alert("ä»…é…åˆåŠ©åŠ›æ´»åŠ¨ä½¿ç”¨ï¼Œç»‘å®šåŠ©åŠ›åº”ç”¨åŽç”Ÿæ•ˆï¼");var n=i.input_fullname&&i.input_fullname.$el.find("input").val(),a=i.input_mobile&&i.input_mobile.$el.find("input").val(),r=i.input_address&&i.input_address.$el.find("input").val(),o=i.input_email&&i.input_email.$el.find("input").val(),s=i.input_memo&&i.input_memo.$el.find("textarea").val();
i.isValid(n,a,r,o)&&_g.ajax.post({dataType:"JSON",url:"/share/"+t+"/signup",data:{share_id:e,fullname:n,mobile:a,address:r,email:o,memo:s},callback:function(e){200==e.code?(interaction_view.events.onUserList(i.button,80),"function"==typeof epub360FromSubmited&&epub360FromSubmited()):interaction_view.events.onUserList(i.button,81)},onError:function(){interaction_view.events.onUserList(i.button,81)}})})}})}),define("interaction_view/model/contactForm",["interaction_view/model/infoForm"],function(){interaction_view.model.ContactForm=interaction_view.model.Base.extend({setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(){this.iview=new interaction_view.view.ContactForm({model:this})},setsyncmodel:function(){}}),interaction_view.view.ContactForm=interaction_view.view.InfoForm.extend({bindSubmitTrigger:function(e){var t=this,i="tap";t.button.$el.find("img.iconNormal").hammer().on(i,function(){var i=t.input_fullname&&t.input_fullname.$el.find("input").val(),n=t.input_mobile&&t.input_mobile.$el.find("input").val(),a=t.input_address&&t.input_address.$el.find("input").val(),r=t.input_email&&t.input_email.$el.find("input").val(),o=t.input_memo&&t.input_memo.$el.find("textarea").val();t.isValid(i,n,a,r)&&_g.ajax.post({dataType:"JSON",url:"/manage/book/"+interaction_view.doc.id+"/form/",data:{id:t.model.get("id"),title:t.model.get("iDetail").title,share_id:e,fullname:i,mobile:n,address:a,email:r,memo:o},callback:function(e){200==e.code?(interaction_view.events.onContactFormSubmit(t.button,82),"function"==typeof epub360FromSubmited&&epub360FromSubmited()):interaction_view.events.onContactFormSubmit(t.button,83)},onError:function(){interaction_view.events.onContactFormSubmit(t.button,83)}})})}})}),define("interaction_view/model/plugin",["interaction_view/model/base","text!interaction_view/template/offline_info.js"],function(){require("text!interaction_view/template/offline_info.js");interaction_view.model.Plugin=interaction_view.model.Base.extend({defaults:{iType:"Plugin",iCommon:{portait:{iStartx:400,iStarty:200,iWidth:200,iHeight:200},landscape:{iStartx:400,iStarty:200,iWidth:200,iHeight:200}},iDetail:{},iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",callback:null},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(){this.iview=new interaction_view.view.Plugin({model:this})},setsyncmodel:function(){}}),interaction_view.view.Plugin=interaction_view.view.Base.extend({events:{},render:function(){var e=this.getdetail();this.$el.children(".Element").html(e.iSource),this.model.renderWebContent=!0},renderWebContent:function(){this.getdetail()},clearWebContent:function(){}})}),define("interaction_view/model/select",["interaction_view/model/base"],function(){interaction_view.model.Select=interaction_view.model.Base.extend({defaults:{iType:"Select",iCommon:{portait:{iStartx:400,iStarty:200,iWidth:200,iHeight:200},landscape:{iStartx:400,iStarty:200,iWidth:200,iHeight:200}},iDetail:{},iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1",callback:null},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(){this.iview=new interaction_view.view.Select({model:this})},setsyncmodel:function(){}}),interaction_view.view.Select=interaction_view.view.Base.extend({events:{},render:function(){var e=this,t=this.getdetail();this.$el.find("select").on("change",function(){console.log($(this).val()),interaction_view.events.onFormEvent(e.model,$(this).val())});var i=interaction_view.events.onFormButtonRender(this.model);if(console.log(i),this.$el.find("select").empty(),t.placeholder&&this.$el.find("select").append("<option>"+t.placeholder+"</option>"),i.field){for(var n=i.field.i.field_options.options,a=0;a<n.length;a++){var r=$("<option>"+n[a].label+"</option>");r.attr("value",n[a].label),this.$el.find("select").append(r)}i.value&&this.$el.find("select").val(i.value)}t.initial&&this.$el.find("select").val(t.initial)},resetOtherStatus:function(){var e=interaction_view.events.onFormButtonRender(this.model);e.value&&this.$el.find("select").val(e.value)},setVariable:function(e,t,i,n){var a=this;1!=e&&2!=e&&3!=e&&interaction_view.expression.id2values(t,function(e){a.$el.find("select").val(e),n&&n(e)},{_promise:i})}})}),define("interaction_view/model/systemvariable",["interaction_view/model/base"],function(){interaction_view.model.SystemVariable=interaction_view.model.Base.extend({defaults:{iType:"SystemVariable",iVisibility:!0,iCommon:null,iDetail:{},iParentModel:null,iTemplate:null,iParentdiv:".interaction-view",iAutoindex:!1,iSync:!1,iZindex:"-1"},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(){this.iview=new interaction_view.view.SystemVariable({model:this})},setsyncmodel:function(){}}),interaction_view.view.SystemVariable=interaction_view.view.Base.extend({events:{},renderDynamicElement:function(){this.detail=this.model.attributes.iDetail},render:function(){this.model._reset=!0},preload:function(){},afterpreload:function(){if(this.model.pageid=this.model.get("pageid"),this.model.parentpageid=this.model.get("parentpageid"),"LayerRef"==this.model.get("pagetype")){var e=this.model.get("parentpageid"),t=this.model.get("layerid"),i=interaction_view.getParentpage(e);this.model.parentpage=i,this.model.page=i.iOverlaylist.get(this.model.pageid).layer[t]}else this.model.page=interaction_view.getParentpage(this.model.pageid);this.preloaded=!0},triggerVarChange:function(){var e=this.getdetail();1==e.immediate&&interaction_view.events.onSystemVariableChanged(this)}})}),define("interaction_view/model/qqvideo",["interaction_view/model/video"],function(){interaction_view.model.QQVideo=interaction_view.model.Video.extend({defaults:{iType:"QQVideo",iLock:!0,iVisibility:!0,iCommon:{},iDetail:{},iAutoindex:!1,iSync:!1,iZindex:"-1",iUrl:null,callback:null},setview:function(){this.iview=new interaction_view.view.QQVideo({model:this})}}),interaction_view.view.QQVideo=interaction_view.view.Video.extend({events:{},render:function(){this.file,this.model._reset=!0},setOtherDisplay:function(){this.model.media&&interaction_view.media.pause(this.model)},preload:function(){var e=this.getdetail();e.vid&&(this.preloadmodel=this.sendToPreload({vid:e.vid}))},resetOtherStatus:function(){this.model.hided||this.model.media&&(interaction_view.media.video.reset(this.model),this.model.get("iDetail").iControl&&this.$el.find(".jwdisplayIcon").css({opacity:1}))}})}),define("interaction_view/model/MobileValid",["interaction_view/model/userList"],function(){interaction_view.model.MobileValid=interaction_view.model.Base.extend({setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(){this.iview=new interaction_view.view.MobileValid({model:this})},setsyncmodel:function(){}}),interaction_view.view.MobileValid=interaction_view.view.Base.extend({render:function(){this.model._reset=!0,this.binded=!1},getRelationOverlay:interaction_view.view.UserList.prototype.getRelationOverlay,resetOtherStatus:function(){this.binded||(this.input_mobile=this.getRelationOverlay(0),this.input_valid=this.getRelationOverlay(1),this.button=this.getRelationOverlay(2),this.input_valid.$el.find("input")[0].type="number",this.bindSubmitTrigger(),this.binded=!0)},isValid:function(e){if(!$.trim(e))return interaction_view.application.errorAlert("è¯·è¾“å…¥æ‰‹æœºå·ç ï¼"),!1;var t=/^0?1[3|4|5|7|8][0-9]\d{8}$/;return t.test(e)?!0:(interaction_view.application.errorAlert("è¯·è¾“å…¥æ­£ç¡®æ‰‹æœºå·ç ï¼"),!1)},bindSubmitTrigger:function(){var e=this,t=this.input_mobile.model.attributes.iDetail.app_id;if(t){var i="tap",n=[e.button.$el.find(".iText>div").text(),"ç§’åŽé‡æ–°å‘é€"];e.button.$el.hammer().on(i,function(){if(e.button.$el.find(".iText>div").text()==n[0]){var i=e.input_mobile&&e.input_mobile.$el.find("input").val();e.isValid(i)&&(e.input_valid.$el.find("input").val(""),_g.ajax.post({dataType:"JSON",url:"/form/"+t+"/verifymobile/",data:{mobile:i},callback:function(t){function i(e){0==a?e.text(n[0]):(e.text(a+"ç§’åŽé‡æ–°èŽ·å–éªŒè¯ç "),a--,setTimeout(function(){i(e)},1e3))}if(400==t.code)interaction_view.application.errorAlert("æ‰‹æœºå·æœ‰è¯¯ï¼");else if(409==t.code)interaction_view.application.errorAlert("æ­¤æ‰‹æœºå·å·²ç»å‚ä¸Žè¿‡ï¼Œè¯·ä½¿ç”¨å…¶ä»–å·ç ï¼");else if(200==t.code){var a=60;i(e.button.$el.find(".iText>div"))}else interaction_view.application.errorAlert(t.msg)},onError:function(){interaction_view.application.errorAlert("ç³»ç»Ÿé”™è¯¯ï¼Œè¯·é‡è¯•ï¼")}}))}}),interaction_view.environment.otherFormValue.veriyCode="",e.input_valid.$el.find("input").change(function(){interaction_view.environment.otherFormValue.veriyCode={value:$(this).val(),errMsg:"è¯·è¾“å…¥éªŒè¯ç ï¼"}})}}})}),epub360.PlayerPlugins.push({config:{type:"StaticList",template:"Paragraph"},render:function(){this.updateTemplate()},updateTemplate:function(){function e(){var e=$("<div class='contentGridRow'></div>");if(e.html(a.detail),0==i.iTemplate&&i.iCols>1){var n=t.getcommon().iWidth/i.iCols;e.css({display:"inline-block",width:n})}else 2==i.iTemplate&&e.css({display:"inline-block"});return e}var t=this,i=this.getdetail(),n=this.$el.find(".iParagraph>.paragraph>div"),a=_.find(i.templates,function(e){return e.id==i.styleIndex}),r=e();n.html("<div class='contentList'></div>"),n=n.find(".contentList"),a&&a.detail&&(i.data&&0!=i.data.length?_.each(i.data,function(e){var t=r.clone();t.find("[es-title]").each(function(n,a){var r=$(a).attr("es-title"),o=_.find(i.structure,function(e){return e.title==r}),s=_.indexOf(i.structure,o);if(s>=0&&(("text"==o.type||"æ–‡æœ¬"==o.type)&&$(a).text(e[s].value),"paragraph"==o.type||"æ®µè½"==o.type?$(a).html(e[s].value):("img"==o.type||"å›¾ç‰‡"==o.type||"èƒŒæ™¯å›¾ç‰‡"==o.type)&&("img"==a.tagName.toLowerCase()?$(a).attr("src",e[s].value):$(a).css("background-image","url("+e[s].value+")")),o.show&&e[s].show||t.find("[es-order="+o.order+"]").hide(),e[s].show&&_.include(["0","1","2"],e[s].linktype+""))){var l={page_id:e[s].linkvalue,url:e[s].linkvalue};$(a).removeAttr("href").addClass("hasaction"),$(a).hammer().on("tap",function(){interaction_view.renderLink(e[s].linktype,l)})}}),n.append(t)}):(n.append(r),_.each(i.structure,function(e){e.show||n.find("[es-order="+e.order+"]").hide()})))},renderScroll:function(){this.scrollview&&this.scrollview.iScroll.destroy();var e=this,t=this.$el.find(".contentList"),i=t.parent(),n=t.outerHeight(),a=_g.ui.isOverflowed(i).y,r=n-i.height();a&&(this.scrollview=new _g.scrollview({containment:i,contentel:t,mask_width:i.width(),mask_height:i.height(),content_width:i.width,content_height:n,content_x:0,content_y:0,scrollY:!0,HWCompositing:!0,onScrolling:function(t){a&&(Math.abs(t.deltaY)>r+30||t.deltaY>30)&&(i.addClass("is_exceededY"),e.$el.children(".Element").removeClass("disableDragY iMouseWheel disableMouseWheelY"))},onScrollend:function(){a&&i.removeClass("is_exceededY")}}),this.$el.children(".Element").addClass("disableDragY iMouseWheel disableMouseWheelY"))},immediateRender:function(){this.renderScroll(),console.log("å…ƒç´ å¼€å§‹åœ¨é¡µé¢æ’­æ”¾")},setotherdisplay:function(){},otherOnShow:function(){console.log("element shown"),this.renderScroll()},otherOnHide:function(){console.log("element hided")}}),define("interaction_view/components/staticlist",function(){}),epub360.PlayerPlugins.push({config:{type:"Puzzle",Model:"ImageBlock",template:['<div class="iView dynamic hide <%=isMasterOverlay?"masterhide":""%>" data-type="<%=iType%>" id="<%=id%>" style="width: 0px; height: 0px; backgroud-repeat:no-repeat;background-postion:center;">','<div class="iPuzzle Element" style="position:absolute;left: -<%=iCommon[iPageDirection].iWidth/2%>px; top: -<%=iCommon[iPageDirection].iHeight/2%>px;width:<%=iCommon[iPageDirection].iWidth%>px;height:<%=iCommon[iPageDirection].iHeight%>px;">','<div class="el_wrap bk_full" style="position:absolute;left:0;top:0;width:100%;height:100%;position:absolute;<%=iDetail.iStyle%>">',"</div>","</div>","</div>"].join("")},render:function(){var e=this.getdetail();if("Puzzle"==this.model.get("iType")){var t=this.model.id;$(this.container).find("#"+t).find(".el_wrap").html(e.itemplateOn);var i=$(this.container).find("#"+t).find("[es-type=img]");_.each(i,function(t,i){var n=e.iImg;n&&n[i]&&$(t).css({"background-image":"url("+n[i].picture+")","background-position":n[i].iStyle}),e.templateStyle&&$(t).css("border-radius",e.templateStyle.borderRadius).parent().css("padding",e.templateStyle.blockpadding)}),console.log("å…ƒç´ å·²ç»å®Œæˆåœ¨é¡µé¢çš„å±•çŽ°")}},immediateRender:function(){console.log("å…ƒç´ å¼€å§‹åœ¨é¡µé¢æ’­æ”¾")},setOtherDisplay:function(){var e=this.getdetail();e.iFullview&&this.fullview()},otherOnShow:function(){console.log("element shown")},otherOnHide:function(){console.log("element hided")},fullview:function(){var e=this,t=this.getdetail();if(this.$el.addClass("hasaction"),"undefined"!=typeof wx_permissions&&wx_permissions.previewImage)wx.previewImage({current:t.iImg[index].picture,urls:_.map(t.iImg,function(e){return e.picture})});else if(t.iImg&&t.iImg.length>0){var i=e.$el.children(".Element").find("[es-type=img]");_.each(i,function(i,n){$(i).on("click",function(){var i=n;if(!(i>=t.iImg.length)){var a={picture:t.iImg[i].picture,width:t.iImg[i].width,height:t.iImg[i].height,model:e.model,index:i};e.setFullView(a)}})})}},isFullSwitch:function(){return!1}}),define("interaction_view/components/puzzle/puzzle",function(){}),epub360.PlayerPlugins.push({config:{type:"Gyroscope",template:"Container"},render:function(){var e=this.getdetail();switch(e.init_display?this.$el.show():this.$el.hide(),this.$el.find(".el_wrap").html("0"),this.iKind=e.iKind,this.start=e.start||0,this.end=e.end||0,this.iKind){case 0:this.gy_range=360,this.gy_start=-180,this.start<-180&&(this.start=-180),this.start>180&&(this.start=180),this.end>180&&(this.end=180),this.end<-180&&(this.end=-180);break;case 1:this.gy_range=180,this.gy_start=-90,this.start<-90&&(this.start=-90),this.start>90&&(this.start=90),this.end>90&&(this.end=90),this.end<-90&&(this.end=-90);break;case 2:this.gy_range=360,this.gy_start=0,this.start<0&&(this.start=0),this.start>360&&(this.start=360),this.end>360&&(this.end=360),this.end<0&&(this.end=0)}this.range=Math.abs(this.end-this.start),this.oper=this.end-this.start>0?1:-1,this.model.eventsHandle=[]},immediateRender:function(){this.getdetail();this.model.disabled=!1,this.model.value=0,this.range&&_e.orientation.event.on("orientation",this.listenOrientation)},listenOrientation:function(e){if(!this.model.disabled&&(console.log(e),e)){var t,i=e.beta,n=e.gamma,a=e.alpha;if(t=0==this.iKind?i:1==this.iKind?n:a,1===this.oper){if(!(t>=this.start&&t<=this.end))return}else if(!(t>=this.end&&t<=this.start))return;if(t=_g.number.decimal(t,2),this.model.value==t)return;this.model.value=t*this.oper,this.$el.find(".el_wrap").html(this.model.value);for(var r=0;r<this.model.eventsHandle.length;r++)this.model.eventsHandle[r].func()}},updateText:function(){},onStop:function(){_e.orientation.event.off("orientation",this.listenOrientation)}}),define("interaction_view/components/gyroscope/gyroscope",function(){}),epub360.PlayerPlugins.push({config:{type:"contentGrid",template:"Container"},render:function(){this.totalInfoPage=0,this.currentPage=1,this.queryOpts={key:"",value:""},this.db_id=this.model.attributes.iDetail.db_id,this.query_id=this.model.attributes.iDetail.query_id,this.model.attributes.iDetail.autoload&&this.updateTemplate()},refresh:function(e){this.queryOpts={key:"",value:""},this.db_id=this.model.attributes.iDetail.db_id,this.query_id=this.model.attributes.iDetail.query_id,this.updateTemplate(function(){e.done()})},updateTemplate:function(e,t){function i(){var e=$("<div class='contentGridRow'></div>");if(e.html(l.detail),0==r.iTemplate&&r.iCols>1){var t=a.getcommon().iWidth/r.iCols;e.css({display:"inline-block",width:t})}else 2==r.iTemplate&&e.css({display:"inline-block"});return e}function n(){function n(e,t){var i=$(t).attr("es-title"),n=_.find(r.structure,function(e){return e.title==i}),a=_.indexOf(r.structure,n);if(_.include(["text","paragraph","img"],n.type)){var o=interaction_view.expression.id2values(r.fields[a],null,{force_compute:!0});"text"==n.type||"paragraph"==n.type?$(t).text(o):"img"==n.type&&$(t).css("background-image","url("+o+")"),n.show||c.find("[es-order="+n.order+"]").hide()}else if("èƒŒæ™¯å›¾ç‰‡"==n.type&&interaction_view.expression.id2values(r.fields[a],function(e){$(t).css("background-image","url("+e+")")},{force_compute:!0}),"å›¾ç‰‡"==n.type)interaction_view.expression.id2values(r.fields[a],function(e){$(t).attr("src",e)},{force_compute:!0});else if("æ–‡æœ¬"==n.type)interaction_view.expression.id2values(r.fields[a],function(e){$(t).text(e)},{force_compute:!0});else if("é“¾æŽ¥"==n.type)var o=interaction_view.expression.id2values(r.fields[a].linkvalue,function(e){0==r.fields[a].linktype?$(t).hammer().on("tap",function(){window.location=e}):$(t).hammer().on("tap",function(){window.location="tel:"+e})},{force_compute:!0});else"é“¾æŽ¥å—"==n.type&&(r.fields[a].is_bind_bkimg&&interaction_view.expression.id2values(r.fields[a].bkimg,function(e){$(t).css("background-image","url("+e+")")},{force_compute:!0}),r.fields[a].is_bind_link&&interaction_view.expression.id2values(r.fields[a].linkvalue,function(e){0==r.fields[a].linktype?$(t).hammer().on("tap",function(){window.location=e}):$(t).hammer().on("tap",function(){window.location="tel:"+e})},{force_compute:!0}))}for(var o=i(),l=0;l<r.iCount;l++){var c=o.clone();c.find("[es-bind=1]").length?c.find("[es-bind=1]").each(n):c.find("[es-title]").each(n),s.append(c),c.data("variables",$.extend(!0,[],r.variables)),a.onContentGridRender(c,r)}o.remove();var d={x:0,y:0};t&&(d=a.scrollview.iScroll.getComputedPosition()),a.renderScroll(d),e&&e()}var a=this,r=this.getdetail(),o=r.db_dbtype,s=this.$el.find(".Element .el_wrap"),l=_.find(r.templates,function(e){return e.id==r.styleIndex});if(l&&l.detail)if(a.db_id&&a.query_id){var c=new dboperate,d=!1,h=r.iCount,u=1;t?(this.currentPage<this.totalInfoPage?this.currentPage++:d=!0,u=this.currentPage):h=this.currentPage*r.iCount,!d&&c.getqueryValue(a.db_id,a.query_id,u,h,function(n){a.totalInfoPage=n.data.numpages;var o={x:0,y:0};t&&(o=a.scrollview.iScroll.getComputedPosition()),!t&&s.html("<div class='contentList'></div>"),s=s.find(".contentList");for(var l=i(),c=0;h>c;c++)if(n.data.results[c]){var d=l.clone();r.fields&&r.fields.length&&(d.find("[es-bind=1]").length?d.find("[es-bind=1]").each(function(e,t){a.bindData($(t),n.data.results[c])}):d.find("[es-title]").each(function(e,t){a.bindData($(t),n.data.results[c])})),d.data("value",n.data.results[c]),s.append(d),a.onContentGridRender(d,r)}l.remove(),a.renderScroll(o),e&&e()},{query:this.queryOpts,type:o||0})}else!t&&s.html("<div class='contentList'></div>"),s=s.find(".contentList"),r.fields&&r.fields.length?setTimeout(n,0):(s.html(l.detail),_.each(r.structure,function(e){e.show||s.find("[es-order="+e.order+"]").hide()}))},bindData:function(e,t){var i=this.getdetail(),n=e.attr("es-title"),a=_.find(i.structure,function(e){return e.title==n});if(a){var r=_.indexOf(i.structure,a);if(_.include(["text","paragraph","img"],a.type)){var o=this.getFieldVal(i.fields[r],t);"text"==a.type||"paragraph"==a.type?e.text(o):"img"==a.type&&e.css("background-image","url("+o+")"),a.show||e.parents(".contentGridRow:first").find("[es-order="+a.order+"]").hide(),""==o&&e.hide()}else if("èƒŒæ™¯å›¾ç‰‡"==a.type){var o=this.getFieldVal(i.fields[r],t);e.css("background-image","url("+o+")")}else if("æ–‡æœ¬"==a.type){var o=this.getFieldVal(i.fields[r],t);e.text(o)}else if("é“¾æŽ¥"==a.type){var o=this.getFieldVal(i.fields[r].linkvalue,t);0==i.fields[r].linktype?e.hammer().on("tap",function(){window.location=o}):e.hammer().on("tap",function(){window.location="tel:"+o})}else if("é“¾æŽ¥å—"==a.type){if(i.fields[r].is_bind_bkimg){var o=this.getFieldVal(i.fields[r].bkimg,t);e.css("background-image","url("+o+")")}if(i.fields[r].is_bind_link){var o=this.getFieldVal(i.fields[r].linkvalue,t);0==i.fields[r].linktype?e.hammer().on("tap",function(){window.location=o}):e.hammer().on("tap",function(){window.location="tel:"+o})}}}},getFieldVal:function(e,t){var i=/\$[^\$]+\$/g,n=String(e).match(i),a=e;return _.each(n,function(e){var i=interaction_view.expression.getFieldValue(e,t);a=a.replace(e,i)}),interaction_view.expression.id2values(a,null,{force_compute:!0})},onContentGridRender:function(e,t){var i=this;e.data("variables",$.extend(!0,[],t.variables)),_.each(e.data("variables"),function(t){t.initial=i.getFieldVal(t.initial,e.data("value"))}),interaction_view.events.onContentGridRender(this,{$dom:e})},idToObject:function(e){e=e.replace("$d_","").replace("$","");var t=e.split(".");return t[t.length-1]},renderScroll:function(e){this.scrollview&&this.scrollview.iScroll.destroy();var t=this,i=this.getdetail(),n=!0,a=!1,r=this.$el.find(".Element .el_wrap"),o=!1;if(this.$el.hasClass("hide")&&(this.$el.removeClass("hide"),o=!0),r.css({width:"100%",height:"100%"}),r.find(".contentList").length){r.find(".contentList").css("height","");var s=r.find(".contentList").height();if(i.pulldown)a=1==i.pulldownType;else{n=!1;var l=this.model.attributes.iCommon.landscape.iHeight;if(l>=s)return}interaction_view.renderScroll({containment:r,contentel:r.find(".contentList").first(),view:t,content_y:e&&e.y||0,pullDown:n,pullUp:!0,autoload_more:a,onPullDown:function(){t.$el.find(".info_content").css("height",""),t.updateTemplate()},onPullUp:function(){t.$el.find(".info_content").css("height",""),t.updateTemplate(null,!0)}}),o&&this.$el.addClass("hide")}},immediateRender:function(){console.log("å…ƒç´ å¼€å§‹åœ¨é¡µé¢æ’­æ”¾")},setotherdisplay:function(){},otherOnShow:function(){this.renderScroll(),console.log("element shown")},otherOnHide:function(){console.log("element hided")},renderQuery:function(e,t,i,n){this.queryOpts={key:i.key,value:i.value},this.db_id=e,this.query_id=t,this.updateTemplate(n)}}),define("interaction_view/components/contentGrid/contentGrid",function(){}),epub360.PlayerPlugins.push({config:{type:"Debug",category:"global"},initialize:function(){var e=this;"undefined"!=typeof DB&&(DB.Debug=!0),interaction_view.DEBUG=!0,console.log("Debugå·²ç»åˆå§‹åŒ–å®Œæˆ"),interaction_view.containment.append('<div id="epub360-debug-btn"></div>'),$("#epub360-debug-btn").on("click",function(){var t=!1;interaction_view.containment.find("#epub360-debug").remove(),interaction_view.containment.append('<div id="epub360-debug"></div>'),interaction_view.containment.append('<div class="debug_menu"><div class="debug_btn debug_request">res</div><div class="debug_btn debug_close">&Chi;</div></div>'),$(".debug_close").on("click",function(){interaction_view.containment.find("#epub360-debug").remove(),interaction_view.containment.find(".debug_menu").remove()}),e.renderDebug();try{e.renderQueue()}catch(i){}return $(".debug_request").on("click",function(){return t?(e.renderDebug(),t=!1):(e.renderRequest(),t=!0),!1}),!1})},renderDebug:function(){interaction_view.containment.find("#epub360-debug").empty();var e=$("<li><span>å…¨å±€å˜é‡</span><ul></ul></li>");interaction_view.containment.find("#epub360-debug").append(e),interaction_view.globallist.each(function(t){if(_.include(["GlobalVariable","ShareVariable"],t.attributes.iType)){var i=t.attributes.iDetail.title||t.attributes.iType,n=t.attributes.iDetail.initial,a=typeof n,r=$('<li style="margin:10px;">'+i+":"+n+"("+a+")</li>");e.append(r)}});var e=$("<li><span>å½“å‰é¡µå˜é‡</span><ul></ul></li>");if(interaction_view.containment.find("#epub360-debug").append(e),interaction_view.currentPage){var t=interaction_view.ipagelist.getPage(interaction_view.currentPage);this.renderVariable(e,t)}var e=$("<li><span>å½“å‰é¡µæ¡ä»¶åˆ¤æ–­</span><ul></ul></li>");interaction_view.currentPage&&this.renderCondition(e,interaction_view.currentPage);var e=$("<li><span>Masterpageé¡µå˜é‡</span><ul></ul></li>");if(interaction_view.currentPage){var t=interaction_view.imasterlist.at(0);this.renderVariable(e,t)}var e=$("<li><span>Masterpageé¡µæ¡ä»¶åˆ¤æ–­</span><ul></ul></li>");interaction_view.currentPage&&this.renderCondition(e,interaction_view.imasterlist.at(0).id);var e=$("<li><span>Backgroundé¡µå˜é‡</span><ul></ul></li>");if(interaction_view.currentPage){var t=interaction_view.ibackgroundlist.at(0);this.renderVariable(e,t)}var e=$("<li><span>Backgroundé¡µæ¡ä»¶åˆ¤æ–­</span><ul></ul></li>");interaction_view.currentPage&&this.renderCondition(e,interaction_view.ibackgroundlist.at(0).id)},renderRequest:function(){interaction_view.containment.find("#epub360-debug").empty();var e=$("<li><span>æ•°æ®è¡¨åŽå°è¯·æ±‚æ•°æ®</span><ul></ul></li>");interaction_view.containment.find("#epub360-debug").append(e);for(var t in DB.Logs)if(DB.Logs[t]){var i=(DB.Logs[t].req||"send:<br>")+(DB.Logs[t].res||"è¯·æ±‚æ— è¿”å›žæ•°æ®:"),n=$('<li style="margin:10px;">'+i+"</li>");e.children().eq(0).after(n)}},renderVariable:function(e,t){interaction_view.containment.find("#epub360-debug").append(e),t.iOverlaylist.each(function(t){if("Variable"==t.attributes.iType){var i=t.attributes.iDetail.title||t.attributes.iType,n=t.attributes.iDetail.initial,a=typeof n,r=$('<li style="margin:10px;">'+i+":"+n+"("+a+")</li>");e.append(r)}})},renderCondition:function(e,t){interaction_view.containment.find("#epub360-debug").append(e);for(var i={},n=0;n<interaction_view.events.conditionEvents.length;n++){var a=interaction_view.events.conditionEvents[n];if(a.page_id==t){var r=a.title;if(!i[r]){i[r]=1;var o=null!=a.result&&void 0!=a.result?a.result:"æœªæ‰§è¡Œ",s=$('<li style="margin:10px 10px ;">'+r+":("+o+")</li>");e.append(s)}}}},renderQueue:function(){var e=$("<li><span>è§¦å‘å™¨å½“å‰æ®‹ç•™é˜Ÿåˆ—</span><ul></ul></li>");if(interaction_view.containment.find("#epub360-debug").append(e),interaction_view.queue.current){var t=interaction_view.queue.current.debug,i="ç±»åˆ«:"+t.category,n=$('<li style="margin:10px 10px ;">'+i+"</li>");e.append(n);var i="è§¦å‘äº‹ä»¶:"+t.iType,n=$('<li style="margin:10px 10px ;">'+i+"</li>");e.append(n);var i="è§¦å‘æ‰§è¡Œ:"+t.actionType,n=$('<li style="margin:10px 10px ;">'+i+"</li>");e.append(n);var i="é¡µé¢:ç¬¬"+(_.pluck(interaction_view.ipagelist.getPages(),"id").indexOf(t.page_id)+1)+"é¡µ("+t.page_id+")",n=$('<li style="margin:10px 10px ;">'+i+"</li>");e.append(n);var i="ç»„ä»¶:"+t.overlay_id;interaction_view.ipagelist.getPage(t.page_id).iOverlaylist.get(t.overlay_id)&&(i="ç»„ä»¶:"+interaction_view.ipagelist.getPage(t.page_id).iOverlaylist.get(t.overlay_id).attributes.iDetail.title||interaction_view.ipagelist.getPage(t.page_id).iOverlaylist.get(t.overlay_id).attributes.iType);var n=$('<li style="margin:10px 10px ;">'+i+"</li>");e.append(n)}}}),define("interaction_view/components/debug/debug",function(){}),epub360.PlayerPlugins.push({config:{type:"Anchor",template:""},render:function(){console.log("å…ƒç´ å·²ç»å®Œæˆåœ¨é¡µé¢çš„å±•çŽ°"),interaction_view.DEBUG?this.$el.find(".el_wrap").first().append('<div class="div_qGhbyA">&diams;</div>'):this.$el.hide()},resetOtherStatus:function(){console.log("å…ƒç´ çŠ¶æ€é‡ç½®äº†")},immediateRender:function(){console.log("å…ƒç´ æ‰€åœ¨é¡µé¢å·²ç»æ˜¯å½“å‰é¡µ,å…ƒç´ å¼€å§‹åœ¨é¡µé¢ä¸­é©¬ä¸Šå°±è¦å¼€å§‹æ’­æ”¾")},setotherdisplay:function(){},onInitialize:function(){console.log("å…ƒç´ åˆå§‹åŒ–")},onEpubReady:function(){console.log("Epubå·²ç»åˆå§‹åŒ–å®Œæˆ")},onStop:function(){console.log("å…ƒç´ åœ¨å½“å‰é¡µåœæ­¢æ’­æ”¾")},onPlay:function(){},otherOnShow:function(){},otherOnHide:function(){},onAnchorTrigger:function(e,t,i,n,a){var r=n.condition.split("_"),o=r.slice(0,1).toString(),s=Number(r.slice(1,2).toString()),l=r.slice(2,3).toString(),c=Number(r.slice(3,4).toString());if(!c||!n.executed){{var d,h,u,p=n.overlaymodel.attributes.iCommon.landscape.iStartx,v=n.overlaymodel.attributes.iCommon.landscape.iStarty,g=a?a.width():window.get_window_size().x,f=a?a.height():window.get_window_size().y;interaction_view.getAnimationPage(interaction_view.currentPage).get("height")}h=t,"å‘ä¸Šæ»šåŠ¨æŽ¥è§¦æ—¶"==l?u=1:"å‘ä¸‹æ»šåŠ¨æŽ¥è§¦æ—¶"==l?u=3:"æŽ¥è§¦æ—¶"==l?u=5:"å‘å·¦æ»šåŠ¨æŽ¥è§¦æ—¶"==l?u=0:"å‘å³æ»šåŠ¨æŽ¥è§¦æ—¶"==l&&(u=2);var m=!1;if("è§†çª—ä¸Šè¾¹çº¿"!=o||1!=e&&3!=e)if("è§†çª—ä¸‹è¾¹çº¿"!=o||1!=e&&3!=e)if("è§†çª—å·¦è¾¹çº¿"!=o||0!==e&&2!=e)if("è§†çª—å³è¾¹çº¿"!=o||0!==e&&2!=e){if("è§†çª—ä¸­å¿ƒ"==o)if(1==e||3==e)m=1==e&&s>=v-t-f/2&&v-i-f/2>s||3==e&&v-t-f/2>=s&&s>v-i-f/2;else if(0===e||2==e){if(!a)return;m=0===e&&s>=p-t-g/2&&p-i-g/2>s||2==e&&p-t-g/2>=s&&s>p-i-g/2}}else{if(!a)return;m=0===e&&s>=p-t-g&&p-i-g>s||2==e&&p-t-g>=s&&s>p-i-g}else{if(!a)return;m=0===e&&p-t<=Number(s)&&Number(s)<p-i||2==e&&p-t>=Number(s)&&Number(s)>p-i}else m=1==e&&s>=v-t-f&&v-i-f>s||3==e&&v-t-f>=s&&s>v-i-f;else m=1==e&&v-t<=Number(s)&&Number(s)<v-i||3==e&&v-t>=Number(s)&&Number(s)>v-i;5>u&&m&&u==e?(n.executed=!0,n.func()):5===u&&m&&(console.log("æ»‘åŠ¨æ–¹å‘:"+e+" é”šç‚¹Yåæ ‡:"+v+" æ»šåŠ¨å€¼ä¸Žé”šç‚¹çš„å·®å€¼:"+d+" æ»šåŠ¨å€¼:"+t+" åç§»å€¼:"+s+" ä¸Šä¸€ä¸ªå€¼:"+i),n.executed=!0,n.func())}}}),define("interaction_view/components/anchor/anchor",function(){}),epub360.PlayerPlugins.push({config:{type:"ShareVariable",category:"global"},initialize:function(){var e=_g.getUrlParameterByName(this.model.id,message_link);e||0==e||(e=_g.getHashParameterByName(this.model.id)),e&&(0==this.model.attributes.iDetail.iKind&&(e=Number(e)),this.model.attributes.iDetail.initial=e)}}),define("interaction_view/components/ShareVariable/ShareVariable",function(){}),epub360.PlayerPlugins.push({config:{type:"DataBinder",Model:"Image",template:"Image"},immediateRender:function(){console.log("åŒå‘ç»‘å®šæ¸²æŸ“å®Œæˆ");var e=this,t=(e.$el,this.getdetail()),i=t.dataBinder,n=t.autoLoad;if(n){{var a=interaction_view.expression;interaction_view.globallist.models}_.each(i,function(e){var t=e.expression_id;a.id2values(t,function(t){if(console.log("æ•°æ®åº“çš„å€¼ä¸º"+t),t){(e.id.indexOf("@g_")>0||0==e.id.indexOf("@g_"))&&(interaction_view.globallist.where({id:e.id.replace("@g_","").replace("@","")})[0].attributes.iDetail.initial=t);var i=a.getPagePath(e.id);if(null!=i)switch(i.type){case"p":case"c":if("c"==i.type)var n=configpage.page;else var n=interaction_view.ipagelist.getPage(i.page_id);if(!n)break;var r=n.iOverlaylist.get(i.element_id);if(null!=r)switch(r.attributes.iType){case"Input":r.iview.$el.find("input[type=text]").val(t);break;case"Textarea":r.iview.$el.find("textarea").val(t);break;case"Variable":r.iview.setVariable("0",t,null,null);break;case"Paragraph":r.iview.updateText(t);break;case"Image":case"ImageBlock":r.iview.replaceImg(t);break;case"Select":var o="<option value='-1'>ä¸é™</option><option value='0'>æ¯äººä¸€æ¬¡</option><option value='1'>æ¯å¤©ä¸€æ¬¡</option><option value='2'>æ¯å¤©äºŒæ¬¡</option><option value='3'>æ¯å¤©ä¸‰æ¬¡</option>";r.iview.$el.find("select").empty(),r.iview.$el.find("select").append($(o)),r.iview.$el.find("select option[value="+t+"]").prop("selected",!0)}break;case"m":var r=interaction_view.imasterlist.models[0].iOverlaylist.get(i.element_id);if(null!=r)switch(r.attributes.iType){case"Input":r.iview.$el.find("input[type=text]").val(t);break;case"Textarea":r.iview.$el.find("textarea").val(t);break;case"Variable":r.iview.setVariable("0",t,null,null);break;case"Paragraph":r.iview.updateText(t);break;case"Image":case"ImageBlock":r.iview.replaceImg(t)}break;case"b":var r=interaction_view.ibackgroundlist.models[0].iOverlaylist.get(i.element_id);if(null!=r)switch(r.attributes.iType){case"Input":r.iview.$el.find("input[type=text]").val(t);break;case"Textarea":r.iview.$el.find("textarea").val(t);break;case"Variable":r.iview.setVariable("0",t,null,null);break;case"Paragraph":r.iview.updateText(t);break;case"Image":case"ImageBlock":r.iview.replaceImg(t)}}}},{force_compute:!0})})}},resetOtherStatus:function(){console.log("å…ƒç´ çŠ¶æ€é‡ç½®äº†")},setotherdisplay:function(){},onInitialize:function(){console.log("å…ƒç´ åˆå§‹åŒ–")},onEpubReady:function(){console.log("Epubå·²ç»åˆå§‹åŒ–å®Œæˆ")},onStop:function(){console.log("å…ƒç´ åœ¨å½“å‰é¡µåœæ­¢æ’­æ”¾")},onPlay:function(){},otherOnShow:function(){},otherOnHide:function(){},refresh:function(e){var t=this,i=t.getdetail().dataBinder,n=interaction_view.expression;_.each(i,function(t){var i=t.expression_id;n.id2values(i,function(i){if(i){(t.id.indexOf("@g_")>0||0==t.id.indexOf("@g_"))&&(interaction_view.globallist.where({id:t.id.replace("@g_","").replace("@","")})[0].attributes.iDetail.initial=i);var a=n.getPagePath(t.id);if(null!=a){var r=null;switch(a.type){case"p":var o=interaction_view.ipagelist.getPage(a.page_id);r=o.iOverlaylist.get(a.element_id);break;case"m":r=interaction_view.imasterlist.models[0].iOverlaylist.get(a.element_id);break;case"b":r=interaction_view.ibackgroundlist.models[0].iOverlaylist.get(a.element_id)}if(null!=r)switch(r.attributes.iType){case"Input":r.iview.$el.find("input[type=text]").val(i);
break;case"Textarea":r.iview.$el.find("textarea").val(i);break;case"Variable":r.iview.setVariable("0",i,null,null);break;case"Paragraph":r.iview.updateText(i);break;case"Image":r.iview.replaceImg(i);break;case"Select":var s="<option value='-1'>ä¸é™</option><option value='0'>æ¯äººä¸€æ¬¡</option><option value='1'>æ¯å¤©ä¸€æ¬¡</option><option value='2'>æ¯å¤©äºŒæ¬¡</option><option value='3'>æ¯å¤©ä¸‰æ¬¡</option>";r.iview.$el.find("select").empty(),r.iview.$el.find("select").append($(s)),r.iview.$el.find("select option[value="+i+"]").prop("selected",!0)}}}e.done()},{force_compute:!0})})}}),define("interaction_view/components/DataBinder/DataBinder",function(){}),epub360.PlayerPlugins.push({config:{type:"StateGroup",template:"others"},render:function(){console.log(this.model.toJSON())},immediateRender:function(){console.log("å…ƒç´ å¼€å§‹åœ¨é¡µé¢æ’­æ”¾")},setOtherDisplay:function(){},onPlay:function(){this.state=new window.stategroup(this.model),this.state.render()},otherOnShow:function(){console.log("element shown")},otherOnHide:function(){console.log("element hided")},onStop:function(){if(this.state.killOverlayTweenmax(this.getdetail().chooseElement),this.state&&this.state.ioverlaylist&&this.state.ioverlaylist.length)for(var e=0;e<this.state.ioverlaylist.length;e++){var t=this.state.ioverlaylist[e];!t.isMasterOverlay&&t.iview&&t.iview.$el&&interaction_view.setPos(t.iview.$el,{x:t.iview.x,y:t.iview.y})}}}),define("interaction_view/components/stategroup/stategroup",function(){}),epub360.PlayerPlugins.push({config:{type:"Map",template:"Map"},render:function(){}}),define("interaction_view/components/map/map",function(){}),epub360.PlayerPlugins.push({config:{type:"FormView",template:"FormView"},resetOtherStatus:function(){},onSizeAdaptChange:function(){this.$el.children(".Element").children("iframe").css({width:this.originWidth,height:this.originHeight})}}),define("interaction_view/components/formview/formview",function(){}),epub360.PlayerPlugins.push({config:{type:"Palette",template:"Container"},render:function(){this.model.paintStartEvents=[]},resetOtherStatus:function(){console.log("å…ƒç´ çŠ¶æ€é‡ç½®äº†")},immediateRender:function(){var e=this,t=this.getdetail(),i=this.getcommon();this.$el.children(".Element").css("cursor","pointer"),this.$el.children(".Element").addClass("disableDragX disableDragY"),this.$el.find(".el_wrap").html('<div class="palette_tmp"></div>'),this.$el.find(".el_wrap").children().css({width:i.iWidth,height:i.iHeight}),this.$el.find(".el_wrap").is(":hidden")||this.$el.find(".el_wrap").children().eraser({size:t.size,imageWidth:i.iWidth,imageHeight:i.iHeight,completeRatio:1,draw:!0,color:t.color,brush:t.brush,completeRatioFunction:function(){},completeFunction:function(){},onPaintStart:function(){for(var t=0;t<e.model.paintStartEvents.length;t++)e.model.paintStartEvents[t].func()}})},setotherdisplay:function(){},onStop:function(){console.log("å…ƒç´ åœ¨å½“å‰é¡µåœæ­¢æ’­æ”¾")},otherOnShow:function(){this.immediateRender()},otherOnHide:function(){}}),define("interaction_view/components/palette/palette",function(){}),epub360.PlayerPlugins.push({config:{type:"LayerSlide",template:"LayerRef",Model:"LayerRef",model_object:{setiview:function(){this.iview=new interaction_view.view.LayerSlide({model:this})}}},render:function(){var e=this,t=this.getdetail();this.currentSlideIndex=null,this.model.on("slideTo",function(i){if(console.log(i),null!=e.currentSlideIndex&&e.currentSlideIndex==i)return!1;if(null!=e.currentSlideIndex&&e.currentSlideIndex!=i){var n=t.layer_ids[e.currentSlideIndex];interaction_view.stopPlay(e.model.layer[n])}if(e.preloaded){var a=t.layer_ids[i];if(!e.model.layer[a])return;e.model.layer[a].isLayer=!0,interaction_view.play(e.model.layer[a]),e.currentSlideIndex=i,e.model.layer[a].playFinished=!0}}),this.model._reset=!0},playAnimation:function(){{var e=this,t=this.getdetail();t.iSlidetype}this.delay=Number(t.iInterval)||2,this.autoplay=t.iAutoplay;var i=t.iRepeat?-1:0;return this.iFade=t.iFade||0,this.iRewind=t.iRewind,this.timeline=new TimelineMax({paused:!0,repeat:i,onComplete:this.setRewind}),this.slideel=e.$el.children(".Element").find(".layer-content").first(),this.slidelength=t.layer_ids.length,this.slidelength<2?!1:(this.repeat=i,this.slipable=t.iSlipable,this.setTimeline(),this.autoplay?!this.timeline||this.$el.children(".Element").is(":hidden")&&!interaction_view.ismobile||this.timeline.play(0):this.setSlideDisplay(0),void(this.slipable?(this.control(),this.$el.addClass("hascontrols")):this.slideel&&this.slideel.on("click",function(){e.$el.children(".Element").trigger("click")})))},playLayer:function(){this.autoplay&&this.timeline&&!this.$el.children(".Element").is(":hidden")&&this.timeline.play(0),this.slidelength>0&&this.model.trigger("slideTo",0)},setTimeline:function(){if("Fade"==this.iFade)this.setFade();else if("Slip"==this.iFade)this.setSlip();else{if("None"!=this.iFade)return;this.setNone()}this.slideel.children().first().css({opacity:1,left:0,top:0}).nextAll().css("opacity",0)},getSlipeInterval:function(){},getLayerContentSize:function(){var e=this.getdetail(),t={};if(!e.layer_ids||e.layer_ids.length>0){var i=_.map(e.layer_ids,function(e){return interaction_view.ilayerlist.get(e).toJSON()});return t.width=_.max(_.pluck(i,"layer_width")),t.height=_.max(_.pluck(i,"layer_height")),t}return null},getStartPoint:function(){return this.delay+(this.delay+.500002)*this.delay},getEndPoint:function(e){return(this.delay+.500002)*e+1e-5},getCurrentIndex:function(e){var t=this.timeline.duration(),i=t/this.slidelength;return parseInt(e/i,10)},testControl:function(e){var t=$(e).closest(".iView");if(t.hasClass("hasaction"))return!1;if(t){var i=t.attr("data-type");return"Slide"!=i&&"CycleImage"!=i||!t.attr("data-iSlipable")?!0:!1}return!0},resetOtherStatus:function(){this.resetlayer();var e=this,t=this.getdetail();t.layer_ids&&0!=t.layer_ids.length&&(this.slideel.children().first().css({opacity:1,left:0,top:0}),this.autoplay=t.iAutoplay,e.currentIndex=0,e.currentSlideIndex=null,this.hasSlideNumber&&(this.setSlideNumberPosition(),this.changeSlideNumber()),this.$el.children(".Element").removeClass("is_exceededX"),this.$el.children(".Element").removeClass("is_exceededY"),this.timeline&&(this.timeline.pause(1e-5),!this.autoplay||this.$el.children(".Element").is(":hidden")&&!interaction_view.ismobile?this.setSlideDisplay(0):this.timeline.play(0)))},getSlideLength:function(){var e=this.getdetail();return e.layer_ids?e.layer_ids.length:0}}),define("interaction_view/components/layerslide/layerslide",function(){}),epub360.PlayerPlugins.push({config:{type:"ComponentRefRef",template:"LayerRef",Model:"LayerRef",model_object:{setiview:function(){var e=this.get("iCommon");this.offset=this.getOffset(e),e.landscape.iStartx=0,e.landscape.iStarty=0,e.landscape.iWidth=interaction_view.size.x,e.landscape.iHeight=interaction_view.size.y,this.iview=new interaction_view.view.ComponentRef({model:this})},setsyncmodel:function(){},filterlayers:function(){var e=this,t=this.get("iDetail"),i=t.layer_ids;this.components={},t.layer_ids&&t.layer_ids.length>0&&(i=_.filter(i,function(t){var i=interaction_view.iComponentlist.get(t);return i&&(e.components[t]=i),i})),t.layer_ids=i,this.set("iDetail",t)},getOffset:function(e){var t={x:0,y:0},i=this.get("iDetail");if(i.layer_ids&&i.layer_ids.length){var n=i.layer_ids[0],a=this.getComponentSize(n);t={x:e.landscape.iStartx-a.left,y:e.landscape.iStarty-a.top}}return t},getComponentSize:function(e,t){t||(t={w:200,h:200,left:null,top:null,bottom:null,right:null});var i=this.components[e];if(i){var n=i.overlays;_.each(n,function(e){null==t.left?(t.left=e.iCommon[iPageDirection].iStartx,t.top=e.iCommon[iPageDirection].iStarty,t.right=e.iCommon[iPageDirection].iStartx+e.iCommon[iPageDirection].iWidth,t.bottom=e.iCommon[iPageDirection].iStarty+e.iCommon[iPageDirection].iHeight):(t.left=t.left<e.iCommon[iPageDirection].iStartx?t.left:e.iCommon[iPageDirection].iStartx,t.top=t.top<e.iCommon[iPageDirection].iStarty?t.top:e.iCommon[iPageDirection].iStarty,t.right=t.right>e.iCommon[iPageDirection].iStartx+e.iCommon[iPageDirection].iWidth?t.right:e.iCommon[iPageDirection].iStartx+e.iCommon[iPageDirection].iWidth,t.bottom=t.bottom>e.iCommon[iPageDirection].iStarty+e.iCommon[iPageDirection].iHeight?t.bottom:e.iCommon[iPageDirection].iStarty+e.iCommon[iPageDirection].iHeight)})}return null!=t.left&&null!=t.top&&(t.w=t.right-t.left,t.h=t.bottom-t.top),t}}},events:{},render:function(){this.$el.css({width:"100%",height:"100%"}),this.renderMask(),this.model._reset=!0},renderMask:function(){},preload:function(){var e=this.model.get("iDetail");e.layer_ids&&e.layer_ids.length>0&&this.sendToPreload({file:null})},loadLayer:function(e){var t=this.getdetail();this.layerCheckList=_.clone(t.layer_ids),this.firstlayer=t.layer_ids?t.layer_ids[0]:null,this.preloadmodel=e;var i=require("interaction_view/view/layer");i=_g.mvc.createView(i),this.layerview=new i({model:this.model}),this.layerview.afterload()},afterlayerload:function(e){if(console.log(e),this.preloadmodel){this.layerCheckList=_.reject(this.layerCheckList,function(t){return t==e}),this.model.layer[e].iOverlaylist.each(function(e){e.iview.preloaded||e.iview.afterpreload()}),this.model.layer[e].iActionlist.each(function(e){e.iview.render()});{this.model.toJSON().iDetail.iHidden||!1}0==this.layerCheckList.length&&(this.$el.addClass("hide").css("opacity",""),this.slideel=this.$el.find(".layer-content").first(),this.slideel.children(".layer-item").first().show(),this.slidestyle=this.slideel.attr("style"),this.playAnimation(),this.firstlayer&&"ComponentRef"==this.model.get("iType")&&(this.model.layer[this.firstlayer].isLayer=!0),this.preloadmodel.set("loaded",!0),this.preloadmodel.page.ipreloadlist.preloadcheck(null,!0,this.model))}},playLayer:function(){this.firstlayer&&interaction_view.play(this.model.layer[this.firstlayer])},playAnimation:function(){this.getdetail();this.$el.find(".layer-content").children().css("opacity",1)},onExecuteBindingForComponentRef:function(e){var t=this.getMoveRange();1!=e.type&&(e.cdirection||t.x>0&&this.scrollview&&this.scrollview.iScroll.scrollTo(-e.deltarate*t.x,this.getCurrentPosition().top),e.cdirection&&t.y>0&&this.scrollview&&this.scrollview.iScroll.scrollTo(this.getCurrentPosition().left,-e.deltarate*t.y))},getCurrentPosition:function(){if(this.$el.find(".layer-content").length>0){var e={left:0,top:0};return this.scrollview&&(e={left:this.scrollview.iScroll.x,top:this.scrollview.iScroll.y}),e}return{left:0,top:0}},getCurrentPositionRate:function(){var e=0,t=0,i=this.getMoveRange(),n=this.getCurrentPosition();return i.x&&(e=-n.left/i.x),i.y&&(t=-n.top/i.y),{left:e,top:t}},getLayerContentSize:function(){var e=this.getdetail(),t={};return!e.layer_ids||e.layer_ids.length>0?(t.width=interaction_view.size.x,t.height=interaction_view.size.y,t):null},resetlayer:function(){var e=this,t=this.getdetail();t.layer_ids&&t.layer_ids.length>0&&(_.each(t.layer_ids,function(t){e.model.layer[t].iAnimationlist.resetAnimationStatus(),e.model.layer[t].iOverlaylist.resetViewStatus()}),!this.model.bindingfixed&&this.slideel&&this.slideel.attr("style",this.slidestyle),e.currentIndex=0)},resetOtherStatus:function(){this.resetlayer()},onShow:function(e){var t=this.getdetail(),i=this;t.layer_ids&&t.layer_ids.length>0&&_.each(t.layer_ids,function(n){i.model.layer[n].iOverlaylist.each(e&&t.layer_ids.indexOf(n)==e?function(e){e.iview.onShow()}:function(e){e.iview.onShow()})})},onBeforeHide:function(e){var t=this.getdetail(),i=this;t.layer_ids&&t.layer_ids.length>0&&_.each(t.layer_ids,function(n){e&&t.layer_ids.indexOf(n)==e||i.model.layer[n].iOverlaylist.each(function(e){e.iview.onBeforeHide(),_.include(["RichText","Region"],e.get("iType"))&&e.iview.resetOtherStatus()})})},onHide:function(e){var t=this.getdetail(),i=this;t.layer_ids&&t.layer_ids.length>0&&_.each(t.layer_ids,function(n){e&&t.layer_ids.indexOf(n)==e||i.model.layer[n].iOverlaylist.each(function(e){e.iview.onHide()})})},onSizeAdaptChange:function(){}}),define("interaction_view/components/componentref/componentref",function(){}),epub360.PlayerPlugins.push({config:{type:"LayerRef",template:"LayerRef",model_object:{setiview:function(){this.iview=new interaction_view.view.LayerRef({model:this})},setcollection:function(){iOverlaylist.get(this.id)||iOverlaylist.add(this)},setview:function(){var e=this.get("iDetail"),t=this;t.layer={},this.filterlayers(),e.layer_ids&&e.layer_ids.length>0&&_.each(e.layer_ids,function(e){t.layer[e]={},t.layer[e].iOverlaylist=new interaction_view.collection.list,t.layer[e].iAnimationlist=new interaction_view.collection.Animation,t.layer[e].iActionlist=new interaction_view.collection.Action,t.layer[e].ipreloadlist=new interaction_view.collection.Preload,t.layer[e].subcontainer=t.layer[e].ipreloadlist.subcontainer=t.layer[e].iOverlaylist.subcontainer=t.layer[e].iAnimationlist.subcontainer=t.layer[e].iActionlist.subcontainer=t.id,t.layer[e].ipreloadlist.path=t.layer[e].iOverlaylist.path=t.layer[e].iAnimationlist.path=t.layer[e].iActionlist.path=t.createPath(e),t.layer[e].ipreloadlist.pageid=t.layer[e].iOverlaylist.pageid=t.layer[e].iAnimationlist.pageid=t.layer[e].iActionlist.pageid=t.id,t.layer[e].ipreloadlist.pagetype=t.layer[e].iOverlaylist.pagetype=t.layer[e].iAnimationlist.pagetype=t.layer[e].iActionlist.pagetype="LayerRef",t.layer[e].ipreloadlist.parentpageid=t.layer[e].iOverlaylist.parentpageid=t.layer[e].iAnimationlist.parentpageid=t.layer[e].iActionlist.parentpageid=t.get("pageid"),t.layer[e].ipreloadlist.layerid=t.layer[e].iOverlaylist.layerid=t.layer[e].iAnimationlist.layerid=t.layer[e].iActionlist.layerid=e,t.layer[e].iAnimationlist.page=t.layer[e],t.layer[e].iAnimationlist.iPage_id=t.get("pageid")}),this.setiview()},createPath:function(e){var t=interaction_view.createPath({path:this.get("path"),isSubOverlay:this.get("isSubOverlay"),page_id:this.get("pageid"),model:this,layer_id:e});return t},setsyncmodel:function(){},filterlayers:function(){var e=this.get("iDetail"),t=e.layer_ids;e.layer_ids&&e.layer_ids.length>0&&(t=_.filter(t,function(e){return interaction_view.ilayerlist.get(e)})),e.layer_ids=t,this.set("iDetail",e)}}},events:{},render:function(){this.renderMask(),this.model._reset=!0,this.last_y=0,this.last_x=0},renderMask:function(){var e=this.getdetail();e.layer_ids&&e.layer_ids.length>0&&(this.$el.children(".Element").children().children().css({translate:[e.x,e.y]}),this.scrollview&&(this.$el.children(".Element").children().removeClass("is_exceededX"),this.$el.children(".Element").children().removeClass("is_exceededY"),this.scrollview.iScroll.scrollTo(e.x,e.y),this.last_x=e.x,this.last_y=e.y))},preload:function(){var e=this.model.get("iDetail");e.layer_ids&&e.layer_ids.length>0&&this.sendToPreload({file:null})},loadLayer:function(e){var t=this.getdetail();this.layerCheckList=_.clone(t.layer_ids),this.firstlayer=t.layer_ids?t.layer_ids[0]:null,this.preloadmodel=e;var i=require("interaction_view/view/layer");i=_g.mvc.createView(i),this.layerview=new i({model:this.model}),this.layerview.afterload()},afterlayerload:function(e){if(console.log(e),this.preloadmodel){this.layerCheckList=_.reject(this.layerCheckList,function(t){return t==e}),this.model.layer[e].iOverlaylist.each(function(e){e.iview.preloaded||e.iview.afterpreload()}),this.model.layer[e].iActionlist.each(function(e){e.iview&&e.iview.render({init:!0})});{this.model.toJSON().iDetail.iHidden||!1}0==this.layerCheckList.length&&(this.$el.addClass("hide").css("opacity",""),this.slideel=this.$el.find(".layer-content").first(),this.slideel.children(".layer-item").first().show(),this.slidestyle=this.slideel.attr("style"),this.playAnimation(),this.firstlayer&&"LayerRef"==this.model.get("iType")&&(this.model.layer[this.firstlayer].isLayer=!0),this.preloadmodel.set("loaded",!0),this.preloadmodel.page.ipreloadlist.preloadcheck(null,!0,this.model))}},playLayer:function(){this.firstlayer&&interaction_view.play(this.model.layer[this.firstlayer])},playAnimation:function(){var e=this,t=this.getdetail();this.$el.find(".layer-content").children().css("opacity",1);var i=this.getLayerContentSize(),n=this.getcommon(),a=t.layer_ids&&t.layer_ids[0]||"";return i.width==n.iWidth&&i.height==n.iHeight?!1:void this.setMaskSlipable({items:this.$el.find(".layer-content"),containment:this.$el.children(".Element").children(),contentel:this.$el.children(".Element").children().children(),content_x:t.x,content_y:t.y,onScrollStart:function(){},onScrolling:function(t,i,n,r){if(console.log(r),t.attr("data-anchor")){var o,s;if(void 0!=r){s=1,r>e.last_y?s=3:r<e.last_y&&(s=1);var l=e.last_y;e.last_y=r}if(void 0!=n){o=1,n>e.last_x?o=2:n<e.last_x&&(o=0);var c=e.last_x;e.last_x=n}t.find("[data-type=Anchor]").each(function(){var i=this.id,n=_.filter(interaction_view.events.scrollEvents,function(e){return e.layer_id==a&&e.overlay_id==i});if(n&&n.length)for(var r=0;r<n.length;r++){var d=n[r];void 0!=s&&d.overlaymodel.iview.onAnchorTrigger(s,-e.last_y,-l,d,t),void 0!=o&&d.overlaymodel.iview.onAnchorTrigger(o,-e.last_x,-c,d,t)}})}}})},onExecuteBindingForLayerRef:function(e){var t=this.getMoveRange();1!=e.type&&(e.cdirection||t.x>0&&this.scrollview&&this.scrollview.iScroll.scrollTo(-e.deltarate*t.x,this.getCurrentPosition().top),e.cdirection&&t.y>0&&this.scrollview&&this.scrollview.iScroll.scrollTo(this.getCurrentPosition().left,-e.deltarate*t.y))},getCurrentPosition:function(){if(this.$el.find(".layer-content").length>0){var e={left:0,top:0};return this.scrollview&&(e={left:this.scrollview.iScroll.x,top:this.scrollview.iScroll.y}),e}return{left:0,top:0}},getCurrentPositionRate:function(){var e=0,t=0,i=this.getMoveRange(),n=this.getCurrentPosition();return i.x&&(e=-n.left/i.x),i.y&&(t=-n.top/i.y),{left:e,top:t}},getLayerContentSize:function(){var e=this.getdetail(),t={};if(!e.layer_ids||e.layer_ids.length>0){var i=_.map(e.layer_ids,function(e){return interaction_view.ilayerlist.get(e).toJSON()});return t.width=_.max(_.pluck(i,"layer_width")),t.height=_.max(_.pluck(i,"layer_height")),t}return null},stoplayer:function(){var e=this,t=this.getdetail();t.layer_ids&&t.layer_ids.length>0&&_.each(t.layer_ids,function(t){e.model.layer[t].iAnimationlist.timeline&&e.model.layer[t].iAnimationlist.timeline.pause(0),e.model.layer[t].iAnimationlist.css_timeline&&e.model.layer[t].iAnimationlist.css_timeline.stop(),e.model.layer[t].iOverlaylist.resetViewStatus(),interaction_view.bezierPatch&&interaction_view.bezierPatch(e.model.layer[t])})},resetlayer:function(){var e=this,t=this.getdetail();t.layer_ids&&t.layer_ids.length>0&&(_.each(t.layer_ids,function(t){e.model.layer[t].iAnimationlist.resetAnimationStatus(),e.model.layer[t].iOverlaylist.resetViewStatus()}),!this.model.bindingfixed&&this.slideel&&this.slideel.attr("style",this.slidestyle),e.currentIndex=0)},resetOtherStatus:function(){this.resetlayer(),"LayerRef"==this.model.get("iType")&&this.renderMask()},onShow:function(e){var t=this.getdetail(),i=this;t.layer_ids&&t.layer_ids.length>0&&_.each(t.layer_ids,function(n){i.model.layer[n].iOverlaylist.each(e&&t.layer_ids.indexOf(n)==e?function(e){e.iview.onShow()}:function(e){e.iview.onShow()})})},onBeforeHide:function(e){var t=this.getdetail(),i=this;t.layer_ids&&t.layer_ids.length>0&&_.each(t.layer_ids,function(n){e&&t.layer_ids.indexOf(n)==e||i.model.layer[n].iOverlaylist.each(function(e){e.iview.onBeforeHide(),_.include(["RichText","Region"],e.get("iType"))&&e.iview.resetOtherStatus()})})},onHide:function(e){var t=this.getdetail(),i=this;t.layer_ids&&t.layer_ids.length>0&&_.each(t.layer_ids,function(n){e&&t.layer_ids.indexOf(n)==e||i.model.layer[n].iOverlaylist.each(function(e){e.iview.onHide()})})},onSizeAdaptChange:function(){this.$el.children(".Element").children(".layer-mask").css({width:this.originWidth,height:this.originHeight})}}),define("interaction_view/components/layerref/layerref",function(){}),epub360.PlayerPlugins.push({type:"actionexecute",config:{type:200,exec:function(e,t,i){t.immediate(function(){var t=e.model.get("iDetail"),i=t.results[0].values,n=t.results[0].ani_iType;if(i&&i.length&&n){for(var a=t.results[0].ani_duration,r=t.results[0].ani_delay,o=t.results[0].ani_repeat,s=[],l=0;l<i.length;l++){var c=i[l],d=c.page_id,h=interaction_view.getAnimationPage(d,e.model.page),u=h.iOverlaylist.get(c.id);if(u&&u.iview&&u.iview.$el){var p={el:u.iview.$el.children(".Element"),type:n,delay:r,duration:a,repeat:o,onShow:u.iview.onShow};s.push(p)}}if(s.length){var v=new Animate({items:s,className:"child_Action_Element",autoClear:!0,onStart:function(){if(e.executeactions&&e.executeactions.length)for(var t=0;t<e.executeactions.length;t++){var i=e.executeactions[t];"cssanimatestart"==i.attributes.iDetail.customType&&i.iview.executeAction(i.iview)}},onEnd:function(){if(e.executeactions&&e.executeactions.length)for(var t=0;t<e.executeactions.length;t++){var i=e.executeactions[t];"cssanimateend"==i.attributes.iDetail.customType&&i.iview.executeAction(i.iview)}}});v.play()}}},null,{debug:i})},setExecuteActions:function(e,t,i){i||(i={}),console.log(i),e.executeactions=[];for(var n=0;n<t.length;n++){var a=$.extend(!0,{},t[n]),r=new interaction_view.model.Action(a);r.iview.render(),e.executeactions.push(r)}}}}),define("interaction_view/actionexecutes/cssanimateaction/cssanimateaction",function(){}),epub360.PlayerPlugins.push({type:"actionexecute",config:{type:404,exec:function(e,t,i){t.immediate(function(){var t=e.model.get("iDetail"),i=t.results[0],n=i.overlay;if(n){var a=interaction_view.getParentpage(n.page_id);if(a){var r=a.iOverlaylist.get(n.id);if(r){var o,s,l=(r.iview.$el,interaction_view.expression.id2values(i.duration)),c=!1,d={};if((i.positionlimit||i.sizelimit||i.skewlimit||i.rotatelimit)&&(s=interaction_view.transform.getState(r),console.log(s),o={position:{},size:{},transform:{}}),i.position){if(s)var h=s.size.width/2,u=s.size.height/2;else var p=interaction_view.transform.getSize(r),h=p.width/2,u=p.height/2;var v,g;if(i.position_x){var f=interaction_view.expression.id2values(i.position_x);0==i.selectx?(v=f+h,o&&(o.position.x=v)):1==i.selectx?(v="+="+f,o&&(o.position.x=s.position.x+f)):(v="-="+f,o&&(o.position.x=s.position.x-f))}if(i.position_y){var m=interaction_view.expression.id2values(i.position_y);0==i.selecty?(g=m+u,o&&(o.position.y=g)):1==i.selecty?(g="+="+m,o&&(o.position.y=s.position.y+m)):(g="-="+m,o&&(o.position.y=s.position.y-m))}if(i.position_y||i.position_x){if(i.positionlimit){var _={x:h,y:u},w=["x","y"];for(var y in w)void 0!=i[w[y]+"max"]&&void 0!=o.position[w[y]]&&(o.position[w[y]]-_[w[y]]<=i[w[y]+"max"]||("x"==w[y]?v=void 0:g=void 0)),void 0!=i[w[y]+"min"]&&void 0!=o.position[w[y]]&&(o.position[w[y]]-_[w[y]]>=i[w[y]+"min"]||("x"==w[y]?v=void 0:g=void 0))}if(d.position||(d.position={}),(i.selectx>0||i.selecty>0)&&(d.position.oper=!0),void 0==v&&void 0==g)return;d.position.x=v,d.position.y=g,c=!0}}if(i.size){d.size={};var b;if(b=s?{width:s.size.width,height:s.size.height}:interaction_view.transform.getSize(r),i.itemwidth){var x=Number(interaction_view.expression.id2values(i.itemwidth));i.selectwidth&&0!=i.selectwidth?1==i.selectwidth?(x=b.width+x,o&&(o.size.width=x)):(x=b.width-x,o&&(o.size.width=x)):(i.selectwidth="0",o&&(o.size.width=x))}else x=void 0;if(i.itemheight){var S=Number(interaction_view.expression.id2values(i.itemheight));i.selectheight&&0!=i.selectheight?1==i.selectheight?(S=b.height+S,o&&(o.size.height=S)):(S=b.height-S,o&&(o.size.height=S)):(i.selectheight="0",o&&(o.size.height=S))}else S=void 0;if(d.size.width=x,d.size.height=S,i.sizelimit){var w=["width","height"];for(var y in w)void 0!=i[w[y]+"max"]&&void 0!=o.size[w[y]]&&(o.size[w[y]]<=i[w[y]+"max"]||(d.size[w[y]]=void 0)),void 0!=i[w[y]+"min"]&&void 0!=o.size[w[y]]&&(o.size[w[y]]>=i[w[y]+"min"]||(d.size[w[y]]=void 0))}}if(i.rotate){if(i.changex){var T=Number(interaction_view.expression.id2values(i.changex));0==i.rotatex?(i.rotatex="0",o&&(o.transform.changex=T)):1==i.rotatex?(o&&(o.transform.changex=s.transform.rotationX+T),T="+="+T):(o&&(o.transform.changex=s.transform.rotationX-T),T="-="+T)}else T=void 0;if(i.changey){var k=Number(interaction_view.expression.id2values(i.changey));0==i.rotatey?(i.rotatey="0",o&&(o.transform.changey=k)):1==i.rotatey?(o&&(o.transform.changey=s.transform.rotationY+k),k="+="+k):(o&&(o.transform.changey=s.transform.rotationY-k),k="-="+k)}else k=void 0;if(i.changez){var C=Number(interaction_view.expression.id2values(i.changez));0==i.rotatez?(i.rotatez="0",o&&(o.transform.changez=C)):1==i.rotatez?(o&&(o.transform.changez=s.transform.rotation+C),C="+="+C):(o&&(o.transform.changez=s.transform.rotation-C),C="-="+C)}else C=void 0;if(i.rotatelimit){var w=["changex","changey","changez"];for(var y in w)void 0!=i[w[y]+"max"]&&void 0!=o.transform[w[y]]&&(o.transform[w[y]]<=i[w[y]+"max"]||("changex"==w[y]?T=void 0:"changey"==w[y]?k=void 0:C=void 0)),void 0!=i[w[y]+"min"]&&void 0!=o.transform[w[y]]&&(o.transform[w[y]]>=i[w[y]+"min"]||("changex"==w[y]?T=void 0:"changey"==w[y]?k=void 0:C=void 0))}(i.rotatex||i.rotatey||i.rotatez)&&(d.transform||(d.transform={}),d.transform.rotationX=T,d.transform.rotationY=k,d.transform.rotation=C)}if(i.skew){if(i.skewx){var P=Number(interaction_view.expression.id2values(i.skewx));i.skewxoper&&0!=i.skewxoper?1==i.skewxoper?(o&&(o.transform.skewx=s.transform.skewX+P),P="+="+P):(o&&(o.transform.skewx=s.transform.skewX-P),P="-="+P):i.skewxoper="0"}else P=void 0;if(i.skewy){var D=Number(interaction_view.expression.id2values(i.skewy));i.skewyoper&&0!=i.skewyoper?1==i.skewyoper?(o&&(o.transform.skewy=s.transform.skewY+D),D="+="+D):(o&&(o.transform.skewy=s.transform.skewY-D),D="-="+D):i.skewyoper="0"}else D=void 0;if(i.skewlimit){var w=["skewx","skewy"];for(var y in w)void 0!=i[w[y]+"max"]&&void 0!=o.transform[w[y]]&&(o.transform[w[y]]<=i[w[y]+"max"]||("skewx"==w[y]?P=void 0:D=void 0)),void 0!=i[w[y]+"min"]&&void 0!=o.transform[w[y]]&&(o.transform[w[y]]>=i[w[y]+"min"]||("skewx"==w[y]?P=void 0:D=void 0))}(i.skewx||i.skewy)&&(d.transform||(d.transform={}),d.transform.skewX=P,d.transform.skewY=D)}if(d.transform&&(d.transform.transformOrigin=i.xcenter+"% "+i.ycenter+"%"),interaction_view.transform.setState(r,d,{duration:l,ease:i.animate}),c){var $={page_id:r.page.id,overlay_id:r.id,layer_id:r.attributes.layer_id};r.page.id||($.layer_id=r.page.iOverlaylist.layerid),interaction_view.events.onDragging($)}}}}},null,{debug:i})},setExecuteActions:function(e,t,i){i||(i={}),console.log(i),e.executeactions=[];for(var n=0;n<t.length;n++){var a=$.extend(!0,{},t[n]),r=new interaction_view.model.Action(a);r.iview.render(),e.executeactions.push(r)}}}}),define("interaction_view/actionexecutes/elementproperty/elementproperty",function(){}),epub360.PlayerPlugins.push({type:"actionexecute",config:{type:201,exec:function(e,t,i){t.immediate(function(){var t=e.model.get("iDetail"),i=t.results[0],n=new dboperate(i);n.init(function(){if(e.executeactions.length)for(var t=0;t<e.executeactions.length;t++){var i=e.executeactions[t];"dboperatesuccess"==i.attributes.iDetail.customType&&i.iview.executeAction(i.iview)}})},null,{debug:i})},setExecuteActions:function(e,t,i){i||(i={}),console.log(i),e.executeactions=[];for(var n=0;n<t.length;n++){var a=$.extend(!0,{},t[n]),r=new interaction_view.model.Action(a);r.iview.render(),e.executeactions.push(r)}}}}),define("interaction_view/actionexecutes/datalist/datalist",function(){}),epub360.PlayerPlugins.push({type:"actionexecute",config:{type:301,exec:function(e,t,i){var n=e.model.get("iDetail"),a=n.results[0].values,r=function(e){var t=this,i=new Queue({continuous:!1,onComplete:function(){t.done()}}),n=_.filter(interaction_view.events.conditionEvents,function(t){return t.overlay_id!=e.id?!1:t.page_id==e.page_id});if(n.length>0){for(var a={},r=0;r<n.length;r++)a[n[r].condition]||(a[n[r].condition]=[]),a[n[r].condition].push(n[r]);var o=[],s=[];for(var l in a){s.push(a[l]);var c=interaction_view.expression.doCondition(l);o.push(c)}o.length?promise.join(o).then(function(e){for(var n=0;n<e.length;n++)for(var a=s[n],r=0;r<a.length;r++)a[r].result=e[n],e[n][0]&&a[r].func(i);i.length()?i._exec():t.done()}):t.done()}else t.done()};if(a&&a.length)for(var o=0;o<a.length;o++)t.add(r,a[o],{debug:i})}}}),define("interaction_view/actionexecutes/condition/condition",function(){}),epub360.PlayerPlugins.push({type:"actionexecute",config:{type:204,exec:function(e,t,i){t.immediate(function(){var t=e.model.get("iDetail"),i=t.results[0],n={};if(n.config=i.config,i.state.id){if(interaction_view.imasterlist.models[0].iOverlaylist.get(i.state.id))n.page=interaction_view.imasterlist.models[0],n.group=n.page.iOverlaylist.get(i.state.id);else if(interaction_view.ibackgroundlist.models[0].iOverlaylist.get(i.state.id))n.page=interaction_view.ibackgroundlist.models[0],n.group=n.page.iOverlaylist.get(i.state.id);else if(interaction_view.ipagelist.getPage(i.state.page_id)&&interaction_view.ipagelist.getPage(i.state.page_id).iOverlaylist.get(i.state.id))n.page=interaction_view.ipagelist.getPage(i.state.page_id),n.group=n.page.iOverlaylist.get(i.state.id);else{if(!e.model.page.iOverlaylist.get(i.state.id))return;n.page=e.model.page,n.group=n.page.iOverlaylist.get(i.state.id)}var a=new window.stategroup(n);a.render()}else;},null,{debug:i})},setExecuteActions:function(e,t,i){i||(i={}),e.executeactions=[];for(var n=0;n<t.length;n++){var a=$.extend(!0,{},t[n]),r=new interaction_view.model.Action(a);r.iview.render(),e.executeactions.push(r)}}}}),define("interaction_view/actionexecutes/state/state",function(){}),epub360.PlayerPlugins.push({type:"actionexecute",config:{type:202,exec:function(e,t){var i=e.model.get("iDetail"),n=i.results[0].values,a=function(){var t=this,i=new Queue({continuous:!1,onComplete:function(){if(e.executeactions.length)for(var i=0;i<e.executeactions.length;i++){var n=e.executeactions[i];"onRefreshSuccess"==n.attributes.iDetail.customType&&n.iview.executeAction(n.iview)}t.done()}});_.each(n,function(e){console.log(e);var t=null;switch(e.type){case"page":t=interaction_view.ipagelist.getPage(e.page_id);break;case"master":t=interaction_view.imasterlist.models[0];break;case"background":t=interaction_view.ibackgroundlist.models[0]}var n=t.iOverlaylist.get(e.id),a=function(){n.iview.refresh(this)};i.add(a)}),i._exec()};t.add(a),console.log("æ‰§è¡Œåˆ·æ–°")},setExecuteActions:function(e,t,i){i||(i={}),console.log(i),e.executeactions=[];for(var n=0;n<t.length;n++){var a=$.extend(!0,{},t[n]),r=new interaction_view.model.Action(a);r.iview.render(),e.executeactions.push(r)}}}}),define("interaction_view/actionexecutes/refresh/refresh",function(){}),epub360.PlayerPlugins.push({type:"actionexecute",config:{type:203,exec:function(e,t,i){var n=e.model.attributes.iDetail.results[0].image_url;if(n){var a=function(){interaction_view.isWeixin?interaction_view.weixin.chooseimage(function(t){if(t&&t[0]){interaction_view.localIds=t;var i=t[0];if(e.executeactions.length)for(var a=0;a<e.executeactions.length;a++){var r=e.executeactions[a];"onUploadStart"==r.attributes.iDetail.customType&&r.iview.executeAction(r.iview)}interaction_view.imageUploader(i,function(t){if(interaction_view.expression.setValue(n,t),e.executeactions.length)for(var i=0;i<e.executeactions.length;i++){var a=e.executeactions[i];"onUploadEnd"==a.attributes.iDetail.customType&&a.iview.executeAction(a.iview)}})}}):desktop_upload(e,function(e){console.log(e),interaction_view.expression.setValue(n,e)})};t.immediate(a,null,{debug:i})}},setExecuteActions:function(e,t,i){i||(i={}),console.log(i),e.executeactions=[];for(var n=0;n<t.length;n++){var a=$.extend(!0,{},t[n]),r=new interaction_view.model.Action(a);r.iview.render(),e.executeactions.push(r)}}}}),define("interaction_view/actionexecutes/uploadimage/uploadimage",function(){}),epub360.PlayerPlugins.push({type:"actionexecute",config:{type:302,exec:function(e,t,i,n){function a(e){var t=new promise.Promise,i=Number(e.oper),n=_.find(d,function(t){return t.id==e.id});switch(i){case 0:1==e.type?interaction_view.expression.id2values(e.value,function(i){var n=c.find("[es-id="+e.id+"]");n.length&&(_.include(["div"],n[0].tagName.toLowerCase())?n.css("background-image","url("+i+")"):_.include(["img"],n[0].tagName.toLowerCase())?n.attr("src",i):_.include(["h1","h2","h3","h4","h5","h6","p"],n[0].tagName.toLowerCase())&&n.text(i)),t.done()
},{$contentGridRow:c}):interaction_view.expression.id2values(e.value,function(e){n.initial=e,t.done()},{$contentGridRow:c});break;case 1:interaction_view.expression.id2values(e.value,function(e){0==n.iKind&&(n.initial=Number(n.initial)),n.initial+=e,t.done()},{$contentGridRow:c});break;case 2:interaction_view.expression.id2values(e.value,function(e){0==n.iKind&&(n.initial=Number(n.initial)),n.initial-=e,t.done()},{$contentGridRow:c});break;case 3:var a=interaction_view.setRandom(n);n.initial=a,t.done()}return t}function r(e){var t=interaction_view.ipagelist.getPage(interaction_view.currentPage).iOverlaylist.get(e);return t||(t=interaction_view.imasterlist.models[0].iOverlaylist.get(e)),t||(t=interaction_view.ibackgroundlist.models[0].iOverlaylist.get(e)),t?t.iview:void 0}var o=e.model.get("iDetail"),s=o.results[0].values,l=r(s.id);if(n.$dom)var c=n.$dom;if(4==s.type)t.add(function(t){var i=this,a=new Queue({continuous:!1,onComplete:function(){i.done()}}),r=_.filter(interaction_view.events.conditionEvents,function(i){return i.overlay_id==e.model.attributes.overlay_id&&_.contains(t.conditions,i.cond_id)?i.page_id==e.model.attributes.page_id:!1});if(r.length>0){for(var o={},s=0;s<r.length;s++)o[r[s].condition]||(o[r[s].condition]=[]),o[r[s].condition].push(r[s]);var l=[],c=[];for(var d in o){c.push(o[d]);var h=interaction_view.expression.doCondition(d,{$dom:n.$dom});l.push(h)}l.length?promise.join(l).then(function(e){for(var t=0;t<e.length;t++)for(var r=c[t],o=0;o<r.length;o++)r[o].result=e[t],e[t][0]&&r[o].func(a,{$dom:n.$dom});a.length()?a._exec():i.done()}):i.done()}else i.done()},s,{debug:i});else if(3==s.type){var d=c.data("variables");t.add(function(e){var t=this,i=[];_.each(e.variables,function(e){i.push(a(e))}),i.length?promise.join(i).then(function(){t&&t.done()}):t&&t.done()},s,{debug:i})}else t.immediate(function(){var i=c.data("value");s&&(0==s.type?_.each(s.fields,function(a,r){if(a&&(interaction_view.expression.setValue(a,i[r]),e.executeactions.length))for(var r=0;r<e.executeactions.length;r++){var o=e.executeactions[r];"onSuccess"==o.attributes.iDetail.customType&&o.iview.executeAction(o.iview,t,{$dom:n.$dom})}}):1==s.type?interaction_view.expression.getDataById(l.model.attributes.iDetail.db_id,l.model.attributes.iDetail.query_id,i.id,function(i){if(c.data("value",i.data.results[0]),c.find("[es-bind=1]").each(function(e,t){l.bindData($(t),i.data.results[0])}),e.executeactions.length)for(var a=0;a<e.executeactions.length;a++){var r=e.executeactions[a];"onSuccess"==r.attributes.iDetail.customType&&r.iview.executeAction(r.iview,t,{$dom:n.$dom})}}):2==s.type&&(0==s.show?_.each(s.show_ids,function(e){c.find("[es-id="+e+"]").show()}):_.each(s.show_ids,function(e){c.find("[es-id="+e+"]").hide()})))},null,{debug:i})},setExecuteActions:function(e,t,i){i||(i={}),console.log(i),e.executeactions=[];for(var n=0;n<t.length;n++){var a=$.extend(!0,{},t[n]),r=new interaction_view.model.Action(a);r.iview.render(),e.executeactions.push(r)}}}}),define("interaction_view/actionexecutes/contentGrid/contentGrid",function(){}),epub360.PlayerPlugins.push({type:"actionexecute",config:{type:303,exec:function(e,t,i){t.immediate(function(){var t=e.model.get("iDetail"),i=t.results[0],n=i.overlay;if(n){var a=interaction_view.getParentpage(n.page_id);if(a){var r=a.iOverlaylist.get(n.id);if(r){var o=e.model.attributes.iDetail.results[0].image_url;if(i.oper)switch(Number(i.oper)){case 1:console.log("è½¬æˆå›¾ç‰‡");var s=r.iview.$el.find("canvas").first()[0],l=s.toDataURL(),c=_g.fileapi.base64urltoBase64(l),d=_g.fileapi.b64toBlob({b64Data:c}),h=context_url+"uploadimage";_g.fileapi.sendBinary({blob:d,url:h,filekey:"image",filename:"canvaså›¾ç‰‡"+_g.uuid(1),callback:function(t){try{var i=t.data.results[0];o&&interaction_view.expression.setValue(o,i)}catch(n){}if(e.executeactions.length)for(var a=0;a<e.executeactions.length;a++){var r=e.executeactions[a];"onPaletteSuccess"==r.attributes.iDetail.customType&&r.iview.executeAction(r.iview)}}});break;case 2:var u=i.palette_action_size;if(0===u||u){var u=interaction_view.expression.id2values(u);r.iview.$el.find(".el_wrap").children().eraser("size",u)}break;case 3:var p=i.palette_action_color;i.palette_eraser?r.iview.$el.find(".el_wrap").children().eraser("setmode",0):(r.iview.$el.find(".el_wrap").children().eraser("setmode",1),p&&r.iview.$el.find(".el_wrap").children().eraser("color",p));break;case 4:{i.palette_action_active}i.palette_action_active?(r.iview.$el.find(".el_wrap").children().eraser("enable"),r.iview.$el.children(".Element").addClass("disableDragX disableDragY")):(r.iview.$el.find(".el_wrap").children().eraser("disable"),r.iview.$el.children(".Element").removeClass("disableDragX disableDragY"));break;case 5:r.iview.$el.find(".el_wrap").children().eraser("clear")}}}}},null,{debug:i})},setExecuteActions:function(e,t,i){i||(i={}),console.log(i),e.executeactions=[];for(var n=0;n<t.length;n++){var a=$.extend(!0,{},t[n]),r=new interaction_view.model.Action(a);r.iview.render(),e.executeactions.push(r)}}}}),define("interaction_view/actionexecutes/palette/palette",function(){}),epub360.PlayerPlugins.push({type:"actionexecute",config:{type:403,exec:function(e,t,i){t.immediate(function(){var t=e.model.get("iDetail"),i=t.results[0],n=i.overlay;if(n&&n.length)for(var a=0;a<n.length;a++){var r=n[a],o=interaction_view.getParentpage(r.page_id);if(!o)return;var s=o.iOverlaylist.get(r.id);if(!s)return;if(i.oper)switch(Number(i.oper)){case 1:{i.gyroscope_action_active}s.disabled=i.gyroscope_action_active?!1:!0}}},null,{debug:i})}}}),define("interaction_view/actionexecutes/gyroscope/gyroscope",function(){}),epub360.PlayerPlugins.push({type:"actionexecute",config:{type:205,exec:function(e){function t(e){var t=_.filter(o,function(e){return"Anchor"==e.get("iType")});if(interaction_view.anchorIndex+=parseInt(e),interaction_view.anchorIndex<0)return void(interaction_view.anchorIndex=0);if(interaction_view.anchorIndex>t.length-1)return void(interaction_view.anchorIndex=t.length-1);var i=t[interaction_view.anchorIndex],n=$("section#"+r).find("#"+i.id)[0]._gsTransform.y-$("section#"+r+" #"+i.id+" .Element").height()/2;return n}var i,n=e.model.get("iDetail"),a=n.results[0].scrollTo,r=interaction_view.currentPage,o=interaction_view.ipagelist.getPage(r).iOverlaylist.models,s=$("section#"+r+" .interaction-view").height(),l=interaction_view.doc.get("height");if(interaction_view.ipagelist.getPage(r).iview.scrollview){switch(_.isUndefined(interaction_view.anchorIndex)&&(interaction_view.anchorIndex=0),a){case"0":i=s-l;break;case"1":i=0;break;case"2":var c=n.results[0].toEl;if(!c)return;var d=$("section#"+r);i=d.find("#"+c)[0]._gsTransform.y-d.find("#"+c+" .Element").height()/2;var h=_.filter(o,function(e){return e.id==c})[0];if("Anchor"==h.get("iType")){var u=_.filter(o,function(e){return"Anchor"==e.get("iType")});interaction_view.anchorIndex=u.indexOf(h),console.log(interaction_view.anchorIndex)}break;case"3":i=t("1");break;case"4":i=t("-1")}i===+i&&(l>=s-i&&(i=s-l),interaction_view.ipagelist.getPage(r).iview.scrollview._scrollTo(0,"-"+i))}},setExecuteActions:function(){}}}),define("interaction_view/actionexecutes/pagescroll/pagescroll",function(){}),epub360.PlayerPlugins.push({type:"actionexecute",config:{type:512,exec:function(e,t,i){t.immediate(function(){var t=e.model.get("iDetail"),i=t.results[0],n=i.overlay;if(n){var a=interaction_view.getParentpage(n.page_id);if(a){var r=a.iOverlaylist.get(n.id);if(r){var o=2,s=$("div[data-type='ClipBoard']").first(),l=document.createElement("canvas");s.append(l),l.id="clipboard",$("#clipboard").hide(),l.width=Number(interaction_view.size.x)*o,l.height=interaction_view.ipagelist.getPage(interaction_view.currentPage).get("height")?Number(interaction_view.ipagelist.getPage(interaction_view.currentPage).get("height"))*o:Number(interaction_view.size.y)*o;for(var c=r.toJSON().iDetail.chooseElement,d=e.model.attributes.iDetail.results[0].image_url,h=0,u=[],p=[],v=[],g=[],f=function(){var t=$("div[data-type='ClipBoard']").first().find("canvas")[0],i=t.toDataURL(),n=_g.fileapi.base64urltoBase64(i),a=_g.fileapi.b64toBlob({b64Data:n}),r=context_url+"uploadimage";_g.fileapi.sendBinary({blob:a,url:r,filekey:"image",filename:"canvaså›¾ç‰‡"+_g.uuid(1),callback:function(t){var i=t.data.results[0];if(d&&interaction_view.expression.setValue(d,i),$("#clipboard").remove(),e.executeactions.length)for(var n=0;n<e.executeactions.length;n++){var a=e.executeactions[n];"onClipBoardSuccess"==a.attributes.iDetail.customType&&a.iview.executeAction(a.iview)}}})},m=function(e,t,i,n,a,r,s,l,c,d){var h=t.getContext("2d"),p=2*Number(d["font-size"].replace("px",""))+"px",v=d["font-family"].split(",")[0];h.font=p+" "+v,h.fillStyle=d.color;var g=0,m=0;if(0!=c){h.save(),h.translate(Number(l.iStartx)*o+Number(l.iWidth),Number(l.iStarty)*o+Number(l.iHeight)),h.rotate(c*Math.PI/180),"0px"!=d["border-width"]&&(h.lineWidth=d["border-width"].replace("px",""),h.strokeStyle=d["border-color"],h.strokeRect(-Number(l.iWidth),-Number(l.iHeight),Number(l.iWidth)*o,Number(l.iHeight)*o));for(var _=0;_<e.length;_++)g+=h.measureText(e[_]).width*o,g>2*r&&(h.fillText(e.substring(m,_),-Number(l.iWidth),-Number(l.iHeight)),n+=40,g=0,m=_),_==e.length-1&&h.fillText(e.substring(m,_+1),-Number(l.iWidth),-Number(l.iHeight));h.restore(),0==u.length&&f()}else{"0px"!=d["border-width"]&&(h.lineWidth=d["border-width"].replace("px",""),h.strokeStyle=d["border-color"],h.strokeRect(i,n,Number(l.iWidth)*o,Number(l.iHeight)*o));for(var _=0;_<e.length;_++)g+=h.measureText(e[_]).width*o,g>2*r&&(h.fillText(e.substring(m,_),i,n),n+=40,g=0,m=_),_==e.length-1&&h.fillText(e.substring(m,_+1),i,n+2*Number(d["font-size"].replace("px",""))+10);0==u.length&&f()}},w=function(e){var t=new Array;return e=e.replace(/<div>/g,""),t=e.split("</div>")},y=function(e,t,i,n,a,r,s,l){var c=e.getContext("2d"),d=2*Number(l["font-size"].replace("px",""))+"px",h=l["font-family"].split(",")[0];c.font=d+" "+h,c.fillStyle=l.color;var p=w(t),v=35,g=-Number(r.iHeight);if(0!=s){c.save(),c.translate(Number(r.iStartx)*o+Number(r.iWidth),Number(r.iStarty)*o+Number(r.iHeight)),c.rotate(s*Math.PI/180),"0px"!=l["border-width"]&&(c.lineWidth=l["border-width"].replace("px",""),c.strokeStyle=l["border-color"],c.strokeRect(-Number(r.iWidth),-Number(r.iHeight),Number(r.iWidth)*o,Number(r.iHeight)*o));for(var m=0;m<p.length;m++)c.fillText(p[m],-Number(r.iWidth),g+25),g+=v;c.restore(),0==u.length&&f()}else{"0px"!=l["border-width"]&&(c.lineWidth=l["border-width"].replace("px",""),c.strokeStyle=l["border-color"],c.strokeRect(i,n,Number(r.iWidth)*o,Number(r.iHeight)*o));for(var m=0;m<p.length;m++)c.fillText(p[m],i,n+25),n+=v;0==u.length&&f()}},b=function(e){var t=document.getElementById("clipboard"),i=t.getContext("2d"),n=e.toJSON().iCommon.landscape;n.iStartx=interaction_view.transform.getState(e).position.x-interaction_view.transform.getState(e).size.width/2,n.iStarty=interaction_view.transform.getState(e).position.y-interaction_view.transform.getState(e).size.height/2;var a=e.toJSON().iDetail.init_rotation,r=e.iview.zIndex,s=e.toJSON().iDetail.init_opacity;if(_.include(["ImageBlock","Image","CycleImage","Gallery"],e.toJSON().iType)){var l=e.iview.$el.find(".el_wrap"),c={"border-width":l.css("border-width"),"border-color":l.css("border-color")},d=new Image;if(d.setAttribute("crossOrigin","anonymous"),"none"!=$(e.iview.el).find(".el_wrap").css("background-image"))d.src=$(e.iview.el).find(".el_wrap").css("background-image").replace(/url\((.*)\)/,"$1").replace(/"/g,"");else{if(0==$(e.iview.el).find("img").length)return void h++;d.src=$(e.iview.el).find("img").attr("src")}if(d.complete)return void(0==a?(i.save(),i.globalAlpha=s,i.drawImage(d,Number(n.iStartx)*o,Number(n.iStarty)*o,Number(n.iWidth)*o,Number(n.iHeight)*o),i.restore(),f()):(i.save(),i.globalAlpha=s,i.translate(Number(n.iStartx)*o+Number(n.iWidth),Number(n.iStarty)*o+Number(n.iHeight)),i.rotate(a*Math.PI/180),i.drawImage(d,-Number(n.iWidth),-Number(n.iHeight),Number(n.iWidth)*o,Number(n.iHeight)*o),i.restore(),f()));if(1==e.toJSON().iDetail.iDisplay){var p=n.iWidth/n.iHeight,w=new Image;w.src=d.src,w.haveimg=0==l.find("img").length?0:1,u.push(w),w.onload=function(){h++;var e,t,l=w.width/w.height;if(l>p?(e=n.iWidth*o/l,g.push(1==w.haveimg?[d,Number(n.iStartx)*o,Number(n.iStarty)*o,Number(n.iWidth)*o,e,r,a,s,c]:[d,Number(n.iStartx)*o,Number(n.iStarty)*o+n.iHeight-e/2,Number(n.iWidth)*o,e,r,a,s,c])):(t=n.iHeight*o*l,g.push([d,Number(n.iStartx)*o+n.iWidth-t/2,Number(n.iStarty)*o,t,Number(n.iHeight)*o,r,a,s,c])),h==u.length){g=g.sort(function(e,t){return e[5]-t[5]});for(var m=0;m<g.length;m++)0==g[m][6]?("0px"!=g[m][8]["border-width"]&&(i.lineWidth=2*g[m][8]["border-width"].replace("px",""),i.strokeStyle=g[m][8]["border-color"],i.strokeRect(g[m][1]+i.lineWidth,g[m][2]+i.lineWidth,g[m][3]-2*i.lineWidth,g[m][4]-2*i.lineWidth)),i.save(),i.globalAlpha=g[m][7],i.drawImage(g[m][0],g[m][1]+i.lineWidth,g[m][2]+i.lineWidth,g[m][3]-2*i.lineWidth,g[m][4]-2*i.lineWidth),i.restore()):(i.save(),i.globalAlpha=g[m][7],i.translate(g[m][1]+i.lineWidth+(g[m][3]-2*i.lineWidth)/2,g[m][2]+i.lineWidth+(g[m][4]-2*i.lineWidth)/2),i.rotate(g[m][6]*Math.PI/180),"0px"!=g[m][8]["border-width"]&&(i.lineWidth=2*g[m][8]["border-width"].replace("px",""),i.strokeStyle=g[m][8]["border-color"],i.strokeRect(-(g[m][3]-2*i.lineWidth)/2,-(g[m][4]-2*i.lineWidth)/2,g[m][3]-2*i.lineWidth,g[m][4]-2*i.lineWidth)),i.drawImage(g[m][0],-(g[m][3]-2*i.lineWidth)/2,-(g[m][4]-2*i.lineWidth)/2,g[m][3]-2*i.lineWidth,g[m][4]-2*i.lineWidth),i.restore());for(var m=0;m<v.length;m++)v[m].iview.$el.hasClass("hide")||b(v[m]);f()}}}else g.push([d,Number(n.iStartx)*o,Number(n.iStarty)*o,Number(n.iWidth)*o,Number(n.iHeight)*o,r,a,s,c]);d.onload=function(){if(h++,h==u.length){g=g.sort(function(e,t){return e[5]-t[5]});for(var e=0;e<g.length;e++)0==g[e][6]?("0px"!=g[e][8]["border-width"]&&(i.lineWidth=2*g[e][8]["border-width"].replace("px",""),i.strokeStyle=g[e][8]["border-color"],i.strokeRect(g[e][1]+i.lineWidth,g[e][2]+i.lineWidth,g[e][3]-2*i.lineWidth,g[e][4]-2*i.lineWidth)),i.save(),i.globalAlpha=g[e][7],i.drawImage(g[e][0],g[e][1]+i.lineWidth,g[e][2]+i.lineWidth,g[e][3]-2*i.lineWidth,g[e][4]-2*i.lineWidth),i.restore()):(i.save(),i.globalAlpha=g[e][7],i.translate(g[e][1]+i.lineWidth+(g[e][3]-2*i.lineWidth)/2,g[e][2]+i.lineWidth+(g[e][4]-2*i.lineWidth)/2),i.rotate(g[e][6]*Math.PI/180),"0px"!=g[e][8]["border-width"]&&(i.lineWidth=2*g[e][8]["border-width"].replace("px",""),i.strokeStyle=g[e][8]["border-color"],i.strokeRect(-(g[e][3]-2*i.lineWidth)/2,-(g[e][4]-2*i.lineWidth)/2,g[e][3]-2*i.lineWidth,g[e][4]-2*i.lineWidth)),i.drawImage(g[e][0],-(g[e][3]-2*i.lineWidth)/2,-(g[e][4]-2*i.lineWidth)/2,g[e][3]-2*i.lineWidth,g[e][4]-2*i.lineWidth),i.restore());for(var e=0;e<v.length;e++)v[e].iview.$el.hasClass("hide")||b(v[e]);f()}}}else if(_.include(["Paragraph"],e.toJSON().iType)){var x=e.toJSON().iDetail.iText,S=e.iview.$el.find(".iText").children().length,l=e.iview.$el.find(".el_wrap"),c={"font-size":l.css("font-size"),"background-color":l.css("background-color"),"font-family":l.css("font-family"),color:l.css("color"),"border-width":l.css("border-width"),"border-color":l.css("border-color")},T=e.toJSON().iDetail.iStyle.split(";");if(1==S){var k=e.toJSON().iDetail.iText.replace("<div>","").replace("</div>","");m(k,t,Number(n.iStartx)*o,Number(n.iStarty)*o,15,Number(n.iWidth)*o,T,n,a,c)}else y(t,x,Number(n.iStartx)*o,Number(n.iStarty)*o,T,n,a,c)}else if(_.include(["qrcode"],e.toJSON().iType)){var l=e.iview.$el.find(".el_wrap"),c={"border-width":l.css("border-width"),"border-color":l.css("border-color")},C=$(e.iview.el).find("img"),d=new Image;if(-1==$(C).attr("src").indexOf("base64")&&d.setAttribute("crossOrigin","anonymous"),d.src=$(C).attr("src"),d.complete){if(h++,g.push([d,Number(n.iStartx)*o,Number(n.iStarty)*o,Number(n.iWidth)*o,Number(n.iHeight)*o,r,a,s,c]),h==u.length){g=g.sort(function(e,t){return e[5]-t[5]});for(var P=0;P<g.length;P++)0==g[P][6]?("0px"!=g[P][8]["border-width"]&&(i.lineWidth=2*g[P][8]["border-width"].replace("px",""),i.strokeStyle=g[P][8]["border-color"],i.strokeRect(g[P][1]+i.lineWidth,g[P][2]+i.lineWidth,g[P][3]-2*i.lineWidth,g[P][4]-2*i.lineWidth)),i.save(),i.globalAlpha=g[P][7],i.drawImage(g[P][0],g[P][1]+i.lineWidth,g[P][2]+i.lineWidth,g[P][3]-2*i.lineWidth,g[P][4]-2*i.lineWidth),i.restore()):(i.save(),i.globalAlpha=g[P][7],i.translate(g[P][1]+i.lineWidth+(g[P][3]-2*i.lineWidth)/2,g[P][2]+i.lineWidth+(g[P][4]-2*i.lineWidth)/2),i.rotate(g[P][6]*Math.PI/180),"0px"!=g[P][8]["border-width"]&&(i.lineWidth=2*g[P][8]["border-width"].replace("px",""),i.strokeStyle=g[P][8]["border-color"],i.strokeRect(-(g[P][3]-2*i.lineWidth)/2,-(g[P][4]-2*i.lineWidth)/2,g[P][3]-2*i.lineWidth,g[P][4]-2*i.lineWidth)),i.drawImage(g[P][0],-(g[P][3]-2*i.lineWidth)/2,-(g[P][4]-2*i.lineWidth)/2,g[P][3]-2*i.lineWidth,g[P][4]-2*i.lineWidth),i.restore());for(var P=0;P<v.length;P++)v[P].iview.$el.hasClass("hide")||b(v[P]);f()}return}d.onload=function(){if(h++,g.push([d,Number(n.iStartx)*o,Number(n.iStarty)*o,Number(n.iWidth)*o,Number(n.iHeight)*o,r,a,s,c]),h==u.length){g=g.sort(function(e,t){return e[5]-t[5]});for(var e=0;e<g.length;e++)0==g[e][6]?("0px"!=g[e][8]["border-width"]&&(i.lineWidth=2*g[e][8]["border-width"].replace("px",""),i.strokeStyle=g[e][8]["border-color"],i.strokeRect(g[e][1]+i.lineWidth,g[e][2]+i.lineWidth,g[e][3]-2*i.lineWidth,g[e][4]-2*i.lineWidth)),i.save(),i.globalAlpha=g[e][7],i.drawImage(g[e][0],g[e][1]+i.lineWidth,g[e][2]+i.lineWidth,g[e][3]-2*i.lineWidth,g[e][4]-2*i.lineWidth),i.restore()):(i.save(),i.globalAlpha=g[e][7],i.translate(g[e][1]+i.lineWidth+(g[e][3]-2*i.lineWidth)/2,g[e][2]+i.lineWidth+(g[e][4]-2*i.lineWidth)/2),i.rotate(g[e][6]*Math.PI/180),"0px"!=g[e][8]["border-width"]&&(i.lineWidth=2*g[e][8]["border-width"].replace("px",""),i.strokeStyle=g[e][8]["border-color"],i.strokeRect(-(g[e][3]-2*i.lineWidth)/2,-(g[e][4]-2*i.lineWidth)/2,g[e][3]-2*i.lineWidth,g[e][4]-2*i.lineWidth)),i.drawImage(g[e][0],-(g[e][3]-2*i.lineWidth)/2,-(g[e][4]-2*i.lineWidth)/2,g[e][3]-2*i.lineWidth,g[e][4]-2*i.lineWidth),i.restore());for(var e=0;e<v.length;e++)v[e].iview.$el.hasClass("hide")||b(v[e]);f()}}}},x=0;x<c.length;x++){var S=a.iOverlaylist.get(c[x].id);S&&(p.push(S),_.include(["ImageBlock","Image","CycleImage","Gallery","qrcode"],S.toJSON().iType)&&!S.iview.$el.hasClass("hide")&&u.push(S),_.include(["Paragraph"],S.toJSON().iType)&&!S.iview.$el.hasClass("hide")&&v.push(S))}p=p.sort(function(e,t){return e.iview.zIndex-t.iview.zIndex});for(var x=0;x<p.length;x++)p[x].iview.$el.hasClass("hide")||b(p[x])}}}},null,{debug:i})},setExecuteActions:function(e,t,i){i||(i={}),console.log(i),e.executeactions=[];for(var n=0;n<t.length;n++){var a=$.extend(!0,{},t[n]),r=new interaction_view.model.Action(a);r.iview.render(),e.executeactions.push(r)}}}}),define("interaction_view/actionexecutes/clipboard/clipboard",function(){}),epub360.PlayerPlugins.push({type:"actionexecute",config:{type:505,exec:function(e,t,i){t.immediate(function(){var t=e.model.get("iDetail"),i=t.results[0],n=i.overlay;if(n){var a=interaction_view.getParentpage(n.page_id);if(a){var r=a.iOverlaylist.get(n.id);if(r){var o=interaction_view.expression.id2values(i.url),s=function(e){r.iview.$el.find("img").attr("src",e.toDataURL("image/png"))},l=$("<div></div>");if(l.qrcode({render:"canvas",text:o,width:r.iview.$el.find(".el_wrap").width(),height:r.iview.$el.find(".el_wrap").height()}),s(l.find("canvas")[0]),e.executeactions.length)for(var c=0;c<e.executeactions.length;c++){var d=e.executeactions[c];"onQrcodeSuccess"==d.attributes.iDetail.customType&&d.iview.executeAction(d.iview)}}}}},null,{debug:i})},setExecuteActions:function(e,t,i){i||(i={}),console.log(i),e.executeactions=[];for(var n=0;n<t.length;n++){var a=$.extend(!0,{},t[n]),r=new interaction_view.model.Action(a);r.iview.render(),e.executeactions.push(r)}}}}),define("interaction_view/actionexecutes/qrcode/qrcode",function(){}),epub360.PlayerPlugins.push({type:"action",config:{type:"gyroscope_change",func:function(e,t){console.log(t),e.view.overlaymodel.eventsHandle.push(e)}}}),define("interaction_view/actions/gyroscope/gyroscope",function(){}),epub360.PlayerPlugins.push({type:"action",config:{type:"customtypeaction",func:function(e,t){console.log(t),alert(t)}}}),define("interaction_view/actions/demo/demo",function(){}),epub360.PlayerPlugins.push({type:"action",config:{type:301,func:function(e,t){var i={page_id:e.view.page_id,overlay_id:e.view.overlay_id,layer_id:e.view.layer_id,func:e.func};t.init&&(i.type=301,i.condition=String(e.view.model.attributes.condition),i.title=e.view.model.attributes.iDetail.title||i.condition,e.view.model.attributes.iDetail.cond_id&&(i.cond_id=e.view.model.attributes.iDetail.cond_id),interaction_view.events.conditionEvents.push(i))}}}),define("interaction_view/actions/condition/condition",function(){}),epub360.PlayerPlugins.push({type:"action",config:{type:"anchor",func:function(e,t){var i={page_id:e.view.page_id,overlay_id:e.view.overlay_id,layer_id:e.view.layer_id,func:e.func,overlaymodel:e.view.overlaymodel};i.layer_id&&i.overlaymodel.iview.$el.closest(".layer-mask").attr("data-anchor",1),console.log("è¿›å…¥è§¦å‘çŠ¶æ€"),t.init&&(i.type="anchor",i.condition=String(e.view.model.attributes.condition),interaction_view.events.scrollEvents.push(i))}}}),define("interaction_view/actions/anchor/anchor",function(){}),epub360.PlayerPlugins.push({type:"action",config:{type:"onStartPlay",func:function(e,t){console.log(t);var i={page_id:e.view.page_id,overlay_id:e.view.overlay_id,layer_id:e.view.layer_id,func:e.func};t.init&&(i.type="onStartPlay",interaction_view.events.mediaEvents.push(i))}}}),define("interaction_view/actions/mediaaction/onstartplay",function(){}),epub360.PlayerPlugins.push({type:"action",config:{type:"onEnded",func:function(e,t){console.log(t);var i={page_id:e.view.page_id,overlay_id:e.view.overlay_id,layer_id:e.view.layer_id,func:e.func};t.init&&(i.type="onEnded",interaction_view.events.mediaEvents.push(i))}}}),define("interaction_view/actions/mediaaction/onended",function(){}),epub360.PlayerPlugins.push({type:"action",config:{type:"onRender",func:function(e,t){var i={page_id:e.view.page_id,overlay_id:e.view.overlay_id,layer_id:e.view.layer_id,func:e.func};t.init&&(i.type="onRender",i.title=e.view.model.attributes.iDetail.title,interaction_view.events.contentGridRenderEvents.push(i))}}}),define("interaction_view/actions/contentGrid/contentGrid",function(){}),epub360.PlayerPlugins.push({type:"action",config:{type:"onPaintStart",func:function(e,t){console.log(t),e.view.overlaymodel.paintStartEvents.push(e)}}}),define("interaction_view/actions/palette/palette",function(){}),define("interaction_view/model/main",["interaction_view/model/action","interaction_view/model/animation_view","interaction_view/model/audio","interaction_view/model/cycleimage","interaction_view/model/image","interaction_view/model/page","interaction_view/model/doc","interaction_view/model/preload","interaction_view/model/richtext","interaction_view/model/slide","interaction_view/model/video","interaction_view/model/button","interaction_view/model/pay","interaction_view/model/link","interaction_view/model/binding","interaction_view/model/Grid","interaction_view/model/Cell","interaction_view/model/TextLabel","interaction_view/model/TabBar","interaction_view/model/SearchInput","interaction_view/model/Tree","interaction_view/model/gallery","interaction_view/model/PageIndex","interaction_view/model/webcontent","interaction_view/model/shape","interaction_view/model/BookButton","interaction_view/model/dragdrop","interaction_view/model/dragdropgroup","interaction_view/model/variable","interaction_view/model/timer","interaction_view/model/vote","interaction_view/model/paragraph","interaction_view/model/input","interaction_view/model/textarea","interaction_view/model/selectbutton","interaction_view/model/submitbutton","interaction_view/model/selectbox","interaction_view/model/imageblock","interaction_view/model/weixincamera","interaction_view/model/weixinvoice","interaction_view/model/infoList","interaction_view/model/chartList","interaction_view/model/component","interaction_view/model/textbutton","interaction_view/model/collision","interaction_view/model/usersvg","interaction_view/model/avatar","interaction_view/model/avatarList","interaction_view/model/initButton","interaction_view/model/userList","interaction_view/model/infoForm","interaction_view/model/contactForm","interaction_view/model/plugin","interaction_view/model/select","interaction_view/model/systemvariable","interaction_view/model/qqvideo","interaction_view/model/MobileValid","interaction_view/components/staticlist","interaction_view/components/puzzle/puzzle","interaction_view/components/gyroscope/gyroscope","interaction_view/components/contentGrid/contentGrid","interaction_view/components/debug/debug","interaction_view/components/anchor/anchor","interaction_view/components/ShareVariable/ShareVariable","interaction_view/components/DataBinder/DataBinder","interaction_view/components/stategroup/stategroup","interaction_view/components/map/map","interaction_view/components/formview/formview","interaction_view/components/palette/palette","interaction_view/components/layerslide/layerslide","interaction_view/components/componentref/componentref","interaction_view/components/layerref/layerref","interaction_view/actionexecutes/cssanimateaction/cssanimateaction","interaction_view/actionexecutes/elementproperty/elementproperty","interaction_view/actionexecutes/datalist/datalist","interaction_view/actionexecutes/condition/condition","interaction_view/actionexecutes/state/state","interaction_view/actionexecutes/refresh/refresh","interaction_view/actionexecutes/uploadimage/uploadimage","interaction_view/actionexecutes/contentGrid/contentGrid","interaction_view/actionexecutes/palette/palette","interaction_view/actionexecutes/gyroscope/gyroscope","interaction_view/actionexecutes/pagescroll/pagescroll","interaction_view/actionexecutes/clipboard/clipboard","interaction_view/actionexecutes/qrcode/qrcode","interaction_view/actions/gyroscope/gyroscope","interaction_view/actions/demo/demo","interaction_view/actions/condition/condition","interaction_view/actions/anchor/anchor","interaction_view/actions/mediaaction/onstartplay","interaction_view/actions/mediaaction/onended","interaction_view/actions/contentGrid/contentGrid","interaction_view/actions/palette/palette"],function(){}),define("text!interaction_view/template/alertbox.js",[],function(){return'<div class="alert-box"><div class="alert-msg"><%=text%></div><div class="alert-title"><a class="alert-confirm" href="#">ç¡®å®š</a></div></div>'}),define("text!interaction_view/template/confirmbox.js",[],function(){return'<div class="alert-box confirm"><div class="alert-msg"><%=text%></div><div class="alert-title"><a class="alert-confirm button" href="#">ç¡®å®š</a><a class="alert-cancel button" href="#">å–æ¶ˆ</a></div></div>'}),define("interaction_view/ui/main",["jquery","backbone","text!interaction_view/template/message.js","text!interaction_view/template/alertbox.js","text!interaction_view/template/confirmbox.js"],function(){var e=require("text!interaction_view/template/message.js"),t=require("text!interaction_view/template/alertbox.js"),n=require("text!interaction_view/template/confirmbox.js"),a=document.createElement("DIV");return window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,window.cancelAnimationFrame=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelnimationFrame,{message:function(t,i,n){0==$("body").find(".msg").length&&$("body").append('<div class="msg"></div>'),n||(n=3e3),$(".msg").html(_.template(e,{type:t,msg:i})),$(".msg").fadeIn(),setTimeout(function(){$(".msg").fadeOut("slow"),$(".msg").remove()},n)},getRequest:function(e){var t=location.search,i={};if(-1!=t.indexOf("?")){var n=t.substr(1);strs=n.split("&");for(var a=0;a<strs.length;a++)i[strs[a].split("=")[0]]=unescape(strs[a].split("=")[1])}return e?i[e]:i},deviceType:function(){return"iPad"==navigator.userAgent.match(/iPad/i)?"iPad":"iPhone"==navigator.userAgent.match(/iPhone/i)?"iPhone":"Android"==navigator.userAgent.match(/Android/i)?"Android":"BlackBerry"==navigator.userAgent.match(/BlackBerry/i)?"BlackBerry":"null"},getModelById:function(e,t){var i=null;return e.icollection.each(function(e){e.id==t&&(i=e);var n=interaction_view.getModelById(e,t);n&&(i=n)}),i},model2collection:function(e,t){e.has(t)&&e.icollection.add(e.get(t))},model2tree:function(e,t,i){e.has(t)&&(e.icollection.add(e.get(t)),e.icollection.each(function(e){e.has(i)&&interaction_view.model2tree(e,i,i)}))},getPageIds:function(){var e=[];return $(".reveal").find("section").each(function(){e.push($(this).attr("id"))}),e},createPath:function(e){var t=[];return e.isSubOverlay?t=$.extend(!0,[],e.path):t.push({type:"page",id:e.page_id}),t.push({type:e.model.get("iType"),id:e.model.id}),e.layer_id&&t.push({type:"layer",id:e.layer_id}),t},hashPath:function(e){return _.pluck(e,"id").join("")},getContainerDivByPath:function(e){var t=$(".interaction-view");if(!e)return $(".interaction-view");for(i=0;i<e.length;i++)"page"==e[i].type?interaction_view.ipagelist.getPage(e[i].id)?t=$('.Presentation[id="'+e[i].id+'"]').find(".interaction-view").first():(interaction_view.imasterlist.get(e[i].id)||interaction_view.ibackgroundlist.get(e[i].id))&&(t=$('.Presentation[id="'+interaction_view.currentPage+'"]').find(".interaction-view").first()):t="layer"==e[i].type?t.find('div.layer-item[data-id="'+e[i].id+'"]').first():t.find('div.iView[id="'+e[i].id+'"]').first().children(".Element");return t},getContainerModelByPath:function(e){var t=null;for(i=0;i<e.length;i++)if(t="page"==e[i].type?interaction_view.getParentpage(e[i].id):"layer"==e[i].type?t.layer[e[i].id]:t.iOverlaylist.get(e[i].id),!t)return null;return t},formatLabel:function(e){var t,i="",n="",a="";return e.iPosition||(t="left"),1==e.iPosition&&(t="center"),2==e.iPosition&&(t="right"),void 0!=e.radius&&(i="border-top-left-radius:"+e.radius+"px; border-top-right-radius:"+e.radius+"px; border-bottom-right-radius:"+e.radius+"px; border-bottom-left-radius:"+e.radius+"px;"),void 0!=e.border_color&&e.border_size&&(n="border:"+e.border_size+"px solid "+e.border_color+";"),void 0!=e.bg_color&&(a="background-color:"+e.bg_color+";"),e.el?($(e.el).css({"font-size":e.font_size,color:e.text_color,"text-align":t}),void(i&&$(e.el).css("border-radius",e.radius+"px"))):'<p style="text-align:'+t+";font-size:"+e.font_size+"px;color:"+e.text_color+";"+i+n+a+'">'+e.text+"</p>"},getWebContentSrc:function(e){switch(e.contentType){case 0:if(e.iUrl){var t=-1!=e.iUrl.indexOf("http://")||-1!=e.iUrl.indexOf("https://")?e.iUrl:0==e.iUrl.indexOf("/")?e.iUrl:"http://"+e.iUrl;return window.location.protocol&&"https:"==window.location.protocol&&-1==t.indexOf("https")&&(t=t.replace("http","https")),{src:t,content:null}}return null;case 1:if(e.iFile&&e.iFile[0]&&e.iFile[0].file){if("undefined"==typeof cbt_data||interaction_view.forpreview)var t=e.iFile[0].file.replace(".zip","/");else var t=e.iFile[0].file.replace(".zip","/index.html");return window.location.protocol&&"https:"==window.location.protocol&&-1==t.indexOf("https")&&(t=t.replace("http","https")),{src:t,content:null}}return null;case 2:return e.iSource?{src:null,content:e.iSource}:null}},getMapUrl:function(e){if(window.location.host&&e.match(/^http[s]?:\/\/([^\/]+)\/.*$/)){var t=e.match(/^http[s]?:\/\/([^\/]+)\/.*$/)[1];e=e.replace(t,window.location.host)}return window.location.protocol&&"https:"==window.location.protocol&&-1==e.indexOf("https")&&(e=e.replace("http","https")),e},getAnimationPage:function(e,t){return interaction_view.getParentpage(e)?interaction_view.getParentpage(e):t},filterAnimations:function(e,t,i,n){var a=_.filter(e,function(e){var t=e.toJSON();return t.iTiming&&t.iTiming.waitaction&&!interaction_view.SinglePreview&&!n?!1:0==t.iKind&&t.iGroup_id&&!i?!1:t.isH5?!1:!0
});return a},preloadImg:function(e){var t=new Image;t.onload=function(){},t.src=e},drawImg:function(e,t,i,n){console.log(i);try{n.clearRect(0,0,2*e.canvas_width,2*e.canvas_height),n.drawImage(e.model.iImgs[i],0,0,2*e.canvas_width,2*e.canvas_height),this.onload=null}catch(a){console.log(a)}},getOverlays:function(e,t){var i=[];if(i=0==interaction_view.imasterlist.length?iMasterlist.at(0).overlaylist.models:interaction_view.imasterlist.at(0).iOverlaylist.models,interaction_view.currentPage==t)i=_.union(i,interaction_view.getAnimationPage(interaction_view.currentPage).iOverlaylist.models);else if(interaction_view.ilayerlist.get(t)){var n=interaction_view.getAnimationPage(interaction_view.currentPage).iOverlaylist.models.filter(function(e){return"LayerRef"==e.attributes.iType&&e.layer[t]});n&&n.length&&(i=_.union(i,n[0].layer[t].iOverlaylist.models))}return _.filter(i,function(t){return t.attributes.iType==e})},getVarsOp:function(e,t,i){"undefined"!=typeof t&&t&&t.length||(t=[0,1,2]),_.each(t,function(e,i){t[i]=String(e)});var n=_.filter(interaction_view.getOverlays("Variable",e),function(e){return _.include(t,String(e.attributes.iDetail.iKind))});n=_.union(n,interaction_view.getOverlays("Paragraph",e)),i&&(n=_.union(n,i));var a="@",r=/@/g,o=/\@[^\@]+\@/g,s=function(e){if(!c(e))return e;if("@å¾®ä¿¡_ç”¨æˆ·æ˜µç§°@"==e)return"undefined"!=typeof epub360_userinfo&&epub360_userinfo.nickname?epub360_userinfo.nickname:"@å¾®ä¿¡_ç”¨æˆ·æŽˆæƒ_æœªå¯ç”¨@";if("@åŠ©åŠ›_ç”¨æˆ·èº«ä»½@"==e)return"undefined"!=typeof epub360_userinfo&&epub360_userinfo.nickname?interaction_view.environment.Shareapp.usertype():"@åŠ©åŠ›_ç”¨æˆ·æŽˆæƒ_æœªå¯ç”¨@";if("@åŠ©åŠ›_åŠ©åŠ›æ•°@"==e)return"undefined"!=typeof epub360_userinfo&&epub360_userinfo.nickname?interaction_view.environment.Shareapp.total():"@åŠ©åŠ›_ç”¨æˆ·æŽˆæƒ_æœªå¯ç”¨@";if("@åŠ©åŠ›_æ˜¯å¦å‘èµ·@"==e)return 2==interaction_view.environment.Shareapp.status?1:0;var t;e=e.replace(r,"");var i=interaction_view.application.getFormFieldValue(e);if(null!=i)return i;if(ids=e.split("_"),ext=ids.length>1?ids[1]:"",ids.length>1&&["position","voted"].indexOf(ext)>-1?e=ids[0]:ext="",t=_.filter(n,function(t){return t.id==e}),t.length){var a=t[0],o=t[0].attributes.iDetail;if("Vote"==a.get("iType")){var s=parseInt(o.initial);return""==ext?s=a.get("value")||parseInt(o.initial):"position"==ext?s=a.get("position")||0:"voted"==ext&&(s=a.get("voted")||0),s}if("undefined"!=typeof o.initial)return String(o.initial);if("undefined"!=typeof o.iText){var l=String(t[0].iview.userContent||o.iText),d=l.replace(/<br>/g,"\n").replace(/<\/div><div>/g,"\n").replace("<div>","").replace("</div>","");return d}return String(t[0].get("suboverlays")[0].iDetail.iValue)}return"0"},l=function(e){var t=String(e),i=t.match(o);return _.each(i,function(e){t=t.replace(e,s(e))}),t},c=function(e){return e&&e[0]==a},d=function(e){var t=String(e),i=t.match(o);return i&&i.length?!0:!1};return{vars:n,var2val:function(e,t){var i=String(e),a=i.match(o);return n&&n.length||a?t?l(e):Number(s(e))||0:e},beginWithAT:c,hasAT:d}},getParentpage:function(e){return interaction_view.getPage(e)},getPageType:function(e){return interaction_view.imasterlist.length&&e.model.page.id==interaction_view.imasterlist.at(0).id?"master":interaction_view.ibackgroundlist.length&&e.model.page.id==interaction_view.ibackgroundlist.at(0).id?"background":"page"},getPageType2:function(e){return e.isMasterOverlay?"master":e.isBackgroundOverlay?"background":"page"},imageEditor:function(e,t,i,n,a,r){$(".reveal").addClass("noevents");var o,s;o=$.zoom?t*$.zoom:t,s=$.zoom?i*$.zoom:i;var l=e.iview.$el.children(".Element").offset(),c=$.zoom?l.left*$.zoom:l.left,d=$.zoom?l.top*$.zoom:l.top,h=_.isNaN(Number(e._rotate))?0:Number(e._rotate),u=_.isNaN(Number(e._scale))?1:Number(e._scale),p=_.isNaN(Number(e._x))?0:Number(e._x),v=_.isNaN(Number(e._y))?0:Number(e._y),g="rotate("+h+"deg) scale("+u+") skew(0deg) translate("+p+"px ,"+v+"px)";e.iview.$el.find("img").css({"-webkit-transform":g,width:"100%",height:"auto"}),interaction_view.imageEditorClear(),interaction_view.containment.append('<div class="editor_mask" style="opacity:0;"></div>'),interaction_view.containment.append('<div class="imageeditorcontainer"><div class="imageeditor" style="position:absolute;left:'+c+"px;top:"+d+"px;width:"+o+"px;height:"+s+'px;z-index:999999999;"><img src="'+n+'" style="width:100%;opacity:0;"></div></div>'),"undefined"!=typeof epub360&&epub360.settings&&["USER_FREE","USER_BASIC"].indexOf(epub360.settings.billing_type)>=0&&interaction_view.containment.append('<div style=" padding-bottom: 3px;display: inline-block;z-index: 999999999;position: absolute; bottom: 10px;  text-align: center; width: 100%;"><a href="http://www.epub360.com/?utm_source=epub360&amp;utm_medium=player&amp;utm_content=%E5%85%8D%E8%B4%B9%E6%8A%80%E6%9C%AF%E6%94%AF%E6%8C%81&amp;utm_campaign=loading" target="_blank" style="color: #c9c9c9;font-size: 14px;padding: 8px 14px;background: #a1a1a1;border-radius: 15px; -moz-border-radius: 15px;" class="advertise">Epub360.com æŠ€æœ¯æ”¯æŒ</a></div>'),interaction_view.containment.append('<div class="imageeditorbuttons"><button class="weixinbutton chooseimage"></button><button class="weixinbutton imageconfirm"></button></div>'),interaction_view.bindImageEditor($(".imageeditor").children("img"),h,u,p,v,e),$(".imageconfirm").on("click",function(){var e=$(".imageeditor").children("img").data();return a&&a(e.x||0,e.y||0,e.scale||1,e.rotate||0),interaction_view.imageEditorClear(),$(".reveal").removeClass("noevents"),!1}),$(".chooseimage").on("click",function(){return interaction_view.weixin.chooseimage(function(e){e&&(interaction_view.localIds=e,r(e[0]))}),!1}),setTimeout(function(){$(".imageeditorcontainer").on("click",function(e){if($(e.target).is(e.currentTarget)){var t=$(".imageeditor").children("img").data();a&&a(t.x||0,t.y||0,t.scale||1,t.rotate||0),interaction_view.imageEditorClear(),$(".reveal").removeClass("noevents")}})},500)},imageEditorClear:function(){$(".editor_mask").remove(),$(".imageeditorcontainer").remove(),$(".voiceeditor").remove(),$(".imageeditor-confirm").remove(),$(".weixinbutton").remove(),$(".advertise").remove(),$(".imageeditorbuttons").remove()},bindImageEditor:function(e,t,i,n,a,r){var o=!1,s=0,l=1;e.data({rotate:t,scale:i,x:n,y:a}),e.hammer().on("drag",function(e){if(!o){var s=n+e.gesture.deltaX,l=a+e.gesture.deltaY,c="rotate("+t+"deg) scale("+i+") skew(0deg) translate("+s+"px, "+l+"px)";r.iview.$el.find("img").css({transform:c,"-webkit-transform":c}),$(".imageeditorbuttons").hide(),e.gesture.preventDefault()}}),e.hammer().on("rotate",function(c){o=!0,l=c.gesture.scale;var d=i+(l-1);s=c.gesture.rotation;var h=t+s;e.data({scale:d,rotate:h,x:n,y:a});var u="rotate("+h+"deg) scale("+d+") skew(0deg) translate("+n+"px ,"+a+"px)";r.iview.$el.find("img").css({transform:u,"-webkit-transform":u}),$(".imageeditorbuttons").hide(),c.gesture.preventDefault()}),e.hammer().on("pinch",function(c){o=!0,l=c.gesture.scale;var d=i+(l-1);s=c.gesture.rotation;var h=t+s;e.data({scale:d,rotate:h,x:n,y:a}),$(".imageeditorbuttons").hide();var u="rotate("+h+"deg) scale("+d+") skew(0deg) translate("+n+"px ,"+a+"px)";r.iview.$el.find("img").css({transform:u,"-webkit-transform":u}),c.gesture.preventDefault()}),e.hammer().on("dragend",function(r){var c=r.gesture.deltaX,d=r.gesture.deltaY;o?(t+=s,i+=l-1,e.data({rotate:t,scale:i,x:n,y:a})):(n+=c,a+=d,e.data({rotate:t,scale:i,x:n,y:a})),s=0,l=1,o=!1,$(".imageeditorbuttons").show()})},imageUploader:function(e,t){wx.uploadImage({localId:e,success:function(e){var i=context_url+"uploadimage";_g.ajax.post({url:i,data:{serverid:e.serverId},callback:function(e){200==e.code?t&&t(e.data.results[0]):interaction_view.errorAlert(e.msg)}})},fail:function(){interaction_view.errorAlert("å›¾ç‰‡ä¸Šä¼ é”™è¯¯")}})},voiceEditor:function(e){$(".reveal").addClass("noevents"),interaction_view.weixin.voiceauth(),interaction_view.imageEditorClear(),interaction_view.containment.append('<div class="editor_mask" style="opacity:0;"></div>'),"undefined"!=typeof epub360&&epub360.settings&&["USER_FREE","USER_BASIC"].indexOf(epub360.settings.billing_type)>=0&&interaction_view.containment.append('<div style=" padding-bottom: 3px;display: inline-block;z-index: 999999999;position: absolute; bottom: 10px;  text-align: center; width: 100%;"><a href="http://www.epub360.com/?utm_source=epub360&amp;utm_medium=player&amp;utm_content=%E5%85%8D%E8%B4%B9%E6%8A%80%E6%9C%AF%E6%94%AF%E6%8C%81&amp;utm_campaign=loading" target="_blank" style="color: #c9c9c9;font-size: 14px;padding: 8px 14px;background: #a1a1a1;border-radius: 15px; -moz-border-radius: 15px;" class="advertise">Epub360.com æŠ€æœ¯æ”¯æŒ</a></div>'),interaction_view.containment.append('<div class="voiceeditor absolutecenter weixin-record">    <div class="voiceeditor-control">         <button class="voicebutton" id="playVoice" style="opacity:0;"></button>         <button class="voicebutton" id="startRecord"></button>         <div class="voicetext">æŒ‰ä½å½•éŸ³</div>         <button class="weixincancel"></button>         <button class="weixinconfirm"></button>    </div></div>'),interaction_view.bindVoiceEditor(),$(".weixinconfirm").on("click",function(){return interaction_view.imageEditorClear(),$(".reveal").removeClass("noevents"),e&&e(interaction_view.voicelocalId),!1}),$(".weixincancel").on("click",function(){return wx.stopRecord({success:function(){},fail:function(){}}),interaction_view.imageEditorClear(),$(".reveal").removeClass("noevents"),!1})},bindVoiceEditor:function(){var e=!1,t=function(){return interaction_view.voicelocalId?(wx.playVoice({localId:interaction_view.voicelocalId}),void window.setTimeout(function(){$("#playVoice").attr("id","stopVoice")},500)):void interaction_view.errorAlert("ä½ è¿˜æ²¡æœ‰å½•éŸ³å‘¢ï¼")};$(".weixin-record").on("touchstart","#startRecord",function(){return e=!0,wx.startRecord({success:function(){e?$("div.voicetext").html("æ­£åœ¨å½•éŸ³...."):wx.stopRecord({})},cancel:function(){interaction_view.errorAlert("å¼€å¯å¾®ä¿¡åŠŸèƒ½å¤±è´¥")}}),window.setTimeout(function(){$("#startRecord").attr("id","stopRecord")},100),!1}),$(".weixin-record").on("touchend","#stopRecord",function(){return wx.stopRecord({success:function(e){interaction_view.voicelocalId=e.localId,$("#playVoice").css("opacity",1),t()},fail:function(){interaction_view.errorAlert("å¾®ä¿¡å½•éŸ³å¤±è´¥")}}),window.setTimeout(function(){$("#stopRecord").attr("id","startRecord")},100),e=!1,$("div.voicetext").html("æŒ‰ä½å½•éŸ³"),!1}),$(".weixin-record").on("touchcancel","#stopRecord",function(){return wx.stopRecord({success:function(e){interaction_view.voicelocalId=e.localId,$("#playVoice").css("opacity",1),t()},fail:function(){interaction_view.errorAlert("å¾®ä¿¡å½•éŸ³å¤±è´¥")}}),window.setTimeout(function(){$("#stopRecord").attr("id","startRecord")},100),e=!1,!1}),$(".weixin-record").on("click","#playVoice",function(){return t(),!1}),$(".weixin-record").on("click","#stopVoice",function(){return interaction_view.voicelocalId?(wx.stopVoice({localId:interaction_view.voicelocalId}),window.setTimeout(function(){$("#stopVoice").attr("id","playVoice")},500),!1):void interaction_view.errorAlert("ä½ è¿˜æ²¡æœ‰å½•éŸ³å‘¢ï¼")}),wx.onVoicePlayEnd({complete:function(){$("#stopVoice").attr("id","playVoice")}}),wx.onVoiceRecordEnd({complete:function(e){interaction_view.voicelocalId=e.localId,$("#playVoice").css("opacity",1),t(),$("#stopRecord").attr("id","startRecord")}})},voiceUploader:function(e,t){wx.uploadVoice({localId:e,isShowProgressTips:1,success:function(e){var i=(e.serverId,context_url+"uploadvoice");_g.ajax.post({url:i,data:{serverid:e.serverId},callback:function(e){200==e.code?t&&t(e.data.results[0]):interaction_view.errorAlert(e.msg)}})}})},errorAlert:function(e){if(!interaction_view.containment.children(".alert_mask").length){interaction_view.containment.append('<div class="alert_mask"></div>');var i=_.template(t,{text:e});interaction_view.containment.append(i),interaction_view.containment.find(".alert-confirm").on("click",function(){return interaction_view.containment.find(".alert_mask").remove(),interaction_view.containment.find(".alert-box").remove(),!1})}},confirmBox:function(e,t){if(!interaction_view.containment.children(".alert_mask").length){interaction_view.containment.append('<div class="alert_mask"></div>');var i=_.template(n,{text:e});interaction_view.containment.append(i),interaction_view.containment.find(".alert-confirm").on("click",function(){return interaction_view.containment.find(".alert_mask").remove(),interaction_view.containment.find(".alert-box").remove(),t&&t(),!1}),interaction_view.containment.find(".alert-cancel").on("click",function(){return interaction_view.containment.find(".alert_mask").remove(),interaction_view.containment.find(".alert-box").remove(),!1})}},playbgsound:function(){if(interaction_view.bgsound){var e=interaction_view.bgsound;if(!e.hasPlayed){var t=e.iview.getdetail();e.media=audio,e.iview.$el.find(".status-play").addClass("status-pause").removeClass("status-play"),e.media.paused||(e.hasPlayed=!0),$("audio#bgsound").on("loadstart",function(){}).on("error",function(){}).on("timeupdate",function(){if(e.iview.slider){var t=e.media.currentTime,i=e.media.duration,n=100*_g.number.decimal(t/i,2);e.iview.onSliderChange(n)}}),$("audio#bgsound").on("ended",function(){if(t.iRepeat)_g.device.android()&&e.media.play();else{if(e.iview.slider&&e.iview.sliderstop(),0==e.media.seekable.length)return;try{}catch(i){}e.onAnimationStart&&(interaction_view.events.onAnimationEnd(e.onAnimationStart),e.onAnimationStart=null)}})}}},createLoop:function(e){var t=1e3*e.delay,i=17,n=0,a={};a.paused=!0,a._int=null;var r=0;return a.duration=function(){return e.duration},a.play=function(){a.paused=!1;var o=function(){a&&(a._int=requestAnimationFrame(o),n*i>=t?(console.log("play"),e.callback&&e.callback(),n=1,r=r+e.delay<=e.duration?r+e.delay:0):n+=1)};o()},a.pause=function(){a._int&&window.cancelAnimationFrame(a._int)},a.kill=function(){a._int&&(window.cancelAnimationFrame(a._int),a.paused=!0),a=null},a.time=function(){return r},a},renderLink:function(e,t){function i(){if(interaction_view.ismobile){var e=window.location.href;e=_g.changeURLPar(e,"return","1"),window.history.pushState({},"",e),window.location.href=n}else window.open(n,"_blank")}if(interaction_view.foredit)return void global.message("warning","è¯·ä½¿ç”¨é¢„è§ˆå…¨éƒ¨æ¨¡å¼é¢„è§ˆè¯¥åŠŸèƒ½");if(0==e&&t.page_id)interaction_view.ipagelist.getPage(t.page_id)&&presentation.gotopage(t.page_id,0);else{if(1==e&&t.url){if(!t.url)return;var n=t.url;if(0==n.indexOf("@"))return void window.open(n,"_blank");-1==n.indexOf("://")&&(n="http://"+n),window.location.href.indexOf("query_string")>0&&(n+=n.indexOf("?")>=0&&"&"+window.location.search.replace("?","")||window.location.search);var a=n.match(/\w+:\/\//);if(a&&-1==["https://","http://"].indexOf(n.match(/\w+:\/\//)[0]))return void(window.location.href=n);var r=interaction_view.evil_check(n);return 200!=r?414==r?void interaction_view.errorAlert('<div>è¯¥ç½‘å€è¢«è…¾è®¯ç”µè„‘ç®¡å®¶æ£€æµ‹ä¸ºå±é™©ï¼Œåœæ­¢è®¿é—®!</div><div class="url">'+n+"</div>"):void(wx_config.LOGO?interaction_view.confirmBox('<div>æ–°æ‰“å¼€ç½‘å€æ— æ³•ç¡®å®šæ˜¯å¦å®‰å…¨ï¼Œæ˜¯å¦ç»§ç»­è®¿é—®?</div><div class="url">'+n+"</div>",i):i()):void i()}if(2==e&&t.url){if(!interaction_view.ismobile)return;window.location="tel:"+t.url}}},setPos:function(e,t){var i=t.x,n=t.y,a=t.scale;if(interaction_view.ismobile&&"undefined"==typeof TweenMax){var r="transform";"transform"in document.documentElement.style||(r="webkitTransform");var o=e[0].style[r].match(/[,\(][^\,]+/g);void 0!=i&&void 0==n?n==parseFloat(o[5].substring(2)):void 0==i&&void 0!=n&&i==parseFloat(o[4].substring(2)),void 0!=i&&void 0!=n&&(o.pop(),o.pop(),e[0].style[r]="matrix"+temp2.join("")+", "+i+", "+n+")"),void 0!=a&&"undefined"!=typeof TweenMax&&TweenMax.set(e,{scale:a})}else(void 0!=i||void 0!=n)&&TweenMax.set(e,t),void 0!=a&&TweenMax.set(e,{scale:a})},renderScroll:function(e){e.pullUpInfo||(e.pullUpInfo="ä¸Šæ‹‰åŠ è½½æ›´å¤š"),e.pullDownInfo||(e.pullDownInfo="é‡Šæ”¾æ›´æ–°");var t=e.view,i=(e.containment,0);e.mask_width=$(e.containment).outerWidth(),e.container_height=$(e.containment).outerHeight(),e.content_width=$(e.contentel).outerWidth(),e.content_height=$(e.contentel).outerHeight(),$(e.contentel).height(e.container_height%2?e.content_height-1:e.content_height),e.maskel||($(e.contentel).parent(".info_content").length&&($(e.contentel).siblings(".pullDown").remove(),$(e.contentel).siblings(".pullUp").remove(),$(e.contentel).unwrap(".info_content")),e.maskel=$('<div class="info_content" style="padding:0;"></div>'),$(e.contentel).wrap(e.maskel),e.pullDown&&$(e.contentel).before('<div class="pullDown" style="position:relative;margin-top: -38px;height: 38px;color:#999;text-align: center;font-size: 12px;">ä¸‹æ‹‰åˆ·æ–°</div>'),e.pullUp&&$(e.contentel).after('<div class="pullUp" style="text-align: center;font-size: 12px; color:#999;height:18px;clear:both; display:none;">ä¸Šæ‹‰åŠ è½½æ›´å¤š</div>'),e.maskel.height(e.content_height),e.mask_height=e.content_height),e.mask_height<=e.container_height&&(e.mask_height=e.container_height+1),t&&t.scrollview&&t&&t.scrollview&&t.scrollview.iScroll.destroy(),$(e.containment).addClass("iMouseWheel disableMouseWheelY disableDragY");var n=e.content_height-e.container_height,a=new _g.scrollview({containment:e.containment,contentel:e.maskel,mask_width:e.mask_width,mask_height:e.container_height,content_width:e.content_width,content_height:e.mask_height,content_x:0,content_y:e.content_y||0,scrollY:!0,onScrolling:function(t){if(t.deltaY>0&&$(e.containment).find(".pullUp").first().hide(),t.deltaY<-5-n&&e.pullUp&&$(e.containment).find(".pullUp").first().show(),e.autoload_more&&-t.deltaY>=n||-t.deltaY>n+30)e.pullUp?(i=1,$(e.containment).find(".pullUp").first().text(e.pullUpInfo)):(i=0,$(e.containment).addClass("is_exceededY"),$(e.containment).removeClass("disableDragY iMouseWheel disableMouseWheelY"));else{if(!(t.deltaY>30))return e.pullUp&&$(e.containment).find(".pullUp").text(e.pullUpInfo),void(e.pullDown&&$(e.containment).find(".pullDown").text(e.pullDownInfo));e.pullDown?(i=2,$(e.containment).find(".pullDown").first().text(e.pullDownInfo)):i=0}},onScrollend:function(){1==i?e.onPullUp&&e.onPullUp():2==i&&e.onPullDown&&e.onPullDown(),i=0,$(e.containment).removeClass("is_exceededY"),$(e.containment).find(".pullUp").hide()}});t&&(t.scrollview=a),$(e.containment).addClass("hascontrols")},setRandom:function(e){if(e.iRepeatable){e.usedRandom||(e.usedRandom=[]),this.isUseup(e);var t;do t=this.getRandom(e);while(_.contains(e.usedRandom,t));return e.usedRandom.push(t),t}return this.getRandom(e)},isUseup:function(e){(!e.randlist&&e.usedRandom.length>=e.range[1]-e.range[0]+1||e.randlist&&e.usedRandom.length>=e.randlist.length)&&(e.usedRandom=[])},getRandom:function(e){return e.randlist?e.randlist[_.random(0,e.randlist.length-1)]:_.random(e.range[0],e.range[1])},getImgSrc:function(e){var t=e.find(".image_wrap img");if(t.length)return t.attr("src");var i=e.find(".image_wrap").css("background-image"),n=i.substring(4,i.length-1);return n.replace(/"/g,"")},parseVar:function(e){if(_.isNaN(Number(e))){var t=$("<input type='text' />");t.val(e),e="'"+t.val()+"'",t.remove()}else{var i=Number(e);if(i>0&&e[0]&&"0"===e[0]){var t=$("<input type='text' />");t.val(e),e="'"+t.val()+"'",t.remove()}else e=i}return e},evil_check:function(e){var t=200;return e?($.ajax({type:"POST",url:portal_url+"checkguanjia/",data:{url:e},async:!1,contentType:"application/json",dataType:"json",crossDomain:!0,success:function(e){200!=e.code&&201!=e.code&&(t=e.code)},error:function(){t=200}}),t):200},getPageElement:function(e,t){if("string"!=typeof e)return e.iOverlaylist.get(t);var i=interaction_view.getPage(e);return i?i.iOverlaylist.get(t):null},getPage:function(e){if("string"!=typeof e)return e;var t;return t=interaction_view.ipagelist.getPage(e)?interaction_view.ipagelist.getPage(e):interaction_view.imasterlist.get(e)||interaction_view.ibackgroundlist.get(e),!t&&"undefined"!=typeof configpage&&configpage.page&&configpage.page.id==e?configpage.page:t},_setXY:function(){},_setRotate:function(){},getTransform:function(){},setTransform:function(){},_checkPropPrefix:function(e,t){t=t||a;var i,n,r=t.style;if(void 0!==r[e])return e;for(e=e.charAt(0).toUpperCase()+e.substr(1),i=["O","Moz","ms","Ms","Webkit"],n=5;--n>-1&&void 0===r[i[n]+e];);return n>=0?(_prefix=3===n?"ms":i[n],_prefixCSS="-"+_prefix.toLowerCase()+"-",_prefix+e):null},_getXY:function(e){e=e[0]?e[0]:e;var t=interaction_view.TransformPrefix,i=new WebKitCSSMatrix(e.style[t]);return{x:i.e,y:i.f}},_getmatrix:function(e,t,i,n){var a=Math.round(180*Math.asin(e)/Math.PI),r=Math.round(180*Math.acos(t)/Math.PI),o=Math.round(180*Math.asin(i)/Math.PI),s=Math.round(180*Math.acos(n)/Math.PI),l=0;return a==r||-a==r?l=s:-a+r==180?l=180+o:a+r==180&&(l=360-o||360-s),l>=360?0:l},_getRotation:function(e){e=e[0]?e[0]:e;var t=interaction_view.TransformPrefix,i=new WebKitCSSMatrix(e.style[t]);console.log(i);var n=Math.PI;return{x:Math.acos(i.a)*(180/n),y:Math.asin(i.b)*(180/n)}},_setSize:function(){},_setXY:function(){},_setRotation:function(){},isEvilCode:function(e){return"string"==typeof e&&e.match(/\$\./g)?(console.log(e),""):e}}}),define("text!interaction_view/template/pagenumber.js",[],function(){return'<%if(presentation.getPageNumber().horizontal_count>1){ %>\n<nav class="iView master nav-horizen pagenumber" style="position:absolute;left:<%=pageno_horizontal.x%>px;top:<%=pageno_horizontal.y%>px;<%=pageno_horizontal.show?"":"display:none;"%>">\n    <%for(i=0;i<presentation.getPageNumber().horizontal_count;i++){%><li class="<%=Reveal.getIndices().h==i?"active":""%>"><a href="#" data-index="<%=i%>"></a></li><% } %>\n</nav>\n<% } %>\n<%if(presentation.getPageNumber().vertical_count>1){ %>\n<nav class="iView master nav-vertical pagenumber" style="position:absolute;left:<%=pageno_vertical.x%>px;top:<%=pageno_vertical.y%>px;<%=pageno_vertical.show?"":"display:none;"%>">\n    <%for(i=0;i<presentation.getPageNumber().vertical_count;i++){%><li class="<%=Reveal.getIndices().v==i?"active":""%>"><a href="#" data-index="<%=i%>"></a></li><% } %>\n</nav>\n<% } %>'}),define("interaction_view/ui/presentation",["_g/ui","text!interaction_view/template/pagenumber.js"],function(){var e=require("text!interaction_view/template/pagenumber.js"),t={masterPageReset:function(){interaction_view.imasterlist.length&&interaction_view.imasterlist.at(0).iOverlaylist.each(function(e){_.include(["Grid","PageIndex","Gallery"],e.get("iType"))&&e.iview.resetOtherStatus()})},preloadpageAudio:function(){interaction_view.ismobile&&interaction_view.imasterlist.at(0).iOverlaylist.each(function(e){"Audio"==e.get("iType")&&e.media&&(e.hasPlayed||e.get("iDetail").iAutoplay&&(e.media&&e.media.paused&&interaction_view.media.play(e),e.hasPlayed=!0))})},play:function(e){var i=null;if(i="string"==typeof e?interaction_view.getParentpage(e):e,!i.isLayer&&"page"==i.get("type")){if(1==interaction_view.environment.Shareapp.status)return void(interaction_view.environment.Shareapp.waitpage=i.id);interaction_view.environment.Shareapp.waitpage==i.id&&(interaction_view.environment.Shareapp.waitpage="")}"Page"==interaction_view.mode&&!i.isLayer&&interaction_view.ipagelist.getPage(i.id)&&(t.setBackgroundDisplay(i),"undefined"!=typeof ScrollPage&&ScrollPage.bindScrollPage(interaction_view.currentPage)),1==i.playFinished&&(i.iOverlaylist.resetViewStatus(),i.iOverlaylist.resetBindings(),i.iAnimationlist.resetAnimationStatus(),i.playFinished=!1),i.iOverlaylist.each(function(e){i.playFinished||e._reset&&e.iview.resetStatus(),e.media&&(e.autoplay?interaction_view.ismobile&&e.get("isBgsound")?"undefined"==typeof bgsound_id&&(interaction_view.media.play(e),e.media.paused||(e.hasPlayed=!0)):(interaction_view.media.play(e,{autoplay:!0}),e.media.paused||(e.hasPlayed=!0)):("Video"==e.get("iType")||"QQVideo"==e.get("iType"))&&(e.get("iDetail").iHidden||(e.notallowed=!0,e.iview.$el.removeClass("hide"),e.iview.$el.css("opacity",1),e.control&&e.iview.$el.find("video").css("display","block"),e.hided=!1))),e.renderWebContent&&e.iview.renderWebContent(),e.iview.immediateRender&&e.iview.immediateRender()}),i.played=!1,interaction_view.events.clearWaitClick(),interaction_view.events.clearAnimationWaitSwipe(),i.iAnimationlist.setParams(),i.iAnimationlist.css_timeline&&i.iAnimationlist.css_timeline.play(),i.iAnimationlist.setPlay(),i.playFinished=!0,"Page"!=interaction_view.mode||interaction_view.masterplayed||i.isLayer||(interaction_view.masterplayed=!0,interaction_view.imasterlist.length&&interaction_view.play(interaction_view.imasterlist.at(0))),"Page"!=interaction_view.mode||interaction_view.backgroundplayed||i.isLayer||(interaction_view.backgroundplayed=!0,interaction_view.ibackgroundlist.length&&interaction_view.play(interaction_view.ibackgroundlist.at(0))),i.isLayer?interaction_view.events.onPageStart(i.iOverlaylist.pageid,i.iOverlaylist.layerid):interaction_view.events.onPageStart(i.id),interaction_view.events.onControllerEvent(i.id),"Page"==interaction_view.mode&&!i.isLayer&&interaction_view.ipagelist.getPage(i.id)&&t.setMasterDisplay(i),i.iAnimationlist.timeline&&i.iAnimationlist.timeline.play(0,!1),i.iOverlaylist.each(function(e){switch(e.get("iType")){case"LayerRef":case"LayerSlide":case"ComponentRef":e.iview.playLayer();break;case"Timer":e.iview.resetTimer();break;case"Vote":e.iview.triggerVoted();break;case"Variable":case"SystemVariable":e.iview.triggerVarChange()}e._autoplay&&e.iview._autoplay(),e.iview.onPlay&&e.iview.onPlay()})},pause:function(e){var t;t="string"==typeof e?interaction_view.ipagelist.getPage(e):e,t.playFinished&&t.iAnimationlist.timeline&&t.iAnimationlist.timeline.pause()},continuePlay:function(e){var t;t="string"==typeof e?interaction_view.ipagelist.getPage(e):e,t.playFinished&&t.iAnimationlist.timeline&&t.iAnimationlist.timeline.play()},stop:function(e){var t;t="string"==typeof e?interaction_view.ipagelist.getPage(e):e,t.playFinished&&(t.iAnimationlist.timeline&&(t.iAnimationlist.timeline.pause(0),t.iOverlaylist.resetViewStatus(),"string"==typeof e&&$(".interaction-view").css("cursor","auto"),interaction_view.bezierPatch(e)),t.iAnimationlist.css_timeline&&t.iAnimationlist.css_timeline.stop(),t.iActionlist.each(function(e){e.iview.timeline&&e.iview.timeline.pause(1e-5)}),t.iOverlaylist.each(function(e){e.media&&(e.iview.resetOtherStatus(),("Video"==e.iview.iType||"QQVideo"==e.iview.iType)&&(interaction_view.isAndroid&&interaction_view.media.pause(e),e.iview.$el.addClass("hide"))),("LayerRef"==e.iview.iType||"LayerSlide"==e.iview.iType||"ComponentRef"==e.iview.iType)&&e.iview.stoplayer(),("LayerRef"==e.iview.iType||"Image"==e.iview.iType||"ImageBlock"==e.iview.iType)&&e.iview.renderMask(),("Slide"==e.iview.iType||"LayerSlide"==e.iview.iType||"CycleImage"==e.iview.iType)&&e.iview.timeline&&e.iview.timeline.pause(1e-5),"Timer"==e.iview.iType&&e.iview.stopTimerSimple(),e.renderWebContent&&e.iview.clearWebContent(),e.iview.onStop&&e.iview.onStop()})),"string"==typeof e&&(t.iview.$el.hasClass("dragConnector")&&connector.clearDragController(t.iview.$el),interaction_view.events.onPageStopClear(e))},getPageNumber:function(){var e=Reveal.getVerticalLength(),t=Reveal.getHorizontalLength();return{vertical_count:e,horizontal_count:t}},setMasterDisplay:function(e){t.setPageNumber(e),interaction_view.show_master=e.get("show_master")?!0:!1;var i=$('.Presentation[id="'+e.id+'"]').find(".interaction-view");interaction_view.touchview&&(i=$(".reveal")),interaction_view.show_master||"Master"==interaction_view.mode?i.children(".iView.master").removeClass("masterhide"):i.children(".iView.master").addClass("masterhide"),t.masterPageReset(e)},setBackgroundDisplay:function(e){interaction_view.show_background=e.get("show_background")?!0:!1;var t=$('.Presentation[id="'+e.id+'"]').find(".interaction-view");interaction_view.touchview&&(t=$(".reveal")),interaction_view.show_background||"Background"==interaction_view.mode?t.children(".iView.background").removeClass("backgroundhide"):t.children(".iView.background").addClass("backgroundhide")},setPageNumber:function(i){var n=$('.Presentation[id="'+i.id+'"]').find(".interaction-view");interaction_view.touchview&&(n=$(".reveal")),"Master"!=interaction_view.mode&&"Page"!=interaction_view.mode||!interaction_view.imasterlist.length||(n.children(".iView.master.pagenumber").remove(),n.append(_.template(e,interaction_view.imasterlist.at(0).toJSON())),t.setPageNumberPosition())},setPageNumberPosition:function(){$("nav.pagenumber").each(function(){$(this).css({left:$(this).position().left-$(this).outerWidth(!1)/2,top:$(this).position().top-$(this).outerHeight(!1)/2})})},bezierPatch:function(e){var t;t="string"==typeof e?interaction_view.ipagelist.getPage(e):e,t.iAnimationlist.each(function(e){_.include([301,302],e.get("iType"))&&e.toJSON().iDetail.autoRotate&&TweenMax.set(e._animation.obj,{rotation:"0_cw"})})},startLoad:function(){t.pagesForLoad=[],interaction_view.imasterlist&&interaction_view.imasterlist.length&&t.pagesForLoad.push(interaction_view.imasterlist.at(0).id),interaction_view.ibackgroundlist&&interaction_view.ibackgroundlist.length&&t.pagesForLoad.push(interaction_view.ibackgroundlist.at(0).id),_.each(interaction_view.ipagelist.getPages(),function(e){t.pagesForLoad.push(e.id)}),interaction_view.iconfiglist&&interaction_view.iconfiglist.length&&t.pagesForLoad.push(interaction_view.iconfiglist.at(0).id),t.pagelength=t.pagesForLoad.length;var e;if(!interaction_view.forpreview||"Layer"!=interaction.doc.mode&&"Background"!=interaction.doc.mode){if(interaction_view.imasterlist&&interaction_view.imasterlist.length||interaction_view.ibackgroundlist&&interaction_view.ibackgroundlist.length){if(interaction_view.imasterlist&&interaction_view.imasterlist.length&&(e=interaction_view.imasterlist.at(0)),interaction_view.ibackgroundlist&&interaction_view.ibackgroundlist.length){var i=interaction_view.ibackgroundlist.at(0);i.iview.prepareLoad(),i.iview.startLoad(),i.isStartLoad=!0}}else e=interaction_view.ipagelist.at(0);if(interaction_view.iconfiglist&&interaction_view.iconfiglist.length){var n=interaction_view.iconfiglist.at(0);n.iview.prepareLoad(),n.iview.startLoad(),n.isStartLoad=!0}}else e=interaction_view.imasterlist&&interaction_view.imasterlist.length?interaction_view.imasterlist.at(0):interaction_view.ipagelist.at(0);e.iview.prepareLoad(),e.iview.startLoad(),e.isStartLoad=!0},pagesForLoad:[],pageLoadEvent:function(){},pageLoad:function(e){var i=interaction_view.ipagelist.getPage(e);i.isStartLoad||i.get("loaded")?interaction_view.ismobile&&t.pagePreloadCenter(e):(i.iview.prepareLoad(),i.iview.startLoad(),i.isStartLoad=!0)},bookStatus:0,foredit:function(){},forpreview:function(){interaction_view.mode="Page",interaction_view.events.clearAll(),$("body").children("preloader").remove(),$("body").append('<div id="preloader"></div>'),interaction_view.forpreview||$("body").prepend('<div class="loading progress progress-striped active"><div class="bar" style="width: 0%;"></div></div>'),interaction_view.finishPagePreload=function(e,i){if(t.pagesForLoad=_.reject(t.pagesForLoad,function(t){return t==e}),i||(i=interaction_view.ipagelist.getPage(e)||interaction_view.imasterlist.get(e)||interaction_view.ibackgroundlist.get(e)),interaction_view.donext(i),i.set("loaded",!0,{silent:!0}),(0==t.pagesForLoad.length||t.pagelength-t.pagesForLoad.length>=1)&&(0==interaction_view.imasterlist.length||interaction_view.imasterlist.at(0).get("loaded"))&&(0==interaction_view.ibackgroundlist.length||interaction_view.ibackgroundlist.at(0).get("loaded"))){var n="undefined"!=typeof configpage&&configpage.page&&configpage.page.get("loaded"),a="undefined"!=typeof configpage&&configpage.page;(!a||n)&&(interaction_view.preloadended||(interaction_view.preloadended=!0),n&&t.play(configpage.page))}if("wait"==interaction_view.playstatus&&interaction_view.preloadended){var r=interaction_view.ipagelist.getPage(interaction_view.currentPage);r.get("loaded")&&(interaction_view.playstatus="play",interaction_view.containment.children(".prejsloading").length?(clear_loading_progress_waiting=clear_loading_progress_waiting||200,200>=clear_loading_progress_waiting&&(clear_loading_progress_waiting=100),60>loading_progress_percent?(200>=clear_loading_progress_waiting&&(loading_progress_percent=66),window.loading_progress_timer1=setInterval(function(){compute_loadding_progress(),set_loading_progress()
},clear_loading_progress_waiting)):(loading_progress_percent=100,set_loading_progress(),clearInterval(loading_progress_timer),workEnd("-------- 3. presentation : start clear loading 1 --------"),interaction_view.containment.children(".prejsloading").fadeOut(800,function(){interaction_view.containment.children(".prejsloading").remove(),interaction_view.play(interaction_view.currentPage),workEnd("-------- 3. presentation : start clear loading 1 --------"),window.loadAnalytics&&loadAnalytics()}))):(interaction_view.containment.children("#jswait-loading").remove(),interaction_view.play(interaction_view.currentPage)))}else if(interaction_view.preloadended&&interaction_view.transitionPagePreLoad&&e==interaction_view.transitionPagePreLoad.page_id){var o=interaction_view.transitionPagePreLoad.transition;interaction_view.transitionPagePreLoad=null,t.gotopage(e,o)}if(0==t.pagesForLoad.length?$(".loading").remove():interaction_view.ismobile||interaction_view.ipagelist.getPage(t.pagesForLoad[0])&&t.pageLoad(t.pagesForLoad[0]),interaction_view.ismobile)if(t.isFirstPageLoading){if(e==t.isFirstPageLoading&&(t.firstpageloaded=!0),t.firstpageloaded&&interaction_view.imasterlist.at(0).get("loaded")&&interaction_view.ibackgroundlist.at(0).get("loaded")){var s=t.isFirstPageLoading;t.isFirstPageLoading=null,t.preloadFourDirections(),t.pagePreloadCenter(s)}}else t.pagePreloadCenter(e)},interaction_view.setPreloadStatus=function(){var e=0,t=0;_.each(interaction_view.ipagelist.getPages(),function(i){t+=i.ipreloadlist.length,i.ipreloadlist.length>0&&(e+=i.ipreloadlist.where({loaded:!0}).length)}),interaction_view.imasterlist.length&&(t+=interaction_view.imasterlist.at(0).ipreloadlist.length,interaction_view.imasterlist.at(0).ipreloadlist.length>0&&(e+=interaction_view.imasterlist.at(0).ipreloadlist.where({loaded:!0}).length)),interaction_view.ibackgroundlist.length&&(t+=interaction_view.ibackgroundlist.at(0).ipreloadlist.length,interaction_view.ibackgroundlist.at(0).ipreloadlist.length>0&&(e+=interaction_view.ibackgroundlist.at(0).ipreloadlist.where({loaded:!0}).length)),$(".loading").children("div").css("width",String(e/t*100)+"%")},interaction_view.donext=function(e){e.iview.afterpreload()},interaction_view.play=t.play,interaction_view.stopPlay=t.stop,interaction_view.pausePlay=t.pause,interaction_view.continuePlay=t.continuePlay,interaction_view.bezierPatch=t.bezierPatch,interaction_view.slideChange=function(e){if(Reveal&&("number"==typeof e&&Reveal.slide(e),"string"==typeof e)){var t=interaction_view.getModelById(interaction_view.iChapter,e);Reveal.slide(t.get("index"))}},interaction_view.firstPlay=!0},screencontrol:function(){window.isFullscreen=!1,window.screenLock=!1,window.screenAutoAdapt=function(){if(!window.screenLock)if(screenfull.isFullscreen){isFullscreen=!0;var e=window.screen.width/window.screen.height>=interaction_view.size.x/interaction_view.size.y?window.screen.height/interaction_view.size.y:window.screen.width/interaction_view.size.x;_g.ui.scale(".reveal",e)}else isFullscreen=!1,_g.ui.scale(".reveal",1)},!interaction_view.ismobile&&(screenfull.onchange=screenAutoAdapt)},gotopagebyargs:function(e,i){var n=null;if(_.isNumber(e)&&!_.isNaN(e))n=interaction_view.ipagelist.getPages()[e]?interaction_view.ipagelist.getPages()[e].id:null;else if(_.include(["first","last","prev","next"],e))switch(e){case"first":n=Reveal.getFirst();break;case"last":n=Reveal.getLast();break;case"prev":n=Reveal.getPrev();break;case"next":n=Reveal.getNext()}else n=e;n&&t.gotopage(n,i||0)},gotopage:function(e,i){interaction_view.transitionPagePreLoad=null;var n,a,r,o,s=null;if(e!=interaction_view.currentPage){switch(i){case 0:r=0,a="y",n="up",o=1;break;case 1:r=0,a="x",n="right",o=-1;break;case 2:r=0,a="y",n="down",o=-1;break;case 3:r=0,a="x",n="left",o=1;break;case 4:r=1,a="y",n="up",o=1;break;case 5:r=1,a="x",n="right",o=-1;break;case 6:r=1,a="y",n="down",o=-1;break;case 7:r=1,a="x",n="left",o=1;break;case 8:r=2,a="x",n="left",o=1;break;case 10:r=3,a="y",n="up",o=1;break;case 11:r=3,a="x",n="right",o=-1;break;case 12:r=3,a="y",n="down",o=-1;break;case 13:r=3,a="x",n="left",o=1;break;case 14:r=4,a="y",n="up",o=1;break;case 15:r=4,a="x",n="right",o=-1;break;case 16:r=4,a="y",n="down",o=-1;break;case 17:r=4,a="x",n="left",o=1;break;case 18:r=5,a="y",n="up",o=1;break;case 19:r=5,a="x",n="right",o=-1;break;case 20:r=5,a="y",n="down",o=-1;break;case 21:r=5,a="x",n="left",o=1}if(interaction_view.ipagelist.getPage(e)){var l=interaction_view.ipagelist.getPage(e);if(0==interaction_view.doc.toJSON().play_mode?indexh=interaction_view.ipagelist.indexOf(l):(l.icollection.length&&(l=l.icollection.at(0)),indexh=l.collection.parent.collection.indexOf(l.collection.parent),s=l.collection.indexOf(l)),!l.get("loaded"))return interaction_view.transitionPagePreLoad={page_id:e,transition:i},void t.pageLoad(e);if(Reveal.lockAction=!0,9==i)return void Reveal.slide(indexh,s);Reveal.setSingleSlideItem(indexh,s,n),Reveal.originh=Reveal.indexh,Reveal.originv=Reveal.indexv,Reveal.indexh=indexh,null!=s&&(Reveal.indexv=s),Reveal.transition.autostart(r,a,o)}}},preloadFourDirections:function(){t.touchPreloadPageList=[];var e=Reveal.getSlideDirections();e.left?t.touchPreloadPageList.push(Reveal.getLeft()):interaction_view.control.getGroupLeft(Reveal.getCurrentSlideId())&&t.touchPreloadPageList.push(interaction_view.control.getGroupLeftId(Reveal.getCurrentSlideId())),e.right?t.touchPreloadPageList.push(Reveal.getRight()):interaction_view.control.getGroupRight(Reveal.getCurrentSlideId())&&t.touchPreloadPageList.push(interaction_view.control.getGroupRightId(Reveal.getCurrentSlideId())),3==Reveal.slideType&&(e.up&&t.touchPreloadPageList.push(Reveal.getUp()),e.down&&t.touchPreloadPageList.push(Reveal.getDown())),t.touchPreloadPageList.length&&t.pagePreloadCenter()},clearPreloadPages:function(){t.touchClearPageList=[];for(var e=Reveal.getAllSlideIds(),i=0;i<e.length;i++){var n=e[i];n!=Reveal.getLeft()&&n!=Reveal.getRight()&&n!=Reveal.getUp()&&n!=Reveal.getDown()&&n!=Reveal.getCurrentSlideId()&&n!=interaction_view.control.getGroupRightId(Reveal.getCurrentSlideId())&&n!=interaction_view.control.getGroupLeftId(Reveal.getCurrentSlideId())&&t.touchClearPageList.push(n)}t.touchClearPageList.length&&t.pageClearCenter()},pagePreloadCenter:function(e){if(e&&(t.touchPreloadPageList=_.reject(t.touchPreloadPageList,function(t){return t==e})),t.touchPreloadPageList.length){var i=t.touchPreloadPageList[0];t.pageLoad(i)}},pageClearCenter:function(e){if(e&&(t.touchClearPageList=_.reject(t.touchClearPageList,function(t){return t==e})),t.touchClearPageList.length){var i=interaction_view.ipagelist.getPage(t.touchClearPageList[0]);i.iview.clearPageLoad()}},touchPreloadPageList:[],touchClearPageList:[]};window.presentation=t}),define("interaction_view/ui/control",[],function(){var e={bindArrowControls:function(){Reveal.setNavigateFuncs({navigateLeft:e.slideLeft,navigateRight:e.slideRight})},slideUp:function(){Reveal.up()},slideDown:function(){Reveal.down()},slideLeft:function(){var t=Reveal.getCurrentSlide().id,i=e.getLeft(t);i&&e.slideTo(i.id)},slideRight:function(){var t=Reveal.getCurrentSlide().id,i=e.getRight(t);i&&e.slideTo(i.id)},getGroupLeft:function(e){if(3!=Reveal.slideType)return null;var t=interaction_view.ipagelist.getPage(e);if(!t)return null;var i=(t.get("group"),t.collection.parent),n=interaction_view.ipagelist.at(interaction_view.ipagelist.indexOf(i)-1);if(n){var a=n.icollection.at(0);return a}return null},getGroupRight:function(e){if(3!=Reveal.slideType)return null;var t=interaction_view.ipagelist.getPage(e);if(!t)return null;var i=(t.get("group"),t.collection.parent),n=interaction_view.ipagelist.at(interaction_view.ipagelist.indexOf(i)+1);if(n){var a=n.icollection.at(0);return a}return null},getGroupLeftId:function(e){var t=interaction_view.control.getGroupLeft(e);return t?t.id:null},getGroupRightId:function(e){var t=interaction_view.control.getGroupRight(e);return t?t.id:null},getRight:function(e){var t=interaction_view.ipagelist.getPage(e),i=t.get("group"),n=t.collection.parent,a=interaction_view.ipagelist.at(interaction_view.ipagelist.indexOf(n)+1);if(a){var r=a.icollection.at(0),o=r.get("group");return i!=o?!1:r}return!1},getLeft:function(e){var t=interaction_view.ipagelist.getPage(e),i=t.get("group"),n=t.collection.parent,a=interaction_view.ipagelist.at(interaction_view.ipagelist.indexOf(n)-1);if(a){var r=a.icollection.at(0),o=r.get("group");return i!=o?!1:r}return!1},getCurrent:function(){},slideTo:function(e){var t=interaction_view.ipagelist.getPage(e);indexh=t.collection.parent.collection.indexOf(t.collection.parent),indexv=t.collection.indexOf(t),Reveal.slide(indexh,indexv)}};return e}),function(){var e={addEvent:function(e,t,i,n){e.addEventListener?e.addEventListener(t,i,!!n):$(e).on(t,i)},removeEvent:function(e,t,i,n){e.removeEventListener?e.removeEventListener(t,i,!!n):$(e).off(t,i)},document:{disable_contextmenu:function(e){e||(e=document),e.oncontextmenu=function(e){return e&&e.preventDefault(),!1}},enable_contextmenu:function(e){e||(e=document),e.oncontextmenu=function(){}},onCopy:function(){$(document).on("copy",function(e){console.log(e)})},disable_paste:function(){document.disable_paste=!0},enable_paste:function(){document.disable_paste=!1}}};"undefined"==typeof require?(window._g||(window._g={}),window._g.event=e):define("_g/event",["_g/base"],function(){return window._g.event=e,window._g.event})}(window),define("interaction_view/ui/event",["_g/ui","_g/event"],function(){var events={pageStartEvents:[],pageClickEvents:[],pageDblClickEvents:[],pageWXShareSuccessEvents:[],pageSwipeEvents:[],elementChangeToEvents:[],slideClickEvents:[],slideDblClickEvents:[],animationStartEvents:[],animationEndEvents:[],animationUpdateEvents:[],bindingEvents:[],mediaEvents:[],controllerEvents:[],dragStartEvents:[],dragEndEvents:[],draggingEvents:[],dragDropEvents:[],dragDropGroupEvents:[],timerEvents:[],variableEvents:[],voteEvents:[],paragraphEvents:[],pageShakeEvents:[],formEvents:[],eraserEvents:[],formSubmitEvents:[],WeixinCameraEvents:[],collisionEvents:[],userListEvents:[],contactFormEvents:[],systemVariableEvents:[],videoAutoPlayControlPatch:[],userdataSaveEvents:[],sharedataSaveEvents:[],preloadPageEvents:[],epub360StartEvents:[],conditionEvents:[],scrollEvents:[],contentGridRenderEvents:[],init:function(){target=$(".slides"),target.on("click",function(e){return"undefined"!=typeof Reveal&&Reveal.lockAction?(e.preventDefault(),!1):void(events.testControl(e)&&events.onClickEvent())}),interaction_view.ismobile?target.hammer&&target.hammer().on("doubletap",function(e){events.testDblControl(e)&&(events.onDblClickEvent(),e.preventDefault()),_g.ui.clearSelection()}):target.on("dblclick",function(e){return"undefined"!=typeof Reveal&&Reveal.lockAction?(e.preventDefault(),!1):(events.testDblControl(e)&&(events.onDblClickEvent(),e.preventDefault()),void _g.ui.clearSelection())}),interaction_view.ismobile||events.initWheelEvent(),_e.orientation.inited||_e.orientation&&(_e.orientation.init(),_e.orientation.inited=!0),"1"!=_g.getUrlParameterByName("-build")&&_g.event.document.disable_contextmenu(),events.initShakeEvent(),epub360.Player={},_.extend(epub360.Player,Backbone.Events)},wheelEvents:[],initWheelEvent:function(){_g.mousewheel.init()},initShakeEvent:function(){if(_g.device.mobile()&&"undefined"!=typeof Shake){var e=new Shake({threshold:_g_device.iphone()?11:25});e.start(),window.addEventListener("shake",function(){interaction_view.events.onPageShakeEvent()},!1)}},testControl:function(e){var t=$(e.target).closest(".iView");if($(e.target).closest(".iView").hasClass("hasaction"))return!1;if(t){var i=t.attr("data-type");if(("Slide"==i||"CycleImage"==i)&&t.attr("data-iSlipable"))return!1}return $(e.target).closest(".iLayerRef").length>0&&$(e.target).closest(".iLayerRef").parent(".iView").hasClass("hascontrols")?!1:!0},testDblControl:function(e){$(e.target).closest(".iView");return $(e.target).closest(".iView").hasClass("hasDblClick")?!1:!0},onPageStart:function(e,t){interaction_view.ipagelist.getPage(e)&&epub360.settings.pems.has_analytics_src&&interaction_view.analytics.set(e);var i=_.filter(interaction_view.events.pageStartEvents,function(i){return i.page_id==e&&(t?i.layer_id==t:!0)});i.length>0&&_.each(i,function(e){e.func()})},onPageSwipeEvent:function(e,t,i){var n=_.filter(interaction_view.events.pageSwipeEvents,function(n){return n.page_id==t&&(i?n.layer_id==i:!0)&&e==n.swipeType});return n.length>0?(_.each(n,function(e){e.func()}),events.clearAnimationWaitSwipe(),!0):!1},onPageShakeEvent:function(){var e=_.filter(interaction_view.events.pageShakeEvents,function(e){return e.page_id==interaction_view.currentPage||e.page_id==interaction_view.imasterlist.at(0).id});return e.length>0?(_.each(e,function(e){e.func()}),events.clearAnimationWaitShake(),!0):!1},onChangeTo:function(e,t,i){var n=_.filter(interaction_view.events.elementChangeToEvents,function(n){return n.page_id==e&&n.overlay_id==t&&n.index==i});n.length>0&&_.each(n,function(e){e.func()})},onClickEvent:function(){if(interaction_view.events.pageClickEvents.length>0){var e=_.filter(interaction_view.events.pageClickEvents,function(e){return"waitaction"==e.type});if(e.length>0)_.each(e,function(e){e.func()});else{var t=_.filter(interaction_view.events.pageClickEvents,function(e){return e.page_id==interaction_view.currentPage&&"page"==e.type});if(t.length>0)_.each(t,function(e){e.func()});else{var i=_.filter(interaction_view.events.pageClickEvents,function(e){return"master"==e.type});if(i.length>0)interaction_view.show_master&&_.each(i,function(e){e.func()});else{var n=_.filter(interaction_view.events.pageClickEvents,function(e){return"background"==e.type});interaction_view.show_background&&_.each(n,function(e){e.func()})}}}events.clearWaitClick()}},onDblClickEvent:function(){if(interaction_view.events.pageDblClickEvents.length>0){var e=_.filter(interaction_view.events.pageDblClickEvents,function(e){return e.page_id==interaction_view.currentPage&&"page"==e.type});if(e.length>0)_.each(e,function(e){e.func()});else{var t=_.filter(interaction_view.events.pageDblClickEvents,function(e){return"master"==e.type});if(t.length>0)interaction_view.show_master&&_.each(t,function(e){e.func()});else{var i=_.filter(interaction_view.events.pageDblClickEvents,function(e){return"background"==e.type});interaction_view.show_background&&_.each(i,function(e){e.func()})}}}},onSlideClickEvent:function(){},onSlideDblClickEvent:function(){},onControllerEvent:function(){},onBingChangeTo:function(e){var t=_.filter(interaction_view.events.bindingEvents,function(t){return t.id==e.id&&t.page_id==e.page_id});_.each(t,function(t){e.direction=t.direction,t.func(e)})},onAnimationStart:function(e){var t=_.filter(interaction_view.events.animationStartEvents,function(t){return e.layer_id?e.overlay_id?t.overlay_id==e.overlay_id&&t.animation_id==e.animation_id&&t.layer_id==e.layer_id:t.animation_id==e.animation_id&&t.layer_id==e.layer_id:e.overlay_id?t.overlay_id==e.overlay_id&&t.animation_id==e.animation_id&&t.page_id==e.page_id:t.animation_id==e.animation_id&&t.page_id==e.page_id});_.each(t,function(e){e.func()})},onAnimationEnd:function(e){var t=_.filter(interaction_view.events.animationEndEvents,function(t){return e.layer_id?e.overlay_id?t.overlay_id==e.overlay_id&&t.animation_id==e.animation_id&&t.layer_id==e.layer_id:t.animation_id==e.animation_id&&t.layer_id==e.layer_id:e.overlay_id?t.overlay_id==e.overlay_id&&t.animation_id==e.animation_id&&t.page_id==e.page_id:t.animation_id==e.animation_id&&t.page_id==e.page_id});_.each(t,function(e){e.func()})},onAnimationUpdate:function(e){var t=_.filter(interaction_view.events.animationUpdateEvents,function(t){return e.layer_id?e.overlay_id?t.overlay_id==e.overlay_id&&t.animation_id==e.animation_id&&t.layer_id==e.layer_id:t.animation_id==e.animation_id&&t.layer_id==e.layer_id:e.overlay_id?t.overlay_id==e.overlay_id&&t.animation_id==e.animation_id&&t.page_id==e.page_id:t.animation_id==e.animation_id&&t.page_id==e.page_id});_.each(t,function(e){e.func()})},onDragStart:function(e){var t=_.filter(interaction_view.events.dragStartEvents,function(t){return e.layer_id?t.overlay_id==e.overlay_id&&t.layer_id==e.layer_id:t.overlay_id==e.overlay_id&&t.page_id==e.page_id});_.each(t,function(e){e.func()})},onDragEnd:function(e){var t=_.filter(interaction_view.events.dragEndEvents,function(t){return e.layer_id?t.overlay_id==e.overlay_id&&t.layer_id==e.layer_id:t.overlay_id==e.overlay_id&&t.page_id==e.page_id});_.each(t,function(e){e.func()})},onDragging:function(e){var t=_.filter(interaction_view.events.draggingEvents,function(t){return e.layer_id?t.overlay_id==e.overlay_id&&t.layer_id==e.layer_id:t.overlay_id==e.overlay_id&&t.page_id==e.page_id});_.each(t,function(e){e.func()})},onDragDrop:function(e,t,i){function n(t,i){return t.overlay_id!=e.id||t.drop_type!=i?!1:e.page.isLayer?t.layer_id==e.page.iOverlaylist.layerid:t.page_id==e.page.id}var a;return 0==i?(a=_.filter(interaction_view.events.dragDropEvents,function(e){return n(e,8)}),void _.each(a,function(e){e.func()})):(e.iview.Status=2,_.include(e.iview.getdetail().element_ids,t.id)?(e.iview.Status=1,a=_.filter(interaction_view.events.dragDropEvents,function(e){return n(e,9)})):a=_.filter(interaction_view.events.dragDropEvents,function(e){return n(e,10)}),void _.each(a,function(e){e.func()}))},onDragDropGroup:function(e){function t(e,t,i){return e.overlay_id!=i.id||e.drop_type!=t?!1:i.page.isLayer?e.layer_id==i.page.iOverlaylist.layerid:e.page_id==i.page.id}$.each(e.iview.DragDropGroups,function(e,i){var n=i.iview.getdetail().element_ids,a=0,r=!0;if($.each(n,function(e,t){var n=i.page.iOverlaylist.where({id:t})[0];if(n&&n.iview){if(n=n.iview,0==n.Status)return r=!1,!1;1==n.Status&&a++}}),r){var o;o=a==n.length?_.filter(interaction_view.events.dragDropGroupEvents,function(e){return t(e,11,i)}):_.filter(interaction_view.events.dragDropGroupEvents,function(e){return t(e,12,i)}),_.each(o,function(e){e.func()})}})},onTimerStart:function(e){_.each(e.Actions_19,function(e){e.func()})},onTimerStop:function(e){_.each(e.Actions_17,function(e){e.func()})},onTimerInterval:function(e,t){_.each(e.Actions_18,function(e){(0==(Math.abs(t%e.condition)-e.condition).toFixed(2)||0==Math.abs(t%e.condition).toFixed(2))&&e.func()})},onTimerCountTo:function(e){_.each(e.Actions_16,function(t){var i=e.currentTime-t.condition,n=2*Math.abs(i);(0>=i&&n<=e.frame||i>0&&n<e.frame)&&t.func()})},onVariableChanged:function(view){var detail=view.getdetail(),initial="0"==detail.iKind&&Number(detail.initial)||detail.initial,actions=_.filter(interaction_view.events.variableEvents,function(e){return interaction_view.events.filterType(view,e,22)}),VarOPobj=interaction_view.getVarsOp(interaction_view.currentPage,null,interaction_view.environment.Votes.get());_.each(actions,function(v){var cond;cond=v.condition.replace(/%@/g,"initial"),cond=VarOPobj.var2val(cond,!0),eval(cond)&&v.func()})},onSystemVariableChanged:function(e){var t=_.filter(interaction_view.events.systemVariableEvents,function(t){return interaction_view.events.filterTypeByView(e,t)});t.length&&(console.log(t),_.each(t,function(e){if(100==e.type&&interaction_view.isWeixin&&e.func(),101!=e.type||interaction_view.isWeixin||e.func(),102==e.type&&interaction_view.isAndroid&&e.func(),103==e.type&&interaction_view.isIos&&e.func(),104==e.type&&interaction_view.isWin&&e.func(),105==e.type&&interaction_view.isMac&&e.func(),"undefined"!=typeof epub360_userinfo&&void 0!=epub360_userinfo.is_subscribe){if(interaction_view.foredit)return void global.message("warning","è¯·ä½¿ç”¨é¢„è§ˆå…¨éƒ¨æ¨¡å¼é¢„è§ˆè¯¥åŠŸèƒ½");110==e.type&&epub360_userinfo.is_subscribe&&e.func(),111!=e.type||epub360_userinfo.is_subscribe||e.func()}"epub360"==epub360_domain&&(130==e.type&&0==interaction_view.environment.Sharedata.mode&&e.func(),131==e.type&&1==interaction_view.environment.Sharedata.mode&&e.func()),"epub360"==epub360_domain&&"undefined"!=typeof epub360_userinfo&&(140==e.type&&1==epub360_userinfo.visit_count&&e.func(),141==e.type&&epub360_userinfo.visit_count>1&&e.func())}))},onVoted:function(e){var t=_.filter(interaction_view.events.voteEvents,function(t){return interaction_view.events.filterType(e,t,23)});_.each(t,function(e){e.func()})},onParagraphChanged:function(e){var t=_.filter(interaction_view.events.paragraphEvents,function(t){return interaction_view.events.filterType(e,t,54)});_.each(t,function(e){e.func()})},onFormEvent:function(e,t){var i=e.createPath(),n=_.filter(interaction_view.events.formEvents,function(e){return e.overlay&&interaction_view.hashPath(i)==interaction_view.hashPath(e.overlay.path)+e.overlay.id});"Select"==e.get("iType")?_.each(n,function(e){e.key==t&&e.func(t)}):_.each(n,function(e){e.func(t)})},onFormSubmitEvent:function(e,t){var i=_.filter(interaction_view.events.formSubmitEvents,function(e){return e.id==t});_.each(i,function(e){e.func(status)})},onFormButtonRender:function(e){var t=e.createPath(),i=null,n=null,a=_.filter(interaction_view.events.formEvents,function(e){return e.overlay&&interaction_view.hashPath(t)==interaction_view.hashPath(e.overlay.path)+e.overlay.id});return _.each(a,function(t){n=t,i=interaction_view.application.getValue(t.id,t.cid,t.key),t.bindSwitch&&interaction_view.application.sendOverlayToButtonGroup(e)}),{field:n,value:i}},onEraserEvent:function(e){var t=_.filter(interaction_view.events.eraserEvents,function(t){return interaction_view.events.filterType(e,t,41)});_.each(t,function(e){e.func()})},onWeixinEvent:function(e,t){var i=_.filter(interaction_view.events.WeixinCameraEvents,function(i){return interaction_view.events.filterType(e,i,t)});_.each(i,function(e){e.func()})},onCollision:function(e){var t=_.filter(interaction_view.events.collisionEvents,function(t){return interaction_view.events.filterType(e,t,73)});_.each(t,function(e){e.func()})},onUserList:function(e,t){var i=_.filter(interaction_view.events.userListEvents,function(i){return interaction_view.events.filterType(e,i,t)});_.each(i,function(e){e.func()})},onContactFormSubmit:function(e,t){var i=_.filter(interaction_view.events.contactFormEvents,function(i){return interaction_view.events.filterType(e,i,t)});_.each(i,function(e){e.func()})},onUserdataSave:function(e){var t=_.filter(interaction_view.events.userdataSaveEvents,function(t){var i=e.model.toJSON();return t.userdatasave_hash==i.page_id+"_"+i.id});_.each(t,function(e){e.func()})},onSharedataSave:function(e){var t=_.filter(interaction_view.events.sharedataSaveEvents,function(t){return t.sharedatasave_hash==e.model.toJSON().id});_.each(t,function(e){e.func()})},onContentGridRender:function(e,t){var i=_.filter(interaction_view.events.contentGridRenderEvents,function(t){return interaction_view.events.filterType(e,t,"onRender")});_.each(i,function(e){e.func(null,t)})},clearWaitClick:function(){interaction_view.events.pageClickEvents=_.reject(interaction_view.events.pageClickEvents,function(e){return"waitaction"==e.type})},clearAnimationWaitSwipe:function(){interaction_view.events.pageSwipeEvents=_.reject(interaction_view.events.pageSwipeEvents,function(e){return"waitaction"==e.type})},clearAnimationWaitShake:function(){interaction_view.events.pageShakeEvents=_.reject(interaction_view.events.pageShakeEvents,function(e){return"waitaction"==e.type})},clearRelatedEvents:function(e){interaction_view.events.animationStartEvents=_.reject(interaction_view.events.animationStartEvents,function(t){return t.page_id==e||t.iPage_id==e}),interaction_view.events.animationEndEvents=_.reject(interaction_view.events.animationEndEvents,function(t){return t.page_id==e||t.iPage_id==e}),interaction_view.events.animationUpdateEvents=_.reject(interaction_view.events.animationUpdateEvents,function(t){return"collision"==t._label&&(t.page_id==e||t.iPage_id==e)}),interaction_view.events.draggingEvents=_.reject(interaction_view.events.draggingEvents,function(t){return"collision"==t._label&&(t.page_id==e||t.iPage_id==e)}),interaction_view.events.variableEvents=_.reject(interaction_view.events.variableEvents,function(t){return t.iPage_id==e})},onPageStopClear:function(e){interaction_view.events.conditionEvents=_.map(interaction_view.events.conditionEvents,function(t){return t.page_id==e&&(t.result=null),t}),interaction_view.events.scrollEvents=_.map(interaction_view.events.scrollEvents,function(t){return t.page_id==e&&(t.executed=!1),t})},clearAll:function(){interaction_view.events.pageClickEvents=[],interaction_view.events.pageDblClickEvents=[],interaction_view.events.pageStartEvents=[],interaction_view.events.pageWXShareSuccessEvents=[],interaction_view.events.bindingEvents=[],interaction_view.events.elementChangeToEvents=[],interaction_view.events.animationStartEvents=[],interaction_view.events.animationEndEvents=[],interaction_view.events.animationUpdateEvents=[],interaction_view.events.slideClickEvents=[],interaction_view.events.slideDblClickEvents=[],interaction_view.events.controllerEvents=[],interaction_view.events.dragDropEvents=[],interaction_view.events.dragDropGroupEvents=[],interaction_view.events.timerEvents=[],interaction_view.events.variableEvents=[],interaction_view.events.voteEvents=[],interaction_view.events.paragraphEvents=[],interaction_view.events.pageSwipeEvents=[],interaction_view.events.pageShakeEvents=[],interaction_view.events.formEvents=[],interaction_view.events.formSubmitEvents=[],interaction_view.events.eraserEvents=[],interaction_view.events.WeixinCameraEvents=[],interaction_view.events.collisionEvents=[],interaction_view.events.dragStartEvents=[],interaction_view.events.draggingEvents=[],interaction_view.events.dragEndEvents=[],interaction_view.events.userListEvents=[],interaction_view.events.contactFormEvents=[],interaction_view.events.systemVariableEvents=[],interaction_view.events.userdataSaveEvents=[],interaction_view.events.sharedataSaveEvents=[],interaction_view.events.preloadPageEvents=[],interaction_view.events.conditionEvents=[],interaction_view.events.scrollEvents=[],interaction_view.events.contentGridRenderEvents=[],interaction_view.events.mediaEvents=[],"undefined"!=typeof Reveal&&(Reveal.wheelLock=!1,Reveal.dragLock=!1,Reveal.wheelEventLock=!1),_e.orientation&&_e.orientation.event&&_e.orientation.event.off("orientation")},filterType:function(e,t,i){return t.overlay_id!=e.model.id||t.type!=i?!1:e.model.page.isLayer?t.layer_id==e.model.page.iOverlaylist.layerid:t.page_id==e.model.page.id},filterTypeByView:function(e,t){return t.overlay_id!=e.model.id?!1:e.model.page.isLayer?t.layer_id==e.model.page.iOverlaylist.layerid:t.page_id==e.model.page.id}};return events}),define("interaction_view/ui/environment",["underscore"],function(){var env={Userdata:{id:"",source_id:"",data:{},collection:{},mode:0,status:0,init:function(){if("undefined"==typeof epub360_domain||"epub360"!=epub360_domain||1==interaction_view.forpreview)return env.Userdata.status=2,!0;var e=_g.getUrlParameterByName("userdata",message_link);return _g.getUrlParameterByName("source_openid",message_link)&&(e=_g.getUrlParameterByName("source_openid",message_link)),null==e||e==epub360_userinfo.openid?(env.Userdata.status=2,epub360_userinfo.openid&&(env.Userdata.id=epub360_userinfo.openid,env.Userdata.source_id=env.Userdata.id,void 0!=epub360_userinfo.data&&epub360_userinfo.data&&env.Userdata.initData(epub360_userinfo.data)),!0):(env.Userdata.id=epub360_userinfo.openid,env.Userdata.source_id=e,env.Userdata.mode=1,env.Userdata.get(),!0)},state:function(){return env.Userdata.status},initData:function(data){for(var i=0;i<data.length;i++){var item=data[i],page_id=item.iPageid,overlay_id=item.overlay_id,userdata_page=env.Userdata.data[page_id];if(void 0==userdata_page&&(env.Userdata.data[page_id]={}),"Paragraph"==item.iType){var text=item.iDetail.iText;item.iDetail={iText:eval("'"+text+"'")}}if(env.Userdata.data[page_id][overlay_id]=item,env.Userdata.collection[page_id+"_"+overlay_id]){var view=env.Userdata.collection[page_id+"_"+overlay_id];if("Paragraph"==item.iType&&view.updateText(item.iDetail.iText,addtourl=0),"ImageBlock"==item.iType&&(view.getArgs(),view.setOtherDisplay()),"Audio"==item.iType){var detail=view.getdetail(),url=item.iDetail.value;interaction_view.media.changeSrc(view.model,url),detail.iAutoplay&&interaction_view.media.play(view.model),detail.iFile[0].file=url}"Slide"==item.iType&&(view.rmbLast=parseInt(item.iDetail.value),view.setElementTo(view.rmbLast)),"Variable"==item.iType&&view.render(),delete env.Userdata.collection[page_id+"_"+overlay_id]}}},get:function(e){env.Userdata.status=1,_g.ajax.get({dataType:"JSON",url:"userdata/"+env.Userdata.source_id+"/",callback:function(t){if(200==t.code){env.Userdata.status=2;var i=t.data.results.data;env.Userdata.initData(i),e&&e()}},onError:function(){}})},set:function(e,t){if(""!=env.Userdata.id){0==env.Userdata.initial&&(env.Userdata.initial=1);var i="userdata/"+env.Userdata.id+"/";_g.ajax.post({dataType:"JSON",data:JSON.stringify(e),url:i,callback:function(e){200==e.code&&t()},onError:function(){}})}},update:function(e,t,i,n){var a="sharedata/"+env.Userdata.id+"/"+e+"/"+t+"/";_g.ajax.post({dataType:"JSON",type:"PUT",data:JSON.stringify(i),url:a,callback:function(e){200==e.code&&(env.Userdata.share(e.data.results[0].id,t),n&&n())},onError:function(){}})},share:function(){var e=0;-1==message_link.indexOf(env.Userdata.id)&&(message_link=_g.replaceUrlParameterByName("source_openid","source_openid="+env.Userdata.id,message_link),e=1),e&&interaction_view.weixin.share()},getitem:function(e,t){if(env.Userdata.data[e]){var i=env.Userdata.data[e][t];if(i)return i.iDetail}return null},setitem:function(e,t){if(""!=env.Userdata.id){env.Userdata.id!=env.Userdata.source_id&&env.Userdata.reset();var i=e.model.get("pageid");void 0==env.Userdata.data[i]&&(env.Userdata.data[i]={});var n={overlay_id:e.model.id,iPageid:i,title:e.model.get("iDetail").title,iType:e.model.get("iType"),iDetail:t};if(env.Userdata.data[i][e.model.id])env.Userdata.update(i,e.model.id,n,function(){env.Userdata.data[i][e.model.id]=n});else{if(1==env.Userdata.initial)return void env.Userdata.setitems.push(n);env.Userdata.set([n])}}},setitems:function(e,t){if(""!=env.Userdata.id){env.Userdata.id!=env.Userdata.source_id&&env.Userdata.reset();for(var i=[],n=0;n<e.length;n++){var a=e[n],r=a.model.get("pageid");void 0==env.Userdata.data[r]&&(env.Userdata.data[r]={});var o={overlay_id:a.model.id,iPageid:r,title:a.model.get("iDetail").title,iType:a.model.get("iType")},s=a.getdetail();"Variable"==o.iType&&(o.iDetail={value:s.initial}),i.push(o),env.Userdata.data[r][a.model.id]=o}i&&env.Userdata.set(i,t)}},reset:function(){env.Userdata.source_id=env.Userdata.id,env.Userdata.mode=0,env.Userdata.status=2,env.Userdata.data=void 0!=epub360_userinfo.data&&epub360_userinfo.data||{},env.Userdata.initial=0,env.Userdata.share()},disableMode:function(){env.Userdata.mode=0},addView:function(e){var t=e.model,i=t.get("pageid");env.Userdata.collection[i+"_"+t.id]||env.Userdata.updateView(e)},updateView:function(e){var t=e.model,i=t.get("pageid");env.Userdata.collection[i+"_"+t.id]=e},getList:function(){return _.toArray(env.Userdata.collection)}},Sharedata:{id:"",source_id:"",data:{},collection:{},enabled:!0,mode:0,status:0,init:function(){if("undefined"==typeof epub360_domain||"epub360"!=epub360_domain||1==interaction_view.forpreview)return env.Sharedata.status=2,!0;message_link&&message_link.indexOf("source_openid")>-1&&(env.Sharedata.mode=1),message_link&&message_link.indexOf("disableHistoryStart")>-1&&message_link.indexOf("pageid")>-1&&(env.Sharedata.mode=1);var e=_g.getUrlParameterByName("sharedata",message_link);return null==e?(env.Sharedata.status=2,!0):(env.Sharedata.id=e,env.Sharedata.source_id=e,env.Sharedata.mode=1,env.Sharedata.get(),!0)},state:function(){return env.Sharedata.status},get:function(callback){env.Sharedata.status=1,_g.ajax.get({dataType:"JSON",url:"sharedata/"+env.Sharedata.id+"/",callback:function(result){if(200==result.code){env.Sharedata.status=2;for(var data=result.data.results.data,i=0;i<data.length;i++){var item=data[i],page_id=item.iPageid,overlay_id=item.overlay_id,sharedata_page=env.Sharedata.data[page_id];
if(void 0==sharedata_page&&(env.Sharedata.data[page_id]={}),"Paragraph"==item.iType){var text=item.iDetail.iText;item.iDetail={iText:eval("'"+text+"'")}}if(env.Sharedata.data[page_id][overlay_id]=item,env.Sharedata.collection[page_id+"_"+overlay_id]){var view=env.Sharedata.collection[page_id+"_"+overlay_id];if("Paragraph"==item.iType&&view.updateText(item.iDetail.iText,addtourl=0),"ImageBlock"==item.iType&&(view.getArgs(),view.setOtherDisplay()),"Audio"==item.iType){var detail=view.getdetail(),url=item.iDetail.value;interaction_view.media.changeSrc(view.model,url),detail.iAutoplay&&interaction_view.media.play(view.model),detail.iFile[0].file=url}"Slide"==item.iType&&(view.rmbLast=parseInt(item.iDetail.value),view.setElementTo(view.rmbLast)),delete env.Sharedata.collection[page_id+"_"+overlay_id]}}callback&&callback()}},onError:function(){}})},set:function(e,t){if(""!=env.Sharedata.id&&1!=env.Sharedata.initial){(void 0==env.Sharedata.initial||0==env.Sharedata.initial)&&(env.Sharedata.initial=1);var i="sharedata/"+env.Sharedata.id+"/";_g.ajax.post({dataType:"JSON",data:JSON.stringify(e),url:i,callback:function(i){if(200==i.code){for(var n,a,r=0,o=0;o<e.length;o++)n=e[o].iPageid,a=e[o].overlay_id,env.Sharedata.data[n][a].changed=!1,r+=env.Sharedata.share(env.Sharedata.id,a);1==env.Sharedata.initial&&(env.Sharedata.initial=0),r&&interaction_view.weixin.share(),t&&t()}},onError:function(){}})}},update:function(e,t,i,n){var a="sharedata/"+env.Sharedata.id+"/"+e+"/"+t+"/";_g.ajax.post({dataType:"JSON",type:"PUT",data:JSON.stringify(i),url:a,callback:function(e){200==e.code&&(env.Sharedata.share(e.data.results[0].id,t),n&&n())},onError:function(){}})},share:function(e,t){var i=0;-1==message_link.indexOf(env.Sharedata.id)&&(message_link=_g.replaceUrlParameterByName("sharedata","sharedata="+env.Sharedata.id,message_link),i=1);var n=new RegExp("&?"+t+"=([^&])+"),a=n.exec(message_link);return a&&(message_link=message_link.replace(a[0],""),i=1),i},getitem:function(e,t){if(env.Sharedata.data[e]){var i=env.Sharedata.data[e][t];if(i)return i.iDetail}return null},setitem:function(e,t){if(env.Sharedata.id==env.Sharedata.source_id&&env.Sharedata.reset(),""!=env.Sharedata.id){var i=e.model.get("pageid");void 0==env.Sharedata.data[i]&&(env.Sharedata.data[i]={});var n={overlay_id:e.model.id,iPageid:i,title:e.model.get("iDetail").title,iType:e.model.get("iType"),iDetail:t,changed:!0};env.Sharedata.data[i][e.model.id]=n}},setitems:function(e){var t=[];for(var i in env.Sharedata.data)for(var n in env.Sharedata.data[i])1==env.Sharedata.data[i][n].changed&&t.push(env.Sharedata.data[i][n]);env.Sharedata.set(t,e)},reset:function(){env.Sharedata.id="","object"==typeof wx_config&&wx_config.nonceStr&&(env.Sharedata.id=wx_config.nonceStr),env.Sharedata.mode=0,env.Sharedata.status=2,env.Sharedata.data={},env.Sharedata.initial=0},disableMode:function(){env.Sharedata.mode=0},addView:function(e){var t=e.model,i=t.get("pageid");env.Sharedata.collection[i+"_"+t.id]||env.Sharedata.updateView(e)},updateView:function(e){var t=e.model,i=t.get("pageid");env.Sharedata.collection[i+"_"+t.id]=e},getList:function(){return _.toArray(env.Sharedata.collection)}},Shareapp:{id:"",slug:"",shareinfo:{},helperinfo:{},appinfo:{},status:0,collection:{},init:function(){if(""==interaction_view.shareapp.id)return!1;env.Shareapp.slug=interaction_view.shareapp.id;var e=_g.getUrlParameterByName("shareid",message_link);return null==e?!1:""==interaction_view.shareapp.id?!1:(env.Shareapp.id=e,env.Shareapp.get(),!0)},get:function(e){env.Shareapp.status=1,_g.ajax.get({dataType:"JSON",url:"/share/"+env.Shareapp.slug+"/info?id="+env.Shareapp.id,callback:function(t){200==t.code?(env.Shareapp.shareinfo=t.data.results[0].shareinfo,env.Shareapp.helperinfo=t.data.results[0].helperinfo,env.Shareapp.appinfo=t.data.results[0].appinfo,1==env.Shareapp.status&&(env.Shareapp.status=2,env.Shareapp.waitpage&&env.Shareapp.waitpage==interaction_view.currentPage?interaction_view.play(interaction_view.currentPage):(console.info("env.Shareapp.get"),$.each(env.Shareapp.collection,function(e,t){var i=t;i.model.get("pageid")==interaction_view.currentPage&&2!=i.status&&i.resetOtherStatus()}))),e&&e()):env.Shareapp.status=0},onError:function(){interaction_view.environment.Shareapp.status=0}})},usertype:function(){return""==env.Shareapp.slug?"@åŠ©åŠ›_æœªå¯ç”¨@":""==env.Shareapp.id?0:env.Shareapp.status<2?0:env.Shareapp.shareinfo.openid==epub360_userinfo.openid?1:interaction_view.environment.Shareapp.helperinfo.help_num>0?2:0},total:function(){return""==env.Shareapp.slug?"@åŠ©åŠ›_æœªå¯ç”¨@":""==env.Shareapp.id?0:env.Shareapp.status<2?0:interaction_view.environment.Shareapp.shareinfo.total},help:function(e){e&&e()},create:function(){},add:function(e){var t=e.model;env.Shareapp.collection[t.id]||env.Shareapp.update(e)},update:function(e){var t=e.model;env.Shareapp.collection[t.id]=e},getList:function(){return _.toArray(env.Shareapp.collection)}},Votes:{collection:{},add:function(e){env.Votes.collection[e.id]||env.Votes.update(e)},update:function(e){env.Votes.collection[e.id]=e},get:function(){return _.toArray(env.Votes.collection)}},Paragraph:{editable:!1,stateChanged:function(e){_.each(interaction_view.getOverlays("Slide",interaction_view.currentPage),function(t){t.iview.setControl(e)})},enable:function(){env.Paragraph.editable=!0,$("body").addClass("ParagraghEditable"),env.Paragraph.stateChanged(!0)},disable:function(){env.Paragraph.editable=!1,$("body").removeClass("ParagraghEditable"),env.Paragraph.stateChanged(!1)},state:function(){return env.Paragraph.editable}},otherFormValue:{}};return env}),define("interaction_view/ui/mobilemedia",[],function(){var e={statusclear:function(e){e.loaded=!1,e.played=!1,e.reseted=!1,e.completed=!1},play:function(t,i){i||(i={}),("Video"==t.get("iType")||"QQVideo"==t.get("iType"))&&e.video.play(t,i),"Audio"==t.get("iType")&&e.audio.play(t)},pause:function(e){if(!e.media||e.media.paused)return!1;try{e.media.pause()}catch(t){}e.iview.slider&&e.iview.sliderstop()},seek:function(t,i,n){n&&(i=e.getTimeByPercent(t,n));try{t.media.currentTime=i}catch(a){}},changeSrc:function(e,t){try{e.media.src=t}catch(i){}},video:{render:function(){},init:function(t,i,n){function a(e){i.loaded=e,t.set("loaded",!0),t.page.ipreloadlist.preloadcheck(t.toJSON().file,e,i)}var r=n;if(".m3u8"==_g.string.getUrlExt(r)||".M3U8"==_g.string.getUrlExt(r))return void(e.video.initH&&e.video.initH(t,i,n));var o=i.iview.getdetail(),s=(i.iview.getcommon(),o.iFullscreen?"":'webkit-playsinline="true" playsinline="true"'),l=$("<video "+s+' x-webkit-airplay="allow" preload="auto" autobufer="true" style="position:absolute; display:none;width:100%;height:100%;top:0;left:0;" src="'+r+'" poster="'+o.iFile[0].picture+'"></video>'),c=$('<img style="position:absolute;left:0;top:0;" src="'+o.iFile[0].picture+'" width="100%" height="100%"/>'),d=$('<span class="video-control status-play absolutecenter" style="cursor: pointer;margin: auto;"></span>');i.iview.$el.removeClass("hide").children(".Element").append(l).append(c),interaction_view.isAndroid&&i.iview.$el.removeClass("hide").children(".Element").append(d),d.hide(),o.iControl&&(l.attr("controls","controls"),interaction_view.isIos&&c.addClass("hide noevents"),d.show(),d.one("click",function(){d.hide(),interaction_view.media.play(i)})),o.iRepeat&&l.attr("loop","loop"),i.media=l[0],i.poster=c,i.control_btn=d,i.autoplay=o.iAutoplay||!1,i.fullscreen=o.iFullscreen||!1,i.control=o.iControl||!1,l.on("play",function(){i.fullscreen&&interaction_view.media.video._fullScreen(i)}).on("error",function(){}).on("canplay",function(){i.autoplay&&!interaction_view.isAndroid&&c.hide(),l.show()}),a(!0),l.on("ended",function(){o.iAutohide&&(i.iview.$el.addClass("hide"),i.hided=!0),i.onAnimationStart&&(interaction_view.events.onAnimationEnd(i.onAnimationStart),i.onAnimationStart=null)})},play:function(t){if(t.hls)return void(e.video.playH&&e.video.playH(t));if(!t.loaded||!t.media||!t.media.paused)return t.iview.slider&&t.media&&t.iview.sliderplay(),!1;if(t.reseted=!1,("Video"==t.get("iType")||"QQVideo"==t.get("iType"))&&(t.poster&&(t.poster.hide(),t.control_btn.hide()),t.fullscreen&&interaction_view.media.video._fullScreen(t),t.iview.$el.removeClass("hide"),t.hided=!1),!t.bindStart){var i=function(){console.log("start play");var e=_.filter(interaction_view.events.mediaEvents,function(e){return e.overlay_id==t.id&&"onStartPlay"==e.type});if(e.length)for(var n=0;n<e.length;n++)e[n].func();$(t.media).off("timeupdate",i),t.bindStart=!1};$(t.media).on("timeupdate",i),t.bindStart=!0}if(!t.bindEnded){var n=function(){console.log("ended play");var e=_.filter(interaction_view.events.mediaEvents,function(e){return e.overlay_id==t.id&&"onEnded"==e.type});if(e.length)for(var i=0;i<e.length;i++)e[i].func();$(t.media).off("ended",n),t.bindEnded=!1};$(t.media).on("ended",n),t.bindEnded=!0}t.media.play(),t.iview.slider&&t.iview.sliderplay()},reset:function(t){if(t.hls&&e.video.resetH&&e.video.resetH(t),!t.media||t.reseted)return!1;try{t.media.currentTime=0,t.media.paused||t.media.pause()}catch(i){}t.reseted=!0},getDuration:function(e){return e.duration},_testfullscreen:function(e){var t="webkit";return e[t+"RequestFullScreen"]?t+"RequestFullScreen":e[t+"EnterFullScreen"]?t+"EnterFullScreen":!1},_fullScreen:function(e){if(!interaction_view.isIos){var t=e.media,i=interaction_view.media.video._testfullscreen(t);if(!i)return void console.log("ä¸æ”¯æŒå…¨å±æ¨¡å¼");if(!document.webkitIsFullScreen){var n=function(){t.removeEventListener(webkitfullscreenchange,n,!1),interaction_view.isAndroid&&e.onAnimationStart&&(interaction_view.events.onAnimationEnd(e.onAnimationStart),e.onAnimationStart=null)};t.addEventListener("webkitfullscreenchange",n,!1),t[i]()}}}},audio:{init:function(e,t,i){var n=e.toJSON().file,a="Audio_"+e.id+t.id;if(t.src=n,t.audioid=a,".m3u8"!=_g.string.getUrlExt(n)&&".M3U8"!=_g.string.getUrlExt(n)){{var r=t.iview.getdetail();t.iview.getcommon()}if(i&&"undefined"!=typeof bgsound_id&&"undefined"!=typeof bgsound_src&&bgsound_id==t.id){if(t.media=audio,interaction_view.bgsound=t,t.isBgsound=!0,!audio)return audioelement=t,t.loaded=!0,e.set("loaded",!0),void e.page.ipreloadlist.preloadcheck(e.toJSON().file,!0,t);o=$("audio#bgsound"),r.iAutoplay&&(t.autoplay=!0,t.media.play(),t.iview.sliderplay&&t.iview.sliderplay()),t.media.paused||(t.hasPlayed=!0)}else{var o=$('<audio id="'+a+'" style="position:absolute;"> <source src="'+n+'" /> </audio>');t.iview.$el.removeClass("hide").children(".Element").append(o),!_g.device.android()&&r.iRepeat&&o.attr("loop",""),t.media=o[0],t.autoplay=r.iAutoplay||!1,r.iAutoplay&&i&&(interaction_view.bgsound||(t.isBgsound=!0,interaction_view.bgsound=t))}t.loaded=!0,e.set("loaded",!0),e.page.ipreloadlist.preloadcheck(e.toJSON().file,!0,t),o.on("loadstart",function(){}).on("error",function(){}).on("timeupdate",function(){if(t.iview.slider){var e=t.media.currentTime,i=t.media.duration,n=100*_g.number.decimal(e/i,2);t.iview.onSliderChange(n)}}),o.on("ended",function(){if(r.iRepeat)_g.device.android()&&t.media.play();else{if(t.iview.slider&&t.iview.sliderstop(),0==t.media.seekable.length)return;try{}catch(e){}t.onAnimationStart&&(interaction_view.events.onAnimationEnd(t.onAnimationStart),t.onAnimationStart=null)}})}},getDuration:function(e){return e.duration},play:function(t){e.video.play(t)},reset:function(t){t.isBgsound||e.video.reset(t)}},getTimeByPercent:function(e,t){if(!e.media)return null;var i=e.media.duration;return t/100*i}};return e}),define("interaction_view/ui/adapt",[],function(){var e={elements:[],size:{x:0,y:0},adjustSize:function(){},adjustPosition:function(){},parseSize:function(e){return e.width&&$.zoom&&1!=$.zoom&&(e.width=e.width/$.zoom),e.height&&$.zoom&&1!=$.zoom&&(e.height=e.height/$.zoom),e},parseOffset:function(e,t){return t||(t={}),e.model.isMasterOverlay||e.model.isBackgroundOverlay||(0!=t.x&&(e.x=e.x-Reveal.marginLeft),0!=t.y&&(e.y=e.y-Reveal.marginTop)),e},adjustElement:function(e){{var t=e.view.getcommon();Reveal._getScreenScale()}if(e.view.x=t.iStartx+t.iWidth/2,e.view.y=t.iStarty+t.iHeight/2,e.view.staticX=t.iStartx,e.view.staticY=t.iStarty,e.adapt&&5!=e.adapt)switch(console.log(e.adapt),e.adapt){case 1:e.view.sizeLeft=!0,e.view.sizeTop=!0,e.view=interaction_view.adapt.parseOffset(e.view),e.view.model.isPositionAdapt=!0;break;case 2:e.view.sizeTop=!0;var i=t.iStartx+t.iWidth/2;Reveal.slideScreenWidth>Reveal.slideWidth?(e.view.x=i+(Reveal.slideScreenWidth-Reveal.slideWidth)/2,e.view.staticX=e.view.x-t.iWidth/2):e.view.x=i,e.view=interaction_view.adapt.parseOffset(e.view),e.view.model.isPositionAdapt=!0;break;case 3:e.view.sizeTop=!0,e.view.sizeRight=!0;var i=t.iStartx+t.iWidth/2,n=interaction_view.size.x-i;e.view.x=Reveal.slideScreenWidth-n,e.view.staticX=e.view.x-t.iWidth/2,e.view=interaction_view.adapt.parseOffset(e.view),e.view.model.isPositionAdapt=!0;break;case 4:e.view.sizeLeft=!0;var a=t.iStarty+t.iHeight/2;e.view.y=Reveal.slideScreenHeight>Reveal.slideHeight?a+(Reveal.slideScreenHeight-Reveal.slideHeight)/2:a,e.view.staticY=e.view.y-t.iHeight/2,e.view=interaction_view.adapt.parseOffset(e.view);break;case 5:break;case 6:e.view.sizeRight=!0;var i=t.iStartx+t.iWidth/2,n=interaction_view.size.x-i;e.view.x=Reveal.slideScreenWidth-n;var a=t.iStarty+t.iHeight/2;e.view.y=Reveal.slideScreenHeight>Reveal.slideHeight?a+(Reveal.slideScreenHeight-Reveal.slideHeight)/2:a,e.view.staticX=e.view.x-t.iWidth/2,e.view.staticY=e.view.y-t.iHeight/2,e.view=interaction_view.adapt.parseOffset(e.view);break;case 7:e.view.sizeLeft=!0,e.view.sizeBottom=!0;var a=t.iStarty+t.iHeight/2,r=interaction_view.size.y-a;e.view.y=Reveal.slideScreenHeight-r,e.view.staticY=e.view.y-t.iHeight/2,e.view=interaction_view.adapt.parseOffset(e.view),e.view.model.isPositionAdapt=!0;break;case 8:e.view.sizeBottom=!0;var i=t.iStartx+t.iWidth/2;Reveal.slideScreenWidth>Reveal.slideWidth?(e.view.x=i+(Reveal.slideScreenWidth-Reveal.slideWidth)/2,e.view.x=e.view.x):e.view.x=i;var a=t.iStarty+t.iHeight/2,r=interaction_view.size.y-a;e.view.y=Reveal.slideScreenHeight-r,e.view.staticX=e.view.x-t.iWidth/2,e.view.staticY=e.view.y-t.iHeight/2,e.view=interaction_view.adapt.parseOffset(e.view),e.view.model.isPositionAdapt=!0;break;case 9:e.view.sizeBottom=!0,e.view.sizeRight=!0;var i=t.iStartx+t.iWidth/2,n=interaction_view.size.x-i;e.view.x=Reveal.slideScreenWidth-n;var a=t.iStarty+t.iHeight/2,r=interaction_view.size.y-a;e.view.y=Reveal.slideScreenHeight-r,e.view.staticX=e.view.x-t.iWidth/2,e.view.staticY=e.view.y-t.iHeight/2,e.view=interaction_view.adapt.parseOffset(e.view),e.view.model.isPositionAdapt=!0;break;case 10:e.view.sizeLeft=!0,e.view.sizeRight=!0;var o=interaction_view.currentScreenSize?interaction_view.currentScreenSize.x:Reveal.slideScreenWidth,s=o-t.iStartx-(interaction_view.size.x-t.iStartx-t.iWidth);e.view.width=s;var a=t.iStarty+t.iHeight/2;e.view.y=Reveal.slideScreenHeight>Reveal.slideHeight?a+(Reveal.slideScreenHeight-Reveal.slideHeight)/2:a,e.view=interaction_view.adapt.parseSize(e.view),e.view.x=e.view.staticX+e.view.width/2,e.view.staticY=e.view.y-e.view.originHeight/2,e.view=interaction_view.adapt.parseOffset(e.view);break;case 11:e.view.sizeTop=!0,e.view.sizeBottom=!0;var i=t.iStartx+t.iWidth/2;Reveal.slideScreenWidth>Reveal.slideWidth?(e.view.x=i+(Reveal.slideScreenWidth-Reveal.slideWidth)/2,e.view.staticX=e.view.x-e.view.originWidth/2):e.view.x=i;var l=interaction_view.currentScreenSize?interaction_view.currentScreenSize.y:Reveal.slideScreenHeight,c=l-t.iStarty-(interaction_view.size.y-t.iStarty-t.iHeight);e.view.height=c,e.view=interaction_view.adapt.parseSize(e.view),e.view.y=e.view.staticY+e.view.height/2,e.view=interaction_view.adapt.parseOffset(e.view);break;case 12:e.view.sizeLeft=!0,e.view.sizeRight=!0,e.view.sizeTop=!0,e.view.sizeBottom=!0;var o=interaction_view.currentScreenSize?interaction_view.currentScreenSize.x:Reveal.slideScreenWidth,s=o-t.iStartx-(interaction_view.size.x-t.iStartx-t.iWidth);e.view.width=s;var l=interaction_view.currentScreenSize?interaction_view.currentScreenSize.y:Reveal.slideScreenHeight,c=l-t.iStarty-(interaction_view.size.y-t.iStarty-t.iHeight);e.view.height=c,e.view=interaction_view.adapt.parseSize(e.view),e.view.staticX=t.iStartx,e.view.staticY=t.iStarty,e.view.x=t.iStartx+e.view.width/2,e.view.y=t.iStarty+e.view.height/2,e.view=interaction_view.adapt.parseOffset(e.view);break;case 13:e.view.sizeLeft=!0,e.view.sizeRight=!0,e.view.sizeTop=!0;var o=interaction_view.currentScreenSize?interaction_view.currentScreenSize.x:Reveal.slideScreenWidth,s=o-t.iStartx-(interaction_view.size.x-t.iStartx-t.iWidth);e.view.width=s,e.view=interaction_view.adapt.parseSize(e.view),e.view.x=e.view.staticX+e.view.width/2;var a=t.iStarty+t.iHeight/2;if(Reveal.slideScreenHeight>Reveal.slideHeight)var d=Reveal.slideScreenHeight-Reveal.slideHeight;else var d=0;e.view.staticY=e.view.y-t.iHeight/2;var l=interaction_view.currentScreenSize?interaction_view.currentScreenSize.y:Reveal.slideScreenHeight,c=l-t.iStarty-(interaction_view.size.y-t.iStarty-t.iHeight)-d;e.view.height=c,e.view=interaction_view.adapt.parseOffset(e.view);break;case 14:e.view.sizeLeft=!0,e.view.sizeRight=!0,e.view.sizeBottom=!0;var o=interaction_view.currentScreenSize?interaction_view.currentScreenSize.x:Reveal.slideScreenWidth,s=o-t.iStartx-(interaction_view.size.x-t.iStartx-t.iWidth);e.view.width=s,e.view=interaction_view.adapt.parseSize(e.view),e.view.x=e.view.staticX+e.view.width/2;var a=t.iStarty+t.iHeight/2;e.view.y=Reveal.slideScreenHeight>Reveal.slideHeight?a+(Reveal.slideScreenHeight-Reveal.slideHeight)/2:a,e.view.staticY=e.view.y-t.iHeight/2;var l=interaction_view.currentScreenSize?interaction_view.currentScreenSize.y:Reveal.slideScreenHeight,c=l-t.iStarty-(interaction_view.size.y-t.iStarty-t.iHeight);e.view.height=c,e.view=interaction_view.adapt.parseOffset(e.view);break;case 15:if(e.view.sizeLeft=!0,e.view.sizeTop=!0,e.view.sizeBottom=!0,Reveal.slideScreenWidth>Reveal.slideWidth)var d=Reveal.slideScreenWidth-Reveal.slideWidth;else var d=0;var o=interaction_view.currentScreenSize?interaction_view.currentScreenSize.x:Reveal.slideScreenWidth,s=o-t.iStartx-(interaction_view.size.x-t.iStartx-t.iWidth)-d;e.view.width=s;var l=interaction_view.currentScreenSize?interaction_view.currentScreenSize.y:Reveal.slideScreenHeight,c=l-t.iStarty-(interaction_view.size.y-t.iStarty-t.iHeight);e.view.height=c,e.view=interaction_view.adapt.parseSize(e.view),e.view.x=e.view.staticX+e.view.width/2,e.view.y=e.view.staticY+e.view.height/2,e.view=interaction_view.adapt.parseOffset(e.view);break;case 16:e.view.sizeRight=!0,e.view.sizeTop=!0,e.view.sizeBottom=!0;var i=t.iStartx+t.iWidth/2;Reveal.slideScreenWidth>Reveal.slideWidth?(e.view.x=i+(Reveal.slideScreenWidth-Reveal.slideWidth)/2,e.view.staticX=e.view.x-t.iWidth/2):e.view.x=i;var o=interaction_view.currentScreenSize?interaction_view.currentScreenSize.x:Reveal.slideScreenWidth,s=o-t.iStartx-(interaction_view.size.x-t.iStartx-t.iWidth);e.view.width=s;var l=interaction_view.currentScreenSize?interaction_view.currentScreenSize.y:Reveal.slideScreenHeight,c=l-t.iStarty-(interaction_view.size.y-t.iStarty-t.iHeight);e.view.height=c,e.view=interaction_view.adapt.parseSize(e.view),e.view.y=e.view.staticY+e.view.height/2,e.view=interaction_view.adapt.parseOffset(e.view);break;case 17:e.view.sizeTop=!0,e.view.staticY=e.view.y-t.iHeight/2,e.view.height=t.iHeight+Reveal.marginTop,e.view.y=e.view.y+Reveal.marginTop/2,e.view=interaction_view.adapt.parseOffset(e.view,{x:!1});break;case 18:e.view.sizeRight=!0,e.view.staticY=e.view.y-t.iHeight/2,e.view.width=t.iWidth+Reveal.marginLeft,e.view.x=e.view.x+Reveal.marginLeft/2,e.view=interaction_view.adapt.parseOffset(e.view,{x:!1,y:!1});break;case 19:e.view.sizeBottom=!0,e.view.staticY=e.view.y-t.iHeight/2,e.view.height=t.iHeight+Reveal.marginTop,e.view.y=e.view.model.isMasterOverlay||e.view.model.isBackgroundOverlay?e.view.y+Reveal.marginTop:e.view.y+Reveal.marginTop/2,e.view=interaction_view.adapt.parseOffset(e.view,{x:!1,y:!1});break;case 20:e.view.sizeLeft=!0,e.view.staticY=e.view.y-t.iHeight/2,e.view.width=t.iWidth+Reveal.marginLeft,e.view.x=e.view.x+Reveal.marginLeft/2,e.view=interaction_view.adapt.parseOffset(e.view,{y:!1})}else{var i=t.iStartx+t.iWidth/2,a=t.iStarty+t.iHeight/2;Reveal.slideScreenWidth>Reveal.slideWidth?(e.view.x=i+(Reveal.slideScreenWidth-Reveal.slideWidth)/2,e.view.staticX=e.view.x-t.iWidth/2):e.view.x=i,Reveal.slideScreenHeight>Reveal.slideHeight?(e.view.y=a+(Reveal.slideScreenHeight-Reveal.slideHeight)/2,e.view.staticY=e.view.y-t.iHeight/2):e.view.y=a,e.view=interaction_view.adapt.parseOffset(e.view)}},change:function(){_.each(interaction_view.adapt.elements,function(e){interaction_view.adapt.excute(e)})},excute:function(e){interaction_view.adapt.adjustElement(e);var t=!1;e.view.model.get("isStatic")?(e.view.width&&(t=!0,e.view.originWidth=e.view.width,e.view.$el.width(e.view.width),e.view.$el.children(".Element").width(e.view.width)),e.view.height&&(t=!0,e.view.originHeight=e.view.height,e.view.$el.height(e.view.height),e.view.$el.children(".Element").height(e.view.height)),e.view.$el.css({left:e.view.staticX,top:e.view.staticY})):(interaction_view.setPos(e.view.$el[0],{x:e.view.x,y:e.view.y}),e.view.width&&(t=!0,e.view.originWidth=e.view.width,e.view.$el.children(".Element").width(e.view.width),e.view.$el.children(".Element").css("left",-e.view.width/2)),e.view.height&&(t=!0,e.view.originHeight=e.view.height,e.view.$el.children(".Element").height(e.view.height),e.view.$el.children(".Element").css("top",-e.view.height/2)),e.view.copyelstyle=e.view.$el.attr("style"),e.view.copyelementstyle=e.view.$el.children(".Element").attr("style")),t&&e.view.onSizeAdaptChange&&e.view.onSizeAdaptChange()}};return e}),define("text!interaction_view/template/analytics.js",[],function(){return'<iframe src="<%=data.src%>" style="border:none;width:0;height:0;" class="analytics_frame"></iframe>'}),define("interaction_view/ui/analytics",["text!interaction_view/template/analytics.js"],function(){var e=(require("text!interaction_view/template/analytics.js"),{set:function(e){}});return e}),define("interaction_view/ui/weixin",[],function(){var e={chooseimage:function(e){return interaction_view.foredit?void global.message("warning","è¯·åœ¨å¾®ä¿¡æ¨¡å¼é¢„è§ˆè¯¥åŠŸèƒ½"):void("undefined"!=typeof wx_permissions&&wx_permissions.chooseImage?wx.chooseImage({success:function(t){t.localIds&&t.localIds.length?e&&e(t.localIds):e&&e(null)}}):interaction_view.weixin.error())},voiceauth:function(){if(interaction_view.foredit)return void global.message("warning","è¯·åœ¨å¾®ä¿¡æ¨¡å¼é¢„è§ˆè¯¥åŠŸèƒ½");if("undefined"!=typeof wx_permissions&&wx_permissions.startRecord){if(interaction_view.weixinvoiceauth)return;wx.startRecord({success:function(){wx.stopRecord({})},cancel:function(){interaction_view.errorAlert("å¼€å¯å¾®ä¿¡åŠŸèƒ½å¤±è´¥")}}),interaction_view.weixinvoiceauth=!0}},shareable:function(){return"undefined"!=typeof wx_permissions&&wx_permissions.onMenuShareTimeline?!0:!1},eventStatistic:function(e){var t="system",i=e,n="weixin",a="www.epub360.com";current_host=window.location.host,-1!=current_host.indexOf("tu960")&&(a=current_host);var r="http://"+a+"/manage/book/"+interaction_view.book_id+"/event.gif?opt_category="+t+"&opt_action="+n+"&opt_label="+i+"&t="+_g.uuid(),o=document.createElement("img");o.src=r,o.onload=function(){}},share:function(){if("undefined"!=typeof wx_permissions&&wx_permissions.onMenuShareTimeline){var e=message_link;"current"==interaction_view.share_page_id?e=_g.changeURLPar(e,"pageid",interaction_view.currentPage):"first"!=interaction_view.share_page_id?e=_g.changeURLPar(e,"pageid",interaction_view.share_page_id):"first"==interaction_view.share_page_id&&message_link.indexOf("pageid")>0&&(e=_g.changeURLPar(e,"pageid","")),wx.onMenuShareAppMessage({title:msgTitle,desc:msgContent,link:e,imgUrl:imgUrl,trigger:function(){_gaq.push(["_trackEvent","weixin","share","appmessage","click"])},success:function(){shareSuccess(),interaction_view.weixin.eventStatistic("å‘é€ç»™æœ‹å‹"),_gaq.push(["_trackSocial","Wechat","appmessage",ga_opt_target,ga_opt_pagePath]),_paq.push(["trackEvent","weixin","share","appmessage"])},cancel:function(){_gaq.push(["_trackEvent","weixin","share","appmessage","cancel"])},fail:function(e){_gaq.push(["_trackEvent","error","weixinjsapi","appmessage",JSON.stringify(e)])}}),wx.onMenuShareTimeline({title:shareTitle,link:e,imgUrl:imgUrl,trigger:function(){_gaq.push(["_trackEvent","weixin","share","timeline","click"])},success:function(){shareSuccess(),interaction_view.weixin.eventStatistic("åˆ†äº«åˆ°æœ‹å‹åœˆ"),_gaq.push(["_trackSocial","Wechat","timeline",ga_opt_target,ga_opt_pagePath]),_paq.push(["trackEvent","weixin","share","timeline"])},cancel:function(){_gaq.push(["_trackEvent","weixin","share","timeline","cancel"])},fail:function(e){_gaq.push(["_trackEvent","error","weixinjsapi","timeline",JSON.stringify(e)])}}),wx.onMenuShareQQ({title:msgTitle,desc:msgContent,link:e,imgUrl:imgUrl,trigger:function(){_gaq.push(["_trackEvent","weixin","share","QQ","click"])},complete:function(){_gaq.push(["_trackEvent","weixin","share","QQ","complete"])},success:function(){shareSuccess(),interaction_view.weixin.eventStatistic("åˆ†äº«åˆ°QQ"),_gaq.push(["_trackSocial","Wechat","QQ",ga_opt_target,ga_opt_pagePath]),_paq.push(["trackEvent","weixin","share","QQ"])},cancel:function(){_gaq.push(["_trackEvent","weixin","share","QQ","cancel"])},fail:function(e){_gaq.push(["_trackEvent","error","weixinjsapi","QQ",JSON.stringify(e)])}}),wx.onMenuShareWeibo({title:msgTitle,desc:msgContent,link:message_link,imgUrl:imgUrl,trigger:function(){_paq.push(["trackEvent","weixin","share","Weibo","click"])},complete:function(){_paq.push(["trackEvent","weixin","share","Weibo","complete"])},success:function(){shareSuccess(),interaction_view.weixin.eventStatistic("åˆ†äº«åˆ°å¾®åš"),_gaq.push(["_trackSocial","Wechat","Weibo",ga_opt_target,ga_opt_pagePath]),_paq.push(["trackEvent","weixin","share","Weibo"])},cancel:function(){_gaq.push(["_trackEvent","weixin","share","Weibo","cancel"])},fail:function(e){_gaq.push(["_trackEvent","error","weixinjsapi","Weibo",JSON.stringify(e)])}})}},error:function(){interaction_view.errorAlert("å¼€å¯å¾®ä¿¡åŠŸèƒ½å¤±è´¥")}};return e}),window.desktop_upload=function(e,t){$("body").append("<input type='file' id='image' name='image' style='display:none;'></input>"),$("#image").click();{var i=context_url+"uploadimage";$("#image").attr("id"),$("#image").val()}$("#image").off("change").on("change",function(){if(e.executeactions.length)for(var n=0;n<e.executeactions.length;n++){var a=e.executeactions[n];"onUploadStart"==a.attributes.iDetail.customType&&a.iview.executeAction(a.iview)}_file_change_simple($(this),["jpg","png","bmp","gif","jpeg"],i,function(i){console.log(i);var n=i.results[0];if(t&&(t(n),e.executeactions.length))for(var a=0;a<e.executeactions.length;a++){var r=e.executeactions[a];"onUploadEnd"==r.attributes.iDetail.customType&&r.iview.executeAction(r.iview)}})})},define("interaction_view/modules/desktop/uploadimage_desktop",function(){}),function(e,t){function i(){n.READY||(n.event.determineEventTypes(),n.utils.each(n.gestures,function(e){n.detection.register(e)}),n.event.onTouch(n.DOCUMENT,n.EVENT_MOVE,n.detection.detect),n.event.onTouch(n.DOCUMENT,n.EVENT_END,n.detection.detect),n.READY=!0)}var n=function(e,t){return new n.Instance(e,t||{})};n.defaults={stop_browser_behavior:{userSelect:"none",touchAction:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}},n.HAS_POINTEREVENTS=e.navigator.pointerEnabled||e.navigator.msPointerEnabled,n.HAS_TOUCHEVENTS="ontouchstart"in e,n.MOBILE_REGEX=/mobile|tablet|ip(ad|hone|od)|android|silk/i,n.NO_MOUSEEVENTS=n.HAS_TOUCHEVENTS&&e.navigator.userAgent.match(n.MOBILE_REGEX),n.EVENT_TYPES={},n.DIRECTION_DOWN="down",n.DIRECTION_LEFT="left",n.DIRECTION_UP="up",n.DIRECTION_RIGHT="right",n.POINTER_MOUSE="mouse",n.POINTER_TOUCH="touch",n.POINTER_PEN="pen",n.EVENT_START="start",n.EVENT_MOVE="move",n.EVENT_END="end",n.DOCUMENT=e.document,n.plugins=n.plugins||{},n.gestures=n.gestures||{},n.READY=!1,n.utils={extend:function(e,i,n){for(var a in i)e[a]!==t&&n||(e[a]=i[a]);return e},each:function(e,i,n){var a,r;if("forEach"in e)e.forEach(i,n);else if(e.length!==t){for(a=0,r=e.length;r>a;a++)if(i.call(n,e[a],a,e)===!1)return}else for(a in e)if(e.hasOwnProperty(a)&&i.call(n,e[a],a,e)===!1)return},hasParent:function(e,t){for(;e;){if(e==t)return!0;e=e.parentNode}return!1},getCenter:function(e){var t=[],i=[];return n.utils.each(e,function(e){t.push("undefined"!=typeof e.clientX?e.clientX:e.pageX),i.push("undefined"!=typeof e.clientY?e.clientY:e.pageY)}),{pageX:(Math.min.apply(Math,t)+Math.max.apply(Math,t))/2,pageY:(Math.min.apply(Math,i)+Math.max.apply(Math,i))/2}},getVelocity:function(e,t,i){return{x:Math.abs(t/e)||0,y:Math.abs(i/e)||0}},getAngle:function(e,t){var i=t.pageY-e.pageY,n=t.pageX-e.pageX;return 180*Math.atan2(i,n)/Math.PI},getDirection:function(e,t){var i=Math.abs(e.pageX-t.pageX),a=Math.abs(e.pageY-t.pageY);return i>=a?e.pageX-t.pageX>0?n.DIRECTION_LEFT:n.DIRECTION_RIGHT:e.pageY-t.pageY>0?n.DIRECTION_UP:n.DIRECTION_DOWN},getDistance:function(e,t){var i=t.pageX-e.pageX,n=t.pageY-e.pageY;return Math.sqrt(i*i+n*n)},getScale:function(e,t){return e.length>=2&&t.length>=2?this.getDistance(t[0],t[1])/this.getDistance(e[0],e[1]):1},getRotation:function(e,t){return e.length>=2&&t.length>=2?this.getAngle(t[1],t[0])-this.getAngle(e[1],e[0]):0},isVertical:function(e){return e==n.DIRECTION_UP||e==n.DIRECTION_DOWN},stopDefaultBrowserBehavior:function(e,t){t&&e&&e.style&&(n.utils.each(["webkit","khtml","moz","Moz","ms","o",""],function(i){n.utils.each(t,function(t,n){i&&(n=i+n.substring(0,1).toUpperCase()+n.substring(1)),n in e.style&&(e.style[n]=t)})}),"none"==t.userSelect&&(e.onselectstart=function(){return!1}),"none"==t.userDrag&&(e.ondragstart=function(){return!1}))}},n.Instance=function(e,t){var a=this;return i(),this.element=e,this.enabled=!0,this.options=n.utils.extend(n.utils.extend({},n.defaults),t||{}),this.options.stop_browser_behavior&&n.utils.stopDefaultBrowserBehavior(this.element,this.options.stop_browser_behavior),n.event.onTouch(e,n.EVENT_START,function(e){a.enabled&&n.detection.startDetect(a,e)}),this},n.Instance.prototype={on:function(e,t){var i=e.split(" ");return n.utils.each(i,function(e){this.element.addEventListener(e,t,!1)},this),this},off:function(e,t){var i=e.split(" ");return n.utils.each(i,function(e){this.element.removeEventListener(e,t,!1)},this),this},trigger:function(e,t){t||(t={});var i=n.DOCUMENT.createEvent("Event");i.initEvent(e,!0,!0),i.gesture=t;var a=this.element;return n.utils.hasParent(t.target,a)&&(a=t.target),a.dispatchEvent(i),this},enable:function(e){return this.enabled=e,this},reset:function(){a=null,r=!1,o=!1,n.PointerEvent.reset()}};var a=null,r=!1,o=!1;n.event={bindDom:function(e,t,i){var a=t.split(" ");n.utils.each(a,function(t){e.addEventListener(t,i,!1)})},onTouch:function(e,t,i){var s=this;this.bindDom(e,n.EVENT_TYPES[t],function(l){var c=l.type.toLowerCase();if(!c.match(/mouse/)||!o){c.match(/touch/)||c.match(/pointerdown/)||c.match(/mouse/)&&1===l.which?r=!0:c.match(/mouse/)&&!l.which&&(r=!1),c.match(/touch|pointer/)&&(o=!0);var d=0;r&&(n.HAS_POINTEREVENTS&&t!=n.EVENT_END?d=n.PointerEvent.updatePointer(t,l):c.match(/touch/)?d=l.touches.length:o||(d=c.match(/up/)?0:1),d>0&&t==n.EVENT_END?t=n.EVENT_MOVE:d||(t=n.EVENT_END),(d||null===a)&&(a=l),i.call(n.detection,s.collectEventData(e,t,s.getTouchList(a,t),l)),n.HAS_POINTEREVENTS&&t==n.EVENT_END&&(d=n.PointerEvent.updatePointer(t,l))),d||(a=null,r=!1,o=!1,n.PointerEvent.reset())}})},determineEventTypes:function(){var e;e=n.HAS_POINTEREVENTS?n.PointerEvent.getEvents():n.NO_MOUSEEVENTS?["touchstart","touchmove","touchend touchcancel"]:["touchstart mousedown","touchmove mousemove","touchend touchcancel mouseup"],n.EVENT_TYPES[n.EVENT_START]=e[0],n.EVENT_TYPES[n.EVENT_MOVE]=e[1],n.EVENT_TYPES[n.EVENT_END]=e[2]},getTouchList:function(e){return n.HAS_POINTEREVENTS?n.PointerEvent.getTouchList():e.touches?e.touches:(e.identifier=1,[e])},collectEventData:function(e,t,i,a){var r=n.POINTER_TOUCH;
return(a.type.match(/mouse/)||n.PointerEvent.matchType(n.POINTER_MOUSE,a))&&(r=n.POINTER_MOUSE),{center:n.utils.getCenter(i),timeStamp:(new Date).getTime(),target:a.target,touches:i,eventType:t,pointerType:r,srcEvent:a,preventDefault:function(){this.srcEvent.preventManipulation&&this.srcEvent.preventManipulation(),this.srcEvent.preventDefault&&this.srcEvent.preventDefault()},stopPropagation:function(){this.srcEvent.stopPropagation()},stopDetect:function(){return n.detection.stopDetect()}}}},n.PointerEvent={pointers:{},getTouchList:function(){var e=this,t=[];return n.utils.each(e.pointers,function(e){t.push(e)}),t},updatePointer:function(e,t){return e==n.EVENT_END?this.pointers={}:(t.identifier=t.pointerId,this.pointers[t.pointerId]=t),Object.keys(this.pointers).length},matchType:function(e,t){if(!t.pointerType)return!1;var i=t.pointerType,a={};return a[n.POINTER_MOUSE]=i===t.MSPOINTER_TYPE_MOUSE||i===n.POINTER_MOUSE,a[n.POINTER_TOUCH]=i===t.MSPOINTER_TYPE_TOUCH||i===n.POINTER_TOUCH,a[n.POINTER_PEN]=i===t.MSPOINTER_TYPE_PEN||i===n.POINTER_PEN,a[e]},getEvents:function(){return["pointerdown MSPointerDown","pointermove MSPointerMove","pointerup pointercancel MSPointerUp MSPointerCancel"]},reset:function(){this.pointers={}}},n.detection={gestures:[],current:null,previous:null,stopped:!1,startDetect:function(e,t){this.current||(this.stopped=!1,this.current={inst:e,startEvent:n.utils.extend({},t),lastEvent:!1,name:""},this.detect(t))},detect:function(e){if(this.current&&!this.stopped){e=this.extendEventData(e);var t=this.current.inst.options;return n.utils.each(this.gestures,function(i){return this.stopped||t[i.name]===!1||i.handler.call(i,e,this.current.inst)!==!1?void 0:(this.stopDetect(),!1)},this),this.current&&(this.current.lastEvent=e),e.eventType==n.EVENT_END&&!e.touches.length-1&&this.stopDetect(),e}},stopDetect:function(){this.previous=n.utils.extend({},this.current),this.current=null,this.stopped=!0},extendEventData:function(e){var t=this.current.startEvent;!t||e.touches.length==t.touches.length&&e.touches!==t.touches||(t.touches=[],n.utils.each(e.touches,function(e){t.touches.push(n.utils.extend({},e))}));var i,a,r=e.timeStamp-t.timeStamp,o=e.center.pageX-t.center.pageX,s=e.center.pageY-t.center.pageY,l=n.utils.getVelocity(r,o,s);return"end"===e.eventType?(i=this.current.lastEvent&&this.current.lastEvent.interimAngle,a=this.current.lastEvent&&this.current.lastEvent.interimDirection):(i=this.current.lastEvent&&n.utils.getAngle(this.current.lastEvent.center,e.center),a=this.current.lastEvent&&n.utils.getDirection(this.current.lastEvent.center,e.center)),n.utils.extend(e,{deltaTime:r,deltaX:o,deltaY:s,velocityX:l.x,velocityY:l.y,distance:n.utils.getDistance(t.center,e.center),angle:n.utils.getAngle(t.center,e.center),interimAngle:i,direction:n.utils.getDirection(t.center,e.center),interimDirection:a,scale:n.utils.getScale(t.touches,e.touches),rotation:n.utils.getRotation(t.touches,e.touches),startEvent:t}),e},register:function(e){var i=e.defaults||{};return i[e.name]===t&&(i[e.name]=!0),n.utils.extend(n.defaults,i,!0),e.index=e.index||1e3,this.gestures.push(e),this.gestures.sort(function(e,t){return e.index<t.index?-1:e.index>t.index?1:0}),this.gestures}},n.gestures.Drag={name:"drag",index:50,defaults:{drag_min_distance:-1!==e.navigator.userAgent.toLowerCase().indexOf("android")?5:10,correct_for_drag_min_distance:!0,drag_max_touches:1,drag_block_horizontal:!1,drag_block_vertical:!1,drag_lock_to_axis:!1,drag_lock_min_distance:25},triggered:!1,handler:function(e,t){if(n.detection.current&&n.detection.current.name!=this.name&&this.triggered)return t.trigger(this.name+"end",e),void(this.triggered=!1);if(!(t.options.drag_max_touches>0&&e.touches.length>t.options.drag_max_touches))switch(e.eventType){case n.EVENT_START:this.triggered=!1;break;case n.EVENT_MOVE:if(e.distance<t.options.drag_min_distance&&n.detection.current.name!=this.name)return;if(n.detection.current.name!=this.name&&(n.detection.current.name=this.name,t.options.correct_for_drag_min_distance&&e.distance>0)){var i=Math.abs(t.options.drag_min_distance/e.distance);n.detection.current.startEvent.center.pageX+=e.deltaX*i,n.detection.current.startEvent.center.pageY+=e.deltaY*i,e=n.detection.extendEventData(e)}(n.detection.current.lastEvent.drag_locked_to_axis||t.options.drag_lock_to_axis&&t.options.drag_lock_min_distance<=e.distance)&&(e.drag_locked_to_axis=!0);var a=n.detection.current.lastEvent.direction;e.drag_locked_to_axis&&a!==e.direction&&(e.direction=n.utils.isVertical(a)?e.deltaY<0?n.DIRECTION_UP:n.DIRECTION_DOWN:e.deltaX<0?n.DIRECTION_LEFT:n.DIRECTION_RIGHT),this.triggered||(t.trigger(this.name+"start",e),this.triggered=!0),t.trigger(this.name,e),t.trigger(this.name+e.direction,e),(t.options.drag_block_vertical&&n.utils.isVertical(e.direction)||t.options.drag_block_horizontal&&!n.utils.isVertical(e.direction))&&e.preventDefault();break;case n.EVENT_END:this.triggered&&t.trigger(this.name+"end",e),this.triggered=!1}}},n.gestures.Hold={name:"hold",index:10,defaults:{hold_timeout:800,hold_threshold:1},timer:null,handler:function(e,t){switch(e.eventType){case n.EVENT_START:clearTimeout(this.timer),n.detection.current.name=this.name,this.timer=setTimeout(function(){n.detection.current&&"hold"==n.detection.current.name&&t.trigger("hold",e)},t.options.hold_timeout);break;case n.EVENT_MOVE:e.distance>t.options.hold_threshold&&clearTimeout(this.timer);break;case n.EVENT_END:clearTimeout(this.timer)}}},n.gestures.Release={name:"release",index:1/0,handler:function(e,t){e.eventType==n.EVENT_END&&t.trigger(this.name,e)}},n.gestures.Swipe={name:"swipe",index:40,defaults:{swipe_min_touches:1,swipe_max_touches:1,swipe_velocity:.7},handler:function(e,t){if(e.eventType==n.EVENT_END){if(t.options.swipe_max_touches>0&&e.touches.length<t.options.swipe_min_touches&&e.touches.length>t.options.swipe_max_touches)return;(e.velocityX>t.options.swipe_velocity||e.velocityY>t.options.swipe_velocity)&&(t.trigger(this.name,e),t.trigger(this.name+e.direction,e))}}},n.gestures.Tap={name:"tap",index:100,defaults:{tap_max_touchtime:250,tap_max_distance:10,tap_always:!0,doubletap_distance:20,doubletap_interval:300},handler:function(e,t){if(e.eventType==n.EVENT_END&&"touchcancel"!=e.srcEvent.type){var i=n.detection.previous,a=!1;if(e.deltaTime>t.options.tap_max_touchtime||e.distance>t.options.tap_max_distance)return;i&&"tap"==i.name&&e.timeStamp-i.lastEvent.timeStamp<t.options.doubletap_interval&&e.distance<t.options.doubletap_distance&&(t.trigger("doubletap",e),a=!0),(!a||t.options.tap_always)&&(n.detection.current.name="tap",t.trigger(n.detection.current.name,e))}}},n.gestures.Touch={name:"touch",index:-1/0,defaults:{prevent_default:!1,prevent_mouseevents:!1},handler:function(e,t){return t.options.prevent_mouseevents&&e.pointerType==n.POINTER_MOUSE?void e.stopDetect():(t.options.prevent_default&&e.preventDefault(),void(e.eventType==n.EVENT_START&&t.trigger(this.name,e)))}},n.gestures.Transform={name:"transform",index:45,defaults:{transform_min_scale:.01,transform_min_rotation:1,transform_always_block:!1},triggered:!1,handler:function(e,t){if(n.detection.current.name!=this.name&&this.triggered)return t.trigger(this.name+"end",e),void(this.triggered=!1);if(!(e.touches.length<2))switch(t.options.transform_always_block&&e.preventDefault(),e.eventType){case n.EVENT_START:this.triggered=!1;break;case n.EVENT_MOVE:var i=Math.abs(1-e.scale),a=Math.abs(e.rotation);if(i<t.options.transform_min_scale&&a<t.options.transform_min_rotation)return;n.detection.current.name=this.name,this.triggered||(t.trigger(this.name+"start",e),this.triggered=!0),t.trigger(this.name,e),a>t.options.transform_min_rotation&&t.trigger("rotate",e),i>t.options.transform_min_scale&&(t.trigger("pinch",e),t.trigger("pinch"+(e.scale<1?"in":"out"),e));break;case n.EVENT_END:this.triggered&&t.trigger(this.name+"end",e),this.triggered=!1}}},"function"==typeof define&&define.amd?define("hammerjs",[],function(){return n}):"object"==typeof module&&module.exports?module.exports=n:e.Hammer=n}(window),function(e,t){function i(e,i){e.event.bindDom=function(e,n,a){i(e).on(n,function(e){var i=e.originalEvent||e;i.pageX===t&&(i.pageX=e.pageX,i.pageY=e.pageY),i.target||(i.target=e.target),i.which===t&&(i.which=i.button),i.preventDefault||(i.preventDefault=e.preventDefault),i.stopPropagation||(i.stopPropagation=e.stopPropagation),a.call(this,i)})},e.Instance.prototype.on=function(e,t){return i(this.element).on(e,t)},e.Instance.prototype.off=function(e,t){return i(this.element).off(e,t)},e.Instance.prototype.trigger=function(e,t){var n=i(this.element);return n.has(t.target).length&&(n=i(t.target)),n.trigger({type:e,gesture:t})},i.fn.hammer=function(t){return this.each(function(){var n=i(this),a=n.data("hammer");a?"reset"==t?e.detection.current=null:a&&t&&e.utils.extend(a.options,t):n.data("hammer",new e(this,t||{}))})}}"function"==typeof define&&"object"==typeof define.amd&&define.amd?define("jquery.hammer",["hammerjs","jquery"],i):i(e.Hammer,e.jQuery||e.Zepto)}(this),function(e){function t(e){if(e in h.style)return e;var t=["Moz","Webkit","O","ms"],i=e.charAt(0).toUpperCase()+e.substr(1);if(e in h.style)return e;for(var n=0;n<t.length;++n){var a=t[n]+i;if(a in h.style)return a}}function i(){return h.style[u.transform]="",h.style[u.transform]="rotateY(90deg)",""!==h.style[u.transform]}function n(e){return"string"==typeof e&&this.parse(e),this}function a(e,t,i){t===!0?e.queue(i):t?e.queue(t,i):i()}function r(t){var i=[];return e.each(t,function(t){t=e.camelCase(t),t=e.transit.propertyMap[t]||e.cssProps[t]||t,t=l(t),-1===e.inArray(t,i)&&i.push(t)}),i}function o(t,i,n,a){var o=r(t);e.cssEase[n]&&(n=e.cssEase[n]);var s=""+d(i)+" "+n;parseInt(a,10)>0&&(s+=" "+d(a));var l=[];return e.each(o,function(e,t){l.push(t+" "+s)}),l.join(", ")}function s(t,i){i||(e.cssNumber[t]=!0),e.transit.propertyMap[t]=u.transform,e.cssHooks[t]={get:function(i){var n=e(i).css("transit:transform");return n.get(t)},set:function(i,n){var a=e(i).css("transit:transform");a.setFromString(t,n),e(i).css({"transit:transform":a})}}}function l(e){return e.replace(/([A-Z])/g,function(e){return"-"+e.toLowerCase()})}function c(e,t){return"string"!=typeof e||e.match(/^[\-0-9\.]+$/)?""+e+t:e}function d(t){var i=t;return e.fx.speeds[i]&&(i=e.fx.speeds[i]),c(i,"ms")}e.transit={version:"0.9.9",propertyMap:{marginLeft:"margin",marginRight:"margin",marginBottom:"margin",marginTop:"margin",paddingLeft:"padding",paddingRight:"padding",paddingBottom:"padding",paddingTop:"padding"},enabled:!0,useTransitionEnd:!1};var h=document.createElement("div"),u={},p=navigator.userAgent.toLowerCase().indexOf("chrome")>-1;u.transition=t("transition"),u.transitionDelay=t("transitionDelay"),u.transform=t("transform"),u.transformOrigin=t("transformOrigin"),u.transform3d=i();var v={transition:"transitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",WebkitTransition:"webkitTransitionEnd",msTransition:"MSTransitionEnd"},g=u.transitionEnd=v[u.transition]||null;for(var f in u)u.hasOwnProperty(f)&&"undefined"==typeof e.support[f]&&(e.support[f]=u[f]);h=null,e.cssEase={_default:"ease","in":"ease-in",out:"ease-out","in-out":"ease-in-out",snap:"cubic-bezier(0,1,.5,1)",easeOutCubic:"cubic-bezier(.215,.61,.355,1)",easeInOutCubic:"cubic-bezier(.645,.045,.355,1)",easeInCirc:"cubic-bezier(.6,.04,.98,.335)",easeOutCirc:"cubic-bezier(.075,.82,.165,1)",easeInOutCirc:"cubic-bezier(.785,.135,.15,.86)",easeInExpo:"cubic-bezier(.95,.05,.795,.035)",easeOutExpo:"cubic-bezier(.19,1,.22,1)",easeInOutExpo:"cubic-bezier(1,0,0,1)",easeInQuad:"cubic-bezier(.55,.085,.68,.53)",easeOutQuad:"cubic-bezier(.25,.46,.45,.94)",easeInOutQuad:"cubic-bezier(.455,.03,.515,.955)",easeInQuart:"cubic-bezier(.895,.03,.685,.22)",easeOutQuart:"cubic-bezier(.165,.84,.44,1)",easeInOutQuart:"cubic-bezier(.77,0,.175,1)",easeInQuint:"cubic-bezier(.755,.05,.855,.06)",easeOutQuint:"cubic-bezier(.23,1,.32,1)",easeInOutQuint:"cubic-bezier(.86,0,.07,1)",easeInSine:"cubic-bezier(.47,0,.745,.715)",easeOutSine:"cubic-bezier(.39,.575,.565,1)",easeInOutSine:"cubic-bezier(.445,.05,.55,.95)",easeInBack:"cubic-bezier(.6,-.28,.735,.045)",easeOutBack:"cubic-bezier(.175, .885,.32,1.275)",easeInOutBack:"cubic-bezier(.68,-.55,.265,1.55)",epubOut:"cubic-bezier(.3,1,.0,1)"},e.cssHooks["transit:transform"]={get:function(t){return e(t).data("transform")||new n},set:function(t,i){var a=i;a instanceof n||(a=new n(a)),t.style[u.transform]="WebkitTransform"!==u.transform||p?a.toString():a.toString(!0),e(t).data("transform",a)}},e.cssHooks.transform={set:e.cssHooks["transit:transform"].set},e.fn.jquery<"1.8"&&(e.cssHooks.transformOrigin={get:function(e){return e.style[u.transformOrigin]},set:function(e,t){e.style[u.transformOrigin]=t}},e.cssHooks.transition={get:function(e){return e.style[u.transition]},set:function(e,t){e.style[u.transition]=t}}),s("scale"),s("translate"),s("translateZ"),s("rotate"),s("rotateX"),s("rotateY"),s("rotate3d"),s("perspective"),s("skewX"),s("skewY"),s("x",!0),s("y",!0),n.prototype={setFromString:function(e,t){var i="string"==typeof t?t.split(","):t.constructor===Array?t:[t];i.unshift(e),n.prototype.set.apply(this,i)},set:function(e){var t=Array.prototype.slice.apply(arguments,[1]);this.setter[e]?this.setter[e].apply(this,t):this[e]=t.join(",")},get:function(e){return this.getter[e]?this.getter[e].apply(this):this[e]||0},setter:{rotate:function(e){this.rotate=c(e,"deg")},rotateX:function(e){this.rotateX=c(e,"deg")},rotateY:function(e){this.rotateY=c(e,"deg")},scale:function(e,t){void 0===t&&(t=e),this.scale=e+","+t},skewX:function(e){this.skewX=c(e,"deg")},skewY:function(e){this.skewY=c(e,"deg")},perspective:function(e){this.perspective=c(e,"px")},x:function(e){this.set("translate",e,null)},y:function(e){this.set("translate",null,e)},translate:function(e,t){void 0===this._translateX&&(this._translateX=0),void 0===this._translateY&&(this._translateY=0),null!==e&&void 0!==e&&(this._translateX=c(e,"px")),null!==t&&void 0!==t&&(this._translateY=c(t,"px")),this.translate=this._translateX+","+this._translateY},translateZ:function(e){this.translateZ=c(e,"px")}},getter:{x:function(){return this._translateX||0},y:function(){return this._translateY||0},translateZ:function(){return this.translateZ||0},scale:function(){var e=(this.scale||"1,1").split(",");return e[0]&&(e[0]=parseFloat(e[0])),e[1]&&(e[1]=parseFloat(e[1])),e[0]===e[1]?e[0]:e},rotate3d:function(){for(var e=(this.rotate3d||"0,0,0,0deg").split(","),t=0;3>=t;++t)e[t]&&(e[t]=parseFloat(e[t]));return e[3]&&(e[3]=c(e[3],"deg")),e}},parse:function(e){var t=this;e.replace(/([a-zA-Z0-9]+)\((.*?)\)/g,function(e,i,n){t.setFromString(i,n)})},toString:function(e){var t=[];for(var i in this)if(this.hasOwnProperty(i)){if(!u.transform3d&&("rotateX"===i||"rotateY"===i||"translateZ"===i||"perspective"===i||"transformOrigin"===i))continue;"_"!==i[0]&&t.push(e&&"scale"===i?i+"3d("+this[i]+",1)":e&&"translate"===i?i+"3d("+this[i]+",0)":i+"("+this[i]+")")}return t.join(" ")}},e.fn.transition=e.fn.transit=function(t,i,n,r){var s=this,l=0,c=!0;"function"==typeof i&&(r=i,i=void 0),"function"==typeof n&&(r=n,n=void 0),"undefined"!=typeof t.easing&&(n=t.easing,delete t.easing),"undefined"!=typeof t.duration&&(i=t.duration,delete t.duration),"undefined"!=typeof t.complete&&(r=t.complete,delete t.complete),"undefined"!=typeof t.queue&&(c=t.queue,delete t.queue),"undefined"!=typeof t.delay&&(l=t.delay,delete t.delay),"undefined"==typeof i&&(i=e.fx.speeds._default),"undefined"==typeof n&&(n=e.cssEase._default),e.fx.off&&(i=0),i=d(i);var h=o(t,i,n,l),p=e.transit.enabled&&u.transition,v=p?parseInt(i,10)+parseInt(l,10):0;if(0===v){var f=function(e){s.css(t),r&&r.apply(s),e&&e()};return a(s,c,f),s}var m={},_=function(i){var n=!1,a=function(){n&&s.unbind(g,a),v>0&&s.each(function(){this.style[u.transition]=m[this]||null}),"function"==typeof r&&r.apply(s),"function"==typeof i&&i()};v>0&&g&&e.transit.useTransitionEnd?(n=!0,s.bind(g,a)):window.setTimeout(a,v),s.each(function(){v>0&&(this.style[u.transition]=h),e(this).css(t)})},w=function(e){this.offsetWidth,_(e)};return a(s,c,w),this},e.transit.getTransitionValue=o}("undefined"!=typeof jQuery?jQuery:Zepto),define("jquery.transit",["jquery"],function(){}),function(){var e={0:{x:{activeItem:{x:function(e,t){return-e*(1-t)*100+"%"}},currentItem:{x:function(e,t){return e*t*100+"%"}}},y:{activeItem:{y:function(e,t){return-e*(1-t)*100+"%"}},currentItem:{y:function(e,t){return e*t*100+"%"}}},perspective:!1,currentEasing:"snap",activeEasing:"snap"},1:{x:{activeItem:{x:function(e,t){return-e*(1-t)*100+"%"}},currentItem:{x:0}},y:{activeItem:{y:function(e,t){return-e*(1-t)*100+"%"}},currentItem:{y:0}},activeTop:!0,perspective:!1,currentEasing:"snap",activeEasing:"snap"},2:{x:{activeItem:{},currentItem:{opacity:function(e,t){return 1-t}}},y:{activeItem:{},currentItem:{opacity:function(e,t){return 1-t}}},currentTop:!0,perspective:!1,currentEasing:"snap",activeEasing:"snap"},3:{perspective:!0,currentEasing:"out",activeEasing:"in",currentTop:!0,percentcontrol:[.5,1],.5:{x:{activeItem:{rotateY:function(e){return 90*-e+"deg"},opacity:.2},currentItem:{rotateY:function(e,t){return 90*e*t*2+"deg"},opacity:function(e,t){return.2+.8*(1-2*t)}}},y:{activeItem:{rotateX:function(e){return 90*e+"deg"},opacity:.2},currentItem:{rotateX:function(e,t){return 90*-e*t*2+"deg"},opacity:function(e,t){return.2+.8*(1-2*t)}}}},1:{x:{activeItem:{rotateY:function(e,t){return 90*-e*(1-2*(t-.5))+"deg"},opacity:function(e,t){return.2+.8*(t-.5)*2}},currentItem:{rotateY:function(e){return 90*e+"deg"},opacity:.2}},y:{activeItem:{rotateX:function(e,t){return 90*e*(1-2*(t-.5))+"deg"},opacity:function(e,t){return.2+.8*(t-.5)*2}},currentItem:{rotateX:function(e){return 90*-e+"deg"},opacity:.2}}}},4:{x:{css:{currentItem:{transformOrigin:function(e){return 0>e?"100% 50%":"0% 50%"}},activeItem:{transformOrigin:function(e){return e>0?"100% 50%":"0% 50%"}}},activeItem:{x:function(e,t){return-e*(1-t)*100+"%"},opacity:function(e,t){return t},rotateY:function(e,t){return-e*(1-t)*90+"deg"}},currentItem:{x:function(e,t){return e*t*100+"%"},rotateY:function(e,t){return e*t*90+"deg"},opacity:function(e,t){return 1-t}}},y:{css:{currentItem:{transformOrigin:function(e){return 0>e?"50% 100%":"50% 0%"}},activeItem:{transformOrigin:function(e){return e>0?"50% 100%":"50% 0%"}}},activeItem:{y:function(e,t){return-e*(1-t)*100+"%"},opacity:function(e,t){return t},rotateX:function(e,t){return e*(1-t)*90+"deg"}},currentItem:{y:function(e,t){return e*t*100+"%"},rotateX:function(e,t){return-e*t*90+"deg"},opacity:function(e,t){return 1-t}}},currentTop:!0,perspective:!0,currentEasing:"easeOutCubic",activeEasing:"easeOutCubic"},5:{x:{css:{currentItem:{transformOrigin:function(e){return e>0?"100% 50%":"0% 50%"}}},activeItem:{x:function(e,t){return-e*(1-t)*100+"%"}},currentItem:{x:0,scale:function(e,t){return.5+.5*(1-t)}}},y:{css:{currentItem:{transformOrigin:function(e){return e>0?"50% 100%":"50% 0%"}}},activeItem:{y:function(e,t){return-e*(1-t)*100+"%"}},currentItem:{y:0,scale:function(e,t){return.5+.5*(1-t)}}},activeTop:!0,perspective:!1,currentEasing:"epubOut",activeEasing:"epubOut"}};"undefined"==typeof require?(window._g||(window._g={}),window._g.transitionargs=e):define("_g/transitionargs",["_g/base"],function(){return window._g.transitionargs=e,window._g.transitionargs})}(window),function(){function e(e,t){var i=1200;return"x"===e?"perspective("+i+"px) rotateY("+t+"rad)":"perspective("+i+"px) rotateX("+-t+"rad)"}var t={support:function(){try{return document.createEvent("TouchEvent"),!0}catch(e){return!1}}(),bind:function(){}},n=document.createElement("div"),a=function(e,t){return null==t&&(t=n),void 0!==t.style[e]?e:void 0},r=a("webkitTransform"),o=(a("webkitTransitionProperty"),a("webkitTransitionDuration")),s=(a("webkitTransitionTimingFunction"),a("webkitTransition")),l=function(e){this.init(e)};l.prototype={isDraged:!1,init:function(e){var t={containment:null,containmentClass:"c-transition-containment",perspectiveClass:"c-perspective",itemClass:"c-transition-item",currentClass:"c-transition-current",leftClass:"c-transition-left",rightClass:"c-transition-right",upClass:"c-transition-up",downClass:"c-transition-down",activeClass:"c-transition-active",topClass:"c-transition-top",repeat:!1,direction:0,type:1,duration:1e3,onStart:null,onEnd:function(){},onCancel:function(){},control:!0,autoplay:!1,width:null,height:null,disableControlled:!1,autoplayDirection:-1,autoplayAxis:null};if(this.opts=e?$.extend(!0,{},t,e):t,!this.opts.containment)return!1;if($(this.opts.containment).addClass(this.opts.containmentClass),_.bindAll(this),7==this.opts.type){var i="flipboardStyle";if(!document.getElementById(i)){var n=document.createElement("style");n.setAttribute("id",i),n.innerHTML='[data-flap]{-webkit-backface-visibility:hidden;backface-visibility:hidden}[data-flap].backface-visible{-webkit-backface-visibility:visible;backface-visibility:visible}[data-flap="left"],[data-flap="right"]{z-index:1}[data-flap="front"],[data-flap="back"]{z-index:2}.flap-shadow{position:absolute;top:0;width:50%;height:100%;background:#000;z-index:99999}.flap-shadowY{position:absolute;left:0;width:100%;height:50%;background:#000;z-index:99999}.flap-shadow.left,.flap-shadow.back{left:0}.flap-shadow.right,.flap-shadow.front{right:0}.flap-shadowY.up,.flap-shadowY.bottom{top:0}.flap-shadowY.down,.flap-shadowY.top{bottom:0}.flap-shadow.flap-gradient{background:linear-gradient(to right,rgba(0,0,0,0.5) 0,rgba(0,0,0,0) 100%)}.flap-shadow.back.flap-gradient{background:linear-gradient(to left,rgba(0,0,0,0.5) 0,rgba(0,0,0,0) 100%)}.flap-shadowY.flap-gradient{background:linear-gradient(to top,rgba(0,0,0,0.5) 0,rgba(0,0,0,0) 100%);background:-webkit-linear-gradient(to top,rgba(0,0,0,0.5) 0,rgba(0,0,0,0) 100%)}.flap-shadowY.top.flap-gradient{background:linear-gradient(to bottom,rgba(0,0,0,0.5) 0,rgba(0,0,0,0) 100%);background:-webkit-linear-gradient(to bottom,rgba(0,0,0,0.5) 0,rgba(0,0,0,0) 100%)}',(document.getElementsByTagName("head")[0]||document.body).appendChild(n)}var a=$(this.opts.containment);this.container=a[0],this.$container=a;var r=this.opts.width||this.$container.width(),o=this.opts.height||this.$container.height();this.width=r%2?r+1:r,this.height=o%2?o+1:o,this.hack=this.width>r||this.height>o,a.attr("data-hack",this.hack);var s=a.offset(),l=this.opts.boundary||0;interaction_view.ismobile?(this.boundaryStart=l+s.left,this.boundaryEnd=r-l-s.left,this.boundaryStartY=l+s.top,this.boundaryEndY=o-l-s.top):(this.boundaryStart=l,this.boundaryEnd=r-l,this.boundaryStartY=l,this.boundaryEndY=o-l),this.PI=Math.PI,this.dur=this.opts.duration||"1000",this.rad=this.opts.rad||.5,this.isTransiting=!1,this.shadowOpacity=this.opts.shadowOpacity||.1;var c=this;$(window).resize(function(){c.resize()}),$(this.opts.containment).on("touchend",function(){setTimeout(function(){c.key&&!c.isTransiting&&(console.log("transition is touchended"),c.clearNode(!0))},50)})}return this.opts.control&&(this.control(),this.opts.disableControlled&&this.disableControl()),this.opts.autostart?(this.timerDisabled=!1,this.timerstart({})):this.timerDisabled=!0,this},resize:function(){var e=this.opts.width||this.$container.width(),t=this.opts.height||this.$container.height();this.width=e%2?e+1:e,this.height=t%2?t+1:t,this.hack=this.width>e||this.height>t,this.$container.attr("data-hack",this.hack);var i=this.$container.offset(),n=this.opts.boundary||20;this.boundaryStart=n+i.left,this.boundaryEnd=e-n-i.left,this.boundaryStartY=n+i.top,this.boundaryEndY=t-n-i.top},disableControlled:!1,disableControl:function(){this.disableControlled=!0},enableControl:function(){this.disableControlled=!1},control:function(){var e=this;_g.dragcontrol.bind({el:this.opts.containment,dragstart:function(t){e.disableControlled||e.start(t)},dragleft:function(t){e.disableControlled||e.dragX(t)},dragright:function(t){e.disableControlled||e.dragX(t)},dragup:function(t){e.disableControlled||e.dragY(t)},dragdown:function(t){e.disableControled||e.dragY(t)},dragend:function(t){if(!e.disableControlled){if(e.direction&&!e.timerDisabled){var i="x"==e.direction?t.gesture.deltaX:t.gesture.deltaY;e.TimerDirection=i>0?1:-1}e.dragEnd(t)}},canDragX:function(){return e.opts.autoplayAxis&&"x"!=e.opts.autoplayAxis?!1:!0},canDragY:function(){return e.opts.autoplayAxis&&"y"!=e.opts.autoplayAxis?!1:!0}})},stashitemClass:function(){$(this.opts.containment).find("."+this.opts.itemClass).css({transform:"","-moz-transform":"","-webkit-transform":"","-o-transform":"","-ms-transform":"",opacity:""}),this.stashClass={current:$(this.opts.containment).find("."+this.opts.currentClass).attr("style"),left:$(this.opts.containment).find("."+this.opts.leftClass).attr("style"),right:$(this.opts.containment).find("."+this.opts.rightClass).attr("style"),up:$(this.opts.containment).find("."+this.opts.upClass).attr("style"),down:$(this.opts.containment).find("."+this.opts.downClass).attr("style")},this.stashed=!0},recoveritemClass:function(){if(this.stashed)try{this.currentItem.attr("style",this.stashClass.current||""),this.activeItem.hasClass(this.opts.leftClass)?this.activeItem.attr("style",this.stashClass.left||""):this.activeItem.hasClass(this.opts.rightClass)?this.activeItem.attr("style",this.stashClass.right||""):this.activeItem.hasClass(this.opts.upClass)?this.activeItem.attr("style",this.stashClass.up||""):this.activeItem.hasClass(this.opts.downClass)&&this.activeItem.attr("style",this.stashClass.down||"")}catch(e){console.log(e)}$(this.opts.containment).find("."+this.opts.itemClass).css({transform:"","-moz-transform":"","-webkit-transform":"","-o-transform":"","-ms-transform":"",opacity:""}),this.stashed=!1},start:function(e,t){this.isTransiting||(this.key=1*new Date,void 0==t&&(t=this.opts.type),this.args=_g.transitionargs[t]||{},this.args.perspective?$(this.opts.containment).addClass(this.opts.perspectiveClass):$(this.opts.containment).removeClass(this.opts.perspectiveClass),this.currentItem=$(this.opts.containment).find(">."+this.opts.currentClass),this.currentItem.addClass(this.opts.topClass),this.stashitemClass())},startInit:function(e,t,i){this.dur=this.opts.duration,this.lastsubpi=0,this.startObj={x:0,y:0},this.end={x:0,y:0};var n=this.getPos(e,i);this.startObj.x=this.end.x=n.x,this.startObj.y=this.end.y=n.y,this.touchStartDirection=!1,this.realslide=!1},clearNode:function(e){var t=this;$(t.fromNodeCloneNode).remove(),$(t.toNodeCloneNode).remove(),$(t.fromNodeFlapShadow).remove(),$(t.toNodeFlapShadow).remove(),$(t.fromNodeCloneNodeFlapShadow).remove(),$(t.toNodeCloneNodeFlapShadow).remove(),e&&(t.currentItem&&t.currentItem.length&&(t.currentItem[0].style.removeProperty("visibility"),t.currentItem[0].style.removeProperty("clip"),t.currentItem[0].style.removeProperty("opacity")),t.activeItem&&t.activeItem.length&&(t.activeItem[0].style.removeProperty("visibility"),t.activeItem[0].style.removeProperty("clip"),t.activeItem[0].style.removeProperty("opacity")),t.isTransiting=!1,t.key=null)},initNode:function(){this.fromNode=this.currentItem[0],this.toNode=this.activeItem[0],this.fromNodeCloneNode=this.fromNode.cloneNode(!0),this.toNodeCloneNode=this.toNode.cloneNode(!0),this.r=this.boundaryEnd-this.startObj.x,this.l=this.startObj.x-this.boundaryStart,this.u=this.startObj.y-this.boundaryStartY,this.d=this.boundaryEndY-this.startObj.y,$(this.toNode).css({visibility:"visible"}),$(this.fromNode).css({visibility:"visible"}),$(this.fromNodeCloneNode).css({visibility:"visible"}),$(this.toNodeCloneNode).css({visibility:"visible"})},dragX:function(e,t,i){if(!this.isTransiting&&this.key&&(e.gesture.deltaX<=0?(this.plus=-1,this.activeItem=$(this.opts.containment).find(">."+this.opts.rightClass)):(this.plus=1,this.activeItem=$(this.opts.containment).find(">."+this.opts.leftClass)),this.activeItem.length)){var n=e.gesture.deltaX;if(this.direction="x",void 0==t&&(t=this.opts.type),7!=t)this.dragHandle(n,t);else{if(this.isOverstepBoundary("x",e,i))return;this.touchStartDirection!=e.type&&(console.log("------------------------------",this.isOverstepBoundary("x",e)),this.startInit(e,t,i),this.flipSide=this.startObj.x<this.width/2?"l2r":"r2l",this.touchStartDirection=e.type,this.clearNode(),this.initNode(e),"dragleft"==e.type?this.leftFlap():this.rightFlap());var a=this.getPos(e,i);this.end.x=a.x,this.end.y=a.y,this.dragHandle(this.end.x-this.startObj.x,t)}}},dragY:function(e,t,i){if(!this.isTransiting&&this.key&&(e.gesture.deltaY<=0?(this.plus=-1,this.activeItem=$(this.opts.containment).find("."+this.opts.downClass)):(this.plus=1,this.activeItem=$(this.opts.containment).find("."+this.opts.upClass)),this.activeItem.length)){var n=e.gesture.deltaY;if(this.direction="y",void 0==t&&(t=this.opts.type),7!=t)this.dragHandle(n,t);else{if(this.isOverstepBoundary("y",e,i))return;this.touchStartDirection!=e.type&&(this.startInit(e,t,i),this.direction="y",this.touchStartDirection=e.type,this.flipSide=this.startObj.y<this.height/2?"u2d":"d2u",this.clearNode(),this.initNode(e),this.r=this.d,this.l=this.u,"dragup"==e.type?this.upFlap():this.downFlap());var a=this.getPos(e,i);this.end.x=a.x,this.end.y=a.y,this.dragHandle(this.end.y-this.startObj.y,t)}}},getIsPassMiddlePosition:function(){var e,t,i=this.end.x,n=this.end.y,a=this.startObj.x,r=this.startObj.y,o=this.l,s=this.r,l=this.rad,c=0;return"l2r"==this.flipSide?"dragleft"==this.touchStartDirection?a-o*l>i?(e=this.endRotate,c=1,t=(o-(a-i))/o):(e=0,c=0,t=(a-i)/o):"dragright"==this.touchStartDirection&&(i>a+s*l?(e=this.endRotate,c=1,t=(s-(i-a))/s):(e=0,c=0,t=(i-a)/s)):"r2l"==this.flipSide?"dragleft"==this.touchStartDirection?a-o*l>i?(e=this.endRotate,c=1,t=(o-(a-i))/o):(e=0,c=0,t=(a-i)/o):"dragright"==this.touchStartDirection&&(i>a+s*l?(e=this.endRotate,c=1,t=(s-(i-a))/s):(e=0,c=0,t=(i-a)/s)):"u2d"==this.flipSide?"dragup"==this.touchStartDirection?r-o*l>n?(e=this.endRotate,c=1,t=(o-(r-n))/o):(e=0,c=0,t=(r-n)/o):"dragdown"==this.touchStartDirection&&(n>r+s*l?(e=this.endRotate,c=1,t=(s-(n-r))/s):(e=0,c=0,t=(n-r)/s)):"d2u"==this.flipSide&&("dragup"==this.touchStartDirection?r-o*l>n?(e=this.endRotate,c=1,t=(o-(r-n))/o):(e=0,c=0,t=(r-n)/o):"dragdown"==this.touchStartDirection&&(n>r+s*l?(e=this.endRotate,c=1,t=(s-(n-r))/s):(e=0,c=0,t=(n-r)/s))),{subpi:e,isPassMiddlePosition:c,dur:t}},dragHandle:function(t,n){if(isDraged=!0,this.opts.onStopPlay&&this.opts.onStopPlay(),$(this.opts.containment).find("."+this.opts.itemClass).removeClass(this.opts.activeClass),this.activeItem.addClass(this.opts.activeClass),this.currentItem=$(this.opts.containment).find("."+this.opts.currentClass),void 0==n&&(n=this.opts.type),7!=n){var a=Math.abs(t)/$(this.opts.containment).width();if(_g.browserSupport({msie:9}))if(this.args.percentcontrol){for(i=0;i<this.args.percentcontrol.length;i++)if(a<=this.args.percentcontrol[i]){if(this.args[this.args.percentcontrol[i]][this.direction].css){var o=this.args[this.args.percentcontrol[i]][this.direction].css;o.currentItem&&this.currentItem.css(this.getArgs(o.currentItem,this.plus,a)),o.activeItem&&this.activeItem.css(this.getArgs(o.activeItem,this.plus,a))}this.activeItem.css(this.getArgs(this.args[this.args.percentcontrol[i]][this.direction].activeItem,this.plus,a)),this.currentItem.css(this.getArgs(this.args[this.args.percentcontrol[i]][this.direction].currentItem,this.plus,a));break}}else{if(this.args[this.direction].css){var o=this.args[this.direction].css;o.currentItem&&this.currentItem.css(this.getArgs(o.currentItem,this.plus,a)),o.activeItem&&this.activeItem.css(this.getArgs(o.activeItem,this.plus,a))}this.activeItem.css(this.getArgs(this.args[this.direction].activeItem,this.plus,a)),this.currentItem.css(this.getArgs(this.args[this.direction].currentItem,this.plus,a))}else this.currentItem.css("x"==this.direction?"margin-left":"margin-top",this.plus*a*100+"%"),this.activeItem.css("x"==this.direction?"margin-left":"margin-top",-this.plus*(1-a)*100+"%");this.args.currentTop?this.currentItem.addClass(this.opts.topClass):this.currentItem.removeClass(this.opts.topClass),this.args.activeTop&&this.activeItem.addClass(this.opts.topClass),this.opts.onTransition&&this.opts.onTransition(event,a)
}else{var t=Math.round(Math.abs(t)),s=t,l=this.startObj.x,c=this.end.x,d=this.startObj.y,h=this.end.y;if("x"==this.direction){c<this.boundaryStart&&(c=this.boundaryStart,s=l-this.boundaryStart),c>this.boundaryEnd&&(c=this.boundaryEnd,s=this.boundaryEnd-l);{1*(this.width/2)}}else{h<this.boundaryStartY&&(h=this.boundaryStartY,s=d-this.boundaryStartY),h>this.boundaryEndY&&(h=this.boundaryEndY,s=this.boundaryEndY-d);{1*(this.height/2)}}var u="";if("l2r"==this.flipSide?"dragleft"==this.touchStartDirection?(c>=l&&(c=l,s=0),u=-this.PI*(s/this.l)):"dragright"==this.touchStartDirection&&(l>=c&&(c=l,s=0),u=this.PI*(s/this.r)):"r2l"==this.flipSide?"dragleft"==this.touchStartDirection?(c>=l&&(c=l,s=0),u=-this.PI*(s/this.l)):"dragright"==this.touchStartDirection&&(l>=c&&(c=l,s=0),u=this.PI*(s/this.r)):"u2d"==this.flipSide?"dragup"==this.touchStartDirection?(h>=d&&(h=d,s=0),u=-this.PI*(s/this.l)):"dragdown"==this.touchStartDirection&&(d>=h&&(h=d,s=0),u=this.PI*(s/this.r)):"d2u"==this.flipSide&&("dragup"==this.touchStartDirection?(h>=d&&(h=d,s=0),u=-this.PI*(s/this.l)):"dragdown"==this.touchStartDirection&&(d>=h&&(h=d,s=0),u=this.PI*(s/this.r))),this.lastsubpi==u)return;this.lastsubpi=u,console.log("[this.lastsubpi:",this.lastsubpi,"]"),this.fromNodeCloneNode.style[r]=e(this.direction,u),this.toNodeCloneNode.style[r]=e(this.direction,this.PI+u),this.toNodeFlapShadow.style.opacity=Math.abs(u)>this.PI/2?0:.7-2*Math.abs(u)/this.PI*.7,this.fromNodeFlapShadow.style.opacity=Math.abs(u)>this.PI/2?.7-2*(this.PI-Math.abs(u))/this.PI*.7:0,this.fromNodeCloneNodeFlapShadow.style.opacity=Math.abs(u)>this.PI/2?this.shadowOpacity:2*Math.abs(u)/this.PI*this.shadowOpacity,this.toNodeCloneNodeFlapShadow.style.opacity=Math.abs(u)>this.PI/2?2*(this.PI-Math.abs(u))/this.PI*this.shadowOpacity:this.shadowOpacity,this.args.currentTop?this.currentItem.addClass(this.opts.topClass):this.currentItem.removeClass(this.opts.topClass),this.args.activeTop&&this.activeItem.addClass(this.opts.topClass),this.opts.onTransition&&this.opts.onTransition(event,a)}},dragEnd:function(t,n,a){function l(){3==f&&(g.lastsubpi=w,g.realslide=!1,$(g.toNodeCloneNode).remove(),$(g.toNodeFlapShadow).remove(),$(g.fromNodeCloneNode).remove(),$(g.fromNodeFlapShadow).remove(),g.touchStartDirection=!1,g.isTransiting=!1,g.key=null,g.currentItem[0].style.removeProperty("visibility"),g.currentItem[0].style.removeProperty("clip"),g.currentItem[0].style.removeProperty("opacity"),g.activeItem[0].style.removeProperty("visibility"),g.activeItem[0].style.removeProperty("clip"),g.activeItem[0].style.removeProperty("opacity"),_?g.opts.onEnd&&g.opts.onEnd(_):g.opts.onCancel&&g.opts.onCancel(_))}if(!this.isTransiting)if(void 0==n&&(n=this.opts.type),7!=n){if(!this.currentItem.length||!this.activeItem.length)return;this.currentItem.addClass("c-transition-noevents");var c=this;this.isTransiting=!0;var d="x"==this.direction?t.gesture.deltaX:t.gesture.deltaY,h=Math.abs(d)/$(this.opts.containment).width();if(_g.browserSupport({msie:9}))if(this.args.percentcontrol){for(c.currentItem.removeClass("c-transition-noevents"),this.percent=h,i=0;i<this.args.percentcontrol.length;i++)if(h<=this.args.percentcontrol[i]){this.transitPercent(i);break}}else{var u=1100,p=this.getArgs(this.args[this.direction].currentItem,this.plus,1);p.duration=u,p.easing=this.args.currentEasing;var v=this.getArgs(this.args[this.direction].activeItem,this.plus,1);v.duration=u,v.easing=this.args.activeEasing,v.complete=function(){c.currentItem.removeClass("c-transition-noevents"),c.isTransiting=!1,_g.device.android()?setTimeout(function(){c.onTransitionEnd()},100):c.onTransitionEnd()},this.currentItem.transit(p),this.activeItem.transit(v)}else this.activeItem.css("x"==this.direction?"margin-left":"margin-top","0%"),this.currentItem.css("x"==this.direction?"margin-left":"margin-top",100*-this.plus+"%")}else{var g=this,f=1;g.isTransiting=!0;var m=g.getIsPassMiddlePosition(),_=m.isPassMiddlePosition;if(g.dur=g.dur*m.dur,!(this.currentItem.length&&this.activeItem.length&&g.fromNodeCloneNode&&this.key&&this.touchStartDirection))return _=0,void l();var w=m.subpi;if(a){g.dur=500;var w="x"==g.direction?t.gesture.deltaX<0?-3.141592653589793:3.141592653589793:t.gesture.deltaY<0?-3.141592653589793:3.141592653589793}else if(g.l<=0||g.r<=0||g.lastsubpi==w)return $(g.fromNodeCloneNode).remove(),g.fromNode.style.clip="rect(0px "+g.width+"px "+g.height+"px 0px)",_&&$(g.fromNode).css({visibility:"hidden"}),_||$(g.toNode).css({visibility:"hidden"}),$(g.toNodeCloneNode).remove(),g.toNode.style.clip="rect(0px "+g.width+"px "+g.height+"px 0px)",$(g.fromNodeFlapShadow).remove(),$(g.toNodeFlapShadow).remove(),f=3,void l();$(g.fromNodeCloneNode).on("webkitTransitionEnd",function(){$(g.fromNodeCloneNode).off("webkitTransitionEnd"),$(g.fromNodeCloneNode).remove(),g.fromNode.style.clip="rect(0px "+(g.width+1)+"px "+g.height+"px 0px)",_&&$(g.fromNode).css({visibility:"hidden"}),$(g.fromNodeFlapShadow).remove(),f++,l(),setTimeout(function(){3>f&&(f++,l())},g.dur/2)}),$(g.toNodeCloneNode).on("webkitTransitionEnd",function(){$(g.toNodeCloneNode).off("webkitTransitionEnd"),_||$(g.toNode).css({visibility:"hidden"}),$(g.toNodeCloneNode).remove(),$(g.toNodeFlapShadow).remove(),g.toNode.style.clip="rect(0px "+g.width+"px "+g.height+"px 0px)",f++,l()}),_||a?(g.toNodeFlapShadow.style[s]="opacity "+g.dur/2+"ms ease-in",g.fromNodeFlapShadow.style[s]="opacity "+g.dur/2+"ms ease-in",g.fromNodeFlapShadow.style.opacity=.7,g.toNodeFlapShadow.style.opacity=0,g.fromNodeCloneNodeFlapShadow.style.opacity=0,g.toNodeCloneNodeFlapShadow.style.opacity=0,g.fromNodeCloneNode.style[r]=e(g.direction,w),g.fromNodeCloneNode.style[o]=g.dur+"ms",g.toNodeCloneNode.style[r]=e(g.direction,g.PI+w),g.toNodeCloneNode.style[o]=1.5*g.dur+"ms"):(g.toNodeFlapShadow.style[s]="opacity "+g.dur/2+"ms ease-in",g.fromNodeFlapShadow.style[s]="opacity "+g.dur/2+"ms ease-in",g.toNodeFlapShadow.style.opacity=.7,g.fromNodeFlapShadow.style.opacity=0,g.fromNodeCloneNodeFlapShadow.style.opacity=0,g.toNodeCloneNodeFlapShadow.style.opacity=0,g.fromNodeCloneNode.style[r]=e(g.direction,w),g.fromNodeCloneNode.style[o]=1.5*g.dur+"ms",g.toNodeCloneNode.style[r]=e(g.direction,g.PI+w),g.toNodeCloneNode.style[o]=g.dur+"ms"),console.log("[isPassMiddlePosition:",_,"]"),console.log("[touchStartDirection:",this.touchStartDirection,"]"),console.log("[that.fromNodeCloneNode:",g.fromNodeCloneNode,"]"),console.log("[that.toNodeCloneNode:",g.toNodeCloneNode,"]"),console.log("[that.direction:",g.direction,"]"),console.log("[subpi:",w,"]"),console.log("[lastsubpi:",g.lastsubpi,"]"),console.log("[that.dur:",g.dur,"]")}},onTransitionEnd:function(){var e=this;this.recoveritemClass(),this.currentItem.removeClass(this.opts.currentClass),this.activeItem.addClass(this.opts.currentClass).removeClass(this.opts.activeClass).removeClass(this.opts.upClass).removeClass(this.opts.rightClass).removeClass(this.opts.leftClass).removeClass(this.opts.downClass),$(this.opts.containment).find("."+this.opts.itemClass).removeClass(this.opts.topClass);var t=this.currentItem.index(),i=this.activeItem.index();$(this.opts.containment).removeClass(this.opts.perspectiveClass),e.opts.onEnd&&e.opts.onEnd(t,i),this.timerStart()},transitPercent:function(e){var t=this;if(e<this.args.percentcontrol.length){var t=this,i=this.opts.duration*(this.args.percentcontrol[e]-this.percent),n=this.getArgs(this.args[this.args.percentcontrol[e]][this.direction].currentItem,this.plus,this.args.percentcontrol[e]);n.duration=i,n.easing=this.args.currentEasing;var a=this.getArgs(this.args[this.args.percentcontrol[e]][this.direction].activeItem,this.plus,this.args.percentcontrol[e]);a.duration=i,a.easing=this.args.activeEasing,a.complete=function(){t.transitPercent(e+1)},this.percent=this.args.percentcontrol[e],this.currentItem.transit(n),this.activeItem.transit(a)}else t.isTransiting=!1,this.onTransitionEnd()},getArgs:function(e,t,i){var n={};for(var a in e)n[a]="function"==typeof e[a]?e[a](t,i):e[a];return n},autostart:function(e,t,i){if(!this.isTransiting&&(this.args=_g.transitionargs[e]||{},this.currentItem=$(this.opts.containment).find("."+this.opts.currentClass),this.stashitemClass(),this.key=1*new Date,"x"==t&&(this.activeItem=$(this.opts.containment).find(0>i?"."+this.opts.rightClass:"."+this.opts.leftClass)),"y"==t&&(this.activeItem=$(this.opts.containment).find(0>i?"."+this.opts.downClass:"."+this.opts.upClass)),this.activeItem.length))if(7!=e){this.args.currentTop&&this.currentItem.addClass(this.opts.topClass),this.plus=i,this.direction=t,this.args.perspective?$(this.opts.containment).addClass(this.opts.perspectiveClass):$(this.opts.containment).removeClass(this.opts.perspectiveClass);var n={gesture:{}};"x"==t?n.gesture.deltaX=0:n.gesture.deltaY=0,this.dragHandle(0,e),this.dragEnd(n,e)}else{if("x"==t){if(0>i)var n={gesture:{deltaX:-.01},type:"dragleft"};else var n={gesture:{deltaX:.01},type:"dragright"};this.dragX(n,e,!0)}if("y"==t){if(0>i)var n={gesture:{deltaY:-.01},type:"dragup"};else var n={gesture:{deltaY:.01},type:"dragbottom"};this.dragY(n,e,!0)}this.dragEnd(n,e,!0)}},enableTimer:function(){this.timerDisabled=!1},disableTimer:function(){this.timerDisabled=!0},setCurrent:function(e,t){var i,n=this;$(this.opts.containment).children("."+this.opts.itemClass).removeClass(this.opts.topClass).removeClass(this.opts.activeClass).removeClass(this.opts.upClass).removeClass(this.opts.rightClass).removeClass(this.opts.leftClass).removeClass(this.opts.downClass);var a=$(this.opts.containment).children().length;if(e>=a){if(!this.opts.repeat)return void this.timerStop();this.current=0,e=0}else if(0>e){if(!this.opts.repeat)return void this.timerStop();this.current=a-1,e=a-1}if($(this.opts.containment).children().each(function(){$(this).index()==e?(i=$(this),$(this).addClass(n.opts.currentClass)):$(this).removeClass(n.opts.currentClass)}),t&&i){if("x"==t)var r=this.opts.leftClass,o=this.opts.rightClass;else var r=this.opts.upClass,o=this.opts.downClass;i.prev().length?i.prev().addClass(r):this.opts.repeat&&$(this.opts.containment).children().last().addClass(r),i.next().length?i.next().addClass(o):this.opts.repeat&&$(this.opts.containment).children().first().addClass(o)}},timerStart:function(e){if(!this.timerDisabled){var t=this;if(e)e.type||(e.type=t.opts.type),e.axis||(e.axis="x"),e.diretion||(e.direction=-1),e.startAt||(e.startAt=0),this.setCurrent(e.startAt,e.axis),this.current=e.startAt,this.TimerArgs=e;else{if(!this.TimerArgs)return;e=this.TimerArgs,this.TimerDirection=this.TimerDirection||t.opts.autoplayDirection,this.current=null!=this.tempCurrent?this.tempCurrent:-1==this.TimerDirection?this.current+1:this.current-1,this.tempCurrent=null,this.TimerDirection=null,this.setCurrent(this.current,e.axis)}this.Timer&&window.clearTimeout(this.Timer),this.Timer=window.setTimeout(function(){t.autostart(e.type,e.axis,e.direction)},this.opts.interval)}},timerStop:function(){this.Timer&&(window.clearTimeout(this.Timer),this.Timer=null),this.TimerArgs=null,this.disableTimer()},isOverstepBoundary:function(e,t,i){if(i)return!1;var n=this.getPos(t,i),a=n.x,r=n.y;if(console.log(a,"[",this.boundaryStart,this.boundaryEnd,"]"),console.log("this.key[",this.key,"]"),console.log("direction[",e,"]"),"x"==e){if(a<=this.boundaryStart||a>=this.boundaryEnd)return!0}else if("y"==e&&(r<=this.boundaryStartY||r>=this.boundaryEndY))return!0;return!1},getPos:function(e,t){var i=e.gesture.touches?e.gesture.touches[0]:{};return interaction_view.ismobile?t?{x:interaction_view.size.x,y:interaction_view.size.y}:{x:i.pageX,y:i.pageY}:t?{x:this.$container.offset().left+interaction_view.size.x,y:this.$container.offset().top+interaction_view.size.y}:{x:i.pageX-this.$container.offset().left,y:i.pageY-this.$container.offset().top}},addCloneAttr:function(){$(this.fromNodeFlapShadow).attr("data-clone","fromNodeFlapShadow"),$(this.toNodeFlapShadow).attr("data-clone","toNodeFlapShadow"),$(this.fromNodeCloneNodeFlapShadow).attr("data-clone","fromNodeCloneNodeFlapShadow"),$(this.toNodeCloneNodeFlapShadow).attr("data-clone","toNodeCloneNodeFlapShadow"),$(this.fromNodeCloneNode).attr("data-clone","fromNodeCloneNode"),$(this.toNodeCloneNode).attr("data-clone","toNodeCloneNode")},leftFlap:function(){this.endRotate=-this.PI,this.middlePosition=this.startObj.x-this.l/2,this.fromNodeFlapShadow=$('<div class="flap-shadow flat left" style="opacity: 0;"></div>')[0],this.toNodeFlapShadow=$('<div class="flap-shadow flat right" style="opacity: 0.7;"></div>')[0],this.fromNodeCloneNodeFlapShadow=$('<div class="flap-shadow flap-gradient front" style="opacity: 0;width:'+this.width/2+"px;height:"+this.height+'px;"></div>')[0],this.toNodeCloneNodeFlapShadow=$('<div class="flap-shadow flap-gradient back" style="opacity: '+this.shadowOpacity+";width:"+this.width/2+"px;height:"+this.height+'px;"></div>')[0],this.container.appendChild(this.fromNodeCloneNode),this.container.appendChild(this.toNodeCloneNode),this.fromNode.appendChild(this.fromNodeFlapShadow),this.toNode.appendChild(this.toNodeFlapShadow),this.fromNodeCloneNode.appendChild(this.fromNodeCloneNodeFlapShadow),this.toNodeCloneNode.appendChild(this.toNodeCloneNodeFlapShadow),this.addCloneAttr(),this.hack?(this.fromNode.style.clip="rect(0px "+(this.width/2+1)+"px "+this.height+"px 0px)",this.toNode.style.clip="rect(0px "+this.width+"px "+this.height+"px "+(this.width/2-1)+"px)",this.fromNodeCloneNode.style.clip="rect(0px "+this.width+"px "+this.height+"px "+(this.width/2-1)+"px)",this.fromNodeCloneNode.style.webkitTransform="perspective(1200px) rotateY(0rad)",this.toNodeCloneNode.style.clip="rect(0px "+(this.width/2+1)+"px "+this.height+"px 0px)",this.toNodeCloneNode.style.webkitTransform="perspective(1200px) rotateY("+this.PI+"rad)"):(this.fromNode.style.clip="rect(0px "+this.width/2+"px "+this.height+"px 0px)",this.toNode.style.clip="rect(0px "+this.width+"px "+this.height+"px "+this.width/2+"px)",this.fromNodeCloneNode.style.clip="rect(0px "+this.width+"px "+this.height+"px "+this.width/2+"px)",this.fromNodeCloneNode.style.webkitTransform="perspective(1200px) rotateY(0rad)",this.toNodeCloneNode.style.clip="rect(0px "+this.width/2+"px "+this.height+"px 0px)",this.toNodeCloneNode.style.webkitTransform="perspective(1200px) rotateY("+this.PI+"rad)")},rightFlap:function(){this.endRotate=this.PI,this.middlePosition=this.startObj.x+this.r/2,this.hack?(this.toNode.style.clip="rect(0px "+(this.width/2+1)+"px "+this.height+"px 0px)",this.fromNode.style.clip="rect(0px "+this.width+"px "+this.height+"px "+this.width/2+"px)",this.toNodeCloneNode.style.clip="rect(0px "+this.width+"px "+this.height+"px "+(this.width/2-1)+"px)",this.toNodeCloneNode.style.webkitTransform="perspective(1200px) rotateY(3.141592653589793rad)",this.fromNodeCloneNode.style.clip="rect(0px "+(this.width/2+1)+"px "+this.height+"px 0px)"):(this.toNode.style.clip="rect(0px "+this.width/2+"px "+this.height+"px 0px)",this.fromNode.style.clip="rect(0px "+this.width+"px "+this.height+"px "+this.width/2+"px)",this.toNodeCloneNode.style.clip="rect(0px "+this.width+"px "+this.height+"px "+this.width/2+"px)",this.toNodeCloneNode.style.webkitTransform="perspective(1200px) rotateY(3.141592653589793rad)",this.fromNodeCloneNode.style.clip="rect(0px "+this.width/2+"px "+this.height+"px 0px)"),this.fromNodeCloneNode.style.webkitTransform="perspective(1200px) rotateY(0rad)",this.container.appendChild(this.toNodeCloneNode),this.container.appendChild(this.fromNodeCloneNode),this.fromNodeFlapShadow=$('<div class="flap-shadow flat right" style="opacity: 0;">A</div>')[0],this.toNodeFlapShadow=$('<div class="flap-shadow flat left" style="opacity: 0.7;">B</div>')[0],this.fromNodeCloneNodeFlapShadow=$('<div class="flap-shadow flap-gradient back" style="opacity: 0;width:'+this.width/2+"px;height:"+this.height+'px;">C</div>')[0],this.toNodeCloneNodeFlapShadow=$('<div class="flap-shadow flap-gradient front" style="opacity: '+this.shadowOpacity+";width:"+this.width/2+"px;height:"+this.height+'px;">D</div>')[0],this.fromNode.appendChild(this.fromNodeFlapShadow),this.toNode.appendChild(this.toNodeFlapShadow),this.fromNodeCloneNode.appendChild(this.fromNodeCloneNodeFlapShadow),this.toNodeCloneNode.appendChild(this.toNodeCloneNodeFlapShadow),this.addCloneAttr()},upFlap:function(){this.endRotate=-this.PI,this.middlePosition=this.startObj.y-this.l/2,this.fromNodeFlapShadow=$('<div class="flap-shadowY flat up" style="opacity: 0;"></div>')[0],this.toNodeFlapShadow=$('<div class="flap-shadowY flat down" style="opacity: 0.7;"></div>')[0],this.fromNodeCloneNodeFlapShadow=$('<div class="flap-shadowY flap-gradient top" style="opacity: 0;width:'+this.width+"px;height:"+this.height/2+'px;"></div>')[0],this.toNodeCloneNodeFlapShadow=$('<div class="flap-shadowY flap-gradient bottom" style="opacity: '+this.shadowOpacity+";width:"+this.width+"px;height:"+this.height/2+'px;"></div>')[0],this.fromNodeCloneNode=this.fromNode.cloneNode(!0),this.toNodeCloneNode=this.toNode.cloneNode(!0),this.container.appendChild(this.fromNodeCloneNode),this.container.appendChild(this.toNodeCloneNode),this.fromNode.appendChild(this.fromNodeFlapShadow),this.toNode.appendChild(this.toNodeFlapShadow),this.fromNodeCloneNode.appendChild(this.fromNodeCloneNodeFlapShadow),this.toNodeCloneNode.appendChild(this.toNodeCloneNodeFlapShadow),this.hack?(this.fromNode.style.clip="rect(0px "+this.width+"px "+(this.height/2+1)+"px 0px)",this.toNode.style.clip="rect("+(this.height/2-1)+"px "+this.width+"px "+this.height+"px 0px)",this.fromNodeCloneNode.style.clip="rect("+(this.height/2-1)+"px "+this.width+"px "+this.height+"px 0px)",this.fromNodeCloneNode.style.webkitTransform="perspective(1200px) rotateX(0rad)",this.toNodeCloneNode.style.clip="rect(0px "+this.width+"px "+(this.height/2+1)+"px 0px)",this.toNodeCloneNode.style.webkitTransform="perspective(1200px) rotateX("+this.PI+"rad)"):(this.fromNode.style.clip="rect(0px "+this.width+"px "+this.height/2+"px 0px)",this.toNode.style.clip="rect("+this.height/2+"px "+this.width+"px "+this.height+"px 0px)",this.fromNodeCloneNode.style.clip="rect("+this.height/2+"px "+this.width+"px "+this.height+"px 0px)",this.fromNodeCloneNode.style.webkitTransform="perspective(1200px) rotateX(0rad)",this.toNodeCloneNode.style.clip="rect(0px "+this.width+"px "+this.height/2+"px 0px)",this.toNodeCloneNode.style.webkitTransform="perspective(1200px) rotateX("+this.PI+"rad)"),this.addCloneAttr()},downFlap:function(){this.endRotate=this.PI,this.middlePosition=this.startObj.y+this.r/2,this.hack?(this.toNode.style.clip="rect(0px "+this.width+"px "+(this.height/2+1)+"px 0px)",this.fromNode.style.clip="rect("+this.height/2+"px "+this.width+"px "+this.height+"px 0px)",this.toNodeCloneNode.style.clip="rect("+(this.height/2-1)+"px "+this.width+"px "+this.height+"px 0px)",this.toNodeCloneNode.style.webkitTransform="perspective(1200px) rotateX(3.141592653589793rad)",this.fromNodeCloneNode.style.clip="rect(0px "+this.width+"px "+(this.height/2+1)+"px 0px)"):(this.toNode.style.clip="rect(0px "+this.width+"px "+this.height/2+"px 0px)",this.fromNode.style.clip="rect("+this.height/2+"px "+this.width+"px "+this.height+"px 0px)",this.toNodeCloneNode.style.clip="rect("+this.height/2+"px "+this.width+"px "+this.height+"px 0px)",this.toNodeCloneNode.style.webkitTransform="perspective(1200px) rotateX(3.141592653589793rad)",this.fromNodeCloneNode.style.clip="rect(0px "+this.width+"px "+this.height/2+"px 0px)"),this.fromNodeCloneNode.style.webkitTransform="perspective(1200px) rotateX(0rad)",this.container.appendChild(this.toNodeCloneNode),this.container.appendChild(this.fromNodeCloneNode),this.fromNodeFlapShadow=$('<div class="flap-shadowY flat down" style="opacity: 0;"></div>')[0],this.toNodeFlapShadow=$('<div class="flap-shadowY flat up" style="opacity: 0.7;"></div>')[0],this.fromNodeCloneNodeFlapShadow=$('<div class="flap-shadowY flap-gradient bottom" style="opacity: 0;width:'+this.width+"px;height:"+this.height/2+'px;"></div>')[0],this.toNodeCloneNodeFlapShadow=$('<div class="flap-shadowY flap-gradient top" style="opacity: '+this.shadowOpacity+";width:"+this.width+"px;height:"+this.height/2+'px;"></div>')[0],this.fromNode.appendChild(this.fromNodeFlapShadow),this.toNode.appendChild(this.toNodeFlapShadow),this.fromNodeCloneNode.appendChild(this.fromNodeCloneNodeFlapShadow),this.toNodeCloneNode.appendChild(this.toNodeCloneNodeFlapShadow),this.addCloneAttr()}};var c=function(e){this.init(e)};c.prototype={init:function(e){var t={body:"window",containment:".touchslide",slidesclass:".slides",groupclass:".group",itemclass:".Presentation",width:1024,height:768,overview:!0,controls:!0,progress:!0,slideNumber:!1,history:!1,disableHistoryStart:!1,keyboard:!0,overview:!0,center:!0,touch:!0,loop:!1,rtl:!1,fragments:!0,mouseWheel:!1,hideAddressBar:!0,previewLinks:!1,transition:0,transitionSpeed:"default",onReady:null,onSlideChange:null,canDragX:null,canDragY:null,canDragEnd:null,adapt:!1,screen_mode:1,show_excontent:!1,continuous:!1};if(this.options=e?$.extend(!0,{},t,e):t,_g.browserSupport({msie:9})||(this.options.canDragX=this.options.canDragY=function(){return!1}),_.bindAll(this),this._initVaribles(),this._initControls(),this._initScreenSet(),this._initSlideItems(),this.transition=new _g.transition({type:this.options.transition,containment:this.slideContent,control:!1,onEnd:this._complete,onStopPlay:this._onStopPlay,onCancel:this._cancel,duration:700,shadowOpacity:.3,rad:.1}),this._initSlideStyle(),this.options.onReady){var i=3==this.slideType?this.indexes[0][0]:this.indexes[0];this.options.onReady(this,i)}return this.options.controls&&(this._bindControllers(),this.setControllers()),this.options.progress&&this.setProgressBar(),this.options.keyboard&&this._bindKeyboard(),this.options.mouseWheel&&this._bindMouseWheel(),this.options.history&&this._bindRoute(),this},_bindRoute:function(){var e=this,t=Backbone.Router.extend({routes:{"page/:query":"page"}});this.Router=new t,this.Router.on("route:page",function(t){var i=e.getSlidePositionById(t);i&&e.slide(i.h,i.v)});var i=!1;e.options.disableHistoryStart&&(i=!0);var n=_g.getUrlParameterByName("pageid");"undefined"!=typeof message_link&&(message_link=_g.changeURLPar(message_link,"pageid",""),interaction_view.weixin.share()),n&&(i=!1),e.options.disableHistoryStart?n&&(Backbone.history.start({silent:!1}),this.Router.navigate("page/"+n,{trigger:!0}),Backbone.history.stop()):(Backbone.history.start({silent:i}),this.Router.navigate("page/"+(n||this.getCurrentSlideId()),{trigger:n&&!0}))},_initVaribles:function(){this.indexv=0,this.indexh=0,this.currentSlideDirection=null,this.dragstart=!1,this.dragging=!1,this.sliding=!1},_initControls:function(){var e=this,t=0,i=0;this.hammertime=$(this.options.containment).hammer().on("dragstart",function(t){return interaction_view.stopDragging?void 0:e.sliding?(t.gesture.preventDefault(),!1):void((!e.options.canDrag||e.options.canDrag(t))&&(e.dragstart=!0,e._doStartEvent(t)))}),$(this.options.containment).hammer().on("drag",function(t){return e.sliding?(t.gesture.preventDefault(),!1):void 0}),$(this.options.containment).hammer().on("dragleft",function(i){if(console.log("------dragleft"),e.sliding)return i.gesture.preventDefault(),!1;if(!interaction_view.stopDragging){if(null==e.currentSlideDirection&&(e.currentSlideDirection=1),e.dragLock||interaction_view.events.onPageSwipeEvent(38,interaction_view.currentPage))return e.dragLock=!0,i.gesture.preventDefault(),e.dragstart=!1,!1;if(e.dragLock||e.options.continuous&&e.continuous("left"))return e.dragLock=!0,i.gesture.preventDefault(),!1;if(!e.options.canDragX||e.options.canDragX(i))return e._testSlideDragEventAccess(i)?(e.dragstart=!0,$.zoom&&1!=$.zoom&&(i.gesture.deltaX=i.gesture.deltaX/$.zoom),t=i.gesture.deltaX,e.options.smooth||e._doDragingEvent(i),i.gesture.preventDefault(),!1):void i.gesture.preventDefault()}}),$(this.options.containment).hammer().on("dragright",function(i){if(console.log("------dragright"),e.sliding)return i.gesture.preventDefault(),!1;if(!interaction_view.stopDragging){if(null==e.currentSlideDirection&&(e.currentSlideDirection=1),e.dragLock||interaction_view.events.onPageSwipeEvent(39,interaction_view.currentPage))return e.dragLock=!0,e.dragstart=!1,i.gesture.preventDefault(),!1;if(e.dragLock||e.options.continuous&&e.continuous("right"))return e.dragLock=!0,i.gesture.preventDefault(),!1;if(!e.options.canDragX||e.options.canDragX(i))return e._testSlideDragEventAccess(i)?(e.dragstart=!0,$.zoom&&1!=$.zoom&&(i.gesture.deltaX=i.gesture.deltaX/$.zoom),t=i.gesture.deltaX,e.options.smooth||e._doDragingEvent(i),i.gesture.preventDefault(),!1):(i.gesture.preventDefault(),!1)}}),$(this.options.containment).hammer({drag_lock_to_axis:!0}).on("dragup",function(t){if(e.sliding)return t.gesture.preventDefault(),!1;if(console.log("------dragup"),!interaction_view.stopDragging){if(console.log("dragup"),null==e.currentSlideDirection&&(e.currentSlideDirection=2),e.dragLock||interaction_view.events.onPageSwipeEvent(36,interaction_view.currentPage))return e.dragLock=!0,e.dragstart=!1,t.gesture.preventDefault(),!1;if(e.dragLock||e.options.continuous&&e.continuous("up"))return e.dragLock=!0,t.gesture.preventDefault(),!1;if(!e.options.canDragY||e.options.canDragY(t))return e._testSlideDragEventAccess(t)?(e.dragstart=!0,$.zoom&&1!=$.zoom&&(t.gesture.deltaY=t.gesture.deltaY/$.zoom),i=t.gesture.deltaY,e.options.smooth||e._doDragingEvent(t),t.gesture.preventDefault(),!1):(t.gesture.preventDefault(),!1)}}),$(this.options.containment).hammer({drag_lock_to_axis:!0}).on("dragdown",function(t){if(e.sliding)return t.gesture.preventDefault(),!1;if(console.log("------dragdown"),!interaction_view.stopDragging){if(console.log("dragdown"),null==e.currentSlideDirection&&(e.currentSlideDirection=2),e.dragLock||interaction_view.events.onPageSwipeEvent(37,interaction_view.currentPage))return e.dragLock=!0,e.dragstart=!1,t.gesture.preventDefault(),!1;if(e.dragLock||e.options.continuous&&e.continuous("down"))return e.dragLock=!0,t.gesture.preventDefault(),!1;if(!e.options.canDragY||e.options.canDragY(t))return e._testSlideDragEventAccess(t)?(e.dragstart=!0,$.zoom&&1!=$.zoom&&(t.gesture.deltaY=t.gesture.deltaY/$.zoom),i=t.gesture.deltaY,e.options.smooth||e._doDragingEvent(t),t.gesture.preventDefault(),!1):(t.gesture.preventDefault(),!1)}}),$(this.options.containment).hammer().on("dragend",function(n){if(!interaction_view.stopDragging&&(console.log("slide is dragended"),e.dragstart||(e.currentSlideDirection=null),e.dragLock=!1,(!e.options.canDrag||e.options.canDrag(n))&&(e.options.canDragEnd&&e.options.canDragEnd(n),e._testSlideDragEventAccess(n)))){if(1==e.currentSlideDirection&&t||2==e.currentSlideDirection&&i)if(e.options.smooth){var a=e.getSlideDirections(),r=1==e.currentSlideDirection?"x":"y";e.originh=e.indexh,e.originv=e.indexv;var o=!0;if(1==e.currentSlideDirection){var s=t/Math.abs(t);0>s&&!a.right?o=!1:s>0&&!a.left?o=!1:(e._onStopPlay(),e.indexh=0>s?e.indexh+1:e.indexh-1,e.indexv=0)}else{var s=i/Math.abs(i);0>s&&!a.down?o=!1:s>0&&!a.up?o=!1:(e._onStopPlay(),e.indexv=0>s?e.indexv+1:e.indexv-1)}o&&e.transition.autostart(e.options.transition,r,s)}else $.zoom&&1!=$.zoom&&(2==e.currentSlideDirection&&i&&(n.gesture.deltaY=n.gesture.deltaY/$.zoom),1==e.currentSlideDirection&&t&&(n.gesture.deltaX=n.gesture.deltaX/$.zoom)),e._doDragEndEvent(n);return e.dragstart=!1,e.currentSlideDirection=null,t=0,i=0,n.gesture.preventDefault(),!1}}),$(this.options.containment).on("touchend",function(){console.log("slide is touchended")})},_initSlideItems:function(){var e=0,t=0,i=this,n=[];if(this.slideItems=[],this.slideIds={},this.slideIdsArray=[],0==this.slideContent.children(".slideTempContainer").length&&this.slideContent.append('<div class="slideTempContainer" style="position:absolute;left:-99999px;top:-99999px;"></div>'),this.slideContent.hasClass("c-transition-containment")||this.slideContent.addClass("c-transition-containment"),this.slideTempContainer=this.slideContent.children(".slideTempContainer"),this.slideContent.children(this.options.groupclass).length>0){this.slideType=3,this.slideContent.children(this.options.groupclass).each(function(){n[t]=[],i.slideItems[t]=[],$(this).children(i.options.itemclass).each(function(){var a=$(this).attr("id");n[t][e]=a||1,i.slideItems[t][e]=this,a&&(i.slideIds[a]={h:t,v:e},i.slideIdsArray.push(a)),e+=1}),t+=1,e=0});var a=this.slideContent.children(this.options.groupclass).detach();this.slideTempContainer.append(a)}else{this.slideType=1,this.slideContent.children(this.options.itemclass).each(function(){var e=$(this).attr("id");n[t]=$(this).attr("id")||1,i.slideItems[t]=this,e&&(i.slideIds[e]={h:t,v:null},i.slideIdsArray.push(e)),t+=1});var a=this.slideContent.children(this.options.itemclass).detach();this.slideTempContainer.append(a)}this.indexes=n,this.options.continuous&&(this.options.continuous=1==this.slideType?1:this.indexes[this.indexes.length-1]&&this.indexes[this.indexes.length-2]&&1==this.indexes[this.indexes.length-1].length&&1==this.indexes[this.indexes.length-2].length?1:2),this.options.show_overview&&this._drawOverview()},_initSlideStyle:function(){var e=this;this.slideContent.find(this.options.itemclass).each(function(){$(this).css({width:"100%",height:"100%"}),$(this).children(".interaction-area").css({width:"100%",height:"100%"}),$(this).addClass("c-transition-item")}),this.setSlideItems(),e.setAdaptSlideItems()},_initScreenSet:function(){this.slideScreenWidth=this.options.width,this.slideScreenHeight=this.options.height,this.slideWidth=this.options.width,this.slideHeight=this.options.height,this.slideContainment=$(this.options.containment),this.slideContent=$(this.options.containment).find(this.options.slidesclass).first(),0==this.slideContainment.children(".slides-wrap").length&&this.slideContent.wrap('<div class="slides-wrap" style="position:absolute;width:100%;height:100%;left:0;top:0;z-index:1000;"></div>'),this.slideWrap=this.slideContainment.children(".slides-wrap"),this.slideContainment.css({width:this.slideScreenWidth,height:this.slideScreenHeight}),this.slideContent.css({width:this.slideScreenWidth,height:this.slideScreenHeight}),this.slideGroup=this.slideContent.children(),this.options.adapt&&(this.adapt=!0),this.setAdaptScreen()},sendSlide2Content:function(e){var t=$(e).detach();this.slideContent.append(t)},sendSlide2Temp:function(e){var t=$(e).detach();this.slideTempContainer.append(t)},setSingleSlideItem:function(e,t,i){this.slideContent.find(this.options.itemclass).removeClass("c-transition-"+i),this.slideItem=this.getSlideItem(e,t),$(this.slideItem).addClass("c-transition-"+i),$(this.slideItem).parent().is(this.slideContent)||this.sendSlide2Content(this.slideItem)},setSlideItems:function(){var e=this;this.currentItem=this.getCurrentSlide(),this.leftItem=null,this.rightItem=null,this.upItem=null,this.downItem=null;var t=[];t.push(this.getCurrentSlideId()),$(this.currentItem).parent().is(this.slideContent)||this.sendSlide2Content(this.currentItem);var i=this.getSlideDirections();i.left&&(t.push(this.getLeft()),this.leftItem=this.getSlideItemById(this.getLeft()),$(this.leftItem).parent().is(this.slideContent)||this.sendSlide2Content(this.leftItem),$(this.currentItem).attr("data-left","1")),i.right&&(t.push(this.getRight()),this.rightItem=this.getSlideItemById(this.getRight()),$(this.rightItem).parent().is(this.slideContent)||this.sendSlide2Content(this.rightItem),$(this.currentItem).attr("data-right","1")),3==this.slideType&&(i.up&&(t.push(this.getUp()),this.upItem=this.getSlideItemById(this.getUp()),$(this.upItem).parent().is(this.slideContent)||this.sendSlide2Content(this.upItem),$(this.currentItem).attr("data-up","1")),i.down&&(t.push(this.getDown()),this.downItem=this.getSlideItemById(this.getDown()),$(this.downItem).parent().is(this.slideContent)||this.sendSlide2Content(this.downItem),$(this.currentItem).attr("data-down","1"))),this.slideContent.children(this.options.itemclass).each(function(){var i=$(this).attr("id");_.include(t,i)||e.sendSlide2Temp(this)}),this.slideContent.find(".c-transition-item").each(function(){this.id!=e.currentItem.id&&$(this).removeClass("c-transition-current"),$(this).removeClass("c-transition-left").removeClass("c-transition-right").removeClass("c-transition-up").removeClass("c-transition-down")
}),$(this.currentItem).addClass("c-transition-current"),this.rightItem&&$(this.rightItem).addClass("c-transition-right"),this.leftItem&&$(this.leftItem).addClass("c-transition-left"),this.upItem&&$(this.upItem).addClass("c-transition-up"),this.downItem&&$(this.downItem).addClass("c-transition-down")},setAdaptScreen:function(){if(this.options.adapt){var e=this._getScreenSize(),t=this._getScreenScale();0==this.options.screen_mode?(this.slideScreenWidth=e.x,this.slideScreenHeight=e.y):1==this.options.screen_mode?(t.x&&(e.x=parseInt(e.x/t.x,10)),t.y&&(e.y=parseInt(e.y/t.y,10)),t.x&&(this.slideScreenWidth=e.x>this.options.width?e.x:this.options.width,this.slideScreenHeight=this.options.height),t.y&&(this.slideScreenHeight=e.y>this.options.height?e.y:this.options.height,this.slideScreenWidth=this.options.width)):(t.y&&(e.x=parseInt(e.x/t.y,10)),t.x&&(e.y=parseInt(e.y/t.x,10)),t.y&&(this.slideScreenWidth=e.x<this.options.width?e.x:this.options.width,this.slideScreenHeight=this.options.height),t.x&&(this.slideScreenHeight=e.y<this.options.height?e.y:this.options.height,this.slideScreenWidth=this.options.width)),this.slideContainment.css({width:this.slideScreenWidth+2,height:this.slideScreenHeight}),this.slideContent.css({width:this.slideScreenWidth+2,height:this.slideScreenHeight}),this.slideContent.find(".Presentation").css({overflow:"hidden"}),this.options.show_excontent&&this.slideContent.find(".interaction-view").css({overflow:"visible"}),this.slideWrap.css({overflow:"hidden"}),this.slideContainment.css({overflow:"visible"})}else if(2==this.options.screen_mode){var e=this._getScreenSize(),t=this._getScreenScale();t.y&&(e.x=parseInt(e.x/t.y,10)),t.x&&(e.y=parseInt(e.y/t.x,10)),t.y&&(this.slideScreenWidth=e.x<this.options.width?e.x:this.options.width,this.slideScreenHeight=this.options.height),t.x&&(this.slideScreenHeight=e.y<this.options.height?e.y:this.options.height,this.slideScreenWidth=this.options.width),this.slideContainment.css({width:this.slideScreenWidth,height:this.slideScreenHeight}),this.slideContent.css({width:this.slideScreenWidth,height:this.slideScreenHeight}),this.slideContent.find(".Presentation").css({overflow:"hidden"}),this.slideWrap.css({overflow:"hidden"}),this.slideContainment.css({overflow:"visible"})}},setAdaptSlideItems:function(){var e=(this._getScreenScale(),(this.slideScreenWidth-this.slideWidth)/2),t=(this.slideScreenHeight-this.slideHeight)/2;this.marginLeft=e,this.marginTop=t,this.slideContent.find(".interaction-area").css({"margin-left":e}),this.slideContent.find(".interaction-area").css({"margin-top":t})},_getScreenSize:function(){var e,t;if(interaction_view.isWeixin&&_g.device.ios())return{x:$(window).width(),y:$(window).height()};if("window"==this.options.body){var i=window,n=document,a=n.documentElement,r=n.getElementsByTagName("body")[0];e=i.innerWidth||a.clientWidth||r.clientWidth,t=i.innerHeight||a.clientHeight||r.clientHeight}else e=parseInt($(this.options.body).css("width"),10),t=parseInt($(this.options.body).css("height"),10);return{x:e,y:t}},_getScreenScale:function(){var e=this._getScreenSize(),t=e.x,i=e.y,n=this.options.width,a=this.options.height,r=null;r=n>=a?t/i>=n/a?i/a:t/n:i/t>a/n?t/n:i/a,$.zoom&&(r=$.zoom);var o;return o=t/i>=n/a?{x:r,y:null}:{x:null,y:r}},_bindControllers:function(){var e=this;$(".action-control").children("button").on("click",function(){$(this).hasClass("enabled")&&($(this).hasClass("navigate-right")&&e.next(),$(this).hasClass("navigate-left")&&e.prev(),$(this).hasClass("navigate-up")&&e.up(),$(this).hasClass("navigate-down")&&e.down())})},_bindKeyboard:function(){var e=this;$(document).on("keydown",function(t){var i=!1,n=e.getSlideDirections();37==t.keyCode&&n.left&&(e.options.onKeyboard&&e.options.onKeyboard(),e.prev(),i=!0),38==t.keyCode&&n.up&&(e.options.onKeyboard&&e.options.onKeyboard(),e.up(),i=!0),39==t.keyCode&&n.right&&(e.options.onKeyboard&&e.options.onKeyboard(),e.next(),i=!0),40==t.keyCode&&n.down&&(e.options.onKeyboard&&e.options.onKeyboard(),e.down(),i=!0),27==t.keyCode&&e.options.overview&&e.options.show_controlbar&&e.toggleOverview(e.show_overview?!1:!0),i&&t.preventDefault()})},_bindMouseWheel:function(){var e=this,t=0,i=0;e.wheelLock=!1,e.wheelEventLock=!1,$(this.options.containment).addClass("iMouseWheel enableMouseWheel"),$(this.options.containment).on("wheelstart",function(t){console.log("wstart"),$(t.target).is(this)&&(e.sliding||e.wheelLock||(e.wheelstart=!0))}),$(this.options.containment).on("wheelleft",function(i,n){if($(i.target).is(this)){var a=_g.mousewheel.getMouseWheel(n),r=a.x,o=Math.max(-1,Math.min(1,r||0));null==e.currentSlideDirection&&(e.currentSlideDirection=1);var s=parseInt(e.slideScreenWidth/25,10);if(t+=o/Math.abs(o)*s,i.gesture={deltaX:-1},-100>t&&(e.wheelEventLock||interaction_view.events.onPageSwipeEvent(38,interaction_view.currentPage)))return e.wheelEventLock=!0,void(t=0);if(-100>t&&(e.wheelEventLock||e.options.continuous&&e.continuous("left")))return e.wheelEventLock=!0,t=0,!1;if(e._testSlideDragEventAccess(i)&&(e.wheelstart=!0,_g.mousewheel.currentTarget=$(e.options.containment),-100>t&&!e.wheelLock)){var l=e.getSlideDirections();if(!l.right)return;e.options.onWheel&&e.options.onWheel(),e.wheelLock=!0,e.originh=e.indexh,e.originv=e.indexv,e.indexh=e.indexh+1,e.indexv=0,e.transition.autostart(e.options.transition,"x",i.gesture.deltaX)}}}),$(this.options.containment).on("wheelright",function(i,n){if($(i.target).is(this)){var a=_g.mousewheel.getMouseWheel(n),r=a.x,o=Math.max(-1,Math.min(1,r||0));null==e.currentSlideDirection&&(e.currentSlideDirection=1);var s=parseInt(e.slideScreenWidth/25,10);if(t+=o/Math.abs(o)*s,i.gesture={deltaX:1},t>100&&(e.wheelEventLock||interaction_view.events.onPageSwipeEvent(39,interaction_view.currentPage)))return e.wheelEventLock=!0,void(t=0);if(t>100&&(e.wheelEventLock||e.options.continuous&&e.continuous("right")))return e.wheelEventLock=!0,t=0,!1;if(e._testSlideDragEventAccess(i)&&(e.wheelstart=!0,_g.mousewheel.currentTarget=$(e.options.containment),t>100&&!e.wheelLock)){var l=e.getSlideDirections();if(!l.left)return;e.options.onWheel&&e.options.onWheel(),e.wheelLock=!0,e.originh=e.indexh,e.originv=e.indexv,e.indexh=e.indexh-1,e.indexv=0,e.transition.autostart(e.options.transition,"x",i.gesture.deltaX)}}}),$(this.options.containment).on("wheelup",function(t,n){if(console.log(t.currentTarget),$(t.target).is(this)){var a=_g.mousewheel.getMouseWheel(n),r=a.y,o=Math.max(-1,Math.min(1,r));null==e.currentSlideDirection&&(e.currentSlideDirection=2);var s=parseInt(e.slideScreenHeight/25,10);if(i+=o/Math.abs(o)*s,t.gesture={deltaY:-1},-50>i&&(e.wheelEventLock||interaction_view.events.onPageSwipeEvent(36,interaction_view.currentPage)))return e.wheelEventLock=!0,void(i=0);if(-50>i&&(e.wheelEventLock||e.options.continuous&&e.continuous("up")))return e.wheelEventLock=!0,i=0,!1;if(e._testSlideDragEventAccess(t)&&(e.dragstart=!0,_g.mousewheel.currentTarget=$(e.options.containment),-50>i&&!e.wheelLock)){var l=e.getSlideDirections();if(!l.down)return;e.options.onWheel&&e.options.onWheel(),e.wheelLock=!0,e.originh=e.indexh,e.originv=e.indexv,e.indexv+=1,e.transition.autostart(e.options.transition,"y",t.gesture.deltaY)}}}),$(this.options.containment).on("wheeldown",function(t,n){if($(t.target).is(this)){var a=_g.mousewheel.getMouseWheel(n),r=(a.y,Math.max(-1,Math.min(1,n.wheelDeltaY)));null==e.currentSlideDirection&&(e.currentSlideDirection=2);var o=parseInt(e.slideScreenHeight/25,10);if(i+=r/Math.abs(r)*o,t.gesture={deltaY:1},i>50&&(e.wheelEventLock||interaction_view.events.onPageSwipeEvent(38,interaction_view.currentPage)))return e.wheelEventLock=!0,void(i=0);if(i>50&&(e.wheelEventLock||e.options.continuous&&e.continuous("down")))return e.wheelEventLock=!0,i=0,!1;if(e._testSlideDragEventAccess(t)&&(e.wheelstart=!0,_g.mousewheel.currentTarget=$(e.options.containment),i>50&&!e.wheelLock)){var s=e.getSlideDirections();if(!s.up)return;e.options.onWheel&&e.options.onWheel(),e.wheelLock=!0,e.originh=e.indexh,e.originv=e.indexv,e.indexv-=1,e.transition.autostart(e.options.transition,"y",t.gesture.deltaY)}}}),$(this.options.containment).on("wheelend",function(n){console.log("wend"),$(n.target).is(this)&&(e.wheelstart||(e.currentSlideDirection=null),e.wheelEventLock=!1,e.wheelstart=!1,e.wheelLock=!1,e.currentSlideDirection=null,t=0,i=0)})},_bindOverviewEvents:function(){var e=this;this.touchoverviewelement.hammer().on("tap",function(t){if(console.log(t.target),$(t.target).is(".touchslide_overview_item")){var i=$(t.target).attr("data-indexh"),n=$(t.target).attr("data-indexv");i&&n&&e.slide(Number(i),Number(n))}return e.toggleOverview(!1),!1})},_drawOverview:function(){var e=this,t=this._getScreenSize(),n=this.slideScreenWidth/this.slideScreenHeight,a=parseInt(t.x/4<250?t.x/4:250,10),r=parseInt(a/n,10);if(this.overview_width=a,this.overview_height=r,$("body").append('<div class="touchslide_overview disableMouseWheel iMouseWheel" style="width:100%;height:100%;position:absolute;left:0;z-index:10000;overflow:auto;top:0;display:none;"></div>'),this.touchoverviewelement=$("body").children(".touchslide_overview"),this.touchoverviewelement.append('<div class="touchslide_overview_container"></div>'),this.touchoverviewcontainerel=this.touchoverviewelement.children(".touchslide_overview_container"),this.touchoverviewcontainerel.append('<div class="touchslide_overview_wrap disableMouseWheel iMouseWheel"></div>'),this.touchoverviewel=this.touchoverviewcontainerel.children(".touchslide_overview_wrap"),this.touchoverviewel.css("top",0),this.touchoverviewcontainerel.css({width:a+"px",height:r+"px","margin-left":"-"+a/2+"px","margin-top":"-"+r/2+"px"}),3==this.slideType){for(i=0;i<this.indexes.length;i++){var o=i*a+10*i;for(e.touchoverviewel.append('<div class="touchslide_overview_group" data-index="'+i+'" style="position:absolute;left:'+o+'px;top:0;"></div>'),j=0;j<this.indexes[i].length;j++){var s=j*r+10*j,l=this.options.getOverview?this.options.getOverview(this.indexes[i][j]):null;$(e.touchoverviewel.children()[i]).append('<div class="touchslide_overview_item" data-indexh="'+i+'" data-indexv="'+j+'" style="position:absolute;top:'+s+"px;left:0;width:"+a+"px;height:"+r+'px;"></div>'),$(e.touchoverviewel.children()[i]).children('[data-indexv="'+j+'"]').css({"background-color":"#FFF",outline:"1px solid #ccc"}),l&&$(e.touchoverviewel.children()[i]).children('[data-indexv="'+j+'"]').css({"background-image":"url("+l+")","background-size":"contain","background-position":"center center","background-repeat":"no-repeat"})}}$($(e.touchoverviewel.children()[0]).children()[0]).css("outline","2px solid red")}else{for(i=0;i<this.indexes.length;i++){var o=i*a+10*i,l=this.options.getOverview?this.options.getOverview(this.indexes[i]):null;e.touchoverviewel.append('<div class="touchslide_overview_item" data-indexh="'+i+'" data-indexv="0" style="position:absolute;left:'+o+"px;bottom:0;width:"+a+"px;height:"+r+'px;top:0;"></div>'),$(e.touchoverviewel.children()[i]).css({"background-color":"#FFF",outline:"1px solid #ccc"}),l&&$(e.touchoverviewel.children()[i]).css({"background-image":"url("+l+")","background-size":"contain","background-position":"center center","background-repeat":"no-repeat"})}$(e.touchoverviewel.children()[0]).css("outline","2px solid red")}this._bindOverviewEvents()},continuous:function(e){if(!this.isLast()||"up"!=e&&"left"!=e||this.getCurrentSlideId()!=interaction_view.currentPage){if(this.Ended&&this.isFirst()&&("down"==e||"right"==e)&&this.getCurrentSlideId()==interaction_view.currentPage){var t=0;if("down"==e&&2==this.options.continuous)switch(this.options.transition){case 0:t=0;break;case 1:t=4;break;case 2:t=8;break;case 3:t=10;break;case 4:t=14;break;case 5:t=18}else{if("right"!=e||1!=this.options.continuous)return!1;switch(this.options.transition){case 0:t=3;break;case 1:t=7;break;case 2:t=8;break;case 3:t=13;break;case 4:t=17;break;case 5:t=21}}var i=this.getLast();return presentation.gotopage(i,t),!0}return!1}var t=0;if("up"==e&&2==this.options.continuous)switch(this.options.transition){case 0:t=2;break;case 1:t=6;break;case 2:t=8;break;case 3:t=12;break;case 4:t=16;break;case 5:t=20}else{if("left"!=e||1!=this.options.continuous)return!1;switch(this.options.transition){case 0:t=1;break;case 1:t=5;break;case 2:t=8;break;case 3:t=11;break;case 4:t=15;break;case 5:t=19}}var n=this.getFirst();return presentation.gotopage(n,t),this.Ended=!0,!0},isLast:function(){return 3==this.slideType?this.indexh==this.slideItems.length-1&&this.indexv==this.slideItems[this.indexh].length-1:this.indexh==this.slideItems.length-1},isFirst:function(){return 3==this.slideType?0==this.indexh&&0==this.indexv:0==this.indexh},toggleOverview:function(e){if(this.options.show_overview)if(e){$(".reveal").css("opacity",.1);var t=this.indexh*this.overview_width+10*this.indexh;this.touchoverviewelement.show(),this.touchoverviewelement.scrollLeft(t),this.touchoverviewelement.scrollTop(0),this.show_overview=!0}else $(".reveal").css("opacity",""),this.touchoverviewelement.hide(),this.show_overview=!1},getSlideDirections:function(){var e={left:!1,right:!1,up:!1,down:!1};return 1==this.slideType?(this.indexh>0&&(e.left=!0),this.indexh<this.indexes.length-1&&(e.right=!0)):(this.indexh>0&&(this.options.checkSlidePermission?this.options.checkSlidePermission(this,this.slideType,"left",this.indexh,this.indexv)&&(e.left=!0):e.left=!0),this.indexh<this.indexes.length-1&&(this.options.checkSlidePermission?this.options.checkSlidePermission(this,this.slideType,"right",this.indexh,this.indexv)&&(e.right=!0):e.right=!0),this.indexv>0&&(e.up=!0),this.indexv<this.indexes[this.indexh].length-1&&(e.down=!0)),e},_testSlideDragEventAccess:function(e){var t=!0;return this.dragstart||this.wheelstart?(1==this.currentSlideDirection&&("dragup"==e.type||"dragdown"==e.type||"wheelup"==e.type||"wheeldown"==e.type)&&(t=!1),2==this.currentSlideDirection&&("dragleft"==e.type||"dragright"==e.type||"wheelleft"==e.type||"wheelright"==e.type)&&(t=!1),1==this.slideType&&("dragup"==e.type||"dragdown"==e.type||"wheelup"==e.type||"wheeldown"==e.type)&&(t=!1),2==this.slideType&&("dragleft"==e.type||"dragright"==e.type||"wheelleft"==e.type||"wheelright"==e.type)&&(t=!1),("dragend"==e.type||"wheelend"==e.type)&&(this.currentSlideDirection||(t=!1))):t=!1,t},_doStartEvent:function(e){this.transition.start(e)},_doDragingEvent:function(e){{var t=this._getDragDistance(e),i=this.getSlideDirections();this.transition.opts.type}if("dragleft"==e.type||"dragright"==e.type||"wheelleft"==e.type||"wheelright"==e.type){var n=e.gesture.deltaX;if(-1!=e.type.indexOf("right")&&!i.left)return void(this.dragstart=!1);if(-1!=e.type.indexOf("left")&&!i.right)return void(this.dragstart=!1);interaction_view.transitionPagePreLoad=null,n<t.min&&(e.gesture.deltaX=t.min),n>t.max&&(e.gesture.deltaX=t.max),this.transition.dragX(e)}if("dragup"==e.type||"dragdown"==e.type||"wheelup"==e.type||"wheeldown"==e.type){if(-1!=e.type.indexOf("down")&&!i.up)return void(this.dragstart=!1);if(-1!=e.type.indexOf("up")&&!i.down)return void(this.dragstart=!1);interaction_view.transitionPagePreLoad=null;var a=e.gesture.deltaY;a<t.min&&(e.gesture.deltaY=t.min),a>t.max&&(e.gesture.deltaY=t.max),this.transition.dragY(e)}},_doDragEndEvent:function(e){var t=(this.transition.opts.type,this._getDragDistance({type:1==this.currentSlideDirection?"dragleft":"dragup"})),i=[0,0],n=!1,a=this.getSlideDirections();if(e&&e.gesture){if(1==this.currentSlideDirection){var r=e.gesture.deltaX;if(r<t.min&&(e.gesture.deltaX=t.min),r>t.max&&(e.gesture.deltaX=t.max),0!=r&&(this.originh=this.indexh,this.originv=this.indexv,0>r&&a.right&&(n=!0,this.indexh+=1),r>0&&a.left&&(n=!0,this.indexh-=1),this.indexv=0),n){var o=this.getCurrentSlideId();this.options.onSlideChangeStart&&this.options.onSlideChangeStart(o),(r>0&&a.left||0>r&&a.right)&&(this.sliding=!0,this.transition.dragEnd(e))}}if(2==this.currentSlideDirection){var s=e.gesture.deltaY;if(s<t.min&&(e.gesture.deltaY=t.min),s>t.max&&(e.gesture.deltaY=t.max),0!=s&&(this.originh=this.indexh,this.originv=this.indexv,0>s&&a.down&&(n=!0,i=[0,t.min],this.indexv+=1),s>0&&a.up&&(n=!0,i=[0,t.max],this.indexv-=1)),n){var o=this.getCurrentSlideId();this.options.onSlideChangeStart&&this.options.onSlideChangeStart(o),(s>0&&a.up||0>s&&a.down)&&(this.sliding=!0,this.transition.dragEnd(e))}}n||this.transition.recoveritemClass()}},_complete:function(){var e=this;this.slideContent.find(".c-transition-item").removeClass("c-transition-left").removeClass("c-transition-right").removeClass("c-transition-up").removeClass("c-transition-down").removeClass("c-transition-active"),console.log(e.indexh,e.originh);var t=3==e.slideType?e.indexes[e.indexh][e.indexv]:e.indexes[e.indexh],i=3==e.slideType?e.indexes[e.originh][e.originv]:e.indexes[e.originh];e.preStoped=!1,e.sliding=!1,e.onSlideChange(t,i)},_cancel:function(){var e=this;this.indexh=this.originh,this.indexv=this.originv,7==e.transition.opts.type&&this.slideContent.find(".c-transition-item").removeClass("c-transition-active"),this.slideContent.find(".c-transition-item").removeClass("c-transition-left").removeClass("c-transition-right").removeClass("c-transition-up").removeClass("c-transition-down"),this.setSlideItems(),e.sliding=!1;var t=3==e.slideType?e.indexes[e.indexh][e.indexv]:e.indexes[e.indexh];this.options.onContinuePlay&&this.options.onContinuePlay(t)},_getDragDistance:function(e){var t={min:0,max:0},i=this.getSlideDirections();return("dragleft"==e.type||"dragright"==e.type||"wheelleft"==e.type||"wheelright"==e.type)&&(i.right&&(t.min=-this.slideScreenWidth),i.left&&(t.max=this.slideScreenWidth)),("dragup"==e.type||"dragdown"==e.type||"wheelup"==e.type||"wheeldown"==e.type)&&(i.down&&(t.min=-this.slideScreenHeight),i.up&&(t.max=this.slideScreenHeight)),t},_getCurrentPosition:function(){var e=-this.indexh*this.slideScreenWidth,t=-this.indexv*this.slideScreenHeight;return{x:e,y:t}},isOverview:function(){return!1},getSlideItem:function(e,t){return 3==this.slideType?this.slideItems[e][t]:this.slideItems[e]},getSlideItemById:function(e){var t=this.getSlidePositionById(e);return t?3==this.slideType?this.slideItems[t.h][t.v]:this.slideItems[t.h]:null},getCurrentSlide:function(){return 3==this.slideType?this.slideItems[this.indexh][this.indexv]:this.slideItems[this.indexh]},getCurrentSlideId:function(){return 3==this.slideType?this.indexes[this.indexh][this.indexv]:this.indexes[this.indexh]},getIndices:function(){return{h:this.indexh,v:this.indexv}},getAllSlideIds:function(){return this.slideIdsArray},getFirst:function(){var e=this.getAllSlideIds();return e?e[0]:null},getLast:function(){var e=this.getAllSlideIds();return e?e[e.length-1]:null},getRight:function(){return this.getSlideDirections().right?3==this.slideType?this.indexes[this.indexh+1][0]:this.indexes[this.indexh+1]:null},getLeft:function(){return this.getSlideDirections().left?3==this.slideType?this.indexes[this.indexh-1][0]:this.indexes[this.indexh-1]:null},getUp:function(){return this.getSlideDirections().up&&3==this.slideType?this.indexes[this.indexh][this.indexv-1]:null},getDown:function(){return this.getSlideDirections().down&&3==this.slideType?this.indexes[this.indexh][this.indexv+1]:null},getPrev:function(){return this.getSlideDirections().up?this.getUp():"object"==typeof this.indexes[this.indexh-1]&&this.indexes[this.indexh-1][0]?_.last(this.indexes[this.indexh-1]):this.indexes[this.indexh-1]},getNext:function(){var e;return e=this.getSlideDirections().down?this.getDown():this.getRight(),!e&&Reveal.indexes.length>this.indexh+1&&(e=this.indexes[this.indexh+1][0]),e},getSlidePositionById:function(e){var t=this.slideIds[e];return t},getVerticalLength:function(){return 3==this.slideType?this.indexes[this.indexh].length:1},getHorizontalLength:function(){return this.indexes.length},slide:function(e,t){if(void 0!=e&&(e!=this.indexh||t!=this.indexv)){var i=this.getCurrentSlideId();this.indexh=e,this.indexv=t?t:0;var n=(e*this.slideScreenWidth,t?t*this.slideScreenHeight:0,this.getCurrentSlideId());this.onSlideChange(n,i)}},setControllers:function(){var e=this.getSlideDirections();$(".action-control").children("button").removeClass("enabled"),e.right&&$(".action-control").children(".navigate-right").addClass("enabled"),e.left&&$(".action-control").children(".navigate-left").addClass("enabled"),e.up&&$(".action-control").children(".navigate-up").addClass("enabled"),e.down&&$(".action-control").children(".navigate-down").addClass("enabled")},setProgressBar:function(){var e=parseInt((this.indexh+1)/this.indexes.length*100,10);$(".controlbar").children(".progress").children("span").css({width:e+"%"})},onSlideChange:function(e,t){var i=this;this.setSlideItems(),this.previousSlide=t,this.currentSlide=e,this.options.history&&this.Router.navigate("page/"+e),i.options.onSlideChange&&i.options.onSlideChange(i.currentSlide,i.previousSlide),i.options.controls&&i.setControllers(),i.options.progress&&i.setProgressBar()},_onStopPlay:function(){if(!this.preStoped){var e=this,t=3==e.slideType?e.indexes[e.indexh][e.indexv]:e.indexes[e.indexh];this.options.onStopPlay&&this.options.onStopPlay(t),this.preStoped=!0}},prev:function(){0==this.indexh||this.indexes.length<2||this.slide(this.indexh-1)},next:function(){this.indexh==this.indexes.length-1||this.indexes.length<2||this.slide(this.indexh+1)},up:function(){3==this.slideType&&this.indexes[this.indexh][this.indexv-1]&&this.slide(this.indexh,this.indexv-1)},down:function(){3==this.slideType&&this.indexes[this.indexh][this.indexv+1]&&this.slide(this.indexh,this.indexv+1)},changeOverview:function(e,t){if(this.options.show_overview){var i=t?t*this.overview_height+10*t:0;$(this.touchoverviewel).find(".touchslide_overview_item").css("outline","1px solid #ccc"),3==this.slideType?($($(this.touchoverviewel.children()[this.indexh]).children()[this.indexv]).css("outline","2px solid red"),this.touchoverviewel.children().css("top",0),this.touchoverviewel.children().eq(e).css({top:-i})):$(this.touchoverviewel.children()[this.indexh]).css("outline","2px solid red")}}},"undefined"==typeof require?(window._g||(window._g={}),window._g.touch=t,window._g.transition=l,window._g.touchslide=c):define("interaction_view/ui/pageslide",["_g/base","jquery.hammer","underscore","jquery.transit","backbone","_g/transitionargs"],function(){window._g.touch=t,window._g.transition=l,window._g.touchslide=c})}(window),function(){var e,t,i,n,a,r,o,s,l,c={};t=window.document.documentElement,l=window.navigator.userAgent.toLowerCase(),c.ios=function(){return c.iphone()||c.ipod()||c.ipad()},c.iphone=function(){return i("iphone")},c.ipod=function(){return i("ipod")},c.ipad=function(){return i("ipad")},c.android=function(){return i("android")},c.androidPhone=function(){return c.android()&&i("mobile")},c.androidTablet=function(){return c.android()&&!i("mobile")},c.blackberry=function(){return i("blackberry")||i("bb10")||i("rim")},c.blackberryPhone=function(){return c.blackberry()&&!i("tablet")},c.blackberryTablet=function(){return c.blackberry()&&i("tablet")},c.windows=function(){return i("windows")},c.mac=function(){return i("mac")},c.linux=function(){return i("linux")},c.windowsPhone=function(){return c.windows()&&i("phone")},c.windowsTablet=function(){return c.windows()&&i("touch")},c.fxos=function(){return(i("(mobile;")||i("(tablet;"))&&i("; rv:")},c.fxosPhone=function(){return c.fxos()&&i("mobile")},c.fxosTablet=function(){return c.fxos()&&i("tablet")},c.meego=function(){return i("meego")},c.mobile=function(){return c.androidPhone()||c.iphone()||c.ipod()||c.windowsPhone()||c.blackberryPhone()||c.fxosPhone()||c.meego()},c.tablet=function(){return c.ipad()||c.androidTablet()||c.blackberryTablet()||c.windowsTablet()||c.fxosTablet()},c.msie=function(){return $.browser.msie||!!navigator.userAgent.match(/Trident\/7\./)},c.portrait=function(){return 90!==Math.abs(window.orientation)},c.landscape=function(){return 90===Math.abs(window.orientation)},c.noConflict=function(){return this},c.svg=function(){return document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#Shape","1.1")},c.online=function(e,t,i){var n=new Image;n.onload=function(){console.log("online"),t&&t.constructor==Function&&t()},n.onerror=function(){console.log("offline"),i&&i.constructor==Function&&i()},n.src=e+"?t="+_g.uuid()},c.screenSize=function(){var e=window,t=document,i=t.documentElement,n=t.getElementsByTagName("body")[0],a=e.innerWidth||i.clientWidth||n.clientWidth,r=e.innerHeight||i.clientHeight||n.clientHeight;return{x:a,y:r}},c.isWeixin=function(){var e=navigator.userAgent.toLowerCase();return/micromessenger/.test(e)?!0:!1},i=function(e){return-1!==l.indexOf(e)},a=function(e){var i;return i=new RegExp(e,"i"),t.className.match(i)},e=function(e){return a(e)?void 0:t.className+=" "+e},o=function(e){return a(e)?t.className=t.className.replace(e,""):void 0};var d=function(){c.ios()?c.ipad()?e("ios ipad tablet"):c.iphone()?e("ios iphone mobile"):c.ipod()&&e("ios ipod mobile"):e(c.android()?c.androidTablet()?"android tablet":"android mobile":c.blackberry()?c.blackberryTablet()?"blackberry tablet":"blackberry mobile":c.windows()?c.windowsTablet()?"windows tablet":c.windowsPhone()?"windows mobile":"desktop":c.fxos()?c.fxosTablet()?"fxos tablet":"fxos mobile":c.meego()?"meego mobile":"desktop")};n=function(){return c.landscape()?(o("portrait"),e("landscape")):(o("landscape"),e("portrait"))},s="onorientationchange"in window,r=s?"orientationchange":"resize",window.addEventListener?window.addEventListener(r,n,!1):window.attachEvent?window.attachEvent(r,n):window[r]=n,n(),c.initDom=d,window._g_device=c,"undefined"==typeof require?(window._g||(window._g={}),window._g.device=_g_device):define("_g/device",["_g/base"],function(){return window._g.device=_g_device,window._g.device})}(window),function(e){e.fn.addBack=e.fn.addBack||e.fn.andSelf,e.fn.extend({actual:function(t,i){if(!this[t])throw'$.actual => The jQuery method "'+t+'" you called does not exist';var n,a,r={absolute:!1,clone:!1,includeMargin:!1},o=e.extend(r,i),s=this.eq(0);if(o.clone===!0)n=function(){var e="position: absolute !important; top: -1000 !important; ";s=s.clone().attr("style",e).appendTo("body")},a=function(){s.remove()};else{var l,c=[],d="";n=function(){l=s.parents().addBack().filter(":hidden"),d+="visibility: hidden !important; display: block !important; ",o.absolute===!0&&(d+="position: absolute !important; "),l.each(function(){var t=e(this),i=t.attr("style");c.push(i),t.attr("style",i?i+";"+d:d)})},a=function(){l.each(function(t){var i=e(this),n=c[t];void 0===n?i.removeAttr("style"):i.attr("style",n)})}}n();var h=/(outer)/.test(t)?s[t](o.includeMargin):s[t]();return a(),h}})}(jQuery),define("jquery.actual",["jquery"],function(){}),define("text!interaction_view/template/controlbar.js",[],function(){return'<div class=\'presentation-area\'>\n    <div class="controlbar">\n            <div class="logo"><% if (typeof cbt_data=="undefined"){ %><% if(typeof has_logo != \'undefined\' &&  has_logo){ %><a href="http://www.epub360.com" target="_blank"><img alt="logo" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFIAAAAaCAYAAAAkJwuaAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAABhFJREFUeNrsmVlwlEUQx7+sSTwikSAqiAciJCJQQVFBA4WAZwyXoiioUUAi+CBe4IMFXg8ioIKlgoIHhhKltDzAg0IpopJQbjQYTVKh1NKICUSUwygJC7Gb+k3ZTu2GXcyDD9tV/5qd6S/zfdPT3fPvSUo4HA48WSqYLNggKBasFPwRJCWqDBgw4GAbiqKrFuwUDBW8IKgXPJA0WdsSzZALBFmCHMFCwbGCRwRvJ82VmCHPFpwrqBXMEJwj+FkwWrA8abL4DTlfUC74UjBOUCE4X/Cn4CYMmpQ4DPkEB4164irBLYIGwXj0zyXN1rYhjxF0F6wTXCwoYPwlQaZgtaBG0FWQmzRddEPqYfKT4AfBbsGDgjWCSeifpH2FdnAC79D08Ficz6Ycpu5/YcgboDfHM9ZBMEcwAW90xlD5irZ3Au/QlDBLMK+NZ9T7PxE0CpbwDfbwUz67XfAWB6GTIwT3C+pMTo8lRwumC+YKrouiV6d5XHAz81qZiO5GQSfBCJyjqLy8PPPgLgshV8/LJ3R1wTMFhXhkAWG8X/ANXtFPsAfvjUfWCi5lUyZF0Q8RlHhjYQ64boIfoyysj6DKzG2lMAq70MVvEvQ0Yx8LLuH3OozjROceSCGyzPtu5dgdTf8XQV7IDH7ABB/Rz8djN2NElVbB1wkY0Ybk5hj622kX4W27BOcxNhIjKhUbJHiT8f6CdIzYRE5/CN3MKO+4GyNWkcZ2YLjObNYIouFhwRaioD/rVyO2oCvDXvvplwpOVg8PMahyFO0WysSnbSVEaH4mWCy4wOiW8IG30R+G4T80O+hCNNfzCpXTad8gdTjvzGahKp/jUcX0tVjowe8KWMbr9HVhGd47utLqt88WrKDfzxycK0lp8807XArbgO4++uvpz6I/MBUvU/nNhFXYW6jt52luwEM20fZm4e6j+2C4gN1UmQoCPGuc8fIAZhDAV1WOE+zldyptlnnWD3eX4zPw1iaja/Lmce/qTuoIjEO5CDrRbMhew2zsmly/S6p5WT5/0IG4X8P4nbQN5J5rBGcyrgfSNvS7PENsbYOr6hz3svtFLLzCeK5bUITfEUPFqmAYvb35Q2aRB2KkkTTaF0lR64ggq0unbRbs83Rp3oa4/l92kdcKXhM8j5s7ca6/DFeeY0IoMC87VI5cgHe/S3+GSexDCNsywm07edjl7ysJ3dlEQT0ee7jyKZSuzoT9fxLrkTvwOnXnL6Lsogv9PbS9PA88lDTgSeqFo7w8tsh79juSfycXOoayTGZDtrYTBWxu78pGeVFfwRkez3JhcqR3KEUSJMoZXl45ALdTOQvjTsNAF3Lr1IC+hG/S8D9NMKYdDZne3oZsMZyr0FxO+DvW2k5RECEtaJ69WvA+p2op+h7m3dXU/XPpD4pyMiciY2EbPYmSdgntNG/sCsHLGCwU/HM7HjEpIDCnZqpncP+EjKUPMed0mEA1d54pJqWke1HQbObM8MZazHeFYhwy7tlRXMZs5IrQ6ixTSEnEI5sN3bA0Yov3Ee5Dx3intAt9dzCc6n1YxKMup3jz1XsG7mzmjZiy1dKWfeRQ+3yLSTXNMQ48f0N2Gl2ml4Ja4zhI/+WRpVQG00jiY9GVmhpV5R68J9vkLVd/699MEZxENRJAL5xe6+1b2aQCQ6QDDjbllAvxkKHG81dT446EslyGrtZ4Ul9O/Bz6NRyAWjFdZAh4EUwhm3tVlUpzWE7AqKNNERC3IbXW7saEWWZ8N7VmDTXpcO/vyvDMbRBXrWROMPq9UJow45UY2ebjwRixI/PlGP1TgrtM5TTVoy5XwR50Y58xul/hqCV4up72dwie5VJkmHl2OWdBwEZM9O4HLocSasX1LRs2HmpYDd+9HspYm8rpl0vO6ALNWWoYv3P990CdKf8COF8uNalyy9+5bnOpoRH9ZOpaDadX2SQXXn3x2F6Q5LVm/iKKgzw2ZpXROQMVMs9ik3IexSMr6Q/nHTncJ6w38+itzjvU+Bv5HbDWYv5j4A69FV5f9RUpUf4d64vbySmQ8qTYS4g2/h3rS0dTlyYlDh4ZS74nXBqT5ootfwswAIGagOhx/Kc1AAAAAElFTkSuQmCC"></a><% } %><% } %></div>\n            <div class="progress"><span></span></div>\n            <% if(controlbar_settings.arrow){%>\n              <% if(play_mode==0){ %>\n                <div class="btn-group action-control" style="margin-left: -40px;">\n                   <button class="btn navigate-left" href="#" ><i class="icon-chevron-left icon-2x"></i></button>\n                   <button class="btn navigate-right" href="#" ><i class="icon-chevron-right icon-2x"></i></button>                  \n              <% } else {%>\n                <div class="btn-group action-control" style="margin-left: -90px;">\n                    <button class="btn navigate-left" href="#" ><i class="icon-chevron-left icon-2x"></i></button>\n                    <button class="btn navigate-right" href="#" ><i class="icon-chevron-right icon-2x"></i></button>\n                    <button class="btn navigate-up" href="#" ><i class="icon-chevron-up icon-2x"></i></button>\n                    <button class="btn navigate-down" href="#" ><i class="icon-chevron-down icon-2x"></i></button>\n               <% } %>\n            </div>\n            <% } %>\n    </div>\n</div>'}),define("interaction_view/ui/screenset",["text!interaction_view/template/controlbar.js","_g/device"],function(){var e=require("text!interaction_view/template/controlbar.js"),t={init:function(){if(window.screenLock=!1,window.screenScale=null,window.bar_height=0,window.useTranform=!1,window.get_window_size=function(){var e,t;if(interaction_view.isWeixin&&interaction_view.isIos)return{x:$(window).width(),y:$(window).height()};if(!interaction_view.isWeixin&&interaction_view.isAndroid)return{x:$(window).width(),y:$(window).height()};if(interaction_view.forpreview)e=parseInt($(".interaction-preview").css("width"),10),t=parseInt($(".interaction-preview").css("height"),10);else{var i=window,n=document,a=n.documentElement,r=n.getElementsByTagName("body")[0];e=i.innerWidth||a.clientWidth||r.clientWidth,t=i.innerHeight||a.clientHeight||r.clientHeight}return{x:e,y:t}},window.recover_screen=function(){window.useTransform?(document.querySelectorAll(".reveal")[0].style.transform="scale(1)",document.querySelectorAll(".reveal")[0].style.WebkitTransform="scale(1)",document.querySelectorAll(".reveal")[0].style.MozTransform="scale(1)",document.querySelectorAll(".reveal")[0].style["-o-transform"]="scale(1)"):(document.querySelectorAll(".reveal")[0].style.zoom=1,document.querySelectorAll(".reveal")[0].style.MozTransform="scale(1)"),$.zoom=1},window.adjust_screen=function(){if(window.screenLock)return void interaction_view.screenset.patchForFixedSize();var e=1,t=get_window_size();if(interaction_view.ismobile&&interaction_view.currentScreenSize&&interaction_view.currentScreenSize.x==t.x&&interaction_view.currentScreenSize.y==t.y)return void interaction_view.screenset.patchForIframe();
var i=t.x,n=t.y,a=interaction_view?interaction_view.size.x:parseInt($(".slides")[0].style.width,10),r=interaction_view?interaction_view.size.y:parseInt($(".slides")[0].style.height,10);$("body").height($("html").height()-0),e=a>=r?2==interaction_view.screen_mode?window.screenScale?window.screenScale:i/n>=a/r?i/a:n/r:window.screenScale?window.screenScale:i/n>=a/r?n/r:i/a:2==interaction_view.screen_mode?window.screenScale?window.screenScale:n/i>=r/a?n/r:i/a:window.screenScale?window.screenScale:n/i>=r/a?i/a:n/r,window.useTranform?(document.querySelectorAll(".reveal")[0].style.transform="scale("+e+")",document.querySelectorAll(".reveal")[0].style.WebkitTransform="scale("+e+")",document.querySelectorAll(".reveal")[0].style.MozTransform="scale("+e+")",document.querySelectorAll(".reveal")[0].style["-o-transform"]="scale("+e+")"):(document.querySelectorAll(".reveal")[0].style.zoom=e,document.querySelectorAll(".reveal")[0].style.MozTransform="scale("+e+")"),$.zoom=e,interaction_view.currentScreenSize=t,!interaction_view.ismobile&&_g.device.msie()&&interaction_view.screenset.adjustPatchforIE(e),interaction_view.screenset.patchForIframe(),"undefined"!=typeof Reveal&&Reveal.adapt?(Reveal.setAdaptScreen(),Reveal._initSlideStyle(),interaction_view.adapt.change()):"undefined"!=typeof Reveal?(Reveal.setAdaptScreen(),Reveal._initSlideStyle()):interaction_view.currentScreenSize=null,interaction_view.touchview&&interaction_view.screenset.adjustRevealPosition(e)},interaction_view.ismobile){var e="onorientationchange"in window,t=e?"orientationchange":"resize";window.addEventListener?window.addEventListener(t,interaction_view.screenset.patchForMobileOrientation,!1):window.attachEvent?window.attachEvent(t,interaction_view.screenset.patchForMobileOrientation):window[t]=interaction_view.screenset.patchForMobileOrientation,interaction_view.screenset.patchForMobileOrientation(),interaction_view.isAndroid&&(window.onresize=function(){interaction_view.screenset.patchForMobileOrientation()})}else interaction_view.forpreview||(window.onresize=function(){adjust_screen()},window.onload=adjust_screen);window.screenSizeLock=function(){recover_screen(),window.screenLock=!0,interaction_view.screenset.patchForFixedSize(),interaction_view.screenset.patchForScreenMode2()},window.screenSizeRelease=function(){window.screenLock=!1,adjust_screen()}},patchForScreenMode2:function(){2==interaction_view.screen_mode&&(Reveal.setAdaptScreen(),Reveal._initSlideStyle())},patchForFixedSize:function(){if("undefined"!=typeof Reveal&&Reveal.adapt)Reveal.setAdaptScreen(),Reveal._initSlideStyle(),interaction_view.adapt.change();else{var e="undefined"!=typeof Reveal?Reveal.slideWidth:interaction_view.size.x,t="undefined"!=typeof Reveal?Reveal.slideHeight:interaction_view.size.y,i=get_window_size();if(window.useTransform){var n=(i.y-t)/2;$(".reveal").css({"margin-top":n});var a=(i.x-e)/2;$(".reveal").css({"margin-left":a})}else{var n=(i.y-t)/2;$(".reveal").css({"margin-top":n});var a=(i.x-e)/2;$(".reveal").css({"margin-left":a})}}},bindControlbarAutoHideEvent:function(){interaction_view.controlbarStatus=1,interaction_view.ismobile||$("body").on("mouseover",function(){$(".loading").length>0&&$(".loading").show(),0==interaction_view.controlbarStatus&&interaction_view.screenset.controlbarel&&interaction_view.screenset.controlbarel.show(500),interaction_view.controlbarStatus=1,t.startControlbarHide()})},changeProgressBar:function(){var e=Reveal.getIndices();interaction_view.screenset.controlbarel&&(interaction_view.screenset.controlbarel.find(".progress").children("span")[0].style.width=(e.h+1)/interaction_view.ipagelist.models.length*100+"%")},startControlbarHide:function(){"number"==typeof interaction_view.controlbarTimeOut&&(window.clearTimeout(interaction_view.controlbarTimeOut),delete interaction_view.controlbarTimeOut),interaction_view.controlbarTimeOut=window.setTimeout(function(){interaction_view.screenset.controlbarel&&interaction_view.screenset.controlbarel.hide(),$(".loading").length>0&&$(".loading").hide(500),interaction_view.controlbarStatus=0},3e3)},render:function(){var e=interaction_view.doc.toJSON();interaction_view.screenset.values=t.values=t.queryparse(e),interaction_view.ismobile||interaction_view.forpreview||t.rendercontrolbar(),t.initScreen(),t.bindControlbarAutoHideEvent(),interaction_view.ismobile&&interaction_view.screenset.startControlbarHide()},initScreen:function(){workEnd("-------- 6. screenset  1 add style 1 --------"),t.values.bg_opacity?interaction_view.containment.css("background",t.values.bg_color):interaction_view.containment.css("background-color","transparent"),workEnd("-------- 6. screenset  1 add style 1 --------"),0==t.values.screen_mode&&(window.screenLock=!0,interaction_view.screenset.controlbarel&&(interaction_view.screenset.controlbarel.find("button.actualsize").addClass("active"),interaction_view.screenset.controlbarel.find("button.adaptive").removeClass("active")),recover_screen())},queryparse:function(e){return e.bg_color=_g.getUrlParameterByName("bg_color")?"#"+_g.getUrlParameterByName("bg_color"):e.bg_color,e.bg_opacity=_g.getUrlParameterByName("bg_opacity")?Number(_g.getUrlParameterByName("bg_opacity")):e.bg_opacity,e.screen_mode=_g.getUrlParameterByName("screen_mode")?Number(_g.getUrlParameterByName("screen_mode")):e.screen_mode,e.show_controlbar=_g.getUrlParameterByName("controlbar")?_g.string.string2boolean(_g.getUrlParameterByName("controlbar")):e.show_controlbar,e.controlbar_settings=_g.getUrlParameterByName("controlbar_settings")?JSON.parse(_g.getUrlParameterByName("controlbar_settings")):e.controlbar_settings,e},rendercontrolbar:function(){t.values.show_controlbar&&(interaction_view.containment.append(_.template(e,t.values)),interaction_view.screenset.controlbarel=$("div.presentation-area"),interaction_view.screenset.controlbarel.find("[rel=tooltip]").tooltip())},adjustPatchforIE:function(e){var t=get_window_size();if(t.x/t.y<interaction_view.size.x/interaction_view.size.y){var i=(t.y-interaction_view.size.y*e)/2;$(".reveal").css({"margin-top":i})}else{var n=(t.x-interaction_view.size.x*e)/2;$(".reveal").css({"margin-left":n})}},adjustRevealPosition:function(e){var t=get_window_size(),i="undefined"!=typeof Reveal?Reveal.slideScreenWidth:interaction_view.size.x,n="undefined"!=typeof Reveal?Reveal.slideScreenHeight:interaction_view.size.y;if(t.x/t.y<interaction_view.size.x/interaction_view.size.y){if(window.useTransform)var a=(t.y-n)/2,r=(t.x-i)/2;else{var a;a=!interaction_view.ismobile&&$.browser.mozilla?(t.y-n*e)/2:(t.y/e-n)/2;var r=0}$(".reveal").css({"margin-top":a}),$(".reveal").css({"margin-left":r})}else{if(window.useTransform)var r=(t.x-i)/2,a=(t.y-n)/2;else{var r;r=$.browser.mozilla?(t.x-i*e)/2:(t.x/e-i)/2;var a=0}$(".reveal").css({"margin-left":r}),$(".reveal").css({"margin-top":a})}},patchForIframe:function(){!$.zoom||1==$.zoom},patchForWeiXin:function(){"micromessenger"==navigator.userAgent.toLowerCase().match(/MicroMessenger/i)&&$(".reveal").css("transform","scale(1.005,1.005)")},adaptScreen:function(){},patchForMobileOrientation:function(){var e=interaction_view.doc.toJSON().vertical,t=interaction_view.doc.toJSON().horizontal,i=!1,n=null;return e||t?(t?e||_g.device.portrait()&&(i=!0,$("body").children(".book_mask").length||$("body").append('<div class="book_mask"><img src="/staticfs/diazo/img/screendirectionlock.png"><div>è¯·è°ƒæ•´åˆ°é€‚åˆå±å¹•é˜…è¯»çš„æ–¹å‘</div></div>')):_g.device.landscape()&&(i=!0,$("body").children(".book_mask").length||$("body").append('<div class="book_mask"><img src="/staticfs/diazo/img/screendirectionlock.png"><div>è¯·è°ƒæ•´åˆ°é€‚åˆå±å¹•é˜…è¯»çš„æ–¹å‘</div></div>')),i||$("body").children(".book_mask").remove(),n=_g.device.portrait()?1:0,interaction_view.isAndroid&&interaction_view.isWeixin?n!==interaction_view.current_oriention&&adjust_screen():adjust_screen(),void(interaction_view.current_oriention=_g.device.portrait()?1:0)):!1}};return t}),define("interaction_view/ui/touchinit",[],function(){var e={init:function(){interaction_view.TransformPrefix=interaction_view._checkPropPrefix("transform"),interaction_view.queue=new Queue,interaction_view.PluginManage.init(),interaction_view.iImgs={},interaction_view.share_page_id="first",interaction_view.share_app_data={},interaction_view.LayerActionLoaded={},window.shareSuccess=function(){$("#epub360-ad").addClass("show");var e=!1;if("function"==typeof epub360ShareEvent&&epub360ShareEvent(),["www.epub360.com","m.creatby.com"].indexOf(window.location.host)>=0&&(e=!0),(window.location.pathname.indexOf("uaqjq")>0||window.location.pathname.indexOf("glh1i4")>0)&&(e=!1),!e){var t=_.filter(interaction_view.events.pageWXShareSuccessEvents,function(e){return e.page_id==interaction_view.currentPage});_.each(t,function(e){e.func()})}},interaction_view.wait=function(){$("#jswait-loading").hide(),$("body").append('<div class="mejs-overlay-button player-control-button" style="cursor:pointer;margin-top: -35px;position: absolute;top: 50%;left: 50%;width: 100px;height: 100px;margin: -50px 0 0 -50px;z-index: 1000001;background: url(http://qn.static.epub360.com/thirdparty/mediaelementjs/bigplay.svg);"></div>'),$(".player-control-button").on("click",function(){$("#jswait-loading").show(),$("div#epub360player-cover").remove(),$(".player-control-button").remove(),loading_progress_timer=setInterval(function(){compute_loadding_progress(),set_loading_progress()},200),interaction_view.start()})},interaction_view.start=function(){if(!interaction_view.foredit)for(var e=0;e<interaction_view.events.epub360StartEvents.length;e++)interaction_view.events.epub360StartEvents[e]();workEnd("-------- 1. touchinit 3 interaction_view.start start --------");var t=void 0!=interaction_view.doc.get("disable_history")?interaction_view.doc.get("disable_history"):!0;1==_g.getUrlParameterByName("disableHistoryStart")&&(t=!0),0==_g.getUrlParameterByName("disableHistoryStart")&&(t=!1),workEnd("-------- 1. touchinit 3 add style 1 --------"),interaction_view.ismobile&&$("body").addClass("ios"),workEnd("-------- 1. touchinit 3 add style 1 --------");var i=interaction_view.doc.get("play_mode");interaction_view.book_id=interaction_view.doc.get("id"),interaction_view.play_mode=i,interaction_view.screen_mode=interaction_view.doc.get("screen_mode"),interaction_view.events.init(),interaction_view.screenset.init(),interaction_view.screenset.render();var n=interaction_view.doc.toJSON();interaction_view.ismobile&&$("body").one("touchstart",function(){presentation.preloadpageAudio()}),interaction_view.continuous=n.continuous,interaction_view.hasArrow=n.arrow,workEnd("-------- 1. touchinit 3 interaction_view.start 1 --------"),new _g.touchslide({body:interaction_view.forpreview?".interaction-preview":"window",width:interaction_view.size.x,height:interaction_view.size.y,containment:".reveal",keyboard:!interaction_view.foredit&&!interaction_view.ismobile,controls:!interaction_view.ismobile,mouseWheel:!interaction_view.ismobile&&n.desktop_mousewheel,progress:!interaction_view.ismobile,adapt:n.adapt,history:interaction_view.forpreview?!1:!0,disableHistoryStart:t,show_excontent:n.show_excontent,screen_mode:n.screen_mode,transition:n.switch_mode,overview:interaction_view.forpreview?!1:n.controlbar_settings.overview,show_overview:interaction_view.ismobile?!1:interaction_view.forpreview?!1:!0,show_controlbar:n.show_controlbar,continuous:n.continuous,smooth:n.smooth,onReady:function(e,t){workEnd("-------- 1. touchinit 3 interaction_view.start  _g.touchslide.onReady  start ------------"),interaction_view.screenset.patchForWeiXin(),window.Reveal=e,interaction_view.forpreview||adjust_screen(),interaction_view.playstatus="wait",interaction_view.currentPage=t;var i=require("interaction_view/view/master");interaction_view.imasterlist.length&&interaction_view.imasterlist.at(0).addView("iview",i),workEnd("-------- 1. touchinit 3 interaction_view.start  masterview ------------");var n=require("interaction_view/view/background");interaction_view.ibackgroundlist.length&&interaction_view.ibackgroundlist.at(0).addView("iview",n),"undefined"!=typeof configpage&&configpage.renderView(),presentation.startLoad(),interaction_view.ismobile&&(presentation.isFirstPageLoading=interaction_view.currentPage),presentation.pageLoad(interaction_view.currentPage)},slidePlay:function(e){var t=e;interaction_view.currentPage=e;var i=interaction_view.ipagelist.getPage(interaction_view.currentPage);i.get("loaded")&&interaction_view.imasterlist.at(0).get("loaded")&&interaction_view.ibackgroundlist.at(0).get("loaded")?(interaction_view.playstatus="play",interaction_view.containment.find("#jswait-loading").remove(),interaction_view.android?window.setTimeout(function(){interaction_view.play(t)},50):interaction_view.play(t)):(!interaction_view.containment.has("#jswait-loading").length>0&&interaction_view.containment.jswait&&interaction_view.containment.jswait(),interaction_view.playstatus="wait",i.isStartLoad||interaction_view.ipagelist.getPage(i.id)&&presentation.pageLoad(i.id))},onSlideChangeStart:function(e){Reveal.options.slidePlay(e),Reveal.played=e,interaction_view.ismobile&&window.setTimeout(function(){presentation.preloadFourDirections()},0)},onStopPlay:function(e){interaction_view.pausePlay(e)},onContinuePlay:function(e){interaction_view.continuePlay(e)},onSlideChange:function(e,t){Reveal.lockAction=!1;var i=t;interaction_view.stopPlay(i),Reveal.played!=e&&(Reveal.options.slidePlay(e),interaction_view.ismobile&&window.setTimeout(function(){presentation.preloadFourDirections()},0)),Reveal.played=null,interaction_view.ismobile&&window.setTimeout(function(){presentation.clearPreloadPages()},0),interaction_view.hasArrow&&!interaction_view.continuous&&Reveal.isLast()?($(".master_arrow_icon").hide(),interaction_view.hideArrow=!0):interaction_view.hideArrow&&($(".master_arrow_icon").show(),interaction_view.hideArrow=!1)},onKeyboard:function(){interaction_view.transitionPagePreLoad=null},onWheel:function(){interaction_view.transitionPagePreLoad=null},canDrag:function(e){return 0!=$(e.target).closest(".disableDragX").length&&0!=$(e.target).closest(".disableDragY").length&&0==$(e.target).closest(".dragConnector").length?!1:!0},canDragX:function(e){if(0!=$(e.target).closest(".disableDragX").length){if($(e.target).closest(".disableDragX").hasClass("is_exceededX"))return!0;var t=$(e.target).closest(".dragConnector.disableDragX").data("dragfuncs");return t&&t.length&&(connector.dragcontroller($(e.target).closest(".dragConnector.disableDragX"),e,t,0),e.gesture.preventDefault()),!1}return!0},canDragY:function(e){if(0!=$(e.target).closest(".disableDragY").length){if($(e.target).closest(".disableDragY").hasClass("is_exceededY"))return!0;var t=$(e.target).closest(".dragConnector.disableDragY").data("dragfuncs");return t&&t.length&&(connector.dragcontroller($(e.target).closest(".dragConnector.disableDragY"),e,t,1),e.gesture.preventDefault()),!1}return!0},canDragEnd:function(e){var t=$(e.target).closest(".dragConnector").data("dragfuncs");t&&t.length&&connector.dragcontroller($(e.target).closest(".dragConnector"),e,t)},checkSlidePermission:function(e,t,i){if("left"==i){var n=e.getCurrentSlideId();return interaction_view.control.getLeft(n)?!0:!1}if("right"==i){var n=e.getCurrentSlideId();return interaction_view.control.getRight(n)?!0:!1}return!0},getOverview:function(e){return interaction_view.ipagelist.getPage(e)&&interaction_view.ipagelist.getPage(e).toJSON().nav?interaction_view.ipagelist.getPage(e).toJSON().nav.thumbnail:null}}),interaction_view.ismobile||(interaction_view.presentate=new $.presentate(!0))},interaction_view.init=function(){interaction_view.containment=$(interaction_view.forpreview?".interaction-preview":"body"),presentation.forpreview(),presentation.screencontrol(),_e.preloadpage&&_e.preloadpage.init(),window.iPageDirection="landscape";var e=require("interaction_view/model/doc");if(interaction_view.doc=new e({id:"doc"}),"undefined"!=typeof cbt_data||"undefined"!=typeof epub360_book_data){interaction_view.forpreview||(interaction_view.isPack=!0);var t;workEnd("-------- 1. touchinit 1 page list start --------"),"undefined"!=typeof epub360_book_data?(t=interaction_view.doc.parse(epub360_book_data),workEnd("-------- 1.1 touchinit 1 page parse --------")):t=interaction_view.doc.parse(cbt_data),interaction_view.doc.set(t),workEnd("-------- 1. touchinit 2 page list ready --------"),"false"==_g.getUrlParameterByName("autoplay")?interaction_view.wait():interaction_view.start(),workEnd("-------- 1. touchinit 3 interaction_view.start end --------")}else interaction_view.doc.fetch({success:function(){"false"==_g.getUrlParameterByName("autoplay")?interaction_view.wait():interaction_view.start()}})}}};return e}),define("interaction_view/ui/application",["text!interaction_view/template/alertbox.js"],function(){var e=require("text!interaction_view/template/alertbox.js"),t={buttons:[],buttonGroups:[],initForm:function(e){_.each(e.data,function(t){if(t.binding)if(_.include(["radio","checkboxes","dropdown"],t.field_type)){var i=[];_.each(t.binding,function(n,a){n&&(interaction_view.events.formEvents.push({overlay:n,func:function(i){interaction_view.application.setValue(e.id,t.cid,a,i),"checkboxes"!=t.field_type&&interaction_view.application.execBindingButton(n)},i:t,cid:t.cid,key:a,id:e.id,bindSwitch:"checkboxes"!=t.field_type}),i.push(n))}),"checkboxes"!=t.field_type&&i.length>1&&interaction_view.application.buttonGroups.push({overlays:i})}else interaction_view.events.formEvents.push({overlay:t.binding,func:function(i){if(i&&"number"==t.field_type){i=Number(i);var n=interaction_view.application.validateNumber(i,t.field_options.min,t.field_options.max);n&&interaction_view.application.errorAlert(n)}interaction_view.application.setValue(e.id,t.cid,null,i)},i:t,cid:t.cid,id:e.id})})},getValue:function(e,t,i){var n=_.find(interaction_view.applications,function(t){return t.id==e}),a=_.find(n.data,function(e){return e.cid==t});return _.include(["radio","dropdown"],a.field_type)?i?i==a.value?1:0:a.value:_.include(["checkboxes"],a.field_type)?i&&a.value&&a.value.length?_.include(a.value,i):!1:a.value},setValue:function(e,t,i,n){var a=_.find(interaction_view.applications,function(t){return t.id==e});return"submit"==t?(interaction_view.application.submitForm(e),!1):void(a.data=_.map(a.data,function(e){return e.cid==t&&(_.include(["radio","dropdown"],e.field_type)?e.value=i:_.include(["checkboxes"],e.field_type)?(e.value||(e.value=[]),e.value=n?_.union(e.value,[i]):_.without(e.value,i)):e.value=n),e}))},sendOverlayToButtonGroup:function(e){var t=e.createPath(),i=interaction_view.hashPath(t);_.include(_.pluck(interaction_view.application.buttons,"hash"),i)?interaction_view.application.buttons=_.map(interaction_view.application.buttons,function(t){return t.hash==i&&(t.overlay=e),t}):interaction_view.application.buttons.push({hash:i,overlay:e})},getHashs:function(e){var t=[];return _.each(e,function(e){t.push(interaction_view.hashPath(e.path)+e.id)}),t},execBindingButton:function(e){{var t=interaction_view.hashPath(e.path)+e.id,i=[];_.find(interaction_view.application.buttonGroups,function(e){_.include(interaction_view.application.getHashs(e.overlays),t)&&_.each(e.overlays,function(e){interaction_view.hashPath(e.path)+e.id==t||i.push(e)})})}i.length&&_.each(i,function(e){var t=interaction_view.hashPath(e.path)+e.id,i=_.find(interaction_view.application.buttons,function(e){return e.hash==t});i&&i.overlay.iview.resetButtonStatus()})},isBindingButton:function(e){var t=!1;return _.each(interaction_view.application.buttonGroups,function(i){_.include(interaction_view.application.getHashs(i.overlays),interaction_view.hashPath(e.createPath()))&&(t=!0)}),t},errorMsg:function(e,t,i,n){var a=_.find(interaction_view.applications,function(t){return t.id==e}),r=_.find(a.data,function(e){return e.cid==t});return i?r.label+(n||"ä¸­å¡«å†™çš„æ•°å€¼ä¸æ­£ç¡®"):_.include(["radio","dropdown","checkboxes"],r.field_type)?"è¯·é€‰æ‹©"+r.label:r.label+(n||"ä¸èƒ½ä¸ºç©º")},errorAlert:function(t){if(!interaction_view.containment.children(".alert_mask").length){interaction_view.containment.append('<div class="alert_mask"></div>');var i=_.template(e,{text:t});interaction_view.containment.append(i),interaction_view.containment.find(".alert-confirm").on("click",function(){interaction_view.containment.find(".alert_mask").remove(),interaction_view.containment.find(".alert-box").remove()})}},submitForm:function(e){var t=_.find(interaction_view.applications,function(t){return t.id==e});if(!t)return!1;var i,n={},a=!0,r="";if(_.each(t.data,function(t){if(n[t.cid]=t.value,"number"==t.field_type){var o=!1;if((n[t.cid]||_.isNumber(n[t.cid]))&&(o=!0),t.field_options.integer_only&&_.isNumber(n[t.cid])&&(n[t.cid]=Math.round(n[t.cid])),!_.isNumber(n[t.cid])||_.isNaN(n[t.cid]))(t.required||o)&&(i||(i=interaction_view.application.errorMsg(e,t.cid,o?!0:!1)),a=!1);else{var s=interaction_view.application.validateNumber(n[t.cid],t.field_options.min,t.field_options.max);s&&(i=interaction_view.application.errorMsg(e,t.cid,!0,s),a=!1)}}else if("mobile"==t.field_type){var l=$.trim(n[t.cid]);if(t.required&&!l)a=!1,i=interaction_view.application.errorMsg(e,t.cid);else if(l){var c=/^0?1[3|4|5|7|8][0-9]\d{8}$/;c.test(l)||(a=!1,i="è¯·è¾“å…¥æ­£ç¡®æ‰‹æœºå·ç ï¼")}r=l}else t.required&&!n[t.cid]&&(i||(i=interaction_view.application.errorMsg(e,t.cid)),a=!1)}),!a)return void(i&&interaction_view.application.errorAlert(i));if(_.each(interaction_view.environment.otherFormValue,function(e,t){n[t]=e.value,(""==e.value||void 0==e.value)&&(interaction_view.application.errorAlert(e.errMsg),a=!1)}),a){r&&(epub360_userinfo=epub360_userinfo||{},epub360_userinfo.mobile=r),"undefined"!=typeof epub360_sourceinfo&&epub360_sourceinfo.openid&&(n.source_openid=epub360_sourceinfo.openid);var o="/form/"+t.app_id+"/?format=json";_g.ajax.post({traditional:!0,url:o,data:n,callback:function(i){var n=null;if(200==i.code)interaction_view.events.onFormSubmitEvent(70,t.id),"function"==typeof epub360FromSubmited&&epub360FromSubmited();else{var a=i.msg;if(_.keys(a).length){var r=_.keys(a)[0];n=interaction_view.application.errorMsg(e,r),interaction_view.application.errorAlert(n)}}}})}},setFormData:function(e,t,i,n){var a=_.find(interaction_view.applications,function(t){return t.id==e});if(!a)return!1;3==i&&(n=null);_.each(a.data,function(e){if(e.cid==t){if(1==i||2==i){if(n=Number(n),e.value=Number(e.value),_.isNaN(n)||!_.isNumber(n))return!1;(_.isNaN(e.value)||!_.isNumber(e.value))&&(e.value=0)}1==i?e.value+=n:2==i?e.value-=n:e.value="number"==e.field_type?Number(n):n}})},validateNumber:function(e,t,i){if(_.isNaN(e)||!_.isNumber(e))return"è¯·è¾“å…¥æ•°å­—";var n=!1,a="å–å€¼èŒƒå›´:";return void 0!=t&&(a=a+"å¤§äºŽ"+t,t>=e&&(n=!0)),void 0!=i&&(a=a+"å°äºŽ"+i,e>=i&&(n=!0)),n?a:void 0},getFormFieldValue:function(e){if(2!=e.split("_").length)return null;var t=e.split("_")[0],i=e.split("_")[1],n=_.find(interaction_view.applications,function(e){return e.app_id==t});if(!n)return null;for(var a=null,r=0;r<n.data.length;r++)if(n.data[r].cid==i){"undefined"!=typeof n.data[r].value&&(a=n.data[r].value);break}return a}};return t}),define("interaction_view/ui/timeline",["interaction_view/model/base"],function(){interaction_view.timeline={render:function(e){(epub360.isV2||epub360.variable.isV2)&&(e.timelines=[],e.iOverlaylist.each(function(t){var i=t.get("iAnis");if(i.length&&!t.iAnimationlist){t.iAnimationlist=new interaction_view.collection.Animation,t.iAnimationlist.pageid=e.id;for(var n=[],t=0;t<i.length;t++){var a=$.extend(!0,{},i[t]);a.id=_g.uuid(4),a.iKind||(a.iKind=0),a.pageid=e.id,n.push(a)}t.iAnimationlist.reset(n),e.timelines.push(t.iAnimationlist)}}))},setPlay:function(e){e.timelines&&e.timelines.length&&_.each(e.timelines,function(e){e.setParams(),e.setPlay()})},play:function(e){e.timelines&&e.timelines.length&&_.each(e.timelines,function(e){e.timeline.play(0,!1)})}}}),define("interaction_view/ui/expression",["interaction_view/model/base"],function(){interaction_view.expression={Reg:[/\@/g,/\$/g],Regs:[/\@[^\@]+\@/g,/\$[^\$]+\$/g],Spliter:".",isVar:function(e){e+="";var t=e.match(this.Regs[0])||e.match(this.Regs[1])||e.match(/[\+\-\*\/\>\=\<\!]/g);if(!t){var i=e.match(/\d+/g);return i&&1==i.length&&i[0]==e}return t},id2values_db:function(text){if(!this.isVar(text))return text;var view=this;text=""+text;var ids=text.match(view.Regs[1]);return eval(text)},id2value_db:function(e,t){if("undefined"==typeof e)return"";e=""+e,e=e.replace(this.Reg[1],"");var i=e.substr(2),n=i.match(this.Regs[0]);if(null!=n)for(var a=0;a<n.length;a++)this.id2value(n[a],function(e){i=i.replace(n[a],e)});var r=i.split(this.Spliter),o="";switch(r.length){case 2:o=this.getRule(i,t);break;case 3:o=this.getLine(i,t);break;case 4:o=this.getFields(i,t)}return o},id2values:function(text,callback,opts){if(opts||(opts={}),!this.isVar(text)&&!opts.force_compute)return'""'===text&&(text=""),callback&&callback(text),opts._promise&&opts._promise.done(),text;opts.$contentGridRow&&(this.$contentGridRow=opts.$contentGridRow);var view=this;text=""+text;var ids_var=text.match(view.Regs[0]),funs=[],text_ids=[];if(!opts.noDb){var ids_db=text.match(view.Regs[1]);if(null!=ids_db)for(var func_db=function(e){var t=new promise.Promise;return view.id2value_db(e,function(e){"object"==typeof e&&t.done(e.statusText),_.isNaN(e)&&t.done(e),""===e&&t.done(null,""),e=interaction_view.parseVar(e),t.done(null,e)}),t},i=0;i<ids_db.length;i++){var v=ids_db[i];funs.push(func_db(v)),text_ids.push(v)}}if(null!=ids_var)for(var func_var=function(e){var t=new promise.Promise;return view.id2value(e,function(e){t.done(null,e)}),t},j=0;j<ids_var.length;j++){var m=ids_var[j];funs.push(func_var(m)),text_ids.push(m)}if(funs.length)promise.join(funs).then(function(results){for(var err=[],r=0;r<results.length;r++)if(results[r]){var v=results[r][1];null!=results[r][0]?err.push(results[0]):(""===v&&text!=text_ids[r]&&(v='""'),text=text.replace(text_ids[r],v))}if(err.length)return callback&&callback(),void(opts._promise&&opts._promise.done());try{""===text||(opts.no_compute||(text=eval(text)),_.isString(text)&&("'"==text[0]&&"'"==text[text.length-1]||'"'==text[0]&&'"'==text[text.length-1])&&(text=text.substr(1,text.length-2)),text&&text.replace&&(text=text.replace(/_epub_br_/g,"\n"))),callback&&callback(text),err.length>0?opts._promise&&opts._promise.done():opts._promise&&opts._promise.done()}catch(e){console.log(e),text&&text.replace&&(text=text.replace(/<br>+/g,"\n").replace(/"+/g,"'").replace(/<\/div><div>/g,"\n").replace(/<div>/g,"").replace(/<\/div>/g,"").replace(/'/g,""),text=text.replace(/_epub_br_/g,"\n")),callback&&callback(text),opts._promise&&opts._promise.done()}});else{if(!opts.no_compute)try{text=eval(text)}catch(err){}_.isString(text)&&("'"==text[0]&&"'"==text[text.length-1]||'"'==text[0]&&'"'==text[text.length-1])&&(text=text.substr(1,text.length-2)),callback&&callback(text),opts._promise&&opts._promise.done()}return text},id2value:function(e,t){if("undefined"==typeof e)return"";e=""+e,e=e.replace(this.Reg[0],"");var i=e.indexOf("_"),n=e.substr(0,i),a=e.substr(i+1),r="";switch(n){case"s":r=this.getSystemVar(a);break;case"u":r=this.getUserInfo(a);break;case"g":r=this.getGlobal(a);break;case"m":r=this.getMasterEl(a);break;case"b":r=this.getBackgroundEl(a);break;case"p":r=this.getPageEl(a);break;case"l":r=this.getLayerEl(a);break;case"v":r=this.getVote(a);break;case"z":r=this.getZhuli(a);break;case"f":r=this.getForm(a);break;case"c":r=this.getConfigEl(a);break;case"c0":case"c1":case"c2":r=this.getContentGrid(n,a);break;case"il":r=this.getInsideLayerEl(a);break;default:r=this.getOld(e)}return""===r?(t&&t(r),r):(r=interaction_view.parseVar(r),t&&t(r),r)},getSystemVar:function(e){switch(e){case"time":return(new Date).toLocaleString();case"countnum":return interaction_view.forpreview?123:"undefined"!=typeof wx_config&&wx_config.countnum?wx_config.countnum:0;case"orientation_x":return _e.orientation?_e.orientation.x:0;case"orientation_y":return _e.orientation?_e.orientation.y:0;case"orientation_z":return _e.orientation?_e.orientation.z:0;case"pagenumber":if(!interaction_view.foredit)return interaction_view.ipagelist.getPages().indexOf(interaction_view.ipagelist.getPage(interaction_view.currentPage));if("Page"==interaction.doc.mode)return iPagelist.getPages().indexOf(iPagelist.getPage(interaction_view.currentPage));global.message("warning","è¯·ä½¿ç”¨é¢„è§ˆå…¨éƒ¨æ¨¡å¼é¢„è§ˆè¯¥åŠŸèƒ½");case"messagelink":if(!interaction_view.foredit)return"undefined"!=typeof message_link?message_link:"";global.message("warning","è¯·ä½¿ç”¨é¢„è§ˆå…¨éƒ¨æ¨¡å¼é¢„è§ˆè¯¥åŠŸèƒ½")}return""},getPagePath:function(e){if("undefined"==typeof e)return null;e=""+e,e=e.replace(this.Reg[0],"");var t=e.indexOf("_"),i=e.substr(0,t),n=e.substr(t+1);if(_.include(["p","m","b","c"],i)){var a=n.split(this.Spliter);return{type:i,page_id:a[0],element_id:a[1]}}return null},getUserInfo:function(e){switch(e){case"openid":return"undefined"!=typeof epub360_userinfo&&epub360_userinfo.openid?epub360_userinfo.openid:"";case"uid":return"81234671";case"name":return"undefined"!=typeof epub360_userinfo&&epub360_userinfo.nickname?epub360_userinfo.nickname:"user1";case"portrait":return"undefined"!=typeof epub360_userinfo&&epub360_userinfo.portrait?epub360_userinfo.portrait:"http://qty83k.creatby.com/materials/origin/9fb6a5037931d82e0841933fdd983eba_origin.png"}return""},getGlobal:function(e){var t=interaction_view.globallist.where({id:e})[0];return t?0==t.attributes.iDetail.iKind||2==t.attributes.iDetail.iKind?Number(t.attributes.iDetail.initial):String(t.attributes.iDetail.initial):""},getMasterEl:function(e){var t=e.split(this.Spliter),i=interaction_view.imasterlist.where({id:t[0]})[0];return i?this.getOverlayValue(i,t[1]):""},getBackgroundEl:function(e){var t=e.split(this.Spliter),i=interaction_view.ibackgroundlist.where({id:t[0]})[0];return i?this.getOverlayValue(i,t[1]):""},getPageEl:function(e){var t=e.split(this.Spliter),i=interaction_view.ipagelist.getPage(t[0]);return i?this.getOverlayValue(i,t[1]):""},getLayerEl:function(e){function t(e){var t=e.find(".image_wrap img");if(t.length)return t.attr("src");var i=e.find(".image_wrap").css("background-image");return i.substring(4,i.length-1)}var i=e.split(this.Spliter),n=interaction_view.ipagelist.getPage(i[0]);if(n){var a=n.iOverlaylist.where({id:i[1]})[0];if(a){var r=interaction_view.ilayerlist.where({id:i[2]})[0];if(r){var o=r.overlays.filter(function(e){return e.id==i[3]})[0];if(o){var s=a.iview.$el.find("[data-id="+i[2]+"]").find("#"+i[3]);switch(o.iType){case"Variable":return 0==o.iDetail.iKind||2==o.iDetail.iKind?Number(s.text()):s.text();case"Paragraph":return s.find(".iText").html();case"Input":return s.find("input").val();case"Textarea":var l=s.find("textarea").val();return l.replace(/\n/g,"_epub_br_");case"Image":case"ImageBlock":return t(s);case"Palette":return s.find("canvas")[0].toDataURL();case"Gyroscope":return s.find(".el_wrap").text()}}}}}return""},getConfigEl:function(e){if(void 0!=typeof configpage&&configpage.page){var t=e.split(this.Spliter);return this.getOverlayValue(configpage.page,t[1])}return""},getOverlayValue:function(e,t,i){i||(i={});var n=e.iOverlaylist.where({id:t})[0];if(n||(n={attributes:e.attributes.overlays.filter(function(e){return e.id==t})[0]}),n&&n.attributes)switch(n.attributes.iType){case"Variable":return 0==n.attributes.iDetail.iKind||2==n.attributes.iDetail.iKind?Number(n.attributes.iDetail.initial):String(n.attributes.iDetail.initial);case"Paragraph":return n.iview?n.iview.$el.find(".iText .iContent").length?n.iview.$el.find(".iText .iContent").html()||"":n.iview.$el.find(".iText").length?n.iview.$el.find(".iText").html()||"":"":"";case"Input":return n.iview&&n.iview.$el.find("input").val()||"";case"Textarea":var a=n.iview&&n.iview.$el.find("textarea").val()||"";return i.raw?a:a.replace(/\n/g,"_epub_br_");case"ImageBlock":case"Image":return interaction_view.getImgSrc(n.iview.$el);case"Select":return n.iview.$el.find("select").val()||"";case"Palette":return n.iview.$el.find("canvas")[0].toDataURL();case"Gyroscope":return n.iview.model.value}},getVote:function(e){var t=this.isVote(e);return t?this.getVoteVal(t):0},getVoteVal:function(e){var t=e.item[0],i=e.item[0].attributes.iDetail,n=parseInt(i.initial);
return""==e.ext?n=t.get("value")||parseInt(i.initial):"position"==e.ext?n=t.get("position")||0:"voted"==e.ext&&(n=t.get("voted")||0),n},isVote:function(e){var t,i;return t=e.split("_"),i=t.length>1?t[1]:"",t.length>1&&["position","voted"].indexOf(i)>-1&&(e=t[0]),item=_.filter(interaction_view.environment.Votes.collection,function(t){return t.id==e}),item.length?{item:item,ext:i}:!1},getZhuli:function(e){switch(e){case"identity":if("undefined"!=typeof epub360_userinfo&&epub360_userinfo.nickname)return interaction_view.environment.Shareapp.usertype();case"count":if("undefined"!=typeof epub360_userinfo&&epub360_userinfo.nickname)return interaction_view.environment.Shareapp.total();case"initiater":"undefined"!=typeof epub360_userinfo&&epub360_userinfo.nickname&&(2==interaction_view.environment.Shareapp.status?1:0)}return""},getForm:function(e){var t=interaction_view.application.getFormFieldValue(e);return null!=t?t:""},getContentGrid:function(e,t){var i=t.split(this.Spliter),n="",a=interaction_view.ipagelist.getPage(i[0])||interaction_view.ibackgroundlist.where({id:i[0]})[0]||interaction_view.imasterlist.where({id:i[0]})[0]||interaction_view.ilayerlist.where({id:i[0]})[0];if(a){var r=a.iOverlaylist.where({id:i[1]})[0]||a.overlays.filter(function(e){return e.id==i[1]})[0];if(r)switch(e){case"c0":var o=this.$contentGridRow.data("variables"),s=_.find(o,function(e){return e.id==i[2]});s&&(n=s.initial);break;case"c1":var l=this.$contentGridRow.find("[es-id="+i[2]+"]");l.length&&(_.include(["div"],l[0].tagName.toLowerCase())?n=l.css("background-image")&&l.css("background-image").substr(4,l.css("background-image").length-5)||"":_.include(["img"],l[0].tagName.toLowerCase())?n=l.attr("src"):_.include(["h1","h2","h3","h4","h5","h6","p"],l[0].tagName.toLowerCase())&&(n=l.text()));break;case"c2":n=this.$contentGridRow.data("value")[i[2]]}}return n},getInsideLayerEl:function(e){var t=e.split(this.Spliter);return this.InsideLayerRange?this.getOverlayValue(this.InsideLayerRange,t[1]):void 0},getOld:function(e){switch(e){case"åŠ©åŠ›_ç”¨æˆ·èº«ä»½":return this.getZhuli("identity");case"åŠ©åŠ›_åŠ©åŠ›æ•°":return this.getZhuli("count");case"åŠ©åŠ›_æ˜¯å¦å‘èµ·":return this.getZhuli("initiater");case"å¾®ä¿¡_ç”¨æˆ·æ˜µç§°":return this.getUserInfo("name")}var t=this.isVote(e);if(t)return this.getVoteVal(t);var i=interaction_view.ibackgroundlist.at(0).iOverlaylist.where({id:e})[0];if(i)return this.getOverlayValue(interaction_view.ibackgroundlist.at(0),e);if(i=interaction_view.imasterlist.at(0).iOverlaylist.where({id:e})[0])return this.getOverlayValue(interaction_view.imasterlist.at(0),e);var n=interaction_view.ipagelist.getPage(interaction_view.currentPage);return(i=n.iOverlaylist.where({id:e})[0])?this.getOverlayValue(n,e):""},getRule:function(e,t){if(0==interaction_view.dblist.length||!interaction_view.dblist.get(e.split(this.Spliter)[0]))return console.log("è¡¨ç»„ä»¶ "+e.split(this.Spliter)[0]+" ä¸å­˜åœ¨"),t&&t(""),"";var i=interaction_view.dblist.get(e.split(this.Spliter)[0]).get("sheet_id"),n=e.split(this.Spliter)[1],a=new DB.DBObject(i),r=a.getTableRules(i);switch(n){case"START":n="startTime";break;case"END":n="endTime";break;case"VALID":n="time_status";break;case"NUMS":n="can_save_nums";break;case"RULE":n="rule"}t&&t(r[n])},getLine:function(e,t){var i=this.getBasic(e);i||t&&t("");var n=new window.dboperate;if("COUNT"==e.split(this.Spliter)[2])if("0"==i.type||void 0==i.type)n.uploadQuery({value:i.queryValue,table_id:i.tableId,db_id:i.dbId,option:e.split(this.Spliter)[2]},t);else if("1"==i.type)if(epub360.dbs[i.dbId].query[i.queryId]){var a=epub360.dbs[i.dbId].query[i.queryId].list;t(a.length)}else t("0")},getFields:function(id,callback){var basic=this.getBasic(id);basic||callback&&callback("");var field=id.split(this.Spliter)[2],opera=id.split(this.Spliter)[3],dboperate=new window.dboperate,type=basic.type;if(void 0==type&&(type="0"),"MAX"==opera||"MIN"==opera||"SUM"==opera||"RANDOM"==opera){var _a=new DB.DBAggregate("table_id");switch(opera){case"MAX":_a.max(field);break;case"MIN":_a.min(field);break;case"SUM":_a.sum(field);break;case"RANDOM":_a.random(field)}dboperate.uploadQuery({value:basic.queryValue,table_id:basic.tableId,db_id:basic.dbId,agg:_a,option:opera},callback)}else if(null!=opera.match(/v_\[(.*)\]/)){var value=opera.match(/v_\[(.*)\]/)[1],result=value.split("=")[1],key=value.split("=")[0];if(result.match(/[\+\-\*\/\>\=\<\!]/g))try{result=eval(result)}catch(e){}if("LINENUMBER"==key){if("0"==type)dboperate.uploadQuery({value:basic.queryValue,table_id:basic.tableId,db_id:basic.dbId,option:opera,start:result-1,field:field},callback);else if("1"==type)if(epub360.dbs[basic.dbId].query[basic.queryId]){var _list=epub360.dbs[basic.dbId].query[basic.queryId].list;_list.length>=result?callback(_list.at(result-1).get(field)):callback()}else callback()}else if("ID"==key)try{if(result=eval(result),"0"==type)-1!=field.indexOf("|")?dboperate.uploadQuery({value:basic.queryValue,table_id:basic.tableId,db_id:basic.dbId,option:opera,id:result,join:field},callback):dboperate.uploadQuery({value:basic.queryValue,table_id:basic.tableId,db_id:basic.dbId,option:opera,id:result,field:field},callback);else if("1"==type)if(epub360.dbs[basic.dbId].query[basic.queryId]){var _list=epub360.dbs[basic.dbId].query[basic.queryId].list;_list.get(result)?callback(_list.get(result).get(field)):callback()}else callback()}catch(e){callback()}}},getBasic:function(e){var t=e.split(this.Spliter)[0];if(0==interaction_view.dblist.length||!interaction_view.dblist.get(t))return console.log("è¡¨ç»„ä»¶ "+t+" ä¸å­˜åœ¨"),"";for(var i,n,a,r=e.split(this.Spliter)[1],o=interaction_view.dblist.get(t).get("sheet_id"),s=0;s<interaction_view.dblist.get(t).get("querys").length;s++){var l=interaction_view.dblist.get(t).get("querys")[s];r==l.id&&(i=l,a=l.type)}return n={dbId:t,queryId:r,tableId:o,queryValue:i,type:a}},getFieldstype:function(e){if("undefined"==typeof e)return"";e=""+e,e=e.replace(this.Reg[1],"");var t,i=e.substr(2),n=i.split(this.Spliter),a=n.pop();return a=-1==a.indexOf("|")?a:a.split("|")[1],t="p"==a.substr(0,1)||"weixin_avatar"==a?4:2},transferId:function(e,t){if("undefined"==typeof e)return"";e=""+e,e=e.replace(this.Reg[0],"");var i=e.indexOf("_"),n=e.substr(0,i),a=e.substr(i+1),r=this;switch(n){case"g":r.setGlobal(a,t);break;case"p":r.setVar(a,t);break;case"m":r.setVar(a,t);break;case"b":r.setVar(a,t);break;case"c":r.setVar(a,t)}},setGlobal:function(e,t){var i=interaction_view.globallist.get(e);if(!_.isUndefined(t)){var n,a=t;if(0==i.attributes.iDetail.iKind)if(_.isNaN(Number(a)))a=a;else{var r=Number(a);r>0&&a[0]&&"0"===a[0]||(a=r)}n=i.attributes.iDetail.initial,i.attributes.iDetail.initial=a,"ShareVariable"==i.attributes.iType&&String(n)!=String(a)&&(message_link=_g.changeURLPar(message_link,e,t),interaction_view.weixin.share())}},setVar:function(e,t){var i=e.split(this.Spliter);if(!_.isUndefined(t)){var n=interaction_view.getPage(i[0]);if(n){var a=n.iOverlaylist.get(i[1]);a&&(a.iview.setVariable?a.iview.setVariable("",t):a.iview.updateText?a.iview.updateText(t,addtourl=0):("ImageBlock"==a.get("iType")||"Image"==a.get("iType"))&&a.iview.replaceImg(t))}}},setAssignment:function(e,t,i){if("undefined"==typeof e)return"";e=""+e,e=e.replace(this.Reg[0],""),i=i.results[0];var n=this,a=e.indexOf("_"),r=e.substr(0,a),o=e.substr(a+1);if(-1!=t.indexOf("|")){if(0==interaction_view.dblist.length||!interaction_view.dblist.get(t.split(".")[0]))return console.log("è¡¨ç»„ä»¶ "+t.split(".")[0]+" ä¸å­˜åœ¨"),"";t=t.replace("|","."),t=t.replace(t.split(".")[0],interaction_view.dblist.get(t.split(".")[0]).get("sheet_id"))}switch(r){case"p":n.setVar(o,i[t],!0);break;case"g":n.setGlobal(o,i[t]);break;case"m":n.setVar(o,i[t]);break;case"b":n.setVar(o,i[t]);break;case"c":n.setVar(o,i[t])}},setValue:function(e,t){if("undefined"==typeof e)return"";e=""+e,e=e.replace(this.Reg[0],"");var i=this,n=e.indexOf("_"),a=e.substr(0,n),r=e.substr(n+1);switch(a){case"p":i.setVar(r,t,!0);break;case"g":i.setGlobal(r,t);break;case"m":i.setVar(r,t);break;case"b":i.setVar(r,t);break;case"c":i.setVar(r,t)}},doCondition:function(e,t){t&&t.$dom&&(this.$contentGridRow=t.$dom);var i=new promise.Promise;return interaction_view.expression.id2values(e,function(e){i.done(e)}),i},getDataById:function(e,t,i,n){if(0==interaction_view.dblist.length||!interaction_view.dblist.get(e))return console.log("è¡¨ç»„ä»¶ "+e+" ä¸å­˜åœ¨"),n&&n(""),"";var a=interaction_view.dblist.get(e).get("sheet_id"),r=new window.dboperate,o={value:{id:t,name:"å…¨éƒ¨",scope:0,filter:[{key:"",value:""},{key:"",value:""}],op:0,sort:{field:"created",order:-1},fetch_fields:"",type:"0"},table_id:a,db_id:e,id:i};r.uploadQuery(o,n)},getFieldValue:function(e,t){var i=this.idToObject(e);if(-1!=i.indexOf("|")){var n=i.split("|"),a=n[0],r=n[1];if(0==interaction_view.dblist.length||!interaction_view.dblist.get(a))return console.log("è¡¨ç»„ä»¶ "+a+" ä¸å­˜åœ¨"),"";i=interaction_view.dblist.get(a).get("sheet_id")+"."+r}var o=t[i];return o=interaction_view.parseVar(o)},idToObject:function(e){e=e.replace("$d_","").replace("$","");var t=e.split(".");return t[t.length-1]}}}),define("interaction_view/ui/pluginmanage",["interaction_view/model/base"],function(){interaction_view.PluginManage={Actions:{},ActionExecutes:{},Global:{},init:function(){if(epub360.PlayerPlugins.length){for(var e=[],t=[],i=[],n=[],a=0;a<epub360.PlayerPlugins.length;a++){var r=epub360.PlayerPlugins[a];"actionexecute"==r.type?i.push(r):"action"==r.type?n.push(r):t.push(r)}for(var a=0;a<i.length;a++){var r=i[a];interaction_view.PluginManage.initActionExecute(r)}for(var a=0;a<n.length;a++){var r=n[a];interaction_view.PluginManage.initAction(r)}for(var o=0,a=0;a<t.length;a++)void 0==t[a].order&&(t[a].config.Model?_.find(t,function(e){return e.config.type==t[a].config.Model})?void 0===_.find(t,function(e){return e.config.type==t[a].config.Model}).order?(_.find(t,function(e){return e.config.type==t[a].config.Model}).order=o,o+=1,t[a].order=o,o+=1):t[a].order=o:(t[a].order=o,o+=1):void 0===t[a].order&&(t[a].order=o,o+=1));e=_.sortBy(t,function(e){return e.order});for(var a=0;a<e.length;a++){var s,r=e[a],l=r.config;if(l.category)"global"==l.category&&(interaction_view.view[l.type]=Backbone.View.extend(r));else if(!interaction_view.model[l.type]){var c=interaction_view.PluginManage.parsePluginConfig(l);l.template?(s=_eT[l.template]?_eT[l.template]:l.template,delete l.template):s=_eT.Container,window.funcT["_"+l.type]=_.template(s),interaction_view.PluginManage.initMVC(r,l,c)}}}},initMVC:function(e,t,i){var n=t.Model||"Base";delete t.Model;var a=e.onInitialize;delete e.onInitialize;var r=e.onEpubReady;if(r&&interaction_view.events.epub360StartEvents.push(r),delete e.onEpubReady,interaction_view.view[t.type]=interaction_view.view[n].extend(_.omit(e,"config")),t.model_object)var o=$.extend({},{defaults:i,setcollection:function(){},onInitialize:a},t.model_object);else var o={defaults:i,setcollection:function(){},setview:function(){this.iview=new interaction_view.view[t.type]({model:this})},onInitialize:a};interaction_view.model[t.type]=interaction_view.model[n].extend(o)},parsePluginConfig:function(e){var t={iCommon:{},iDetail:{},iParentdiv:".interaction-view"};if(t.iType=e.type,e.actions&&e.actions.length)for(var i=0;i<e.actions.length;i++){var n=e.actions[i];interaction_view.PluginManage.Actions[n.type]||(interaction_view.PluginManage.Actions[n.type]=n.func)}return t},initAction:function(e){delete e.type;var t=e.config;interaction_view.PluginManage.Actions[t.type]=e.config.func},initActionExecute:function(e){delete e.type;var t=e.config;interaction_view.PluginManage.ActionExecutes[t.type]=e.config}}}),define("interaction_view/ui/transform",["interaction_view/model/base"],function(){interaction_view.transform={update:function(e,t,i,n){var a={};for(var r in e)e[r]===+e[r]&&(a[r]=e[r]);var o=a.init_rotation||0,s=a.rotationX||0,l=a.rotationY||0,c=a.skewX||0,d=a.skewY||0,h=(a.originX===+a.originX?a.originX:50)+"%",u=(a.originY===+a.originY?a.originY:50)+"%";CSSMatrix.setTransform(t,{rotation:o,rotationX:s,rotationY:l,transformPerspective:"600",skewX:c,skewY:d}),i?TweenMax.set(t,{transformOrigin:h+" "+u}):$(t).css("transform-origin",h+" "+u),n&&$(t).css(n)},setState:function(e,t,i){if(i||(i={}),t.position){var n=e.iview.$el;i.duration?(t.position.ease=t.position.ease||i.ease,t.position.immediateRender=!1,t.position.onComplete=i.callback,TweenMax.to(n,i.duration,t.position)):(t.position.oper?(delete t.position.oper,TweenMax.set(n,t.position)):CSSMatrix.setTranslate(n,t.position.x,t.position.y),i.callback&&i.callback())}if(t.transform){var a=e.iview.wrap_el?e.iview.wrap_el[0]:e.iview.$el.children(".Element")[0];i.duration?(t.transform.ease=t.transform.ease||i.ease,t.transform.immediateRender=!1,t.transform.onComplete=i.callback,TweenMax.to(a,i.duration,t.transform)):(TweenMax.set(a,t.transform),i.callback&&i.callback())}if(t.size){var r,o=e.iview.$el.children(".Element"),s={size:{}};if(0===t.size.width||t.size.width?(t.size.oper_w?(t.size.left=t.size.oper_w+"="+t.size.w/2,delete t.size.oper_w,delete t.size.w,r=!0):t.size.left=-t.size.width/2,s.size.width=t.size.width):delete t.size.width,0===t.size.height||t.size.height?(t.size.oper_h?(t.size.top=t.size.oper_h+"="+t.size.h/2,delete t.size.oper_h,delete t.size.h,r=!0):t.size.top=-t.size.height/2,s.size.height=t.size.height):delete t.size.height,i.duration?(t.size.ease=t.size.ease||i.ease,t.size.immediateRender=!1,t.size.onComplete=i.callback,TweenMax.to(o[0],i.duration,t.size)):r?TweenMax.set(o[0],t.size):o.css(t.size),"LayerRef"==e.iview.iType||"LayerSlide"==e.iview.iType){var l=e.iview.$el.find(".layer-mask").first();i.duration?(t.size.ease=t.size.ease||i.ease,t.size.immediateRender=!1,t.size.onComplete=i.callback,TweenMax.to(l[0],i.duration,s.size)):r?TweenMax.set(l[0],s.size):l.css(s.size)}}},getState:function(e){var t={};t.position=CSSMatrix.getTranslate(e.iview.$el);var i=e.iview.$el.children(".Element");t.size={width:Number(i.css("width").replace("px","")),height:Number(i.css("height").replace("px",""))};var n=e.iview.wrap_el?e.iview.wrap_el[0]:e.iview.$el.children(".Element")[0];return t.transform=CSSMatrix.getTransform(n),t},getSize:function(e){var t=e.iview.$el.children(".Element"),i={width:Number(t.css("width").replace("px","")),height:Number(t.css("height").replace("px",""))};return i}}}),function(e){"function"==typeof define&&define.amd?define("coverFlow",["jquery"],e):e(jQuery)}(function(e){if(!e.ui||!e.Widget){e.ui=e.ui||{};var t=0,i=Array.prototype.slice;e.widget=function(t,i,n){var a,r,o,s,l={},c=t.split(".")[0];return t=t.split(".")[1],a=c+"-"+t,n||(n=i,i=e.Widget),e.expr[":"][a.toLowerCase()]=function(t){return!!e.data(t,a)},e[c]=e[c]||{},r=e[c][t],o=e[c][t]=function(e,t){return this._createWidget?void(arguments.length&&this._createWidget(e,t)):new o(e,t)},e.extend(o,r,{version:n.version,_proto:e.extend({},n),_childConstructors:[]}),s=new i,s.options=e.widget.extend({},s.options),e.each(n,function(t,n){return e.isFunction(n)?void(l[t]=function(){var e=function(){return i.prototype[t].apply(this,arguments)},a=function(e){return i.prototype[t].apply(this,e)};return function(){var t,i=this._super,r=this._superApply;return this._super=e,this._superApply=a,t=n.apply(this,arguments),this._super=i,this._superApply=r,t}}()):void(l[t]=n)}),o.prototype=e.widget.extend(s,{widgetEventPrefix:r?s.widgetEventPrefix||t:t},l,{constructor:o,namespace:c,widgetName:t,widgetFullName:a}),r?(e.each(r._childConstructors,function(t,i){var n=i.prototype;e.widget(n.namespace+"."+n.widgetName,o,i._proto)}),delete r._childConstructors):i._childConstructors.push(o),e.widget.bridge(t,o),o},e.widget.extend=function(t){for(var n,a,r=i.call(arguments,1),o=0,s=r.length;s>o;o++)for(n in r[o])a=r[o][n],r[o].hasOwnProperty(n)&&void 0!==a&&(t[n]=e.isPlainObject(a)?e.isPlainObject(t[n])?e.widget.extend({},t[n],a):e.widget.extend({},a):a);return t},e.widget.bridge=function(t,n){var a=n.prototype.widgetFullName||t;e.fn[t]=function(r){var o="string"==typeof r,s=i.call(arguments,1),l=this;return r=!o&&s.length?e.widget.extend.apply(null,[r].concat(s)):r,this.each(o?function(){var i,n=e.data(this,a);return"instance"===r?(l=n,!1):n?e.isFunction(n[r])&&"_"!==r.charAt(0)?(i=n[r].apply(n,s),i!==n&&void 0!==i?(l=i&&i.jquery?l.pushStack(i.get()):i,!1):void 0):e.error("no such method '"+r+"' for "+t+" widget instance"):e.error("cannot call methods on "+t+" prior to initialization; attempted to call method '"+r+"'")}:function(){var t=e.data(this,a);t?(t.option(r||{}),t._init&&t._init()):e.data(this,a,new n(r,this))}),l}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(i,n){n=e(n||this.defaultElement||this)[0],this.element=e(n),this.uuid=t++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=e.widget.extend({},this.options,this._getCreateOptions(),i),this.bindings=e(),n!==this&&(e.data(n,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===n&&this.destroy()}}),this.document=e(n.style?n.ownerDocument:n.document||n),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace)},_destroy:e.noop,widget:function(){return this.element},_on:function(t,i,n){var a,r=this;"boolean"!=typeof t&&(n=i,i=t,t=!1),n?(i=a=e(i),this.bindings=this.bindings.add(i)):(n=i,i=this.element,a=this.widget()),e.each(n,function(n,o){function s(){return t||r.options.disabled!==!0&&!e(this).hasClass("ui-state-disabled")?("string"==typeof o?r[o]:o).apply(r,arguments):void 0}"string"!=typeof o&&(s.guid=o.guid=o.guid||s.guid||e.guid++);var l=n.match(/^([\w:-]*)\s*(.*)$/),c=l[1]+r.eventNamespace,d=l[2];d?a.delegate(d,c,s):i.bind(c,s)})},_off:function(e,t){t=(t||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.unbind(t).undelegate(t)},_trigger:function(t,i,n){var a,r,o=this.options[t];if(n=n||{},i=e.Event(i),i.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),i.target=this.element[0],r=i.originalEvent)for(a in r)a in i||(i[a]=r[a]);return this.element.trigger(i,n),!(e.isFunction(o)&&o.apply(this.element[0],[i].concat(n))===!1||i.isDefaultPrevented())}},function(){var t={};e.each(["Quad","Cubic","Quart","Quint","Expo"],function(e,i){t[i]=function(t){return Math.pow(t,e+2)}}),e.each(t,function(t,i){e.easing["easeIn"+t]=i,e.easing["easeOut"+t]=function(e){return 1-i(1-e)},e.easing["easeInOut"+t]=function(e){return.5>e?i(2*e)/2:1-i(-2*e+2)/2}})}()}!function(e,t,i,n){function a(e,t,i,n){var a=this;a.widget=e,a.element=t,a.items=i,a.options=n}function r(e){return parseFloat((.017453*e).toFixed(6))}function o(){e.coverflow.renderer.Classic.apply(this,arguments)}function s(e,t){return typeof e===t}function l(e,t){return!!~(""+e).indexOf(t)}function c(e,t){var i,a;for(i in e)if(a=e[i],!l(a,"-")&&k[a]!==n)return"pfx"===t?a:!0;return!1}function d(t,i,a){var r,o;for(r in t)if(o=i[t[r]],o!==n)return a===!1?t[r]:s(o,"function")?e.proxy(o,a||i):o;return!1}function h(e,t,i){var n=e.charAt(0).toUpperCase()+e.slice(1),a=(e+" "+P.join(n+" ")+n).split(" ");return s(t,"string")||s(t,"undefined")?c(a,t):(a=(e+" "+D.join(n+" ")+n).split(" "),d(a,t,i))}e.coverflow={renderer:{},support:{}},a.prototype={cssClass:"classic",itemMargin:0,initialize:function(){var t=this,i=t.options,n={},a=t.items.eq(t.widget.currentIndex);t.itemSize=a.width(),t.outerWidth=t.element.parent().outerWidth(!1),t.itemMargin=-Math.floor(i.overlap/2*a.innerWidth()),t.items.css({marginLeft:t.itemMargin,marginRight:t.itemMargin}),n.width=t.items.width()*t.items.length,e.extend(n,t._getCenterPosition()),t.element.css(n)},_getCenterPosition:function(){var e,t=this,i=t.itemSize,n=t.widget.currentIndex;return e=(t.outerWidth-i)/2,e-=n*t.itemSize/2,e+=parseInt(t.element.css("paddingLeft"),10)||0,e-=n*t.itemMargin*2,e-=t.itemMargin,e=Math.round(e),{left:e}},select:function(){return this._getCenterPosition()},getElementTransitionStyles:function(t){var i=e.coverflow.transition[t.easing]||e.coverflow.transition.easeOutQuint;return e.extend(this._getCenterPosition(),{transition:"left "+t.duration+"ms "+i})},refresh:function(t,i,n){var a=this,r=a.options,o=a.items.length,s=a.itemSize,l=a.itemMargin;this.items.each(function(c){var d=c===n&&0>i-n||c-n>0?"left":"right",h=c===n?1-t:c===i?t:1,u={zIndex:o+("left"===d?n-c:c-n)+10},p=1-h*(1-r.scale),v=[p,h*("right"===d?-.15:.15),0,p,0,0];u.left=-c*(s/2)+("right"===d?-s/2+s/2*r.overlap:s/2-s/2*r.overlap)*h,e.coverflow.isOldie&&(c===n?(u.left+=l,u.top=0):u.top=Math.ceil(-l/2)),a._transform(this,u,v),e(this).css(u)})},_transform:function(){var t=this;return e.coverflow.support.transform?void t._matrixTransform.apply(t,arguments):void(e.coverflow.isOldie&&t._fallbackTransform.apply(t,arguments))},_matrixTransform:function(e,t,i){t.transform="matrix("+i.join(",")+")"},_fallbackTransform:function(e,t,i){e.filters["DXImageTransform.Microsoft.Matrix"]||(e.style.filter=(e.style.filter?"":" ")+'progid:DXImageTransform.Microsoft.Matrix(sizingMethod="auto expand")');var n=e.filters["DXImageTransform.Microsoft.Matrix"];n.M11=i[0],n.M12=i[2],n.M21=i[1],n.M22=i[3]}},e.extend(e.coverflow.renderer,{Classic:a}),o.prototype={cssClass:"3d",initialize:function(){var t=this,i={};t.itemSize=t.items.eq(t.widget.currentIndex).outerWidth(!0),t.outerWidth=t.element.parent().outerWidth(!1),i.width=t.itemSize*t.items.length,e.extend(i,t._getCenterPosition(),t._getPerspectiveOrigin()),t.element.css(i)},getItemRenderedWidth:function(){var e=this.options;return Math.cos(r(e.angle))*this.itemSize*e.scale},_getPerspectiveOrigin:function(){var e=this,t=e.options;return{perspectiveOrigin:Math.round(e.itemSize/2+e.widget.currentIndex*e.getItemRenderedWidth()*(1-t.overlap))+"px "+t.perspectiveY+"%"}},_getCenterPosition:function(){var e,t=this,i=t.getItemRenderedWidth(),n=t.widget.currentIndex;return e=(t.outerWidth-t.itemSize)/2,e-=n*i,e+=n*i*t.options.overlap,e-=parseInt(t.element.css("paddingLeft"),10)||0,e=Math.round(e),{left:e}},select:function(){return e.extend({},this._getCenterPosition(),this._getPerspectiveOrigin())},getElementTransitionStyles:function(t){var i=this,n=e.coverflow.transition[t.easing]||e.coverflow.transition.easeOutQuint,a={transitionProperty:"left",transitionDuration:t.duration+"ms",transitionTimingFunction:n,transitionDelay:"initial"};return e.extend(a,i._getCenterPosition(),i._getPerspectiveOrigin())},refresh:function(t,i,n){var a=this,o=a.options,s=a.items.length,l=a.itemSize,c=a.getItemRenderedWidth();this.items.each(function(a){var d,h=a===n&&0>i-n||a-n>0?"left":"right",u=a===n?1-t:a===i?t:1,p={zIndex:s+("left"===h?n-a:a-n)+10},v=1-u*(1-o.scale),g="right"===h?o.angle:-o.angle;g=r(u*g),p.left=Math.round(-a*l+u*a*c*(1-o.overlap)+(1-u)*a*c*(1-o.overlap)),d=[(v*Math.cos(g)).toFixed(6),0,Math.sin(-g).toFixed(6),0,0,v,0,0,Math.sin(g).toFixed(6),0,(v*Math.cos(g)).toFixed(6),0,0,0,0,1],p.transform="matrix3d("+d.join(", ")+")",p.transformOrigin="right"===h?"left center":"right center",e(this).css(p)})}},e.extend(e.coverflow.renderer,{ThreeD:o});for(var u=i.createElement("div"),p=u.style,v=0,g=["ms","moz","webkit","o"],f=g.length,m="",_=0,w=e.coverflow.support,y=function(e){return e.charAt(0).toUpperCase()+e.slice(1)};f>_&&!t.requestAnimationFrame;_++)t.requestAnimationFrame=t[g[_]+"RequestAnimationFrame"],t.cancelAnimationFrame=t[g[_]+"CancelAnimationFrame"]||t[g[_]+"CancelRequestAnimationFrame"];if(t.requestAnimationFrame||(t.requestAnimationFrame=function(e){var i=(new Date).getTime(),n=Math.max(0,16-(i-v)),a=t.setTimeout(function(){e(i+n)},n);return v=i+n,a}),t.cancelAnimationFrame||(t.cancelAnimationFrame=function(e){clearTimeout(e)}),e.each(g,function(e,t){return"ms"!==t&&(t=y(t)),!w.transform&&t+"Transform"in p&&(w.transform=t+"Transform"),!w.transition&&t+"Transition"in p&&(w.transition=t+"Transition"),w.transform&&w.transition?(m=t,!1):!0}),w.transform&&w.transition||(w.transform="transform"in p?"transform":!1,w.transition="transition"in p?"transition":!1),null==e.support.transform&&(e.support.transform=w.transform),null==e.support.transition&&(e.support.transition=w.transition),null==e.cssProps)throw new Error("Your jQuery version is too old. Please upgrade.");m&&e.each(["transitionProperty","transitionDuration","transitionTimingFunction","transitionDelay","perspectiveOrigin"],function(t,i){null==e.cssProps[i]&&(e.cssProps[i]=m+y(i))}),u=null;var b,x=i.documentElement,S="coverflowjsfeaturedetection",T=i.createElement(S),k=T.style,C="Webkit Moz O ms",P=C.split(" "),D=C.toLowerCase().split(" "),$=function(e,t,n,a){var r,o,s,l,c=i.createElement("div"),d=i.body,h=d||i.createElement("body");if(parseInt(n,10))for(;n--;)s=i.createElement("div"),s.id=a?a[n]:S+(n+1),c.appendChild(s);return r=["&#173;","<style id='s",S,"'>",e,"</style>"].join(""),c.id=S,(d?c:h).innerHTML+=r,h.appendChild(c),d||(h.style.background="",h.style.overflow="hidden",l=x.style.overflow,x.style.overflow="hidden",x.appendChild(h)),o=t(c,e),d?c.parentNode.removeChild(c):(h.parentNode.removeChild(h),x.style.overflow=l),!!o},E={}.hasOwnProperty;b=s(E,"undefined")||s(E.call,"undefined")?function(e,t){return t in e&&s(e.constructor.prototype[t],"undefined")}:function(e,t){return E.call(e,t)},e.coverflow.support.transform3d=function(){var e=!!h("perspective");return e&&"webkitPerspective"in x.style&&$("@media (transform-3d),(-webkit-transform-3d){#coverflowjsfeaturedetection{left:9px;position:absolute;height:3px;}}",function(t){e=9===t.offsetLeft&&3===t.offsetHeight}),e}(),null==e.support.transform3d&&(e.support.transform3d=e.coverflow.support.transform3d);var O={transition:"transitionend",MozTransition:"transitionend",OTransition:"oTransitionEnd",WebkitTransition:"webkitTransitionEnd",msTransition:"transitionend"},I=navigator.userAgent.toLowerCase(),A=function(){var e=/(msie) ([\w.]+)/.exec(I);return null!==e&&e[1]&&~~e[2]<10}();e.coverflow=e.extend(!0,{},e.coverflow,{isAndroid:/android/.test(I),isOldie:A,transition:{easeInQuad:"cubic-bezier( .55,.085,.68,.53 )",easeInCubic:"cubic-bezier( .550, .055, .675, .190 )",easeInQuart:"cubic-bezier( .895, .03, .685, .22 )",easeInQuint:"cubic-bezier( .755, .05, .855, .06 )",easeInSine:"cubic-bezier( .47, 0, .745, .715 )",easeInExpo:"cubic-bezier( .95, .05, .795, .035 )",easeInCirc:"cubic-bezier( .6, .04, .98, .335 )",easeInBack:"cubic-bezier( .6, -.28, .735, .045 )",easeOutQuad:"cubic-bezier( .25,.46,.45,.94 )",easeOutCubic:"cubic-bezier( .215,.61,.355,1 )",easeOutQuart:"cubic-bezier( .165, .84, .44, 1 )",easeOutQuint:"cubic-bezier( .23, 1, .32, 1 )",easeOutSine:"cubic-bezier( .39, .575, .565, 1 )",easeOutExpo:"cubic-bezier( .19,1,.22,1 )",easeOutCirc:"cubic-bezier( .075, .82, .165, 1 )",easeOutBack:"cubic-bezier( .175, .885, .32, 1.275 )",easeInOutQuad:"cubic-bezier( .455, .03, .515, .955 )",easeInOutCubic:"cubic-bezier( .645, .045, .355, 1 )",easeInOutQuart:"cubic-bezier( .77, 0, .175, 1 )",easeInOutQuint:"cubic-bezier( .86, 0, .07, 1 )",easeInOutSine:"cubic-bezier( .445, .05, .55, .95 )",easeInOutExpo:"cubic-bezier( 1, 0, 0, 1 )",easeInOutCirc:"cubic-bezier( .785, .135, .15, .86 )",easeInOutBack:"cubic-bezier( .68, -.55, .265, 1.55 )"},renderer:{}}),e.widget("ui.coverflow",{options:{items:"> *",active:0,duration:400,easing:"easeOutQuint",angle:45,perspectiveY:45,scale:.7,overlap:.3,trigger:{itemfocus:!1,itemclick:!0,mousewheel:!0}},isTicking:!1,_create:function(){var i,n,a=this,r=this.options,o=e.coverflow.support||{};a.elementOrigStyle=a.element.attr("style"),a.items=a.element.find(r.items).each(function(){var t=e(this);t.data({coverflowOrigElemAttr:{style:t.attr("style"),"class":t.attr("class"),tabIndex:t.attr("tabIndex")}})}).addClass("ui-coverflow-item"),a._setDimensions(),a.support=o,i=o.transform&&!A&&null==t.opera&&o.transform3d?e.coverflow.renderer.ThreeD:e.coverflow.renderer.Classic,n={angle:r.angle,perspectiveY:r.perspectiveY,scale:r.scale,overlap:r.overlap,itemSize:a.itemSize,outerWidth:a.outerWidth},a.renderer=new i(a,a.element,a.items,n),a.element.addClass("ui-coverflow ui-coverflow-"+a.renderer.cssClass+"-render").parent().addClass("ui-coverflow-wrapper ui-clearfix"),r.trigger.itemfocus&&this._bindFocus(),r.trigger.itemclick&&a.element.data("CoverFlowDisableClick",!1)&&a._on(a.items,{click:function(e){a.element.data("CoverFlowDisableClick")||a._select(e)}}),r.trigger.mousewheel&&a._on({mousewheel:a._onMouseWheel,DOMMouseScroll:a._onMouseWheel}),a.useJqueryAnimate=!(o.transition&&e.isFunction(t.requestAnimationFrame)),a.coverflowrafid=0},_bindFocus:function(){var e=this;e.items.prop("tabIndex",0),e._on(e.items,{focus:e._select})},_init:function(){var e=this,t=e.options;t.duration=~~t.duration,t.duration<1&&(t.duration=1),e.currentIndex=e._isValidIndex(t.active,!0)?t.active:0,e.activeItem=e.items.removeClass("ui-state-active").eq(e.currentIndex).addClass("ui-state-active"),e._setDimensions(),e.renderer.initialize(),e._refresh(1,e._getFrom(),e.currentIndex),e._trigger("beforeselect",null,e._ui()),e._trigger("select",null,e._ui())},_setDimensions:function(){var e=this;e.itemWidth=e.items.width(),e.itemHeight=e.items.height(),e.itemSize=e.items.outerWidth(!0),e.outerWidth=e.element.parent().outerWidth(!1)},_isValidIndex:function(e,t){return t=!!t,e=~~e,(this.currentIndex!==e||t)&&e>-1&&!!this.items.get(e)},_select:function(e){this.select(e.currentTarget)},next:function(){return this.select(this.currentIndex+1)},prev:function(){return this.select(this.currentIndex-1)},_getFrom:function(){var e=this;return Math.abs(e.previous-e.currentIndex)<=1?e.previousIndex:e.currentIndex+(e.previousIndex<e.currentIndex?-1:1)},select:function(i){var n,a=this,r=a.options,o=isNaN(parseInt(i,10))?a.items.index(i):parseInt(i,10);return a._isValidIndex(o)?!1===a._trigger("beforeselect",null,this._ui(a.items.eq(o),o))?!1:(a.isTicking&&(a.useJqueryAnimate?a.element.stop(!0,!1):(a.coverflowrafid&&t.cancelAnimationFrame(a.coverflowrafid),a.element.unbind(O[a.support.transition]))),a.isTicking=!0,a.previousIndex=a.currentIndex,r.active=a.currentIndex=o,n=e.extend({},a.renderer.select(),{coverflow:1}),a.useJqueryAnimate?a._animation(r,n):(r=e.extend({duration:r.duration,easing:r.easing},n),a._transition(r)),!0):!1},_animation:function(t,i){var n=this,a=this._getFrom();e.fx.step.coverflow=function(e){n._refresh(e.now,a,n.currentIndex)},n.element.animate(i,{duration:t.duration,easing:t.easing}).promise().done(function(){n._onAnimationEnd()})},_transition:function(i){var n=this,a=new Date,r=n._getFrom(),o=n.currentIndex,s={},l=function(){var e=((new Date).getTime()-a.getTime())/i.duration;e>1?n.isTicking=!1:n._refresh(e,r,o),n.isTicking&&(n.coverflowrafid=t.requestAnimationFrame(l))};e.isFunction(n.renderer.getElementTransitionStyles)&&(s=e.extend(s,n.renderer.getElementTransitionStyles(i))),n.element.one(O[n.support.transition],function(){n._refresh(1,r,o),n._onAnimationEnd()}).css(s),n.coverflowrafid=t.requestAnimationFrame(l)},_onAnimationEnd:function(){var e=this;e.coverflowrafid&&cancelAnimationFrame(e.coverflowrafid),e.isTicking=!1,e.activeItem=e.items.removeClass("ui-state-active").eq(e.currentIndex).addClass("ui-state-active"),e._trigger("select",null,e._ui())},_refresh:function(e,t,i){this.element.parent().scrollTop(0),this.renderer.refresh(e,t,i)},_ui:function(e,t){return{active:e||this.activeItem,index:null!=t?t:this.currentIndex}},_onMouseWheel:function(e){var t=e.originalEvent;return e.preventDefault(),t.wheelDelta>0||t.detail<0?void this.prev():void this.next()},_destroy:function(){var t=this;t.elementOrigStyle!==n?t.element.attr("style",this.elementOrigStyle):t.element.removeAttr("style"),t.element.removeClass("ui-coverflow ui-helper-clearfix ui-coverflow-"+(t.renderer.cssClass||"classic")+"-render").parent().removeClass("ui-coverflow-wrapper ui-clearfix"),t.items.removeClass("ui-coverflow-item ui-state-active").each(function(){var t=e(this),i=t.data("coverflowOrigElemAttr");
e.each(i,function(e,i){i!==n?t.attr(e,i):t.removeAttr(e)}),t.data("coverflowOrigElemAttr",null)}),t._super()}})}(e,this,this.document)}),function(){function e(e,t,i,n){this.x=e||0,this.y=t||0,this.inkAmount=i,this.color=n,this._latestPos={x:this.x,y:this.y}}e.prototype={x:0,y:0,inkAmount:7,color:"#000",_latestPos:null,render:function(e,t,i,n){this._latestPos.x=this.x,this._latestPos.y=this.y,this.x+=t,this.y+=i;var a=n?7/n:0;a>1?a=1:0>a&&(a=0),e.lineCap=e.lineJoin="round",e.lineWidth=7*a,e.beginPath(),e.moveTo(this._latestPos.x,this._latestPos.y),e.lineTo(this.x,this.y),e.stroke()}};var t={init:function(){var e={init:function(t){return this.each(function(){var i=$(this),n=i.data("eraser");if(!n){var a=i.width(),r=i.height(),o=i.offset(),s=$("<canvas/>"),l=s.get(0),c=t.imageWidth,d=t.imageHeight,h=t&&t.size?t.size:40,u=t&&t.completeRatio?t.completeRatio:.7,p=t&&t.completeFunction?t.completeFunction:null,v=t&&t.completeRatioFunction?t.completeRatioFunction:null,g=t&&t.onPaintStart?t.onPaintStart:null,f=[],m=Math.floor(a/h)||1,_=m*(Math.floor(r/h)||1),w=_,y=t.brush,b=l.getContext("2d");i.after(s),l.id=this.id,l.className=this.className,l.width=a,l.height=r;var x=function(){for(t.draw||(b.globalCompositeOperation="destination-out"),b.strokeStyle=t.color?t.color:"rgba(255,0,0,255)",b.lineWidth=h,b.lineCap="round",s.bind("mousedown.eraser",e.mouseDown),s.bind("touchstart.eraser",e.touchStart),s.bind("touchmove.eraser",e.touchMove),s.bind("touchend.eraser",e.touchEnd);w--;)f.push(1);$.zoom||($.zoom=1),n={posX:o.left,posY:o.top,touchDown:!1,touchID:-999,touchX:0,touchY:0,ptouchX:0,ptouchY:0,canvas:s,ctx:b,w:a,h:r,source:S,size:h,parts:f,colParts:m,numParts:_,ratio:0,complete:!1,completeRatio:u,completeFunction:p,completeRatioFunction:v,imageWidth:c,imageHeight:d,brush:y,onPaintStartFunction:g},s.data("eraser",n),i.data("eraser",n),$(window).resize(function(){$.zoom||($.zoom=1);var e=s.offset();n.posX=e.left,n.posY=e.top,s.data("eraser",n)})};if(t.draw)x(),i.remove();else{if(!this.src)return;var S=new Image;S.onload=function(){c&&d?b.drawImage(S,0,0,c,d):b.drawImage(S,0,0),i.remove(),x()},S.src=this.src}}})},touchStart:function(i){var n=$(this),a=n.data("eraser");if(!a.disabled){var r=n.offset();if(a.posX=r.left,a.posY=r.top,!a.touchDown){var o=i.originalEvent.changedTouches[0],s=o.pageX/$.zoom-a.posX,l=o.pageY/$.zoom-a.posY;e.evaluatePoint(a,s,l),a.touchDown=!0,a.touchID=o.identifier,a.touchX=s,a.touchY=l,a.brush&&t._resetTip(a,a.touchX,a.touchY,a.size),a.onPaintStartFunction&&a.onPaintStartFunction(),$("section#"+interaction_view.currentPage).children().data("is_scrollPage")&&interaction_view.ipagelist.getPage(interaction_view.currentPage).iview.scrollview.iScroll.disable(),i.preventDefault()}}},touchMove:function(t){var n=$(this),a=n.data("eraser");if(!a.disabled){var r=n.offset();if(a.posX=r.left,a.posY=r.top,a.touchDown)for(var o=t.originalEvent.changedTouches,s=o.length;s--;)if(o[s].identifier==a.touchID){var l=o[s].pageX/$.zoom-a.posX,c=o[s].pageY/$.zoom-a.posY;if(a.brush){var d,h=a._tip;for(dx=l-a.touchX,dy=c-a.touchY,console.log(dx,dy),d=Math.sqrt(dx*dx+dy*dy),i=0,len=h.length;len>i;i++)h[i].render(a.ctx,dx,dy,d,a.size);a.touchX=l,a.touchY=c}else e.evaluatePoint(a,l,c),a.ctx.beginPath(),a.ctx.moveTo(a.touchX,a.touchY),a.touchX=l,a.touchY=c,a.ctx.lineTo(a.touchX,a.touchY),a.ctx.stroke();t.preventDefault();break}}},touchEnd:function(e){var t=$(this),i=t.data("eraser");if(!i.disabled){var n=t.offset();if(i.posX=n.left,i.posY=n.top,i.touchDown){for(var a=e.originalEvent.changedTouches,r=a.length;r--;)if(a[r].identifier==i.touchID){i.touchDown=!1,e.preventDefault();break}$("section#"+interaction_view.currentPage).children().data("is_scrollPage")&&interaction_view.ipagelist.getPage(interaction_view.currentPage).iview.scrollview.iScroll.enable()}}},evaluatePoint:function(e,t,i){var n=Math.floor(t/e.size)+Math.floor(i/e.size)*e.colParts;n>=0&&n<e.numParts&&(e.ratio+=e.parts[n],e.parts[n]=0,e.complete||e.ratio/e.numParts>=e.completeRatio&&(e.complete=!0,null!=e.completeRatioFunction&&e.completeRatioFunction()))},mouseDown:function(i){var n=$(this),a=n.data("eraser");if(!a.disabled){var r=n.offset();a.posX=r.left,a.posY=r.top;var o=i.pageX/$.zoom-a.posX,s=i.pageY/$.zoom-a.posY;console.log("mouse page "+i.pageX+" "+i.pageY),console.log("offset "+a.posX+" "+a.posY),e.evaluatePoint(a,o,s),a.touchDown=!0,a.touchX=o,a.touchY=s,a.ctx.beginPath(),a.ctx.moveTo(a.touchX-1,a.touchY),a.ctx.lineTo(a.touchX,a.touchY),a.ctx.stroke(),n.bind("mousemove.eraser",e.mouseMove),$(document).bind("mouseup.eraser",a,e.mouseUp),a.brush&&t._resetTip(a,a.touchX,a.touchY,a.size),a.onPaintStartFunction&&a.onPaintStartFunction(),$("section#"+interaction_view.currentPage).children().data("is_scrollPage")&&interaction_view.ipagelist.getPage(interaction_view.currentPage).iview.scrollview.iScroll.disable(),i.preventDefault()}},mouseMove:function(t){var n=$(this),a=n.data("eraser");if(!a.disabled){var r=n.offset();a.posX=r.left,a.posY=r.top;var o=t.pageX/$.zoom-a.posX,s=t.pageY/$.zoom-a.posY;if(a.brush){var l,c=a._tip;for(dx=o-a.touchX,dy=s-a.touchY,console.log(dx,dy),l=Math.sqrt(dx*dx+dy*dy),i=0,len=c.length;len>i;i++)c[i].render(a.ctx,dx,dy,l,a.size);a.touchX=o,a.touchY=s}else e.evaluatePoint(a,o,s),a.ctx.beginPath(),a.ctx.moveTo(a.touchX,a.touchY),a.touchX=o,a.touchY=s,a.ctx.lineTo(a.touchX,a.touchY),a.ctx.stroke();t.preventDefault()}},mouseUp:function(e){var t=e.data,i=t.canvas;t.disabled||(t.touchDown=!1,i.unbind("mousemove.eraser"),$(document).unbind("mouseup.eraser"),$("section#"+interaction_view.currentPage).children().data("is_scrollPage")&&interaction_view.ipagelist.getPage(interaction_view.currentPage).iview.scrollview.iScroll.enable(),e.preventDefault())},clear:function(){var e=$(this),t=e.data("eraser");if(t){h=0;var i=function(){t.ctx.clearRect(0,0,t.w,t.h);for(var e=t.numParts;e--;)t.parts[e]=0;t.ratio=t.numParts,t.complete=!0,null!=t.completeFunction&&t.completeFunction()};i()}},size:function(e){var t=$(this),i=t.data("eraser");i&&e&&(i.size=e,i.ctx.lineWidth=e)},reset:function(){var e=$(this),t=e.data("eraser");if(t){t.ctx.globalCompositeOperation="source-over",t.imageWidth&&t.imageHeight?t.ctx.drawImage(t.source,0,0,t.imageWidth,t.imageHeight):t.ctx.drawImage(t.source,0,0),t.ctx.globalCompositeOperation="destination-out";for(var i=t.numParts;i--;)t.parts[i]=1;t.ratio=0,t.complete=!1}},color:function(e){var t=$(this),i=t.data("eraser");i&&e&&(i.strokeStyle=e,i.ctx.strokeStyle=e)},enable:function(){var e=$(this),t=e.data("eraser");t.disabled=!1},disable:function(){var e=$(this),t=e.data("eraser");t.disabled=!0},setmode:function(e){var t=$(this),i=t.data("eraser");i.ctx.globalCompositeOperation=e?"source-over":"destination-out"}};$.fn.eraser=function(t){return e[t]?e[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?void $.error("Method "+t+" does not yet exist on jQuery.eraser"):e.init.apply(this,arguments)}},set:function(e,t,i,n){$(e).eraser({size:40,imageWidth:t,imageHeight:i,completeRatio:.5,completeRatioFunction:function(){$(e).eraser("clear"),interaction_view.events.onEraserEvent(n)},completeFunction:function(){n.$el.addClass("invisible noevents")}})},reset:function(e){$(e).eraser("reset")},_resetTip:function(t,i,n,a){console.log("resetTip");var r,o,s,l,c,d,h,u,p,v,g=t._tip=[],f=.5*a;for(d=2*Math.PI*Math.random(),v=f*f*Math.PI/a|0,1>v&&(v=1),console.log("Tip length",v),p=0;v>p;p++)r=f*Math.random(),o=.5*r,s=2*Math.PI*Math.random(),l=r*Math.sin(s),c=o*Math.cos(s),h=Math.cos(d),u=Math.sin(d),g.push(new e(i+l*h-c*u,n+l*u+c*h,7,"#000000"))}};"undefined"==typeof require?(window._e||(window._e={}),window._e.eraser=t):define("_e/eraser",["jquery"],function(){return window._e||(window._e={}),window._e.eraser=t,_e.eraser.init(),window._e.eraser})}(window),function(){function e(e){if(this.hasDeviceMotion="ondevicemotion"in window,this.options={threshold:15,timeout:480},"object"==typeof e)for(var t in e)e.hasOwnProperty(t)&&(this.options[t]=e[t]);if(this.lastTime=new Date,this.lastX=0,this.lastY=0,this.lastZ=0,this.liTime=0,this.curTime=0,this.x=0,this.y=0,this.z=0,this.speed=this.options.threshold,"function"==typeof document.CustomEvent)this.event=new document.CustomEvent("shake",{bubbles:!0,cancelable:!0});else{if("function"!=typeof document.createEvent)return!1;this.event=document.createEvent("Event"),this.event.initEvent("shake",!0,!0)}}e.prototype.reset=function(){this.lastTime=new Date,this.lastX=0,this.lastY=0,this.lastZ=0,this.liTime=0,this.curTime=0},e.prototype.start=function(){this.reset(),this.hasDeviceMotion&&window.addEventListener("devicemotion",this,!1)},e.prototype.stop=function(){this.hasDeviceMotion&&window.removeEventListener("devicemotion",this,!1),this.reset()},e.prototype.devicemotion=function(e){this.liTime=(new Date).getTime(),this.curTime>1e4&&this.liTime-this.curTime>480&&(this.curTime=0,window.dispatchEvent(this.event));var t=e.accelerationIncludingGravity;this.x=t.x,this.y=t.y,this.z=t.z,(Math.abs(this.x-this.lastX)>this.speed||Math.abs(this.y-this.lastY)>this.speed||Math.abs(this.z-this.lastZ)>this.speed)&&(this.curTime=(new Date).getTime(),this.liTime=this.curTime),this.lastX=this.x,this.lastY=this.y,this.lastZ=this.z},e.prototype.handleEvent=function(e){return"function"==typeof this[e.type]?this[e.type](e):void 0},window.Shake=e}(window),define("_e/shake",function(){}),function(){function e(e){if(this.options={className:"child_Element",onStart:null,onEnd:null,autoClear:!1},"object"==typeof e)for(var t in e)e.hasOwnProperty(t)&&(this.options[t]=e[t]);this.init()}var t={1:"bounce",2:"flash",3:"pulse",4:"rubberBand",5:"shake",6:"swing",7:"tada",8:"wobble",9:"jello",12:"rotate",20:"bounceIn",21:"bounceInDown",22:"bounceInLeft",23:"bounceInRight",24:"bounceInUp",61:"bounceOut",62:"bounceOutDown",63:"bounceOutLeft",64:"bounceOutRight",65:"bounceOutUp",25:"fadeIn",26:"fadeInDown",27:"fadeInDownBig",28:"fadeInLeft",29:"fadeInLeftBig",30:"fadeInRight",31:"fadeInRightBig",32:"fadeInUp",33:"fadeInUpBig",67:"fadeOut",68:"fadeOutDown",69:"fadeOutDownBig",70:"fadeOutLeft",71:"fadeOutLeftBig",72:"fadeOutRight",73:"fadeOutRightBig",74:"fadeOutUp",75:"fadeOutUpBig",11:"flip",34:"flipInX",35:"flipInY",76:"flipOutX",77:"flipOutY",36:"lightSpeedIn",78:"lightSpeedOut",37:"rotateIn",38:"rotateInDownLeft",39:"rotateInDownRight",40:"rotateInUpLeft",41:"rotateInUpRight",79:"rotateOut",80:"rotateOutDownLeft",81:"rotateOutDownRight",82:"rotateOutUpLeft",83:"rotateOutUpRight",10:"hinge",42:"rollIn",93:"rollOut",44:"zoomIn",45:"zoomInDown",46:"zoomInLeft",47:"zoomInRight",48:"zoomInUp",84:"zoomOut",85:"zoomOutDown",86:"zoomOutLeft",87:"zoomOutRight",88:"zoomOutUp",49:"slideInDown",50:"slideInLeft",51:"slideInRight",52:"slideInUp",89:"slideOutDown",90:"slideOutLeft",91:"slideOutRight",92:"slideOutUp"};e.prototype.init=function(){for(var e=0;e<this.options.items.length;e++){var t=this.options.items[e];this.options.items[e].origin_el=t.el,t.el.wrapInner('<div class="'+this.options.className+'" style="position:absolute;top:0;left:0;width:100%;height:100%;"></div>'),this.options.items[e].originClass=this.options.className,this.options.items[e].el=t.el.children("div"),this.options.items[e].child=!0}},e.prototype.play=function(){this.options.onStart&&this.options.onStart();for(var e=0;e<this.options.items.length;e++){var i=this.options.items[e],n=i.repeat;n=n?-1==n?"infinite":n:"1";var a=i.el;a.data("anitype",i.type),this.bindEnd(e,a);var r=t[i.type],o=i.originClass.replace("hide","")+" "+r+" animated";if(a[0].style.animationDuration=i.duration+"s",a[0].style.animationDelay=i.delay+"s",a[0].style.animationIterationCount=n,a[0].style.webkitAnimationDuration=i.duration+"s",a[0].style.webkitAnimationDelay=i.delay+"s",a[0].style.webkitAnimationIterationCount=n,i.type<20?a.attr("data-effect","1"):i.type>=20&&i.type<=60?(a.closest(".iView").hasClass("hide")&&(a[0].initHide=!0,a.closest(".iView").removeClass("hide")),i.onShow&&i.onShow(),a.attr("data-in","1"),this.options.autoClear&&a.closest(".iView").find("[data-out]").children().unwrap()):i.type>60&&(a.attr("data-out","1"),this.options.autoClear&&a.closest(".iView").find("[data-in]").children().unwrap()),a[0].className=o,a.find("iframe").length){console.log("has iframe");var s=a.find("iframe").first().data("content");s&&(a.find("iframe").first()[0].contentWindow.document.body.innerText="",a.find("iframe").first()[0].contentWindow.document.write(s),a.find("iframe").first()[0].contentWindow.document.body.style.margin=0,a.find("iframe").first()[0].contentWindow.document.body.style.padding=0)}}},e.prototype.stop=function(){for(var e=0;e<this.options.items.length;e++){var t=this.options.items[e];t.el[0].className=this.options.className,t.el[0].style.animationDuration="",t.el[0].style.animationDelay="",t.el[0].style.animationIterationCount="",t.el[0].style.webkitAnimationDuration="",t.el[0].style.webkitAnimationDelay="",t.el[0].style.webkitAnimationIterationCount="",t.el[0].initHide&&t.el.closest(".iView").addClass("hide"),t.el.closest(".iView").find(".child_Action_Element").children().unwrap()}},e.prototype.bindEnd=function(e,t){var i=this;t.one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$(this).unbind("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend");var t=$(this).data("anitype");t>=20&&60>=t?$(this).closest(".iView").removeClass("noevents"):t>60&&100>t&&$(this).closest(".iView").addClass("noevents"),i.options.items[e].finished=!0,i.options.autoClear&&$(this).attr("data-effect")&&$(this).children().length&&$(this).children().unwrap(),i.end()})},e.prototype.end=function(){_.filter(this.options.items,function(e){return e.finished}).length==this.options.items.length&&this.options.onEnd&&this.options.onEnd()},window.Animate=e,window.ANIMATE_TYPE_VALUE=t}(window),define("_e/cssanimate",function(){}),function(){window.ScrollPage={bindScrollPage:function(e){function t(e){l=0,Reveal.wheelLock=!0,Reveal.originh=Reveal.indexh,Reveal.originv=Reveal.indexv,Reveal.indexv-=e,Reveal.transition.autostart(Reveal.options.transition,"y",e)}var i=this;if("string"==typeof e)var n=interaction_view.ipagelist.getPage(e),a=$("section#"+e).children();else var n=e,a=e.iview.$el;var r=interaction_view.doc.get("height"),o=n.get("height"),s=n.get("is_scrollPage")&&o>r;if(s?this.disable():this.enable(),!a.data("is_scrollPage")){if(s){a.data("is_scrollPage",!0),a.children().css({height:o,"-webkit-transform":"translate3d(0,0,0)"});var l=0,c=50,d=0;n.iview.scrollview=new _g.scrollview({containment:a,contentel:a.children(),mask_width:a.width(),mask_height:r,content_width:a.children().width(),content_height:o,content_x:0,content_y:0,scrollY:!0,bounce:!1,onScrollStart:function(){var e=n.iview.scrollview._getCurrentPosition().y;(e>=0||r-o>=e)&&(l=e>=0?1:-1),d=e,$(window.event.target).parents(".iLayerRef").size()&&n.iview.scrollview.iScroll.disable()},onScrolling:function(e){if(e.deltaY&&(d=i.execScrollEvents(d,e.deltaY)),n.iOverlaylist.each(function(t){t.isPositionAdapt&&t.iview&&t.iview.$el&&t.iview.$el.css({"margin-top":-e.deltaY})}),l)if(l>0&&e.deltaY>c){if(Reveal.getUp())return t(1),!1}else if(0>l&&-e.deltaY>o-r+c&&Reveal.getDown())return t(-1),!1},onScrollend:function(e){l=0,n.iOverlaylist.each(function(t){t.isPositionAdapt&&t.iview&&t.iview.$el&&t.iview.$el.css({"margin-top":-e.deltaY})})}}),a.css({"-webkit-transform":"translate3d(0,0,0)",overflow:"visible"}),n.iview.$el.hasClass("has_swipe")&&n.iview.scrollview.iScroll.disable()}return s}},execScrollEvents:function(e,t){var i=1;t>e?i=3:e>t&&(i=1);var n=e;e=t;var a=_.filter(interaction_view.events.scrollEvents,function(e){return e.page_id==interaction_view.currentPage});return a.length>0&&e!=n&&_.each(a,function(t){t.overlaymodel.iview.onAnchorTrigger(i,Math.abs(e),Math.abs(n),t)}),e},enable:function(){$(".reveal").removeClass("disableMouseWheelY").removeClass("disableDragY").addClass("enableMouseWheelY").addClass("enableDragY")},disable:function(){$(".reveal").removeClass("enableMouseWheelY").removeClass("enableDragY").addClass("disableMouseWheelY").addClass("disableDragY")}}}(window),define("_e/scrollpage",function(){}),function(){window.animation=function(e){this.defaults={countTime:0,currentFrame:0,path:null,raster:null,animation:null},this.options=e,this.options=$.extend(!0,{},this.defaults,"object"==typeof e&&e),this.page=this.options.collection.page,this.options.old_animation=$.extend(!0,{},this.options.animation),this.init()},window.animation.prototype={init:function(){_.bindAll(this),this.handleVars(),0==this.options.animation.iKind&&this.setparam(),1==this.options.animation.iKind&&this.setgroupparam()},refresh:function(){this.options.animation=$.extend(!0,{},this.options.old_animation),this.init()},handleVars:function(){var e=this.options.animation,t=interaction_view.getVarsOp(this.page.id,[0,2]);_.each(this.options.animation.iTiming,function(i,n){"object"!=typeof i&&(e.iTiming[n]=Number(t.var2val(i)))}),_.each(this.options.animation.iDetail,function(i,n){var a=String(i);a.length&&"%"!=a[a.length-1]&&"object"!=typeof i&&(e.iDetail[n]=Number(t.var2val(i)))})},cssTovalue:function(e){var t=e;return t=Number(e.split("px")[0])},EaseTypes:{0:"Linear.easeNone",1:"Power0.easeIn",2:"Power0.easeInOut",3:"Power0.easeOut",4:"Power1.easeIn",5:"Power1.easeInOut",6:"Power1.easeOut",7:"Power2.easeIn",8:"Power2.easeInOut",9:"Power2.easeOut",10:"Power3.easeIn",11:"Power3.easeInOut",12:"Power3.easeOut",13:"Power4.easeIn",14:"Power4.easeInOut",15:"Power4.easeOut",16:"Quad.easeIn",17:"Quad.easeInOut",18:"Quad.easeOut",19:"Cubic.easeIn",20:"Cubic.easeInOut",21:"Cubic.easeOut",22:"Quart.easeIn",23:"Quart.easeInOut",24:"Quart.easeOut",25:"Quint.easeIn",26:"Quint.easeInOut",27:"Quint.easeOut",28:"Strong.easeIn",29:"Strong.easeInOut",30:"Strong.easeOut",31:"Back.easeIn",32:"Back.easeInOut",33:"Back.easeOut",34:"Bounce.easeIn",35:"Bounce.easeInOut",36:"Bounce.easeOut",37:"Circ.easeIn",38:"Circ.easeInOut",39:"Circ.easeOut",40:"Elastic.easeIn",41:"Elastic.easeInOut",42:"Elastic.easeOut",43:"Expo.easeIn",44:"Expo.easeInOut",45:"Expo.easeOut",46:"Sine.easeIn",47:"Sine.easeInOut",48:"Sine.easeOut",49:"SlowMo.ease"},getTypeName:function(e){switch(e){case 100:return"å‡ºçŽ°åŠ¨ç”»";case 101:return"é£žå…¥";case 102:return"æ”¾å¤§";case 103:return"æ¸çŽ°";case 104:return"ç¼©å°å‡ºçŽ°";case 200:return"æ¶ˆå¤±åŠ¨ç”»";case 201:return"é£žå‡º";case 202:return"ç¼©å°";case 203:return"æ¸éš";case 204:return"æ”¾å¤§æ¶ˆå¤±";case 300:return"è¿åŠ¨è·¯å¾„";case 301:return"ç›´çº¿è¿åŠ¨";case 302:return"æ›²çº¿è¿åŠ¨";case 400:return"å¼ºè°ƒåŠ¨ç”»";case 401:return"æ”¾å¤§ç¼©å°";case 402:return"é€æ˜Ž";case 403:return"æ—‹è½¬";case 500:return"åª’ä½“åŠ¨ç”»";case 501:return"æ’­æ”¾";case 502:return"æš‚åœ";case 503:return"ç»“æŸ";case 601:return"é€å­—å‡ºçŽ°";case 701:return"SVGæç»˜åŠ¨ç”»";case 702:return"SVGå˜å½¢åŠ¨ç”»"}},setpathparam:function(e){var t;this.pathoriginalpoint={};var i=this.page.iOverlaylist.get(this.options.animation.overlay_id);this.obj=i.iview.$el[0];var n=i.get("_offset_x")||0,a=i.get("_offset_y")||0,r=this.options.animation.iDetail.autoRotate||!1;if(r){this.page.iOverlaylist.get(this.options.animation.overlay_id).iview.$el[0]}var o=this.options.animation.iDetail.closed;if(302==e){if(this.options.animation.iDetail.path.length<2)return this.param=null,!1;t=[],_.each(this.options.animation.iDetail.path,function(e,i,r){if(0!=i&&e.handleIn){var s={};s.x=e.handleIn.x+e.point.x+n,s.y=e.handleIn.y+e.point.y+a,t.push(s)}if(t.push({x:e.point.x+n,y:e.point.y+a}),e.handleOut){var l={};l.x=e.handleOut.x+e.point.x+n,l.y=e.handleOut.y+e.point.y+a,t.push(l)}if(i==r.length-1&&o&&e.handleOut&&r[0].handleIn){var c=r[0].handleIn,d=r[0].point,s={};s.x=c.x+d.x+n,s.y=c.y+d.y+a,t.push(s),t.push(d)}}),this.param.bezier={values:t,type:"cubic",autoRotate:r}}if(301==e){if(this.options.animation.iDetail.path.length<2)return this.param=null,!1;t=[];var s;for(s=0;s<this.options.animation.iDetail.path.length;s++){if(0!=s){var l=this.options.animation.iDetail.path[s-1],c=this.options.animation.iDetail.path[s],d={x:(l.point.x+c.point.x)/2+n,y:(l.point.y+c.point.y)/2+a};t.push(d)}if(t.push({x:this.options.animation.iDetail.path[s].point.x+n,y:this.options.animation.iDetail.path[s].point.y+a}),s==this.options.animation.iDetail.path.length-1&&o){var l=this.options.animation.iDetail.path[s],c=this.options.animation.iDetail.path[0],d={x:(l.point.x+c.point.x)/2+n,y:(l.point.y+c.point.y)/2+a};t.push(d),t.push({x:this.options.animation.iDetail.path[0].point.x+n,y:this.options.animation.iDetail.path[0].point.y+a})}}this.param.bezier={values:t,type:"quadratic",autoRotate:r}}},setappearparam:function(e){this.startshow=!0,this.fromparam={},this.toparam={},this.toparam.onStart=this.onStart,this.toparam.immediateRender=!1,this.toparam.onComplete=this.param.onComplete,this.toparam.delay=this.param.delay,this.toparam.repeat=this.param.repeat,this.toparam.ease=this.param.ease;var t,i,n;if(101==e){this.stopshow=!0,t=this.options.animation.iDetail.direction||0;var a=this.options.animation.iDetail.pathlength||0,r=this.page.iOverlaylist.get(this.options.animation.overlay_id).iview.x,o=this.page.iOverlaylist.get(this.options.animation.overlay_id).iview.y,s=this.page.iOverlaylist.get(this.options.animation.overlay_id).iview.$el.find(".Element").first().width(),l=this.page.iOverlaylist.get(this.options.animation.overlay_id).iview.$el.find(".Element").first().height();switch(i={},t){case 0:i.y=a?this.page.iOverlaylist.get(this.options.animation.overlay_id).iview.y-a:"-"+l,i.x=r;break;case 1:i.x=a?this.page.iOverlaylist.get(this.options.animation.overlay_id).iview.x+a:interaction_view.size.x+s,i.y=o;break;case 2:i.y=a?this.page.iOverlaylist.get(this.options.animation.overlay_id).iview.y+a:interaction_view.size.y+l,i.x=r;break;case 3:i.x=a?this.page.iOverlaylist.get(this.options.animation.overlay_id).iview.x-a:"-"+s,i.y=o}this.param.css=i,this.fromparam.css={x:Number(i.x),y:Number(i.y)},this.toparam.css={x:Number(r),y:Number(o)},a&&(this.fromparam.css.opacity=0,this.toparam.css.opacity=1),this.obj=this.page.iOverlaylist.get(this.options.animation.overlay_id).iview.$el[0],this.toparam.css.force3D=interaction_view.force3D}if(102==e){this.obj=this.page.iOverlaylist.get(this.options.animation.overlay_id).iview.$el.children(".Element")[0],t=this.options.animation.iDetail.direction||0,n={},i={};{this.page.iOverlaylist.get(this.options.animation.overlay_id)}n.scale=0,this.param.css=n,this.fromparam.css={scale:0},this.toparam.css={scale:1},this.toparam.css.force3D=interaction_view.force3D,interaction_view.force3D&&_g.device.android()&&TweenLite.set(this.obj,{transformPerspective:2e3})}if(103==e&&(t=this.options.animation.iDetail.direction||0,n={},this.param.css={opacity:0},this.fromparam.css={opacity:0},this.toparam.css={opacity:1},this.obj=this.page.iOverlaylist.get(this.options.animation.overlay_id).iview.$el[0],this.toparam.css.force3D=interaction_view.force3D),104==e){this.obj=this.page.iOverlaylist.get(this.options.animation.overlay_id).iview.$el.children(".Element")[0];var c=Number(this.options.animation.iDetail.scale)||2,d=Number(this.options.animation.iDetail.opacity)||.5;n={},i={};{this.page.iOverlaylist.get(this.options.animation.overlay_id)}n.scale=0,this.param.css=n,this.fromparam.css={scale:c,opacity:d},this.toparam.css={scale:1,opacity:1},this.toparam.css.force3D=interaction_view.force3D,interaction_view.force3D&&_g.device.android()&&TweenLite.set(this.obj,{transformPerspective:2e3})}},setdisappearparam:function(e){var t={};if(201==e){var i=this.options.animation.iDetail.direction||0;this.obj=this.page.iOverlaylist.get(this.options.animation.overlay_id).iview.$el[0];var n=this.options.animation.iDetail.pathlength||0,a=2*this.page.iOverlaylist.get(this.options.animation.overlay_id).iview.$el.find(".Element").first().width(),r=2*this.page.iOverlaylist.get(this.options.animation.overlay_id).iview.$el.find(".Element").first().height();switch(i){case 0:t.y=n?this.page.iOverlaylist.get(this.options.animation.overlay_id).iview.y-n:"-"+r;break;case 1:t.x=n?this.page.iOverlaylist.get(this.options.animation.overlay_id).iview.x+n:interaction_view.size.x+a;break;case 2:t.y=n?this.page.iOverlaylist.get(this.options.animation.overlay_id).iview.y+n:interaction_view.size.y+r;break;case 3:t.x=n?this.page.iOverlaylist.get(this.options.animation.overlay_id).iview.x-n:"-"+a}this.param.css=t,n&&(this.param.css.opacity=0)}if(202==e){this.overlay_obj=this.page.iOverlaylist.get(this.options.animation.overlay_id).iview.$el,this.obj=this.overlay_obj.children(".Element")[0];{this.page.iOverlaylist.get(this.options.animation.overlay_id)}t.scale=0,this.param.css=t}if(203==e&&(this.param.css={opacity:0},this.obj=this.page.iOverlaylist.get(this.options.animation.overlay_id).iview.$el[0]),204==e){var o=Number(this.options.animation.iDetail.scale)||2,s=Number(this.options.animation.iDetail.opacity)||0;this.overlay_obj=this.page.iOverlaylist.get(this.options.animation.overlay_id).iview.$el,this.obj=this.overlay_obj.children(".Element")[0];{this.page.iOverlaylist.get(this.options.animation.overlay_id)}t.scale=o,t.opacity=s,this.param.css=t}this.stophide=!0},setstrongparam:function(e){if(this.obj=this.page.iOverlaylist.get(this.options.animation.overlay_id).iview.$el[0],401==e){this.obj=this.page.iOverlaylist.get(this.options.animation.overlay_id).iview.$el.children(".Element")[0];var t=(this.page.iOverlaylist.get(this.options.animation.overlay_id),{});t.scale=_.isNumber(this.options.animation.iDetail.scale)?Number(this.options.animation.iDetail.scale):1,this.param.css=t}if(402==e){var i=this.options.animation.iDetail.opacity||0;this.obj=this.page.iOverlaylist.get(this.options.animation.overlay_id).iview.$el[0],this.param.css={opacity:i}}if(403==e){var n=this.page.iOverlaylist.get(this.options.animation.overlay_id);this.obj=n.iview.wrap_el?n.iview.wrap_el[0]:n.iview.$el.children(".Element")[0];var a=_.isNumber(this.options.animation.iDetail.rotation)?Number(this.options.animation.iDetail.rotation):0,r=this.options.animation.iDetail.axial||0,o=this.options.animation.iDetail.transformOrigin||0,s="_cw",l="+";0>a&&(s="_ccw"),0>a&&(l="-");var t={};switch(0==r&&(t.rotation=l+"="+Math.abs(a)+s),1==r&&(t.rotationX=l+"="+Math.abs(a)+s),2==r&&(t.rotationY=l+"="+Math.abs(a)+s),this.param.css=t,o){case 0:this.param.css.transformOrigin="50% 50%";break;case 1:this.param.css.transformOrigin=0==r?"0% 50%":"left";break;case 2:this.param.css.transformOrigin=0==r?"100% 50%":"right";break;case 3:this.param.css.transformOrigin=0==r?"50% 100%":"bottom center";break;case 4:this.param.css.transformOrigin=0==r?"50% 0%":"top center";break;case 5:this.param.css.transformOrigin="0% 0%";break;case 6:this.param.css.transformOrigin="100% 0%";break;case 7:this.param.css.transformOrigin="0% 100%";break;case 8:this.param.css.transformOrigin="100% 100%";break;default:this.param.css.transformOrigin="50% 50%"}_g.device.android()&&TweenLite.set(this.obj,{transformPerspective:2e3})}this.param.css.force3D=interaction_view.force3D},settextparam:function(e){if(this.startshow=!0,601==e){var t=this.page.iOverlaylist.get(this.options.animation.overlay_id);if("Paragraph"==t.get("iType")){var i=this.page.iOverlaylist.get(this.options.animation.overlay_id).iview.$el.children(".Element")[0];this.obj=$(i).find(".iText"),this.param.text=t.attributes.iDetail.iText,$(this.obj).html("")}}},setgroupparam:function(){this.param={},this.param.data=this.options.animation,this.param.onStartParams=["{self}"],this.param.onStart=this.onStart,this.param.onComplete=this.stop,this.param.onCompleteParams=["{self}"];var e=this.options.animation.iTiming.repeat||0;-1==e?this.param.repeat=-1:e&&-2!=e?this.param.repeat=e-1:-2==e&&(this.param.repeat=-1)},setsvgparam:function(e){var t=this;this.startshow=!0,this.fromparam={},this.toparam={},this.toparam.onStart=this.onStart,this.toparam.immediateRender=!1,this.toparam.onComplete=this.param.onComplete,this.toparam.delay=this.param.delay,this.toparam.repeat=this.param.repeat,this.toparam.ease=this.param.ease;var i=this.page.iOverlaylist.get(this.options.animation.overlay_id);if(701==e)this.obj=i.iview.$el.find("svg").find("rect, circle, ellipse, polyline, path, line, polygon").not("[data-attr=morphCloneElement]"),this.fromparam.drawSVG=this.param.data.iDetail.startx+" "+this.param.data.iDetail.starty,this.toparam.drawSVG=this.param.data.iDetail.endx+" "+this.param.data.iDetail.endy;else if(702==e){this.toparam.paths=[],this.toparam.otherPaths=[];var n=0;if(_.each(this.param.data.iDetail.pathIndex,function(e){null!=e.selected&&n++}),1>=n)return;this.toparam.obj=i.iview.$el.children(".Element").find("svg"),_.each(this.param.data.iDetail.pathIndex,function(e){null!=e.selected?t.toparam.paths.push({shapeIndex:e.selected,id:e.id}):t.toparam.otherPaths.push({id:e.id})})}},setparam:function(){this.param={},this.param.data=this.options.animation;var e=this.page.iOverlaylist.get(this.options.animation.overlay_id);this.overlaymodel=e,this.param.onStartParams=["{self}"],this.param.onStart=this.onStart,this.param.onUpdate=this.onUpdate,this.param.onComplete=this.stop,this.param.onCompleteParams=["{self}"],this.param.ease=this.EaseTypes[this.options.animation.iTiming.ease||0];var t=this.options.animation.iTiming.repeat||0;switch(-1==t?this.param.repeat=-1:t&&-2!=t?this.param.repeat=t-1:-2==t&&(this.param.repeat=-1),this.options.animation.iType){case 100:return"å‡ºçŽ°åŠ¨ç”»";case 101:this.setappearparam(101);break;case 102:this.setappearparam(102);break;case 103:this.setappearparam(103);break;case 104:this.setappearparam(104);break;case 200:return"æ¶ˆå¤±åŠ¨ç”»";case 201:this.setdisappearparam(201);break;case 202:this.setdisappearparam(202);break;case 203:this.setdisappearparam(203);break;case 204:this.setdisappearparam(204);break;case 300:return"è¿åŠ¨è·¯å¾„";case 301:this.setpathparam(301);break;case 302:this.setpathparam(302);break;case 400:return"å¼ºè°ƒåŠ¨ç”»";case 401:this.setstrongparam(401);break;case 402:this.setstrongparam(402);break;case 403:this.setstrongparam(403);break;case 500:return"åª’ä½“åŠ¨ç”»";case 501:this.setmedia(501);break;case 502:this.setmedia(502);break;case 503:this.setmedia(503);break;case 700:return"SVGåŠ¨ç”»";case 701:this.setsvgparam(701);break;case 702:this.setsvgparam(702);break;case 600:return"æ–‡å­—åŠ¨ç”»";case 601:this.settextparam(601)}this.param&&this.param.css&&(this.param.css.force3D=interaction_view.force3D,this.param.css.force3D&&this.obj&&_g.device.android())},setmedia:function(e){"Audio"==this.overlaymodel.get("iType")&&(this.isAudio=!0)},pathstop:function(e){var t=this.options.animation.iTiming.rewind||!1;t&&-1!=this.options.animation.iTiming.repeat&&-2!=this.options.animation.iTiming.repeat&&this.options.animation.iDetail.path&&this.options.animation.iDetail.path[0]&&e.pause(0)},animationstop:function(e){var t=this.options.animation.iTiming.rewind||!1;t&&e&&e.pause(0)},stop:function(e){this.stopshow&&this.showelement(),this.stophide&&this.hideelement(),this.animationstop(e),interaction_view.events.onAnimationEnd({overlay_id:this.options.animation.overlay_id,animation_id:this.options.animation.id,page_id:this.page.id,layer_id:this.options.collection.layerid})},forcestop:function(e){var t=this.options.animation.iTiming.rewind||!1;e.pause(t?0:this.options.animation.iTiming.duration),this.options.collection.onComplete(this.options.animation.id)},addclickcontrol:function(){this.options.collection.addclickstop(this.options.animation.id)},onStart:function(){this.startshow&&this.showelement(),interaction_view.events.onAnimationStart({overlay_id:this.options.animation.overlay_id,animation_id:this.options.animation.id,page_id:this.page.id,layer_id:this.options.collection.layerid})},onUpdate:function(){},showelement:function(){var e=this.page.iOverlaylist.get(this.options.animation.overlay_id);e.iview.onBeforeShow&&e.iview.onBeforeShow(),e.iview.$el.removeClass("hide"),e.iview.onShow&&e.iview.onShow()},hideelement:function(){var e=this.page.iOverlaylist.get(this.options.animation.overlay_id);e.iview.onBeforeHide&&e.iview.onBeforeHide(),e.iview.$el.addClass("hide"),e.iview.onHide&&e.iview.onHide()}},window.animateTimeline={generateTimeline:function(e){if("undefined"!=typeof TimelineMax){var t=interaction_view.getVarsOp(e.iPage_id,[0,2]),i={paused:e.paused,onStart:e.onStart,onComplete:e.onComplete,onStartParams:e.onStartParams,onCompleteParams:e.onComplateParams};
e.repeat&&(i.repeat=e.repeat);var n=new TimelineMax(i);n.elements=[],n.addLabel("Start");var a=0;if(e.ids){e.ids=_.filter(e.ids,function(t){page=t.page||interaction_view.getAnimationPage(t.page_id,e.page);var i=page.iAnimationlist.get(t.id);if(!i)return!1;var t=i.toJSON();return 0!=t.iKind||page.iOverlaylist.get(t.overlay_id)?!0:!1}),e.animations=[];for(var r=0;r<e.ids.length;r++){page=e.ids[r].page||interaction_view.getAnimationPage(e.ids[r].page_id,e.page);var o=page.iAnimationlist.get(e.ids[r].id);o.page=page,e.animations.push(o)}}if(0==e.animations.length)return!1;var s=interaction_view.filterAnimations(e.animations,e.page,e.group,e.foraction);return s=_.filter(s,function(e){return e._animation}),_.each(s,function(i,r){function o(e){return z.obj.find("path#"+e.id)}function l(e){return z.obj.find("path#clone_"+e.id)}function c(){$(B).attr("d",$(B).attr("data-original")),$(B).css($(B).data("initStyle")),$(B).data("show",!1)}function d(e){var t=e.css("fill")||"white",i=parseFloat(e.css("fill-opacity"))>=0?parseFloat(e.css("fill-opacity")):1,n=e.css("stroke")||"black",a=parseFloat(e.css("stroke-opacity"))>=0?parseFloat(e.css("stroke-opacity")):1,r=parseFloat(e.css("stroke-width"))>=0?parseFloat(e.css("stroke-width")):1;return{fill:t,"fill-opacity":i,stroke:n,"stroke-opacity":a,"stroke-width":r}}function h(){$(B).show().css({"stroke-dasharray":"none","stroke-dashoffset":"none"}),$(B).data("show",!0);for(var e=1;e<z.paths.length;e++)o(z.paths[e]).hide();for(var e=0;e<z.otherPaths.length;e++){var t=o(z.otherPaths[e]);t.data("show")||t.hide()}}function u(){h(),z.onStart(),c()}function p(){z.onComplete(),i.attributes.iTiming.rewind?c():$(B).data("show",!1)}if(i){i._animation.refresh();var v=i.page?i.page.id:e.iPage_id,g=i.page?i.page:e.page,f=i.toJSON(),m=$.extend(!0,{},i._animation.param);if(f.iTiming){var w=t.var2val(f.iTiming.delay),y=t.var2val(f.iTiming.repeat),b=t.var2val(f.iTiming.duration);a+=w,b=b;var x=r;if(_.include([0,3,4,5,6,7],f.iTiming.start))switch(n.addLabel(i.id+"_start",a),f.iTiming.start){case 0:n.call(e.page.iAnimationlist.AddClickTween,[n,e.iPage_id,i,a],this,a-w);break;case 3:case 4:case 5:case 6:n.call(e.page.iAnimationlist.AddPageSwipeTween,[n,e.iPage_id,f.iTiming.start,i,a],this,a-w);break;case 7:n.call(e.page.iAnimationlist.AddPageShakeTween,[n,e.iPage_id,f.iTiming.start,i,a],this,a-w)}else if(2==f.iTiming.start)if(0!=x){var S=n.getLabelTime(s[x-1].id+"_start");n.addLabel(i.id+"_start",S+w),a=n.getLabelTime(i.id+"_start")}else n.addLabel(i.id+"_start",a);else n.addLabel(i.id+"_start",a)}if(1==f.iKind&&f.children){var T=[];_.each(f.children,function(e){T.push({id:e,page_id:v,page:g})});var k=animateTimeline.generateTimeline({page:g,ids:T,iPage_id:v,group:!0,paused:!1,repeat:m.repeat,onStart:m.onStart,onComplete:m.onComplete,onStartParams:m.onStartParams,onCompleteParams:m.onCompleteParams,foraction:!0});if(k){n.add(k,a);var C=k;b=k.duration(),k.elements&&k.elements.length&&(n.elements=n.elements.concat(k.elements))}else b=0}else{if(!_g.browserSupport({msie:9})&&!_.include([101,201,100,103,200,203,402,500,501,502,503],i.get("iType"))){var P,D=$(i._animation.obj);if(i._animation.toparam)P=i._animation.toparam.css;else if(i._animation.param)if(i._animation.param.css)P=i._animation.param.css;else if(i._animation.param.bezier){var E=i._animation.param.bezier.values;P=E[E.length-1]}return P&&P.x&&D.css("margin-left",P.x+"px"),P&&P.y&&D.css("margin-top",P.y+"px"),D.removeClass("hide").show(),D.parents(".iView:first").removeClass("hide").show(),!0}var O=i._animation.obj,I={onUpdate:interaction_view.events.onAnimationUpdate,onUpdateParams:[{animation_id:i.id,overlay_id:i.get("overlay_id"),page_id:i.get("page_id"),layer_id:i.get("layer_id")}]};if(i._animation.toparam?i._animation.toparam=$.extend({},i._animation.toparam,I):i._animation.param=$.extend({},i._animation.param,I),_.include([301,302],i.get("iType"))&&!m)return!1;if(_.include([501,502,503],i.get("iType"))){interaction_view.isIos&&i._animation.isAudio&&501==i.get("iType")&&(w||interaction_view.media.play(i._animation.overlaymodel));var A=e.page.iAnimationlist.getMediaTime(i);b=502==i.get("iType")||503==i.get("iType")?0:A,n.call(e.page.iAnimationlist.AddMediaTween,[i],this,a)}else if(_.include([102,103],i.get("iType")))n.add(TweenMax.fromTo(O,b,i._animation.fromparam,i._animation.toparam),a);else if(104==i.get("iType"))n.add(TweenMax.fromTo(O,.01,{opacity:0},i._animation.fromparam),a),n.add(TweenMax.fromTo(O,b-.01,i._animation.fromparam,i._animation.toparam),a+.01);else if(101==i.get("iType"))_g.browserSupport({msie:9})?n.add(TweenMax.fromTo(O,b,i._animation.fromparam,i._animation.toparam),a):n.add(TweenMax.fromTo(O,b,{"margin-left":i._animation.fromparam.css.x,"margin-top":i._animation.fromparam.css.y},{"margin-left":i._animation.toparam.css.x,"margin-top":i._animation.toparam.css.y,immediateRender:!1}),a);else if(201!=i.get("iType")||_g.browserSupport({msie:9}))if(701==i.get("iType")){n.add(TweenMax.fromTo(O,.001,{drawSVG:"0%",display:"block"},{drawSVG:!0,onStart:i._animation.toparam.onStart}),a);var N=$.extend(!0,{},i._animation.toparam);N.onStart=null,n.add(TweenMax.fromTo(O,b-.001,i._animation.fromparam,N),a+.001)}else if(702==i.get("iType")){if(i._animation.toparam.paths.length>=2){var R,M=b/(i._animation.toparam.paths.length-1),z=$.extend(!0,{},i._animation.toparam),L=a,F={immediateRender:z.immediateRender,ease:z.ease,onUpdate:z.onUpdate,onUpdateParams:z.onUpdateParams},B=o(z.paths[0])[0];$(B).data("initStyle")||$(B).data("initStyle",d($(B)));var W=new TimelineMax({repeat:z.repeat,onStart:u,onComplete:p});L=0;for(var r=1;r<i._animation.toparam.paths.length;r++)R=$.extend(!0,{morphSVG:{shape:l(z.paths[r])[0],shapeIndex:z.paths[r-1].shapeIndex}},F),R=$.extend(!0,d(o(z.paths[r])),R),W.add(TweenMax.to(B,M,R),L),L+=M;n.add(W,a)}}else n.add(TweenMax.to(O,b,i._animation.param),a);else n.add(TweenMax.to(O,b,{"margin-left":i._animation.param.css.x,"margin-top":i._animation.param.css.y}),a);var C=n.getChildren()[n.getChildren().length-1]}i.get("iType")>200&&i.get("iType")<210&&n.elements.push(i._animation.overlay_obj||i._animation.obj),y&&y>0?b*=y:-2==y&&n.call(e.page.iAnimationlist.AddRepeatClickTween,[n,e.iPage_id,C,i],this,a),a+=b,n.addLabel(i.id+"_end",a)}}),n}}}}(window),define("_e/animate",function(){});var _gsScope="undefined"!=typeof module&&module.exports&&"undefined"!=typeof global?global:this||window;(_gsScope._gsQueue||(_gsScope._gsQueue=[])).push(function(){_gsScope._gsDefine("TweenMax",["core.Animation","core.SimpleTimeline","TweenLite"],function(e,t,i){var n=function(e){var t,i=[],n=e.length;for(t=0;t!==n;i.push(e[t++]));return i},a=function(e,t,i){var n,a,r=e.cycle;for(n in r)a=r[n],e[n]="function"==typeof a?a(i,t[i]):a[i%a.length];delete e.cycle},r=function(e,t,n){i.call(this,e,t,n),this._cycle=0,this._yoyo=this.vars.yoyo===!0,this._repeat=this.vars.repeat||0,this._repeatDelay=this.vars.repeatDelay||0,this._dirty=!0,this.render=r.prototype.render},o=1e-10,s=i._internals,l=s.isSelector,c=s.isArray,d=r.prototype=i.to({},.1,{}),h=[];r.version="1.19.0",d.constructor=r,d.kill()._gc=!1,r.killTweensOf=r.killDelayedCallsTo=i.killTweensOf,r.getTweensOf=i.getTweensOf,r.lagSmoothing=i.lagSmoothing,r.ticker=i.ticker,r.render=i.render,d.invalidate=function(){return this._yoyo=this.vars.yoyo===!0,this._repeat=this.vars.repeat||0,this._repeatDelay=this.vars.repeatDelay||0,this._uncache(!0),i.prototype.invalidate.call(this)},d.updateTo=function(e,t){var n,a=this.ratio,r=this.vars.immediateRender||e.immediateRender;t&&this._startTime<this._timeline._time&&(this._startTime=this._timeline._time,this._uncache(!1),this._gc?this._enabled(!0,!1):this._timeline.insert(this,this._startTime-this._delay));for(n in e)this.vars[n]=e[n];if(this._initted||r)if(t)this._initted=!1,r&&this.render(0,!0,!0);else if(this._gc&&this._enabled(!0,!1),this._notifyPluginsOfEnabled&&this._firstPT&&i._onPluginEvent("_onDisable",this),this._time/this._duration>.998){var o=this._totalTime;this.render(0,!0,!1),this._initted=!1,this.render(o,!0,!1)}else if(this._initted=!1,this._init(),this._time>0||r)for(var s,l=1/(1-a),c=this._firstPT;c;)s=c.s+c.c,c.c*=l,c.s=s-c.c,c=c._next;return this},d.render=function(e,t,i){this._initted||0===this._duration&&this.vars.repeat&&this.invalidate();var n,a,r,l,c,d,h,u,p=this._dirty?this.totalDuration():this._totalDuration,v=this._time,g=this._totalTime,f=this._cycle,m=this._duration,_=this._rawPrevTime;if(e>=p-1e-7?(this._totalTime=p,this._cycle=this._repeat,this._yoyo&&0!==(1&this._cycle)?(this._time=0,this.ratio=this._ease._calcEnd?this._ease.getRatio(0):0):(this._time=m,this.ratio=this._ease._calcEnd?this._ease.getRatio(1):1),this._reversed||(n=!0,a="onComplete",i=i||this._timeline.autoRemoveChildren),0===m&&(this._initted||!this.vars.lazy||i)&&(this._startTime===this._timeline._duration&&(e=0),(0>_||0>=e&&e>=-1e-7||_===o&&"isPause"!==this.data)&&_!==e&&(i=!0,_>o&&(a="onReverseComplete")),this._rawPrevTime=u=!t||e||_===e?e:o)):1e-7>e?(this._totalTime=this._time=this._cycle=0,this.ratio=this._ease._calcEnd?this._ease.getRatio(0):0,(0!==g||0===m&&_>0)&&(a="onReverseComplete",n=this._reversed),0>e&&(this._active=!1,0===m&&(this._initted||!this.vars.lazy||i)&&(_>=0&&(i=!0),this._rawPrevTime=u=!t||e||_===e?e:o)),this._initted||(i=!0)):(this._totalTime=this._time=e,0!==this._repeat&&(l=m+this._repeatDelay,this._cycle=this._totalTime/l>>0,0!==this._cycle&&this._cycle===this._totalTime/l&&e>=g&&this._cycle--,this._time=this._totalTime-this._cycle*l,this._yoyo&&0!==(1&this._cycle)&&(this._time=m-this._time),this._time>m?this._time=m:this._time<0&&(this._time=0)),this._easeType?(c=this._time/m,d=this._easeType,h=this._easePower,(1===d||3===d&&c>=.5)&&(c=1-c),3===d&&(c*=2),1===h?c*=c:2===h?c*=c*c:3===h?c*=c*c*c:4===h&&(c*=c*c*c*c),this.ratio=1===d?1-c:2===d?c:this._time/m<.5?c/2:1-c/2):this.ratio=this._ease.getRatio(this._time/m)),v===this._time&&!i&&f===this._cycle)return void(g!==this._totalTime&&this._onUpdate&&(t||this._callback("onUpdate")));if(!this._initted){if(this._init(),!this._initted||this._gc)return;if(!i&&this._firstPT&&(this.vars.lazy!==!1&&this._duration||this.vars.lazy&&!this._duration))return this._time=v,this._totalTime=g,this._rawPrevTime=_,this._cycle=f,s.lazyTweens.push(this),void(this._lazy=[e,t]);this._time&&!n?this.ratio=this._ease.getRatio(this._time/m):n&&this._ease._calcEnd&&(this.ratio=this._ease.getRatio(0===this._time?0:1))}for(this._lazy!==!1&&(this._lazy=!1),this._active||!this._paused&&this._time!==v&&e>=0&&(this._active=!0),0===g&&(2===this._initted&&e>0&&this._init(),this._startAt&&(e>=0?this._startAt.render(e,t,i):a||(a="_dummyGS")),this.vars.onStart&&(0!==this._totalTime||0===m)&&(t||this._callback("onStart"))),r=this._firstPT;r;)r.f?r.t[r.p](r.c*this.ratio+r.s):r.t[r.p]=r.c*this.ratio+r.s,r=r._next;this._onUpdate&&(0>e&&this._startAt&&this._startTime&&this._startAt.render(e,t,i),t||(this._totalTime!==g||a)&&this._callback("onUpdate")),this._cycle!==f&&(t||this._gc||this.vars.onRepeat&&this._callback("onRepeat")),a&&(!this._gc||i)&&(0>e&&this._startAt&&!this._onUpdate&&this._startTime&&this._startAt.render(e,t,i),n&&(this._timeline.autoRemoveChildren&&this._enabled(!1,!1),this._active=!1),!t&&this.vars[a]&&this._callback(a),0===m&&this._rawPrevTime===o&&u!==o&&(this._rawPrevTime=0))},r.to=function(e,t,i){return new r(e,t,i)},r.from=function(e,t,i){return i.runBackwards=!0,i.immediateRender=0!=i.immediateRender,new r(e,t,i)},r.fromTo=function(e,t,i,n){return n.startAt=i,n.immediateRender=0!=n.immediateRender&&0!=i.immediateRender,new r(e,t,n)},r.staggerTo=r.allTo=function(e,t,o,s,d,u,p){s=s||0;var v,g,f,m,_=0,w=[],y=function(){o.onComplete&&o.onComplete.apply(o.onCompleteScope||this,arguments),d.apply(p||o.callbackScope||this,u||h)},b=o.cycle,x=o.startAt&&o.startAt.cycle;for(c(e)||("string"==typeof e&&(e=i.selector(e)||e),l(e)&&(e=n(e))),e=e||[],0>s&&(e=n(e),e.reverse(),s*=-1),v=e.length-1,f=0;v>=f;f++){g={};for(m in o)g[m]=o[m];if(b&&(a(g,e,f),null!=g.duration&&(t=g.duration,delete g.duration)),x){x=g.startAt={};for(m in o.startAt)x[m]=o.startAt[m];a(g.startAt,e,f)}g.delay=_+(g.delay||0),f===v&&d&&(g.onComplete=y),w[f]=new r(e[f],t,g),_+=s}return w},r.staggerFrom=r.allFrom=function(e,t,i,n,a,o,s){return i.runBackwards=!0,i.immediateRender=0!=i.immediateRender,r.staggerTo(e,t,i,n,a,o,s)},r.staggerFromTo=r.allFromTo=function(e,t,i,n,a,o,s,l){return n.startAt=i,n.immediateRender=0!=n.immediateRender&&0!=i.immediateRender,r.staggerTo(e,t,n,a,o,s,l)},r.delayedCall=function(e,t,i,n,a){return new r(t,0,{delay:e,onComplete:t,onCompleteParams:i,callbackScope:n,onReverseComplete:t,onReverseCompleteParams:i,immediateRender:!1,useFrames:a,overwrite:0})},r.set=function(e,t){return new r(e,0,t)},r.isTweening=function(e){return i.getTweensOf(e,!0).length>0};var u=function(e,t){for(var n=[],a=0,r=e._first;r;)r instanceof i?n[a++]=r:(t&&(n[a++]=r),n=n.concat(u(r,t)),a=n.length),r=r._next;return n},p=r.getAllTweens=function(t){return u(e._rootTimeline,t).concat(u(e._rootFramesTimeline,t))};r.killAll=function(e,i,n,a){null==i&&(i=!0),null==n&&(n=!0);var r,o,s,l=p(0!=a),c=l.length,d=i&&n&&a;for(s=0;c>s;s++)o=l[s],(d||o instanceof t||(r=o.target===o.vars.onComplete)&&n||i&&!r)&&(e?o.totalTime(o._reversed?0:o.totalDuration()):o._enabled(!1,!1))},r.killChildTweensOf=function(e,t){if(null!=e){var a,o,d,h,u,p=s.tweenLookup;if("string"==typeof e&&(e=i.selector(e)||e),l(e)&&(e=n(e)),c(e))for(h=e.length;--h>-1;)r.killChildTweensOf(e[h],t);else{a=[];for(d in p)for(o=p[d].target.parentNode;o;)o===e&&(a=a.concat(p[d].tweens)),o=o.parentNode;for(u=a.length,h=0;u>h;h++)t&&a[h].totalTime(a[h].totalDuration()),a[h]._enabled(!1,!1)}}};var v=function(e,i,n,a){i=i!==!1,n=n!==!1,a=a!==!1;for(var r,o,s=p(a),l=i&&n&&a,c=s.length;--c>-1;)o=s[c],(l||o instanceof t||(r=o.target===o.vars.onComplete)&&n||i&&!r)&&o.paused(e)};return r.pauseAll=function(e,t,i){v(!0,e,t,i)},r.resumeAll=function(e,t,i){v(!1,e,t,i)},r.globalTimeScale=function(t){var n=e._rootTimeline,a=i.ticker.time;return arguments.length?(t=t||o,n._startTime=a-(a-n._startTime)*n._timeScale/t,n=e._rootFramesTimeline,a=i.ticker.frame,n._startTime=a-(a-n._startTime)*n._timeScale/t,n._timeScale=e._rootTimeline._timeScale=t,t):n._timeScale},d.progress=function(e,t){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&0!==(1&this._cycle)?1-e:e)+this._cycle*(this._duration+this._repeatDelay),t):this._time/this.duration()},d.totalProgress=function(e,t){return arguments.length?this.totalTime(this.totalDuration()*e,t):this._totalTime/this.totalDuration()},d.time=function(e,t){return arguments.length?(this._dirty&&this.totalDuration(),e>this._duration&&(e=this._duration),this._yoyo&&0!==(1&this._cycle)?e=this._duration-e+this._cycle*(this._duration+this._repeatDelay):0!==this._repeat&&(e+=this._cycle*(this._duration+this._repeatDelay)),this.totalTime(e,t)):this._time},d.duration=function(t){return arguments.length?e.prototype.duration.call(this,t):this._duration},d.totalDuration=function(e){return arguments.length?-1===this._repeat?this:this.duration((e-this._repeat*this._repeatDelay)/(this._repeat+1)):(this._dirty&&(this._totalDuration=-1===this._repeat?999999999999:this._duration*(this._repeat+1)+this._repeatDelay*this._repeat,this._dirty=!1),this._totalDuration)},d.repeat=function(e){return arguments.length?(this._repeat=e,this._uncache(!0)):this._repeat},d.repeatDelay=function(e){return arguments.length?(this._repeatDelay=e,this._uncache(!0)):this._repeatDelay},d.yoyo=function(e){return arguments.length?(this._yoyo=e,this):this._yoyo},r},!0),_gsScope._gsDefine("TimelineLite",["core.Animation","core.SimpleTimeline","TweenLite"],function(e,t,i){var n=function(e){t.call(this,e),this._labels={},this.autoRemoveChildren=this.vars.autoRemoveChildren===!0,this.smoothChildTiming=this.vars.smoothChildTiming===!0,this._sortChildren=!0,this._onUpdate=this.vars.onUpdate;var i,n,a=this.vars;for(n in a)i=a[n],l(i)&&-1!==i.join("").indexOf("{self}")&&(a[n]=this._swapSelfInParams(i));l(a.tweens)&&this.add(a.tweens,0,a.align,a.stagger)},a=1e-10,r=i._internals,o=n._internals={},s=r.isSelector,l=r.isArray,c=r.lazyTweens,d=r.lazyRender,h=_gsScope._gsDefine.globals,u=function(e){var t,i={};for(t in e)i[t]=e[t];return i},p=function(e,t,i){var n,a,r=e.cycle;for(n in r)a=r[n],e[n]="function"==typeof a?a.call(t[i],i):a[i%a.length];delete e.cycle},v=o.pauseCallback=function(){},g=function(e){var t,i=[],n=e.length;for(t=0;t!==n;i.push(e[t++]));return i},f=n.prototype=new t;return n.version="1.19.0",f.constructor=n,f.kill()._gc=f._forcingPlayhead=f._hasPause=!1,f.to=function(e,t,n,a){var r=n.repeat&&h.TweenMax||i;return t?this.add(new r(e,t,n),a):this.set(e,n,a)},f.from=function(e,t,n,a){return this.add((n.repeat&&h.TweenMax||i).from(e,t,n),a)},f.fromTo=function(e,t,n,a,r){var o=a.repeat&&h.TweenMax||i;return t?this.add(o.fromTo(e,t,n,a),r):this.set(e,a,r)},f.staggerTo=function(e,t,a,r,o,l,c,d){var h,v,f=new n({onComplete:l,onCompleteParams:c,callbackScope:d,smoothChildTiming:this.smoothChildTiming}),m=a.cycle;for("string"==typeof e&&(e=i.selector(e)||e),e=e||[],s(e)&&(e=g(e)),r=r||0,0>r&&(e=g(e),e.reverse(),r*=-1),v=0;v<e.length;v++)h=u(a),h.startAt&&(h.startAt=u(h.startAt),h.startAt.cycle&&p(h.startAt,e,v)),m&&(p(h,e,v),null!=h.duration&&(t=h.duration,delete h.duration)),f.to(e[v],t,h,v*r);return this.add(f,o)},f.staggerFrom=function(e,t,i,n,a,r,o,s){return i.immediateRender=0!=i.immediateRender,i.runBackwards=!0,this.staggerTo(e,t,i,n,a,r,o,s)},f.staggerFromTo=function(e,t,i,n,a,r,o,s,l){return n.startAt=i,n.immediateRender=0!=n.immediateRender&&0!=i.immediateRender,this.staggerTo(e,t,n,a,r,o,s,l)},f.call=function(e,t,n,a){return this.add(i.delayedCall(0,e,t,n),a)},f.set=function(e,t,n){return n=this._parseTimeOrLabel(n,0,!0),null==t.immediateRender&&(t.immediateRender=n===this._time&&!this._paused),this.add(new i(e,0,t),n)},n.exportRoot=function(e,t){e=e||{},null==e.smoothChildTiming&&(e.smoothChildTiming=!0);var a,r,o=new n(e),s=o._timeline;for(null==t&&(t=!0),s._remove(o,!0),o._startTime=0,o._rawPrevTime=o._time=o._totalTime=s._time,a=s._first;a;)r=a._next,t&&a instanceof i&&a.target===a.vars.onComplete||o.add(a,a._startTime-a._delay),a=r;return s.add(o,0),o},f.add=function(a,r,o,s){var c,d,h,u,p,v;if("number"!=typeof r&&(r=this._parseTimeOrLabel(r,0,!0,a)),!(a instanceof e)){if(a instanceof Array||a&&a.push&&l(a)){for(o=o||"normal",s=s||0,c=r,d=a.length,h=0;d>h;h++)l(u=a[h])&&(u=new n({tweens:u})),this.add(u,c),"string"!=typeof u&&"function"!=typeof u&&("sequence"===o?c=u._startTime+u.totalDuration()/u._timeScale:"start"===o&&(u._startTime-=u.delay())),c+=s;return this._uncache(!0)}if("string"==typeof a)return this.addLabel(a,r);if("function"!=typeof a)throw"Cannot add "+a+" into the timeline; it is not a tween, timeline, function, or string.";a=i.delayedCall(0,a)}if(t.prototype.add.call(this,a,r),(this._gc||this._time===this._duration)&&!this._paused&&this._duration<this.duration())for(p=this,v=p.rawTime()>a._startTime;p._timeline;)v&&p._timeline.smoothChildTiming?p.totalTime(p._totalTime,!0):p._gc&&p._enabled(!0,!1),p=p._timeline;return this},f.remove=function(t){if(t instanceof e){this._remove(t,!1);var i=t._timeline=t.vars.useFrames?e._rootFramesTimeline:e._rootTimeline;return t._startTime=(t._paused?t._pauseTime:i._time)-(t._reversed?t.totalDuration()-t._totalTime:t._totalTime)/t._timeScale,this}if(t instanceof Array||t&&t.push&&l(t)){for(var n=t.length;--n>-1;)this.remove(t[n]);return this}return"string"==typeof t?this.removeLabel(t):this.kill(null,t)},f._remove=function(e,i){t.prototype._remove.call(this,e,i);var n=this._last;return n?this._time>n._startTime+n._totalDuration/n._timeScale&&(this._time=this.duration(),this._totalTime=this._totalDuration):this._time=this._totalTime=this._duration=this._totalDuration=0,this},f.append=function(e,t){return this.add(e,this._parseTimeOrLabel(null,t,!0,e))},f.insert=f.insertMultiple=function(e,t,i,n){return this.add(e,t||0,i,n)},f.appendMultiple=function(e,t,i,n){return this.add(e,this._parseTimeOrLabel(null,t,!0,e),i,n)},f.addLabel=function(e,t){return this._labels[e]=this._parseTimeOrLabel(t),this},f.addPause=function(e,t,n,a){var r=i.delayedCall(0,v,n,a||this);return r.vars.onComplete=r.vars.onReverseComplete=t,r.data="isPause",this._hasPause=!0,this.add(r,e)},f.removeLabel=function(e){return delete this._labels[e],this},f.getLabelTime=function(e){return null!=this._labels[e]?this._labels[e]:-1},f._parseTimeOrLabel=function(t,i,n,a){var r;if(a instanceof e&&a.timeline===this)this.remove(a);else if(a&&(a instanceof Array||a.push&&l(a)))for(r=a.length;--r>-1;)a[r]instanceof e&&a[r].timeline===this&&this.remove(a[r]);if("string"==typeof i)return this._parseTimeOrLabel(i,n&&"number"==typeof t&&null==this._labels[i]?t-this.duration():0,n);if(i=i||0,"string"!=typeof t||!isNaN(t)&&null==this._labels[t])null==t&&(t=this.duration());else{if(r=t.indexOf("="),-1===r)return null==this._labels[t]?n?this._labels[t]=this.duration()+i:i:this._labels[t]+i;i=parseInt(t.charAt(r-1)+"1",10)*Number(t.substr(r+1)),t=r>1?this._parseTimeOrLabel(t.substr(0,r-1),0,n):this.duration()}return Number(t)+i},f.seek=function(e,t){return this.totalTime("number"==typeof e?e:this._parseTimeOrLabel(e),t!==!1)},f.stop=function(){return this.paused(!0)},f.gotoAndPlay=function(e,t){return this.play(e,t)},f.gotoAndStop=function(e,t){return this.pause(e,t)},f.render=function(e,t,i){this._gc&&this._enabled(!0,!1);var n,r,o,s,l,h,u,p=this._dirty?this.totalDuration():this._totalDuration,v=this._time,g=this._startTime,f=this._timeScale,m=this._paused;if(e>=p-1e-7)this._totalTime=this._time=p,this._reversed||this._hasPausedChild()||(r=!0,s="onComplete",l=!!this._timeline.autoRemoveChildren,0===this._duration&&(0>=e&&e>=-1e-7||this._rawPrevTime<0||this._rawPrevTime===a)&&this._rawPrevTime!==e&&this._first&&(l=!0,this._rawPrevTime>a&&(s="onReverseComplete"))),this._rawPrevTime=this._duration||!t||e||this._rawPrevTime===e?e:a,e=p+1e-4;else if(1e-7>e)if(this._totalTime=this._time=0,(0!==v||0===this._duration&&this._rawPrevTime!==a&&(this._rawPrevTime>0||0>e&&this._rawPrevTime>=0))&&(s="onReverseComplete",r=this._reversed),0>e)this._active=!1,this._timeline.autoRemoveChildren&&this._reversed?(l=r=!0,s="onReverseComplete"):this._rawPrevTime>=0&&this._first&&(l=!0),this._rawPrevTime=e;else{if(this._rawPrevTime=this._duration||!t||e||this._rawPrevTime===e?e:a,0===e&&r)for(n=this._first;n&&0===n._startTime;)n._duration||(r=!1),n=n._next;e=0,this._initted||(l=!0)}else{if(this._hasPause&&!this._forcingPlayhead&&!t){if(e>=v)for(n=this._first;n&&n._startTime<=e&&!h;)n._duration||"isPause"!==n.data||n.ratio||0===n._startTime&&0===this._rawPrevTime||(h=n),n=n._next;else for(n=this._last;n&&n._startTime>=e&&!h;)n._duration||"isPause"===n.data&&n._rawPrevTime>0&&(h=n),n=n._prev;h&&(this._time=e=h._startTime,this._totalTime=e+this._cycle*(this._totalDuration+this._repeatDelay))}this._totalTime=this._time=this._rawPrevTime=e}if(this._time!==v&&this._first||i||l||h){if(this._initted||(this._initted=!0),this._active||!this._paused&&this._time!==v&&e>0&&(this._active=!0),0===v&&this.vars.onStart&&(0===this._time&&this._duration||t||this._callback("onStart")),u=this._time,u>=v)for(n=this._first;n&&(o=n._next,u===this._time&&(!this._paused||m));)(n._active||n._startTime<=u&&!n._paused&&!n._gc)&&(h===n&&this.pause(),n._reversed?n.render((n._dirty?n.totalDuration():n._totalDuration)-(e-n._startTime)*n._timeScale,t,i):n.render((e-n._startTime)*n._timeScale,t,i)),n=o;else for(n=this._last;n&&(o=n._prev,u===this._time&&(!this._paused||m));){if(n._active||n._startTime<=v&&!n._paused&&!n._gc){if(h===n){for(h=n._prev;h&&h.endTime()>this._time;)h.render(h._reversed?h.totalDuration()-(e-h._startTime)*h._timeScale:(e-h._startTime)*h._timeScale,t,i),h=h._prev;h=null,this.pause()}n._reversed?n.render((n._dirty?n.totalDuration():n._totalDuration)-(e-n._startTime)*n._timeScale,t,i):n.render((e-n._startTime)*n._timeScale,t,i)}n=o}this._onUpdate&&(t||(c.length&&d(),this._callback("onUpdate"))),s&&(this._gc||(g===this._startTime||f!==this._timeScale)&&(0===this._time||p>=this.totalDuration())&&(r&&(c.length&&d(),this._timeline.autoRemoveChildren&&this._enabled(!1,!1),this._active=!1),!t&&this.vars[s]&&this._callback(s)))}},f._hasPausedChild=function(){for(var e=this._first;e;){if(e._paused||e instanceof n&&e._hasPausedChild())return!0;e=e._next}return!1},f.getChildren=function(e,t,n,a){a=a||-9999999999;for(var r=[],o=this._first,s=0;o;)o._startTime<a||(o instanceof i?t!==!1&&(r[s++]=o):(n!==!1&&(r[s++]=o),e!==!1&&(r=r.concat(o.getChildren(!0,t,n)),s=r.length))),o=o._next;return r},f.getTweensOf=function(e,t){var n,a,r=this._gc,o=[],s=0;for(r&&this._enabled(!0,!0),n=i.getTweensOf(e),a=n.length;--a>-1;)(n[a].timeline===this||t&&this._contains(n[a]))&&(o[s++]=n[a]);return r&&this._enabled(!1,!0),o},f.recent=function(){return this._recent},f._contains=function(e){for(var t=e.timeline;t;){if(t===this)return!0;t=t.timeline}return!1},f.shiftChildren=function(e,t,i){i=i||0;for(var n,a=this._first,r=this._labels;a;)a._startTime>=i&&(a._startTime+=e),a=a._next;if(t)for(n in r)r[n]>=i&&(r[n]+=e);return this._uncache(!0)},f._kill=function(e,t){if(!e&&!t)return this._enabled(!1,!1);for(var i=t?this.getTweensOf(t):this.getChildren(!0,!0,!1),n=i.length,a=!1;--n>-1;)i[n]._kill(e,t)&&(a=!0);return a},f.clear=function(e){var t=this.getChildren(!1,!0,!0),i=t.length;for(this._time=this._totalTime=0;--i>-1;)t[i]._enabled(!1,!1);return e!==!1&&(this._labels={}),this._uncache(!0)},f.invalidate=function(){for(var t=this._first;t;)t.invalidate(),t=t._next;return e.prototype.invalidate.call(this)},f._enabled=function(e,i){if(e===this._gc)for(var n=this._first;n;)n._enabled(e,!0),n=n._next;return t.prototype._enabled.call(this,e,i)},f.totalTime=function(){this._forcingPlayhead=!0;var t=e.prototype.totalTime.apply(this,arguments);return this._forcingPlayhead=!1,t},f.duration=function(e){return arguments.length?(0!==this.duration()&&0!==e&&this.timeScale(this._duration/e),this):(this._dirty&&this.totalDuration(),this._duration)},f.totalDuration=function(e){if(!arguments.length){if(this._dirty){for(var t,i,n=0,a=this._last,r=999999999999;a;)t=a._prev,a._dirty&&a.totalDuration(),a._startTime>r&&this._sortChildren&&!a._paused?this.add(a,a._startTime-a._delay):r=a._startTime,a._startTime<0&&!a._paused&&(n-=a._startTime,this._timeline.smoothChildTiming&&(this._startTime+=a._startTime/this._timeScale),this.shiftChildren(-a._startTime,!1,-9999999999),r=0),i=a._startTime+a._totalDuration/a._timeScale,i>n&&(n=i),a=t;this._duration=this._totalDuration=n,this._dirty=!1}return this._totalDuration}return e&&this.totalDuration()?this.timeScale(this._totalDuration/e):this},f.paused=function(t){if(!t)for(var i=this._first,n=this._time;i;)i._startTime===n&&"isPause"===i.data&&(i._rawPrevTime=0),i=i._next;return e.prototype.paused.apply(this,arguments)},f.usesFrames=function(){for(var t=this._timeline;t._timeline;)t=t._timeline;return t===e._rootFramesTimeline},f.rawTime=function(){return this._paused?this._totalTime:(this._timeline.rawTime()-this._startTime)*this._timeScale},n},!0),_gsScope._gsDefine("TimelineMax",["TimelineLite","TweenLite","easing.Ease"],function(e,t,i){var n=function(t){e.call(this,t),this._repeat=this.vars.repeat||0,this._repeatDelay=this.vars.repeatDelay||0,this._cycle=0,this._yoyo=this.vars.yoyo===!0,this._dirty=!0},a=1e-10,r=t._internals,o=r.lazyTweens,s=r.lazyRender,l=_gsScope._gsDefine.globals,c=new i(null,null,1,0),d=n.prototype=new e;return d.constructor=n,d.kill()._gc=!1,n.version="1.19.0",d.invalidate=function(){return this._yoyo=this.vars.yoyo===!0,this._repeat=this.vars.repeat||0,this._repeatDelay=this.vars.repeatDelay||0,this._uncache(!0),e.prototype.invalidate.call(this)},d.addCallback=function(e,i,n,a){return this.add(t.delayedCall(0,e,n,a),i)},d.removeCallback=function(e,t){if(e)if(null==t)this._kill(null,e);else for(var i=this.getTweensOf(e,!1),n=i.length,a=this._parseTimeOrLabel(t);--n>-1;)i[n]._startTime===a&&i[n]._enabled(!1,!1);return this},d.removePause=function(t){return this.removeCallback(e._internals.pauseCallback,t)},d.tweenTo=function(e,i){i=i||{};var n,a,r,o={ease:c,useFrames:this.usesFrames(),immediateRender:!1},s=i.repeat&&l.TweenMax||t;for(a in i)o[a]=i[a];return o.time=this._parseTimeOrLabel(e),n=Math.abs(Number(o.time)-this._time)/this._timeScale||.001,r=new s(this,n,o),o.onStart=function(){r.target.paused(!0),r.vars.time!==r.target.time()&&n===r.duration()&&r.duration(Math.abs(r.vars.time-r.target.time())/r.target._timeScale),i.onStart&&r._callback("onStart")},r},d.tweenFromTo=function(e,t,i){i=i||{},e=this._parseTimeOrLabel(e),i.startAt={onComplete:this.seek,onCompleteParams:[e],callbackScope:this},i.immediateRender=i.immediateRender!==!1;var n=this.tweenTo(t,i);return n.duration(Math.abs(n.vars.time-e)/this._timeScale||.001)},d.render=function(e,t,i){this._gc&&this._enabled(!0,!1);var n,r,l,c,d,h,u,p,v=this._dirty?this.totalDuration():this._totalDuration,g=this._duration,f=this._time,m=this._totalTime,_=this._startTime,w=this._timeScale,y=this._rawPrevTime,b=this._paused,x=this._cycle;if(e>=v-1e-7)this._locked||(this._totalTime=v,this._cycle=this._repeat),this._reversed||this._hasPausedChild()||(r=!0,c="onComplete",d=!!this._timeline.autoRemoveChildren,0===this._duration&&(0>=e&&e>=-1e-7||0>y||y===a)&&y!==e&&this._first&&(d=!0,y>a&&(c="onReverseComplete"))),this._rawPrevTime=this._duration||!t||e||this._rawPrevTime===e?e:a,this._yoyo&&0!==(1&this._cycle)?this._time=e=0:(this._time=g,e=g+1e-4);else if(1e-7>e)if(this._locked||(this._totalTime=this._cycle=0),this._time=0,(0!==f||0===g&&y!==a&&(y>0||0>e&&y>=0)&&!this._locked)&&(c="onReverseComplete",r=this._reversed),0>e)this._active=!1,this._timeline.autoRemoveChildren&&this._reversed?(d=r=!0,c="onReverseComplete"):y>=0&&this._first&&(d=!0),this._rawPrevTime=e;else{if(this._rawPrevTime=g||!t||e||this._rawPrevTime===e?e:a,0===e&&r)for(n=this._first;n&&0===n._startTime;)n._duration||(r=!1),n=n._next;e=0,this._initted||(d=!0)}else if(0===g&&0>y&&(d=!0),this._time=this._rawPrevTime=e,this._locked||(this._totalTime=e,0!==this._repeat&&(h=g+this._repeatDelay,this._cycle=this._totalTime/h>>0,0!==this._cycle&&this._cycle===this._totalTime/h&&e>=m&&this._cycle--,this._time=this._totalTime-this._cycle*h,this._yoyo&&0!==(1&this._cycle)&&(this._time=g-this._time),this._time>g?(this._time=g,e=g+1e-4):this._time<0?this._time=e=0:e=this._time)),this._hasPause&&!this._forcingPlayhead&&!t){if(e=this._time,e>=f)for(n=this._first;n&&n._startTime<=e&&!u;)n._duration||"isPause"!==n.data||n.ratio||0===n._startTime&&0===this._rawPrevTime||(u=n),n=n._next;else for(n=this._last;n&&n._startTime>=e&&!u;)n._duration||"isPause"===n.data&&n._rawPrevTime>0&&(u=n),n=n._prev;u&&(this._time=e=u._startTime,this._totalTime=e+this._cycle*(this._totalDuration+this._repeatDelay))}if(this._cycle!==x&&!this._locked){var S=this._yoyo&&0!==(1&x),T=S===(this._yoyo&&0!==(1&this._cycle)),k=this._totalTime,C=this._cycle,P=this._rawPrevTime,D=this._time;if(this._totalTime=x*g,this._cycle<x?S=!S:this._totalTime+=g,this._time=f,this._rawPrevTime=0===g?y-1e-4:y,this._cycle=x,this._locked=!0,f=S?0:g,this.render(f,t,0===g),t||this._gc||this.vars.onRepeat&&this._callback("onRepeat"),f!==this._time)return;if(T&&(f=S?g+1e-4:-1e-4,this.render(f,!0,!1)),this._locked=!1,this._paused&&!b)return;this._time=D,this._totalTime=k,this._cycle=C,this._rawPrevTime=P}if(!(this._time!==f&&this._first||i||d||u))return void(m!==this._totalTime&&this._onUpdate&&(t||this._callback("onUpdate")));if(this._initted||(this._initted=!0),this._active||!this._paused&&this._totalTime!==m&&e>0&&(this._active=!0),0===m&&this.vars.onStart&&(0===this._totalTime&&this._totalDuration||t||this._callback("onStart")),p=this._time,p>=f)for(n=this._first;n&&(l=n._next,p===this._time&&(!this._paused||b));)(n._active||n._startTime<=this._time&&!n._paused&&!n._gc)&&(u===n&&this.pause(),n._reversed?n.render((n._dirty?n.totalDuration():n._totalDuration)-(e-n._startTime)*n._timeScale,t,i):n.render((e-n._startTime)*n._timeScale,t,i)),n=l;
else for(n=this._last;n&&(l=n._prev,p===this._time&&(!this._paused||b));){if(n._active||n._startTime<=f&&!n._paused&&!n._gc){if(u===n){for(u=n._prev;u&&u.endTime()>this._time;)u.render(u._reversed?u.totalDuration()-(e-u._startTime)*u._timeScale:(e-u._startTime)*u._timeScale,t,i),u=u._prev;u=null,this.pause()}n._reversed?n.render((n._dirty?n.totalDuration():n._totalDuration)-(e-n._startTime)*n._timeScale,t,i):n.render((e-n._startTime)*n._timeScale,t,i)}n=l}this._onUpdate&&(t||(o.length&&s(),this._callback("onUpdate"))),c&&(this._locked||this._gc||(_===this._startTime||w!==this._timeScale)&&(0===this._time||v>=this.totalDuration())&&(r&&(o.length&&s(),this._timeline.autoRemoveChildren&&this._enabled(!1,!1),this._active=!1),!t&&this.vars[c]&&this._callback(c)))},d.getActive=function(e,t,i){null==e&&(e=!0),null==t&&(t=!0),null==i&&(i=!1);var n,a,r=[],o=this.getChildren(e,t,i),s=0,l=o.length;for(n=0;l>n;n++)a=o[n],a.isActive()&&(r[s++]=a);return r},d.getLabelAfter=function(e){e||0!==e&&(e=this._time);var t,i=this.getLabelsArray(),n=i.length;for(t=0;n>t;t++)if(i[t].time>e)return i[t].name;return null},d.getLabelBefore=function(e){null==e&&(e=this._time);for(var t=this.getLabelsArray(),i=t.length;--i>-1;)if(t[i].time<e)return t[i].name;return null},d.getLabelsArray=function(){var e,t=[],i=0;for(e in this._labels)t[i++]={time:this._labels[e],name:e};return t.sort(function(e,t){return e.time-t.time}),t},d.progress=function(e,t){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&0!==(1&this._cycle)?1-e:e)+this._cycle*(this._duration+this._repeatDelay),t):this._time/this.duration()},d.totalProgress=function(e,t){return arguments.length?this.totalTime(this.totalDuration()*e,t):this._totalTime/this.totalDuration()},d.totalDuration=function(t){return arguments.length?-1!==this._repeat&&t?this.timeScale(this.totalDuration()/t):this:(this._dirty&&(e.prototype.totalDuration.call(this),this._totalDuration=-1===this._repeat?999999999999:this._duration*(this._repeat+1)+this._repeatDelay*this._repeat),this._totalDuration)},d.time=function(e,t){return arguments.length?(this._dirty&&this.totalDuration(),e>this._duration&&(e=this._duration),this._yoyo&&0!==(1&this._cycle)?e=this._duration-e+this._cycle*(this._duration+this._repeatDelay):0!==this._repeat&&(e+=this._cycle*(this._duration+this._repeatDelay)),this.totalTime(e,t)):this._time},d.repeat=function(e){return arguments.length?(this._repeat=e,this._uncache(!0)):this._repeat},d.repeatDelay=function(e){return arguments.length?(this._repeatDelay=e,this._uncache(!0)):this._repeatDelay},d.yoyo=function(e){return arguments.length?(this._yoyo=e,this):this._yoyo},d.currentLabel=function(e){return arguments.length?this.seek(e,!0):this.getLabelBefore(this._time+1e-8)},n},!0),function(){var e=180/Math.PI,t=[],i=[],n=[],a={},r=_gsScope._gsDefine.globals,o=function(e,t,i,n){i===n&&(i=n-(n-t)/1e6),e===t&&(t=e+(i-e)/1e6),this.a=e,this.b=t,this.c=i,this.d=n,this.da=n-e,this.ca=i-e,this.ba=t-e},s=",x,y,z,left,top,right,bottom,marginTop,marginLeft,marginRight,marginBottom,paddingLeft,paddingTop,paddingRight,paddingBottom,backgroundPosition,backgroundPosition_y,",l=function(e,t,i,n){var a={a:e},r={},o={},s={c:n},l=(e+t)/2,c=(t+i)/2,d=(i+n)/2,h=(l+c)/2,u=(c+d)/2,p=(u-h)/8;return a.b=l+(e-l)/4,r.b=h+p,a.c=r.a=(a.b+r.b)/2,r.c=o.a=(h+u)/2,o.b=u-p,s.b=d+(n-d)/4,o.c=s.a=(o.b+s.b)/2,[a,r,o,s]},c=function(e,a,r,o,s){var c,d,h,u,p,v,g,f,m,_,w,y,b,x=e.length-1,S=0,T=e[0].a;for(c=0;x>c;c++)p=e[S],d=p.a,h=p.d,u=e[S+1].d,s?(w=t[c],y=i[c],b=(y+w)*a*.25/(o?.5:n[c]||.5),v=h-(h-d)*(o?.5*a:0!==w?b/w:0),g=h+(u-h)*(o?.5*a:0!==y?b/y:0),f=h-(v+((g-v)*(3*w/(w+y)+.5)/4||0))):(v=h-(h-d)*a*.5,g=h+(u-h)*a*.5,f=h-(v+g)/2),v+=f,g+=f,p.c=m=v,p.b=0!==c?T:T=p.a+.6*(p.c-p.a),p.da=h-d,p.ca=m-d,p.ba=T-d,r?(_=l(d,T,m,h),e.splice(S,1,_[0],_[1],_[2],_[3]),S+=4):S++,T=g;p=e[S],p.b=T,p.c=T+.4*(p.d-T),p.da=p.d-p.a,p.ca=p.c-p.a,p.ba=T-p.a,r&&(_=l(p.a,T,p.c,p.d),e.splice(S,1,_[0],_[1],_[2],_[3]))},d=function(e,n,a,r){var s,l,c,d,h,u,p=[];if(r)for(e=[r].concat(e),l=e.length;--l>-1;)"string"==typeof(u=e[l][n])&&"="===u.charAt(1)&&(e[l][n]=r[n]+Number(u.charAt(0)+u.substr(2)));if(s=e.length-2,0>s)return p[0]=new o(e[0][n],0,0,e[-1>s?0:1][n]),p;for(l=0;s>l;l++)c=e[l][n],d=e[l+1][n],p[l]=new o(c,0,0,d),a&&(h=e[l+2][n],t[l]=(t[l]||0)+(d-c)*(d-c),i[l]=(i[l]||0)+(h-d)*(h-d));return p[l]=new o(e[l][n],0,0,e[l+1][n]),p},h=function(e,r,o,l,h,u){var p,v,g,f,m,_,w,y,b={},x=[],S=u||e[0];h="string"==typeof h?","+h+",":s,null==r&&(r=1);for(v in e[0])x.push(v);if(e.length>1){for(y=e[e.length-1],w=!0,p=x.length;--p>-1;)if(v=x[p],Math.abs(S[v]-y[v])>.05){w=!1;break}w&&(e=e.concat(),u&&e.unshift(u),e.push(e[1]),u=e[e.length-3])}for(t.length=i.length=n.length=0,p=x.length;--p>-1;)v=x[p],a[v]=-1!==h.indexOf(","+v+","),b[v]=d(e,v,a[v],u);for(p=t.length;--p>-1;)t[p]=Math.sqrt(t[p]),i[p]=Math.sqrt(i[p]);if(!l){for(p=x.length;--p>-1;)if(a[v])for(g=b[x[p]],_=g.length-1,f=0;_>f;f++)m=g[f+1].da/i[f]+g[f].da/t[f]||0,n[f]=(n[f]||0)+m*m;for(p=n.length;--p>-1;)n[p]=Math.sqrt(n[p])}for(p=x.length,f=o?4:1;--p>-1;)v=x[p],g=b[v],c(g,r,o,l,a[v]),w&&(g.splice(0,f),g.splice(g.length-f,f));return b},u=function(e,t,i){t=t||"soft";var n,a,r,s,l,c,d,h,u,p,v,g={},f="cubic"===t?3:2,m="soft"===t,_=[];if(m&&i&&(e=[i].concat(e)),null==e||e.length<f+1)throw"invalid Bezier data";for(u in e[0])_.push(u);for(c=_.length;--c>-1;){for(u=_[c],g[u]=l=[],p=0,h=e.length,d=0;h>d;d++)n=null==i?e[d][u]:"string"==typeof(v=e[d][u])&&"="===v.charAt(1)?i[u]+Number(v.charAt(0)+v.substr(2)):Number(v),m&&d>1&&h-1>d&&(l[p++]=(n+l[p-2])/2),l[p++]=n;for(h=p-f+1,p=0,d=0;h>d;d+=f)n=l[d],a=l[d+1],r=l[d+2],s=2===f?0:l[d+3],l[p++]=v=3===f?new o(n,a,r,s):new o(n,(2*a+n)/3,(2*a+r)/3,r);l.length=p}return g},p=function(e,t,i){for(var n,a,r,o,s,l,c,d,h,u,p,v=1/i,g=e.length;--g>-1;)for(u=e[g],r=u.a,o=u.d-r,s=u.c-r,l=u.b-r,n=a=0,d=1;i>=d;d++)c=v*d,h=1-c,n=a-(a=(c*c*o+3*h*(c*s+h*l))*c),p=g*i+d-1,t[p]=(t[p]||0)+n*n},v=function(e,t){t=t>>0||6;var i,n,a,r,o=[],s=[],l=0,c=0,d=t-1,h=[],u=[];for(i in e)p(e[i],o,t);for(a=o.length,n=0;a>n;n++)l+=Math.sqrt(o[n]),r=n%t,u[r]=l,r===d&&(c+=l,r=n/t>>0,h[r]=u,s[r]=c,l=0,u=[]);return{length:c,lengths:s,segments:h}},g=_gsScope._gsDefine.plugin({propName:"bezier",priority:-1,version:"1.3.7",API:2,global:!0,init:function(e,t,i){this._target=e,t instanceof Array&&(t={values:t}),this._func={},this._mod={},this._props=[],this._timeRes=null==t.timeResolution?6:parseInt(t.timeResolution,10);var n,a,r,o,s,l=t.values||[],c={},d=l[0],p=t.autoRotate||i.vars.orientToBezier;this._autoRotate=p?p instanceof Array?p:[["x","y","rotation",p===!0?0:Number(p)||0]]:null;for(n in d)this._props.push(n);for(r=this._props.length;--r>-1;)n=this._props[r],this._overwriteProps.push(n),a=this._func[n]="function"==typeof e[n],c[n]=a?e[n.indexOf("set")||"function"!=typeof e["get"+n.substr(3)]?n:"get"+n.substr(3)]():parseFloat(e[n]),s||c[n]!==l[0][n]&&(s=c);if(this._beziers="cubic"!==t.type&&"quadratic"!==t.type&&"soft"!==t.type?h(l,isNaN(t.curviness)?1:t.curviness,!1,"thruBasic"===t.type,t.correlate,s):u(l,t.type,c),this._segCount=this._beziers[n].length,this._timeRes){var g=v(this._beziers,this._timeRes);this._length=g.length,this._lengths=g.lengths,this._segments=g.segments,this._l1=this._li=this._s1=this._si=0,this._l2=this._lengths[0],this._curSeg=this._segments[0],this._s2=this._curSeg[0],this._prec=1/this._curSeg.length}if(p=this._autoRotate)for(this._initialRotations=[],p[0]instanceof Array||(this._autoRotate=p=[p]),r=p.length;--r>-1;){for(o=0;3>o;o++)n=p[r][o],this._func[n]="function"==typeof e[n]?e[n.indexOf("set")||"function"!=typeof e["get"+n.substr(3)]?n:"get"+n.substr(3)]:!1;n=p[r][2],this._initialRotations[r]=(this._func[n]?this._func[n].call(this._target):this._target[n])||0,this._overwriteProps.push(n)}return this._startRatio=i.vars.runBackwards?1:0,!0},set:function(t){var i,n,a,r,o,s,l,c,d,h,u=this._segCount,p=this._func,v=this._target,g=t!==this._startRatio;if(this._timeRes){if(d=this._lengths,h=this._curSeg,t*=this._length,a=this._li,t>this._l2&&u-1>a){for(c=u-1;c>a&&(this._l2=d[++a])<=t;);this._l1=d[a-1],this._li=a,this._curSeg=h=this._segments[a],this._s2=h[this._s1=this._si=0]}else if(t<this._l1&&a>0){for(;a>0&&(this._l1=d[--a])>=t;);0===a&&t<this._l1?this._l1=0:a++,this._l2=d[a],this._li=a,this._curSeg=h=this._segments[a],this._s1=h[(this._si=h.length-1)-1]||0,this._s2=h[this._si]}if(i=a,t-=this._l1,a=this._si,t>this._s2&&a<h.length-1){for(c=h.length-1;c>a&&(this._s2=h[++a])<=t;);this._s1=h[a-1],this._si=a}else if(t<this._s1&&a>0){for(;a>0&&(this._s1=h[--a])>=t;);0===a&&t<this._s1?this._s1=0:a++,this._s2=h[a],this._si=a}s=(a+(t-this._s1)/(this._s2-this._s1))*this._prec||0}else i=0>t?0:t>=1?u-1:u*t>>0,s=(t-i*(1/u))*u;for(n=1-s,a=this._props.length;--a>-1;)r=this._props[a],o=this._beziers[r][i],l=(s*s*o.da+3*n*(s*o.ca+n*o.ba))*s+o.a,this._mod[r]&&(l=this._mod[r](l,v)),p[r]?v[r](l):v[r]=l;if(this._autoRotate){var f,m,_,w,y,b,x,S=this._autoRotate;for(a=S.length;--a>-1;)r=S[a][2],b=S[a][3]||0,x=S[a][4]===!0?1:e,o=this._beziers[S[a][0]],f=this._beziers[S[a][1]],o&&f&&(o=o[i],f=f[i],m=o.a+(o.b-o.a)*s,w=o.b+(o.c-o.b)*s,m+=(w-m)*s,w+=(o.c+(o.d-o.c)*s-w)*s,_=f.a+(f.b-f.a)*s,y=f.b+(f.c-f.b)*s,_+=(y-_)*s,y+=(f.c+(f.d-f.c)*s-y)*s,l=g?Math.atan2(y-_,w-m)*x+b:this._initialRotations[a],this._mod[r]&&(l=this._mod[r](l,v)),p[r]?v[r](l):v[r]=l)}}}),f=g.prototype;g.bezierThrough=h,g.cubicToQuadratic=l,g._autoCSS=!0,g.quadraticToCubic=function(e,t,i){return new o(e,(2*t+e)/3,(2*t+i)/3,i)},g._cssRegister=function(){var e=r.CSSPlugin;if(e){var t=e._internals,i=t._parseToProxy,n=t._setPluginRatio,a=t.CSSPropTween;t._registerComplexSpecialProp("bezier",{parser:function(e,t,r,o,s,l){t instanceof Array&&(t={values:t}),l=new g;var c,d,h,u=t.values,p=u.length-1,v=[],f={};if(0>p)return s;for(c=0;p>=c;c++)h=i(e,u[c],o,s,l,p!==c),v[c]=h.end;for(d in t)f[d]=t[d];return f.values=v,s=new a(e,"bezier",0,0,h.pt,2),s.data=h,s.plugin=l,s.setRatio=n,0===f.autoRotate&&(f.autoRotate=!0),!f.autoRotate||f.autoRotate instanceof Array||(c=f.autoRotate===!0?0:Number(f.autoRotate),f.autoRotate=null!=h.end.left?[["left","top","rotation",c,!1]]:null!=h.end.x?[["x","y","rotation",c,!1]]:!1),f.autoRotate&&(o._transform||o._enableTransforms(!1),h.autoRotate=o._target._gsTransform,h.proxy.rotation=h.autoRotate.rotation||0,o._overwriteProps.push("rotation")),l._onInitTween(h.proxy,f,o._tween),s}})}},f._mod=function(e){for(var t,i=this._overwriteProps,n=i.length;--n>-1;)t=e[i[n]],t&&"function"==typeof t&&(this._mod[i[n]]=t)},f._kill=function(e){var t,i,n=this._props;for(t in this._beziers)if(t in e)for(delete this._beziers[t],delete this._func[t],i=n.length;--i>-1;)n[i]===t&&n.splice(i,1);if(n=this._autoRotate)for(i=n.length;--i>-1;)e[n[i][2]]&&n.splice(i,1);return this._super._kill.call(this,e)}}(),_gsScope._gsDefine("plugins.CSSPlugin",["plugins.TweenPlugin","TweenLite"],function(e,t){var i,n,a,r,o=function(){e.call(this,"css"),this._overwriteProps.length=0,this.setRatio=o.prototype.setRatio},s=_gsScope._gsDefine.globals,l={},c=o.prototype=new e("css");c.constructor=o,o.version="1.19.0",o.API=2,o.defaultTransformPerspective=0,o.defaultSkewType="compensated",o.defaultSmoothOrigin=!0,c="px",o.suffixMap={top:c,right:c,bottom:c,left:c,width:c,height:c,fontSize:c,padding:c,margin:c,perspective:c,lineHeight:""};var d,h,u,p,v,g,f,m,_=/(?:\-|\.|\b)(\d|\.|e\-)+/g,w=/(?:\d|\-\d|\.\d|\-\.\d|\+=\d|\-=\d|\+=.\d|\-=\.\d)+/g,y=/(?:\+=|\-=|\-|\b)[\d\-\.]+[a-zA-Z0-9]*(?:%|\b)/gi,b=/(?![+-]?\d*\.?\d+|[+-]|e[+-]\d+)[^0-9]/g,x=/(?:\d|\-|\+|=|#|\.)*/g,S=/opacity *= *([^)]*)/i,T=/opacity:([^;]*)/i,k=/alpha\(opacity *=.+?\)/i,C=/^(rgb|hsl)/,P=/([A-Z])/g,D=/-([a-z])/gi,$=/(^(?:url\(\"|url\())|(?:(\"\))$|\)$)/gi,E=function(e,t){return t.toUpperCase()},O=/(?:Left|Right|Width)/i,I=/(M11|M12|M21|M22)=[\d\-\.e]+/gi,A=/progid\:DXImageTransform\.Microsoft\.Matrix\(.+?\)/i,N=/,(?=[^\)]*(?:\(|$))/gi,R=/[\s,\(]/i,M=Math.PI/180,z=180/Math.PI,L={},F=document,B=function(e){return F.createElementNS?F.createElementNS("http://www.w3.org/1999/xhtml",e):F.createElement(e)},W=B("div"),U=B("img"),j=o._internals={_specialProps:l},V=navigator.userAgent,H=function(){var e=V.indexOf("Android"),t=B("a");return u=-1!==V.indexOf("Safari")&&-1===V.indexOf("Chrome")&&(-1===e||Number(V.substr(e+8,1))>3),v=u&&Number(V.substr(V.indexOf("Version/")+8,1))<6,p=-1!==V.indexOf("Firefox"),(/MSIE ([0-9]{1,}[\.0-9]{0,})/.exec(V)||/Trident\/.*rv:([0-9]{1,}[\.0-9]{0,})/.exec(V))&&(g=parseFloat(RegExp.$1)),t?(t.style.cssText="top:1px;opacity:.55;",/^0.55/.test(t.style.opacity)):!1}(),Y=function(e){return S.test("string"==typeof e?e:(e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?parseFloat(RegExp.$1)/100:1},X=function(e){window.console&&console.log(e)},q="",G="",Q=function(e,t){t=t||W;var i,n,a=t.style;if(void 0!==a[e])return e;for(e=e.charAt(0).toUpperCase()+e.substr(1),i=["O","Moz","ms","Ms","Webkit"],n=5;--n>-1&&void 0===a[i[n]+e];);return n>=0?(G=3===n?"ms":i[n],q="-"+G.toLowerCase()+"-",G+e):null},J=F.defaultView?F.defaultView.getComputedStyle:function(){},K=o.getStyle=function(e,t,i,n,a){var r;return H||"opacity"!==t?(!n&&e.style[t]?r=e.style[t]:(i=i||J(e))?r=i[t]||i.getPropertyValue(t)||i.getPropertyValue(t.replace(P,"-$1").toLowerCase()):e.currentStyle&&(r=e.currentStyle[t]),null==a||r&&"none"!==r&&"auto"!==r&&"auto auto"!==r?r:a):Y(e)},Z=j.convertToPixels=function(e,i,n,a,r){if("px"===a||!a)return n;if("auto"===a||!n)return 0;var s,l,c,d=O.test(i),h=e,u=W.style,p=0>n,v=1===n;if(p&&(n=-n),v&&(n*=100),"%"===a&&-1!==i.indexOf("border"))s=n/100*(d?e.clientWidth:e.clientHeight);else{if(u.cssText="border:0 solid red;position:"+K(e,"position")+";line-height:0;","%"!==a&&h.appendChild&&"v"!==a.charAt(0)&&"rem"!==a)u[d?"borderLeftWidth":"borderTopWidth"]=n+a;else{if(h=e.parentNode||F.body,l=h._gsCache,c=t.ticker.frame,l&&d&&l.time===c)return l.width*n/100;u[d?"width":"height"]=n+a}h.appendChild(W),s=parseFloat(W[d?"offsetWidth":"offsetHeight"]),h.removeChild(W),d&&"%"===a&&o.cacheWidths!==!1&&(l=h._gsCache=h._gsCache||{},l.time=c,l.width=s/n*100),0!==s||r||(s=Z(e,i,n,a,!0))}return v&&(s/=100),p?-s:s},et=j.calculateOffset=function(e,t,i){if("absolute"!==K(e,"position",i))return 0;var n="left"===t?"Left":"Top",a=K(e,"margin"+n,i);return e["offset"+n]-(Z(e,t,parseFloat(a),a.replace(x,""))||0)},tt=function(e,t){var i,n,a,r={};if(t=t||J(e,null))if(i=t.length)for(;--i>-1;)a=t[i],(-1===a.indexOf("-transform")||Dt===a)&&(r[a.replace(D,E)]=t.getPropertyValue(a));else for(i in t)(-1===i.indexOf("Transform")||Pt===i)&&(r[i]=t[i]);else if(t=e.currentStyle||e.style)for(i in t)"string"==typeof i&&void 0===r[i]&&(r[i.replace(D,E)]=t[i]);return H||(r.opacity=Y(e)),n=Wt(e,t,!1),r.rotation=n.rotation,r.skewX=n.skewX,r.scaleX=n.scaleX,r.scaleY=n.scaleY,r.x=n.x,r.y=n.y,Et&&(r.z=n.z,r.rotationX=n.rotationX,r.rotationY=n.rotationY,r.scaleZ=n.scaleZ),r.filters&&delete r.filters,r},it=function(e,t,i,n,a){var r,o,s,l={},c=e.style;for(o in i)"cssText"!==o&&"length"!==o&&isNaN(o)&&(t[o]!==(r=i[o])||a&&a[o])&&-1===o.indexOf("Origin")&&("number"==typeof r||"string"==typeof r)&&(l[o]="auto"!==r||"left"!==o&&"top"!==o?""!==r&&"auto"!==r&&"none"!==r||"string"!=typeof t[o]||""===t[o].replace(b,"")?r:0:et(e,o),void 0!==c[o]&&(s=new mt(c,o,c[o],s)));if(n)for(o in n)"className"!==o&&(l[o]=n[o]);return{difs:l,firstMPT:s}},nt={width:["Left","Right"],height:["Top","Bottom"]},at=["marginLeft","marginRight","marginTop","marginBottom"],rt=function(e,t,i){if("svg"===(e.nodeName+"").toLowerCase())return(i||J(e))[t]||0;if(e.getBBox&&Lt(e))return e.getBBox()[t]||0;var n=parseFloat("width"===t?e.offsetWidth:e.offsetHeight),a=nt[t],r=a.length;for(i=i||J(e,null);--r>-1;)n-=parseFloat(K(e,"padding"+a[r],i,!0))||0,n-=parseFloat(K(e,"border"+a[r]+"Width",i,!0))||0;return n},ot=function(e,t){if("contain"===e||"auto"===e||"auto auto"===e)return e+" ";(null==e||""===e)&&(e="0 0");var i,n=e.split(" "),a=-1!==e.indexOf("left")?"0%":-1!==e.indexOf("right")?"100%":n[0],r=-1!==e.indexOf("top")?"0%":-1!==e.indexOf("bottom")?"100%":n[1];if(n.length>3&&!t){for(n=e.split(", ").join(",").split(","),e=[],i=0;i<n.length;i++)e.push(ot(n[i]));return e.join(",")}return null==r?r="center"===a?"50%":"0":"center"===r&&(r="50%"),("center"===a||isNaN(parseFloat(a))&&-1===(a+"").indexOf("="))&&(a="50%"),e=a+" "+r+(n.length>2?" "+n[2]:""),t&&(t.oxp=-1!==a.indexOf("%"),t.oyp=-1!==r.indexOf("%"),t.oxr="="===a.charAt(1),t.oyr="="===r.charAt(1),t.ox=parseFloat(a.replace(b,"")),t.oy=parseFloat(r.replace(b,"")),t.v=e),t||e},st=function(e,t){return"function"==typeof e&&(e=e(m,f)),"string"==typeof e&&"="===e.charAt(1)?parseInt(e.charAt(0)+"1",10)*parseFloat(e.substr(2)):parseFloat(e)-parseFloat(t)||0},lt=function(e,t){return"function"==typeof e&&(e=e(m,f)),null==e?t:"string"==typeof e&&"="===e.charAt(1)?parseInt(e.charAt(0)+"1",10)*parseFloat(e.substr(2))+t:parseFloat(e)||0},ct=function(e,t,i,n){var a,r,o,s,l,c=1e-6;return"function"==typeof e&&(e=e(m,f)),null==e?s=t:"number"==typeof e?s=e:(a=360,r=e.split("_"),l="="===e.charAt(1),o=(l?parseInt(e.charAt(0)+"1",10)*parseFloat(r[0].substr(2)):parseFloat(r[0]))*(-1===e.indexOf("rad")?1:z)-(l?0:t),r.length&&(n&&(n[i]=t+o),-1!==e.indexOf("short")&&(o%=a,o!==o%(a/2)&&(o=0>o?o+a:o-a)),-1!==e.indexOf("_cw")&&0>o?o=(o+9999999999*a)%a-(o/a|0)*a:-1!==e.indexOf("ccw")&&o>0&&(o=(o-9999999999*a)%a-(o/a|0)*a)),s=t+o),c>s&&s>-c&&(s=0),s},dt={aqua:[0,255,255],lime:[0,255,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,255],navy:[0,0,128],white:[255,255,255],fuchsia:[255,0,255],olive:[128,128,0],yellow:[255,255,0],orange:[255,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[255,0,0],pink:[255,192,203],cyan:[0,255,255],transparent:[255,255,255,0]},ht=function(e,t,i){return e=0>e?e+1:e>1?e-1:e,255*(1>6*e?t+(i-t)*e*6:.5>e?i:2>3*e?t+(i-t)*(2/3-e)*6:t)+.5|0},ut=o.parseColor=function(e,t){var i,n,a,r,o,s,l,c,d,h,u;if(e)if("number"==typeof e)i=[e>>16,e>>8&255,255&e];else{if(","===e.charAt(e.length-1)&&(e=e.substr(0,e.length-1)),dt[e])i=dt[e];else if("#"===e.charAt(0))4===e.length&&(n=e.charAt(1),a=e.charAt(2),r=e.charAt(3),e="#"+n+n+a+a+r+r),e=parseInt(e.substr(1),16),i=[e>>16,e>>8&255,255&e];else if("hsl"===e.substr(0,3))if(i=u=e.match(_),t){if(-1!==e.indexOf("="))return e.match(w)}else o=Number(i[0])%360/360,s=Number(i[1])/100,l=Number(i[2])/100,a=.5>=l?l*(s+1):l+s-l*s,n=2*l-a,i.length>3&&(i[3]=Number(e[3])),i[0]=ht(o+1/3,n,a),i[1]=ht(o,n,a),i[2]=ht(o-1/3,n,a);else i=e.match(_)||dt.transparent;i[0]=Number(i[0]),i[1]=Number(i[1]),i[2]=Number(i[2]),i.length>3&&(i[3]=Number(i[3]))}else i=dt.black;return t&&!u&&(n=i[0]/255,a=i[1]/255,r=i[2]/255,c=Math.max(n,a,r),d=Math.min(n,a,r),l=(c+d)/2,c===d?o=s=0:(h=c-d,s=l>.5?h/(2-c-d):h/(c+d),o=c===n?(a-r)/h+(r>a?6:0):c===a?(r-n)/h+2:(n-a)/h+4,o*=60),i[0]=o+.5|0,i[1]=100*s+.5|0,i[2]=100*l+.5|0),i},pt=function(e,t){var i,n,a,r=e.match(vt)||[],o=0,s=r.length?"":e;for(i=0;i<r.length;i++)n=r[i],a=e.substr(o,e.indexOf(n,o)-o),o+=a.length+n.length,n=ut(n,t),3===n.length&&n.push(1),s+=a+(t?"hsla("+n[0]+","+n[1]+"%,"+n[2]+"%,"+n[3]:"rgba("+n.join(","))+")";return s+e.substr(o)},vt="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3}){1,2}\\b";for(c in dt)vt+="|"+c+"\\b";vt=new RegExp(vt+")","gi"),o.colorStringFilter=function(e){var t,i=e[0]+e[1];vt.test(i)&&(t=-1!==i.indexOf("hsl(")||-1!==i.indexOf("hsla("),e[0]=pt(e[0],t),e[1]=pt(e[1],t)),vt.lastIndex=0},t.defaultStringFilter||(t.defaultStringFilter=o.colorStringFilter);var gt=function(e,t,i,n){if(null==e)return function(e){return e};var a,r=t?(e.match(vt)||[""])[0]:"",o=e.split(r).join("").match(y)||[],s=e.substr(0,e.indexOf(o[0])),l=")"===e.charAt(e.length-1)?")":"",c=-1!==e.indexOf(" ")?" ":",",d=o.length,h=d>0?o[0].replace(_,""):"";return d?a=t?function(e){var t,u,p,v;if("number"==typeof e)e+=h;else if(n&&N.test(e)){for(v=e.replace(N,"|").split("|"),p=0;p<v.length;p++)v[p]=a(v[p]);return v.join(",")}if(t=(e.match(vt)||[r])[0],u=e.split(t).join("").match(y)||[],p=u.length,d>p--)for(;++p<d;)u[p]=i?u[(p-1)/2|0]:o[p];return s+u.join(c)+c+t+l+(-1!==e.indexOf("inset")?" inset":"")}:function(e){var t,r,u;if("number"==typeof e)e+=h;else if(n&&N.test(e)){for(r=e.replace(N,"|").split("|"),u=0;u<r.length;u++)r[u]=a(r[u]);return r.join(",")}if(t=e.match(y)||[],u=t.length,d>u--)for(;++u<d;)t[u]=i?t[(u-1)/2|0]:o[u];return s+t.join(c)+l}:function(e){return e}},ft=function(e){return e=e.split(","),function(t,i,n,a,r,o,s){var l,c=(i+"").split(" ");for(s={},l=0;4>l;l++)s[e[l]]=c[l]=c[l]||c[(l-1)/2>>0];return a.parse(t,s,r,o)}},mt=(j._setPluginRatio=function(e){this.plugin.setRatio(e);for(var t,i,n,a,r,o=this.data,s=o.proxy,l=o.firstMPT,c=1e-6;l;)t=s[l.v],l.r?t=Math.round(t):c>t&&t>-c&&(t=0),l.t[l.p]=t,l=l._next;if(o.autoRotate&&(o.autoRotate.rotation=o.mod?o.mod(s.rotation,this.t):s.rotation),1===e||0===e)for(l=o.firstMPT,r=1===e?"e":"b";l;){if(i=l.t,i.type){if(1===i.type){for(a=i.xs0+i.s+i.xs1,n=1;n<i.l;n++)a+=i["xn"+n]+i["xs"+(n+1)];i[r]=a}}else i[r]=i.s+i.xs0;l=l._next}},function(e,t,i,n,a){this.t=e,this.p=t,this.v=i,this.r=a,n&&(n._prev=this,this._next=n)}),_t=(j._parseToProxy=function(e,t,i,n,a,r){var o,s,l,c,d,h=n,u={},p={},v=i._transform,g=L;for(i._transform=null,L=t,n=d=i.parse(e,t,n,a),L=g,r&&(i._transform=v,h&&(h._prev=null,h._prev&&(h._prev._next=null)));n&&n!==h;){if(n.type<=1&&(s=n.p,p[s]=n.s+n.c,u[s]=n.s,r||(c=new mt(n,"s",s,c,n.r),n.c=0),1===n.type))for(o=n.l;--o>0;)l="xn"+o,s=n.p+"_"+l,p[s]=n.data[l],u[s]=n[l],r||(c=new mt(n,l,s,c,n.rxp[l]));n=n._next}return{proxy:u,end:p,firstMPT:c,pt:d}},j.CSSPropTween=function(e,t,n,a,o,s,l,c,d,h,u){this.t=e,this.p=t,this.s=n,this.c=a,this.n=l||t,e instanceof _t||r.push(this.n),this.r=c,this.type=s||0,d&&(this.pr=d,i=!0),this.b=void 0===h?n:h,this.e=void 0===u?n+a:u,o&&(this._next=o,o._prev=this)}),wt=function(e,t,i,n,a,r){var o=new _t(e,t,i,n-i,a,-1,r);return o.b=i,o.e=o.xs0=n,o},yt=o.parseComplex=function(e,t,i,n,a,r,s,l,c,h){i=i||r||"","function"==typeof n&&(n=n(m,f)),s=new _t(e,t,0,0,s,h?2:1,null,!1,l,i,n),n+="",a&&vt.test(n+i)&&(n=[i,n],o.colorStringFilter(n),i=n[0],n=n[1]);var u,p,v,g,y,b,x,S,T,k,C,P,D,$=i.split(", ").join(",").split(" "),E=n.split(", ").join(",").split(" "),O=$.length,I=d!==!1;for((-1!==n.indexOf(",")||-1!==i.indexOf(","))&&($=$.join(" ").replace(N,", ").split(" "),E=E.join(" ").replace(N,", ").split(" "),O=$.length),O!==E.length&&($=(r||"").split(" "),O=$.length),s.plugin=c,s.setRatio=h,vt.lastIndex=0,u=0;O>u;u++)if(g=$[u],y=E[u],S=parseFloat(g),S||0===S)s.appendXtra("",S,st(y,S),y.replace(w,""),I&&-1!==y.indexOf("px"),!0);else if(a&&vt.test(g))P=y.indexOf(")")+1,P=")"+(P?y.substr(P):""),D=-1!==y.indexOf("hsl")&&H,g=ut(g,D),y=ut(y,D),T=g.length+y.length>6,T&&!H&&0===y[3]?(s["xs"+s.l]+=s.l?" transparent":"transparent",s.e=s.e.split(E[u]).join("transparent")):(H||(T=!1),D?s.appendXtra(T?"hsla(":"hsl(",g[0],st(y[0],g[0]),",",!1,!0).appendXtra("",g[1],st(y[1],g[1]),"%,",!1).appendXtra("",g[2],st(y[2],g[2]),T?"%,":"%"+P,!1):s.appendXtra(T?"rgba(":"rgb(",g[0],y[0]-g[0],",",!0,!0).appendXtra("",g[1],y[1]-g[1],",",!0).appendXtra("",g[2],y[2]-g[2],T?",":P,!0),T&&(g=g.length<4?1:g[3],s.appendXtra("",g,(y.length<4?1:y[3])-g,P,!1))),vt.lastIndex=0;else if(b=g.match(_)){if(x=y.match(w),!x||x.length!==b.length)return s;for(v=0,p=0;p<b.length;p++)C=b[p],k=g.indexOf(C,v),s.appendXtra(g.substr(v,k-v),Number(C),st(x[p],C),"",I&&"px"===g.substr(k+C.length,2),0===p),v=k+C.length;s["xs"+s.l]+=g.substr(v)}else s["xs"+s.l]+=s.l||s["xs"+s.l]?" "+y:y;if(-1!==n.indexOf("=")&&s.data){for(P=s.xs0+s.data.s,u=1;u<s.l;u++)P+=s["xs"+u]+s.data["xn"+u];s.e=P+s["xs"+u]}return s.l||(s.type=-1,s.xs0=s.e),s.xfirst||s},bt=9;for(c=_t.prototype,c.l=c.pr=0;--bt>0;)c["xn"+bt]=0,c["xs"+bt]="";c.xs0="",c._next=c._prev=c.xfirst=c.data=c.plugin=c.setRatio=c.rxp=null,c.appendXtra=function(e,t,i,n,a,r){var o=this,s=o.l;return o["xs"+s]+=r&&(s||o["xs"+s])?" "+e:e||"",i||0===s||o.plugin?(o.l++,o.type=o.setRatio?2:1,o["xs"+o.l]=n||"",s>0?(o.data["xn"+s]=t+i,o.rxp["xn"+s]=a,o["xn"+s]=t,o.plugin||(o.xfirst=new _t(o,"xn"+s,t,i,o.xfirst||o,0,o.n,a,o.pr),o.xfirst.xs0=0),o):(o.data={s:t+i},o.rxp={},o.s=t,o.c=i,o.r=a,o)):(o["xs"+s]+=t+(n||""),o)};var xt=function(e,t){t=t||{},this.p=t.prefix?Q(e)||e:e,l[e]=l[this.p]=this,this.format=t.formatter||gt(t.defaultValue,t.color,t.collapsible,t.multi),t.parser&&(this.parse=t.parser),this.clrs=t.color,this.multi=t.multi,this.keyword=t.keyword,this.dflt=t.defaultValue,this.pr=t.priority||0},St=j._registerComplexSpecialProp=function(e,t,i){"object"!=typeof t&&(t={parser:i});var n,a,r=e.split(","),o=t.defaultValue;for(i=i||[o],n=0;n<r.length;n++)t.prefix=0===n&&t.prefix,t.defaultValue=i[n]||o,a=new xt(r[n],t)},Tt=j._registerPluginProp=function(e){if(!l[e]){var t=e.charAt(0).toUpperCase()+e.substr(1)+"Plugin";St(e,{parser:function(e,i,n,a,r,o,c){var d=s.com.greensock.plugins[t];return d?(d._cssRegister(),l[n].parse(e,i,n,a,r,o,c)):(X("Error: "+t+" js file not loaded."),r)}})}};c=xt.prototype,c.parseComplex=function(e,t,i,n,a,r){var o,s,l,c,d,h,u=this.keyword;if(this.multi&&(N.test(i)||N.test(t)?(s=t.replace(N,"|").split("|"),l=i.replace(N,"|").split("|")):u&&(s=[t],l=[i])),l){for(c=l.length>s.length?l.length:s.length,o=0;c>o;o++)t=s[o]=s[o]||this.dflt,i=l[o]=l[o]||this.dflt,u&&(d=t.indexOf(u),h=i.indexOf(u),d!==h&&(-1===h?s[o]=s[o].split(u).join(""):-1===d&&(s[o]+=" "+u)));t=s.join(", "),i=l.join(", ")}return yt(e,this.p,t,i,this.clrs,this.dflt,n,this.pr,a,r)},c.parse=function(e,t,i,n,r,o){return this.parseComplex(e.style,this.format(K(e,this.p,a,!1,this.dflt)),this.format(t),r,o)},o.registerSpecialProp=function(e,t,i){St(e,{parser:function(e,n,a,r,o,s){var l=new _t(e,a,0,0,o,2,a,!1,i);return l.plugin=s,l.setRatio=t(e,n,r._tween,a),l},priority:i})},o.useSVGTransformAttr=u||p;var kt,Ct="scaleX,scaleY,scaleZ,x,y,z,skewX,skewY,rotation,rotationX,rotationY,perspective,xPercent,yPercent".split(","),Pt=Q("transform"),Dt=q+"transform",$t=Q("transformOrigin"),Et=null!==Q("perspective"),Ot=j.Transform=function(){this.perspective=parseFloat(o.defaultTransformPerspective)||0,this.force3D=o.defaultForce3D!==!1&&Et?o.defaultForce3D||"auto":!1},It=window.SVGElement,At=function(e,t,i){var n,a=F.createElementNS("http://www.w3.org/2000/svg",e),r=/([a-z])([A-Z])/g;for(n in i)a.setAttributeNS(null,n.replace(r,"$1-$2").toLowerCase(),i[n]);return t.appendChild(a),a},Nt=F.documentElement,Rt=function(){var e,t,i,n=g||/Android/i.test(V)&&!window.chrome;return F.createElementNS&&!n&&(e=At("svg",Nt),t=At("rect",e,{width:100,height:50,x:100}),i=t.getBoundingClientRect().width,t.style[$t]="50% 50%",t.style[Pt]="scaleX(0.5)",n=i===t.getBoundingClientRect().width&&!(p&&Et),Nt.removeChild(e)),n}(),Mt=function(e,t,i,n,a,r){var s,l,c,d,h,u,p,v,g,f,m,_,w,y,b=e._gsTransform,x=Bt(e,!0);b&&(w=b.xOrigin,y=b.yOrigin),(!n||(s=n.split(" ")).length<2)&&(p=e.getBBox(),t=ot(t).split(" "),s=[(-1!==t[0].indexOf("%")?parseFloat(t[0])/100*p.width:parseFloat(t[0]))+p.x,(-1!==t[1].indexOf("%")?parseFloat(t[1])/100*p.height:parseFloat(t[1]))+p.y]),i.xOrigin=d=parseFloat(s[0]),i.yOrigin=h=parseFloat(s[1]),n&&x!==Ft&&(u=x[0],p=x[1],v=x[2],g=x[3],f=x[4],m=x[5],_=u*g-p*v,l=d*(g/_)+h*(-v/_)+(v*m-g*f)/_,c=d*(-p/_)+h*(u/_)-(u*m-p*f)/_,d=i.xOrigin=s[0]=l,h=i.yOrigin=s[1]=c),b&&(r&&(i.xOffset=b.xOffset,i.yOffset=b.yOffset,b=i),a||a!==!1&&o.defaultSmoothOrigin!==!1?(l=d-w,c=h-y,b.xOffset+=l*x[0]+c*x[2]-l,b.yOffset+=l*x[1]+c*x[3]-c):b.xOffset=b.yOffset=0),r||e.setAttribute("data-svg-origin",s.join(" "))},zt=function(e){try{return e.getBBox()}catch(e){}},Lt=function(e){return!!(It&&e.getBBox&&e.getCTM&&zt(e)&&(!e.parentNode||e.parentNode.getBBox&&e.parentNode.getCTM))},Ft=[1,0,0,1,0,0],Bt=function(e,t){var i,n,a,r,o,s,l=e._gsTransform||new Ot,c=1e5,d=e.style;if(Pt?n=K(e,Dt,null,!0):e.currentStyle&&(n=e.currentStyle.filter.match(I),n=n&&4===n.length?[n[0].substr(4),Number(n[2].substr(4)),Number(n[1].substr(4)),n[3].substr(4),l.x||0,l.y||0].join(","):""),i=!n||"none"===n||"matrix(1, 0, 0, 1, 0, 0)"===n,i&&Pt&&((s="none"===J(e).display)||!e.parentNode)&&(s&&(r=d.display,d.display="block"),e.parentNode||(o=1,Nt.appendChild(e)),n=K(e,Dt,null,!0),i=!n||"none"===n||"matrix(1, 0, 0, 1, 0, 0)"===n,r?d.display=r:s&&Ht(d,"display"),o&&Nt.removeChild(e)),(l.svg||e.getBBox&&Lt(e))&&(i&&-1!==(d[Pt]+"").indexOf("matrix")&&(n=d[Pt],i=0),a=e.getAttribute("transform"),i&&a&&(-1!==a.indexOf("matrix")?(n=a,i=0):-1!==a.indexOf("translate")&&(n="matrix(1,0,0,1,"+a.match(/(?:\-|\b)[\d\-\.e]+\b/gi).join(",")+")",i=0))),i)return Ft;for(a=(n||"").match(_)||[],bt=a.length;--bt>-1;)r=Number(a[bt]),a[bt]=(o=r-(r|=0))?(o*c+(0>o?-.5:.5)|0)/c+r:r;return t&&a.length>6?[a[0],a[1],a[4],a[5],a[12],a[13]]:a},Wt=j.getTransform=function(e,i,n,a){if(e._gsTransform&&n&&!a)return e._gsTransform;var r,s,l,c,d,h,u=n?e._gsTransform||new Ot:new Ot,p=u.scaleX<0,v=2e-5,g=1e5,f=Et?parseFloat(K(e,$t,i,!1,"0 0 0").split(" ")[2])||u.zOrigin||0:0,m=parseFloat(o.defaultTransformPerspective)||0;if(u.svg=!(!e.getBBox||!Lt(e)),u.svg&&(Mt(e,K(e,$t,i,!1,"50% 50%")+"",u,e.getAttribute("data-svg-origin")),kt=o.useSVGTransformAttr||Rt),r=Bt(e),r!==Ft){if(16===r.length){var _,w,y,b,x,S=r[0],T=r[1],k=r[2],C=r[3],P=r[4],D=r[5],$=r[6],E=r[7],O=r[8],I=r[9],A=r[10],N=r[12],R=r[13],M=r[14],L=r[11],F=Math.atan2($,A);u.zOrigin&&(M=-u.zOrigin,N=O*M-r[12],R=I*M-r[13],M=A*M+u.zOrigin-r[14]),u.rotationX=F*z,F&&(b=Math.cos(-F),x=Math.sin(-F),_=P*b+O*x,w=D*b+I*x,y=$*b+A*x,O=P*-x+O*b,I=D*-x+I*b,A=$*-x+A*b,L=E*-x+L*b,P=_,D=w,$=y),F=Math.atan2(-k,A),u.rotationY=F*z,F&&(b=Math.cos(-F),x=Math.sin(-F),_=S*b-O*x,w=T*b-I*x,y=k*b-A*x,I=T*x+I*b,A=k*x+A*b,L=C*x+L*b,S=_,T=w,k=y),F=Math.atan2(T,S),u.rotation=F*z,F&&(b=Math.cos(-F),x=Math.sin(-F),S=S*b+P*x,w=T*b+D*x,D=T*-x+D*b,$=k*-x+$*b,T=w),u.rotationX&&Math.abs(u.rotationX)+Math.abs(u.rotation)>359.9&&(u.rotationX=u.rotation=0,u.rotationY=180-u.rotationY),u.scaleX=(Math.sqrt(S*S+T*T)*g+.5|0)/g,u.scaleY=(Math.sqrt(D*D+I*I)*g+.5|0)/g,u.scaleZ=(Math.sqrt($*$+A*A)*g+.5|0)/g,u.rotationX||u.rotationY?u.skewX=0:(u.skewX=P||D?Math.atan2(P,D)*z+u.rotation:u.skewX||0,Math.abs(u.skewX)>90&&Math.abs(u.skewX)<270&&(p?(u.scaleX*=-1,u.skewX+=u.rotation<=0?180:-180,u.rotation+=u.rotation<=0?180:-180):(u.scaleY*=-1,u.skewX+=u.skewX<=0?180:-180))),u.perspective=L?1/(0>L?-L:L):0,u.x=N,u.y=R,u.z=M,u.svg&&(u.x-=u.xOrigin-(u.xOrigin*S-u.yOrigin*P),u.y-=u.yOrigin-(u.yOrigin*T-u.xOrigin*D))}else if(!Et||a||!r.length||u.x!==r[4]||u.y!==r[5]||!u.rotationX&&!u.rotationY){var B=r.length>=6,W=B?r[0]:1,U=r[1]||0,j=r[2]||0,V=B?r[3]:1;u.x=r[4]||0,u.y=r[5]||0,l=Math.sqrt(W*W+U*U),c=Math.sqrt(V*V+j*j),d=W||U?Math.atan2(U,W)*z:u.rotation||0,h=j||V?Math.atan2(j,V)*z+d:u.skewX||0,Math.abs(h)>90&&Math.abs(h)<270&&(p?(l*=-1,h+=0>=d?180:-180,d+=0>=d?180:-180):(c*=-1,h+=0>=h?180:-180)),u.scaleX=l,u.scaleY=c,u.rotation=d,u.skewX=h,Et&&(u.rotationX=u.rotationY=u.z=0,u.perspective=m,u.scaleZ=1),u.svg&&(u.x-=u.xOrigin-(u.xOrigin*W+u.yOrigin*j),u.y-=u.yOrigin-(u.xOrigin*U+u.yOrigin*V))}u.zOrigin=f;for(s in u)u[s]<v&&u[s]>-v&&(u[s]=0)}return n&&(e._gsTransform=u,u.svg&&(kt&&e.style[Pt]?t.delayedCall(.001,function(){Ht(e.style,Pt)}):!kt&&e.getAttribute("transform")&&t.delayedCall(.001,function(){e.removeAttribute("transform")}))),u},Ut=function(e){var t,i,n=this.data,a=-n.rotation*M,r=a+n.skewX*M,o=1e5,s=(Math.cos(a)*n.scaleX*o|0)/o,l=(Math.sin(a)*n.scaleX*o|0)/o,c=(Math.sin(r)*-n.scaleY*o|0)/o,d=(Math.cos(r)*n.scaleY*o|0)/o,h=this.t.style,u=this.t.currentStyle;if(u){i=l,l=-c,c=-i,t=u.filter,h.filter="";var p,v,f=this.t.offsetWidth,m=this.t.offsetHeight,_="absolute"!==u.position,w="progid:DXImageTransform.Microsoft.Matrix(M11="+s+", M12="+l+", M21="+c+", M22="+d,y=n.x+f*n.xPercent/100,b=n.y+m*n.yPercent/100;if(null!=n.ox&&(p=(n.oxp?f*n.ox*.01:n.ox)-f/2,v=(n.oyp?m*n.oy*.01:n.oy)-m/2,y+=p-(p*s+v*l),b+=v-(p*c+v*d)),_?(p=f/2,v=m/2,w+=", Dx="+(p-(p*s+v*l)+y)+", Dy="+(v-(p*c+v*d)+b)+")"):w+=", sizingMethod='auto expand')",h.filter=-1!==t.indexOf("DXImageTransform.Microsoft.Matrix(")?t.replace(A,w):w+" "+t,(0===e||1===e)&&1===s&&0===l&&0===c&&1===d&&(_&&-1===w.indexOf("Dx=0, Dy=0")||S.test(t)&&100!==parseFloat(RegExp.$1)||-1===t.indexOf("gradient("&&t.indexOf("Alpha"))&&h.removeAttribute("filter")),!_){var T,k,C,P=8>g?1:-1;
for(p=n.ieOffsetX||0,v=n.ieOffsetY||0,n.ieOffsetX=Math.round((f-((0>s?-s:s)*f+(0>l?-l:l)*m))/2+y),n.ieOffsetY=Math.round((m-((0>d?-d:d)*m+(0>c?-c:c)*f))/2+b),bt=0;4>bt;bt++)k=at[bt],T=u[k],i=-1!==T.indexOf("px")?parseFloat(T):Z(this.t,k,parseFloat(T),T.replace(x,""))||0,C=i!==n[k]?2>bt?-n.ieOffsetX:-n.ieOffsetY:2>bt?p-n.ieOffsetX:v-n.ieOffsetY,h[k]=(n[k]=Math.round(i-C*(0===bt||2===bt?1:P)))+"px"}}},jt=j.set3DTransformRatio=j.setTransformRatio=function(e){var t,i,n,a,r,o,s,l,c,d,h,u,v,g,f,m,_,w,y,b,x,S,T,k=this.data,C=this.t.style,P=k.rotation,D=k.rotationX,$=k.rotationY,E=k.scaleX,O=k.scaleY,I=k.scaleZ,A=k.x,N=k.y,R=k.z,z=k.svg,L=k.perspective,F=k.force3D;if(!(((1!==e&&0!==e||"auto"!==F||this.tween._totalTime!==this.tween._totalDuration&&this.tween._totalTime)&&F||R||L||$||D||1!==I)&&(!kt||!z)&&Et))return void(P||k.skewX||z?(P*=M,S=k.skewX*M,T=1e5,t=Math.cos(P)*E,a=Math.sin(P)*E,i=Math.sin(P-S)*-O,r=Math.cos(P-S)*O,S&&"simple"===k.skewType&&(_=Math.tan(S-k.skewY*M),_=Math.sqrt(1+_*_),i*=_,r*=_,k.skewY&&(_=Math.tan(k.skewY*M),_=Math.sqrt(1+_*_),t*=_,a*=_)),z&&(A+=k.xOrigin-(k.xOrigin*t+k.yOrigin*i)+k.xOffset,N+=k.yOrigin-(k.xOrigin*a+k.yOrigin*r)+k.yOffset,kt&&(k.xPercent||k.yPercent)&&(g=this.t.getBBox(),A+=.01*k.xPercent*g.width,N+=.01*k.yPercent*g.height),g=1e-6,g>A&&A>-g&&(A=0),g>N&&N>-g&&(N=0)),y=(t*T|0)/T+","+(a*T|0)/T+","+(i*T|0)/T+","+(r*T|0)/T+","+A+","+N+")",z&&kt?this.t.setAttribute("transform","matrix("+y):C[Pt]=(k.xPercent||k.yPercent?"translate("+k.xPercent+"%,"+k.yPercent+"%) matrix(":"matrix(")+y):C[Pt]=(k.xPercent||k.yPercent?"translate("+k.xPercent+"%,"+k.yPercent+"%) matrix(":"matrix(")+E+",0,0,"+O+","+A+","+N+")");if(p&&(g=1e-4,g>E&&E>-g&&(E=I=2e-5),g>O&&O>-g&&(O=I=2e-5),!L||k.z||k.rotationX||k.rotationY||(L=0)),P||k.skewX)P*=M,f=t=Math.cos(P),m=a=Math.sin(P),k.skewX&&(P-=k.skewX*M,f=Math.cos(P),m=Math.sin(P),"simple"===k.skewType&&(_=Math.tan((k.skewX-k.skewY)*M),_=Math.sqrt(1+_*_),f*=_,m*=_,k.skewY&&(_=Math.tan(k.skewY*M),_=Math.sqrt(1+_*_),t*=_,a*=_))),i=-m,r=f;else{if(!($||D||1!==I||L||z))return void(C[Pt]=(k.xPercent||k.yPercent?"translate("+k.xPercent+"%,"+k.yPercent+"%) translate3d(":"translate3d(")+A+"px,"+N+"px,"+R+"px)"+(1!==E||1!==O?" scale("+E+","+O+")":""));t=r=1,i=a=0}c=1,n=o=s=l=d=h=0,u=L?-1/L:0,v=k.zOrigin,g=1e-6,b=",",x="0",P=$*M,P&&(f=Math.cos(P),m=Math.sin(P),s=-m,d=u*-m,n=t*m,o=a*m,c=f,u*=f,t*=f,a*=f),P=D*M,P&&(f=Math.cos(P),m=Math.sin(P),_=i*f+n*m,w=r*f+o*m,l=c*m,h=u*m,n=i*-m+n*f,o=r*-m+o*f,c*=f,u*=f,i=_,r=w),1!==I&&(n*=I,o*=I,c*=I,u*=I),1!==O&&(i*=O,r*=O,l*=O,h*=O),1!==E&&(t*=E,a*=E,s*=E,d*=E),(v||z)&&(v&&(A+=n*-v,N+=o*-v,R+=c*-v+v),z&&(A+=k.xOrigin-(k.xOrigin*t+k.yOrigin*i)+k.xOffset,N+=k.yOrigin-(k.xOrigin*a+k.yOrigin*r)+k.yOffset),g>A&&A>-g&&(A=x),g>N&&N>-g&&(N=x),g>R&&R>-g&&(R=0)),y=k.xPercent||k.yPercent?"translate("+k.xPercent+"%,"+k.yPercent+"%) matrix3d(":"matrix3d(",y+=(g>t&&t>-g?x:t)+b+(g>a&&a>-g?x:a)+b+(g>s&&s>-g?x:s),y+=b+(g>d&&d>-g?x:d)+b+(g>i&&i>-g?x:i)+b+(g>r&&r>-g?x:r),D||$||1!==I?(y+=b+(g>l&&l>-g?x:l)+b+(g>h&&h>-g?x:h)+b+(g>n&&n>-g?x:n),y+=b+(g>o&&o>-g?x:o)+b+(g>c&&c>-g?x:c)+b+(g>u&&u>-g?x:u)+b):y+=",0,0,0,0,1,0,",y+=A+b+N+b+R+b+(L?1+-R/L:1)+")",C[Pt]=y};c=Ot.prototype,c.x=c.y=c.z=c.skewX=c.skewY=c.rotation=c.rotationX=c.rotationY=c.zOrigin=c.xPercent=c.yPercent=c.xOffset=c.yOffset=0,c.scaleX=c.scaleY=c.scaleZ=1,St("transform,scale,scaleX,scaleY,scaleZ,x,y,z,rotation,rotationX,rotationY,rotationZ,skewX,skewY,shortRotation,shortRotationX,shortRotationY,shortRotationZ,transformOrigin,svgOrigin,transformPerspective,directionalRotation,parseTransform,force3D,skewType,xPercent,yPercent,smoothOrigin",{parser:function(e,t,i,n,r,s,l){if(n._lastParsedTransform===l)return r;n._lastParsedTransform=l;var c;"function"==typeof l[i]&&(c=l[i],l[i]=t);var d,h,u,p,v,g,_,w,y,b=e._gsTransform,x=e.style,S=1e-6,T=Ct.length,k=l,C={},P="transformOrigin",D=Wt(e,a,!0,k.parseTransform),$=k.transform&&("function"==typeof k.transform?k.transform(m,f):k.transform);if(n._transform=D,$&&"string"==typeof $&&Pt)h=W.style,h[Pt]=$,h.display="block",h.position="absolute",F.body.appendChild(W),d=Wt(W,null,!1),D.svg&&(g=D.xOrigin,_=D.yOrigin,d.x-=D.xOffset,d.y-=D.yOffset,(k.transformOrigin||k.svgOrigin)&&($={},Mt(e,ot(k.transformOrigin),$,k.svgOrigin,k.smoothOrigin,!0),g=$.xOrigin,_=$.yOrigin,d.x-=$.xOffset-D.xOffset,d.y-=$.yOffset-D.yOffset),(g||_)&&(w=Bt(W,!0),d.x-=g-(g*w[0]+_*w[2]),d.y-=_-(g*w[1]+_*w[3]))),F.body.removeChild(W),d.perspective||(d.perspective=D.perspective),null!=k.xPercent&&(d.xPercent=lt(k.xPercent,D.xPercent)),null!=k.yPercent&&(d.yPercent=lt(k.yPercent,D.yPercent));else if("object"==typeof k){if(d={scaleX:lt(null!=k.scaleX?k.scaleX:k.scale,D.scaleX),scaleY:lt(null!=k.scaleY?k.scaleY:k.scale,D.scaleY),scaleZ:lt(k.scaleZ,D.scaleZ),x:lt(k.x,D.x),y:lt(k.y,D.y),z:lt(k.z,D.z),xPercent:lt(k.xPercent,D.xPercent),yPercent:lt(k.yPercent,D.yPercent),perspective:lt(k.transformPerspective,D.perspective)},v=k.directionalRotation,null!=v)if("object"==typeof v)for(h in v)k[h]=v[h];else k.rotation=v;"string"==typeof k.x&&-1!==k.x.indexOf("%")&&(d.x=0,d.xPercent=lt(k.x,D.xPercent)),"string"==typeof k.y&&-1!==k.y.indexOf("%")&&(d.y=0,d.yPercent=lt(k.y,D.yPercent)),d.rotation=ct("rotation"in k?k.rotation:"shortRotation"in k?k.shortRotation+"_short":"rotationZ"in k?k.rotationZ:D.rotation-D.skewY,D.rotation-D.skewY,"rotation",C),Et&&(d.rotationX=ct("rotationX"in k?k.rotationX:"shortRotationX"in k?k.shortRotationX+"_short":D.rotationX||0,D.rotationX,"rotationX",C),d.rotationY=ct("rotationY"in k?k.rotationY:"shortRotationY"in k?k.shortRotationY+"_short":D.rotationY||0,D.rotationY,"rotationY",C)),d.skewX=ct(k.skewX,D.skewX-D.skewY),(d.skewY=ct(k.skewY,D.skewY))&&(d.skewX+=d.skewY,d.rotation+=d.skewY)}for(Et&&null!=k.force3D&&(D.force3D=k.force3D,p=!0),D.skewType=k.skewType||D.skewType||o.defaultSkewType,u=D.force3D||D.z||D.rotationX||D.rotationY||d.z||d.rotationX||d.rotationY||d.perspective,u||null==k.scale||(d.scaleZ=1);--T>-1;)y=Ct[T],$=d[y]-D[y],($>S||-S>$||null!=k[y]||null!=L[y])&&(p=!0,r=new _t(D,y,D[y],$,r),y in C&&(r.e=C[y]),r.xs0=0,r.plugin=s,n._overwriteProps.push(r.n));return $=k.transformOrigin,D.svg&&($||k.svgOrigin)&&(g=D.xOffset,_=D.yOffset,Mt(e,ot($),d,k.svgOrigin,k.smoothOrigin),r=wt(D,"xOrigin",(b?D:d).xOrigin,d.xOrigin,r,P),r=wt(D,"yOrigin",(b?D:d).yOrigin,d.yOrigin,r,P),(g!==D.xOffset||_!==D.yOffset)&&(r=wt(D,"xOffset",b?g:D.xOffset,D.xOffset,r,P),r=wt(D,"yOffset",b?_:D.yOffset,D.yOffset,r,P)),$=kt?null:"0px 0px"),($||Et&&u&&D.zOrigin)&&(Pt?(p=!0,y=$t,$=($||K(e,y,a,!1,"50% 50%"))+"",r=new _t(x,y,0,0,r,-1,P),r.b=x[y],r.plugin=s,Et?(h=D.zOrigin,$=$.split(" "),D.zOrigin=($.length>2&&(0===h||"0px"!==$[2])?parseFloat($[2]):h)||0,r.xs0=r.e=$[0]+" "+($[1]||"50%")+" 0px",r=new _t(D,"zOrigin",0,0,r,-1,r.n),r.b=h,r.xs0=r.e=D.zOrigin):r.xs0=r.e=$):ot($+"",D)),p&&(n._transformType=D.svg&&kt||!u&&3!==this._transformType?2:3),c&&(l[i]=c),r},prefix:!0}),St("boxShadow",{defaultValue:"0px 0px 0px 0px #999",prefix:!0,color:!0,multi:!0,keyword:"inset"}),St("borderRadius",{defaultValue:"0px",parser:function(e,t,i,r,o){t=this.format(t);var s,l,c,d,h,u,p,v,g,f,m,_,w,y,b,x,S=["borderTopLeftRadius","borderTopRightRadius","borderBottomRightRadius","borderBottomLeftRadius"],T=e.style;for(g=parseFloat(e.offsetWidth),f=parseFloat(e.offsetHeight),s=t.split(" "),l=0;l<S.length;l++)this.p.indexOf("border")&&(S[l]=Q(S[l])),h=d=K(e,S[l],a,!1,"0px"),-1!==h.indexOf(" ")&&(d=h.split(" "),h=d[0],d=d[1]),u=c=s[l],p=parseFloat(h),_=h.substr((p+"").length),w="="===u.charAt(1),w?(v=parseInt(u.charAt(0)+"1",10),u=u.substr(2),v*=parseFloat(u),m=u.substr((v+"").length-(0>v?1:0))||""):(v=parseFloat(u),m=u.substr((v+"").length)),""===m&&(m=n[i]||_),m!==_&&(y=Z(e,"borderLeft",p,_),b=Z(e,"borderTop",p,_),"%"===m?(h=y/g*100+"%",d=b/f*100+"%"):"em"===m?(x=Z(e,"borderLeft",1,"em"),h=y/x+"em",d=b/x+"em"):(h=y+"px",d=b+"px"),w&&(u=parseFloat(h)+v+m,c=parseFloat(d)+v+m)),o=yt(T,S[l],h+" "+d,u+" "+c,!1,"0px",o);return o},prefix:!0,formatter:gt("0px 0px 0px 0px",!1,!0)}),St("borderBottomLeftRadius,borderBottomRightRadius,borderTopLeftRadius,borderTopRightRadius",{defaultValue:"0px",parser:function(e,t,i,n,r){return yt(e.style,i,this.format(K(e,i,a,!1,"0px 0px")),this.format(t),!1,"0px",r)},prefix:!0,formatter:gt("0px 0px",!1,!0)}),St("backgroundPosition",{defaultValue:"0 0",parser:function(e,t,i,n,r,o){var s,l,c,d,h,u,p="background-position",v=a||J(e,null),f=this.format((v?g?v.getPropertyValue(p+"-x")+" "+v.getPropertyValue(p+"-y"):v.getPropertyValue(p):e.currentStyle.backgroundPositionX+" "+e.currentStyle.backgroundPositionY)||"0 0"),m=this.format(t);if(-1!==f.indexOf("%")!=(-1!==m.indexOf("%"))&&m.split(",").length<2&&(u=K(e,"backgroundImage").replace($,""),u&&"none"!==u)){for(s=f.split(" "),l=m.split(" "),U.setAttribute("src",u),c=2;--c>-1;)f=s[c],d=-1!==f.indexOf("%"),d!==(-1!==l[c].indexOf("%"))&&(h=0===c?e.offsetWidth-U.width:e.offsetHeight-U.height,s[c]=d?parseFloat(f)/100*h+"px":parseFloat(f)/h*100+"%");f=s.join(" ")}return this.parseComplex(e.style,f,m,r,o)},formatter:ot}),St("backgroundSize",{defaultValue:"0 0",formatter:function(e){return e+="",ot(-1===e.indexOf(" ")?e+" "+e:e)}}),St("perspective",{defaultValue:"0px",prefix:!0}),St("perspectiveOrigin",{defaultValue:"50% 50%",prefix:!0}),St("transformStyle",{prefix:!0}),St("backfaceVisibility",{prefix:!0}),St("userSelect",{prefix:!0}),St("margin",{parser:ft("marginTop,marginRight,marginBottom,marginLeft")}),St("padding",{parser:ft("paddingTop,paddingRight,paddingBottom,paddingLeft")}),St("clip",{defaultValue:"rect(0px,0px,0px,0px)",parser:function(e,t,i,n,r,o){var s,l,c;return 9>g?(l=e.currentStyle,c=8>g?" ":",",s="rect("+l.clipTop+c+l.clipRight+c+l.clipBottom+c+l.clipLeft+")",t=this.format(t).split(",").join(c)):(s=this.format(K(e,this.p,a,!1,this.dflt)),t=this.format(t)),this.parseComplex(e.style,s,t,r,o)}}),St("textShadow",{defaultValue:"0px 0px 0px #999",color:!0,multi:!0}),St("autoRound,strictUnits",{parser:function(e,t,i,n,a){return a}}),St("border",{defaultValue:"0px solid #000",parser:function(e,t,i,n,r,o){var s=K(e,"borderTopWidth",a,!1,"0px"),l=this.format(t).split(" "),c=l[0].replace(x,"");return"px"!==c&&(s=parseFloat(s)/Z(e,"borderTopWidth",1,c)+c),this.parseComplex(e.style,this.format(s+" "+K(e,"borderTopStyle",a,!1,"solid")+" "+K(e,"borderTopColor",a,!1,"#000")),l.join(" "),r,o)},color:!0,formatter:function(e){var t=e.split(" ");return t[0]+" "+(t[1]||"solid")+" "+(e.match(vt)||["#000"])[0]}}),St("borderWidth",{parser:ft("borderTopWidth,borderRightWidth,borderBottomWidth,borderLeftWidth")}),St("float,cssFloat,styleFloat",{parser:function(e,t,i,n,a){var r=e.style,o="cssFloat"in r?"cssFloat":"styleFloat";return new _t(r,o,0,0,a,-1,i,!1,0,r[o],t)}});var Vt=function(e){var t,i=this.t,n=i.filter||K(this.data,"filter")||"",a=this.s+this.c*e|0;100===a&&(-1===n.indexOf("atrix(")&&-1===n.indexOf("radient(")&&-1===n.indexOf("oader(")?(i.removeAttribute("filter"),t=!K(this.data,"filter")):(i.filter=n.replace(k,""),t=!0)),t||(this.xn1&&(i.filter=n=n||"alpha(opacity="+a+")"),-1===n.indexOf("pacity")?0===a&&this.xn1||(i.filter=n+" alpha(opacity="+a+")"):i.filter=n.replace(S,"opacity="+a))};St("opacity,alpha,autoAlpha",{defaultValue:"1",parser:function(e,t,i,n,r,o){var s=parseFloat(K(e,"opacity",a,!1,"1")),l=e.style,c="autoAlpha"===i;return"string"==typeof t&&"="===t.charAt(1)&&(t=("-"===t.charAt(0)?-1:1)*parseFloat(t.substr(2))+s),c&&1===s&&"hidden"===K(e,"visibility",a)&&0!==t&&(s=0),H?r=new _t(l,"opacity",s,t-s,r):(r=new _t(l,"opacity",100*s,100*(t-s),r),r.xn1=c?1:0,l.zoom=1,r.type=2,r.b="alpha(opacity="+r.s+")",r.e="alpha(opacity="+(r.s+r.c)+")",r.data=e,r.plugin=o,r.setRatio=Vt),c&&(r=new _t(l,"visibility",0,0,r,-1,null,!1,0,0!==s?"inherit":"hidden",0===t?"hidden":"inherit"),r.xs0="inherit",n._overwriteProps.push(r.n),n._overwriteProps.push(i)),r}});var Ht=function(e,t){t&&(e.removeProperty?(("ms"===t.substr(0,2)||"webkit"===t.substr(0,6))&&(t="-"+t),e.removeProperty(t.replace(P,"-$1").toLowerCase())):e.removeAttribute(t))},Yt=function(e){if(this.t._gsClassPT=this,1===e||0===e){this.t.setAttribute("class",0===e?this.b:this.e);for(var t=this.data,i=this.t.style;t;)t.v?i[t.p]=t.v:Ht(i,t.p),t=t._next;1===e&&this.t._gsClassPT===this&&(this.t._gsClassPT=null)}else this.t.getAttribute("class")!==this.e&&this.t.setAttribute("class",this.e)};St("className",{parser:function(e,t,n,r,o,s,l){var c,d,h,u,p,v=e.getAttribute("class")||"",g=e.style.cssText;if(o=r._classNamePT=new _t(e,n,0,0,o,2),o.setRatio=Yt,o.pr=-11,i=!0,o.b=v,d=tt(e,a),h=e._gsClassPT){for(u={},p=h.data;p;)u[p.p]=1,p=p._next;h.setRatio(1)}return e._gsClassPT=o,o.e="="!==t.charAt(1)?t:v.replace(new RegExp("(?:\\s|^)"+t.substr(2)+"(?![\\w-])"),"")+("+"===t.charAt(0)?" "+t.substr(2):""),e.setAttribute("class",o.e),c=it(e,d,tt(e),l,u),e.setAttribute("class",v),o.data=c.firstMPT,e.style.cssText=g,o=o.xfirst=r.parse(e,c.difs,o,s)}});var Xt=function(e){if((1===e||0===e)&&this.data._totalTime===this.data._totalDuration&&"isFromStart"!==this.data.data){var t,i,n,a,r,o=this.t.style,s=l.transform.parse;if("all"===this.e)o.cssText="",a=!0;else for(t=this.e.split(" ").join("").split(","),n=t.length;--n>-1;)i=t[n],l[i]&&(l[i].parse===s?a=!0:i="transformOrigin"===i?$t:l[i].p),Ht(o,i);a&&(Ht(o,Pt),r=this.t._gsTransform,r&&(r.svg&&(this.t.removeAttribute("data-svg-origin"),this.t.removeAttribute("transform")),delete this.t._gsTransform))}};for(St("clearProps",{parser:function(e,t,n,a,r){return r=new _t(e,n,0,0,r,2),r.setRatio=Xt,r.e=t,r.pr=-10,r.data=a._tween,i=!0,r}}),c="bezier,throwProps,physicsProps,physics2D".split(","),bt=c.length;bt--;)Tt(c[bt]);c=o.prototype,c._firstPT=c._lastParsedTransform=c._transform=null,c._onInitTween=function(e,t,s,c){if(!e.nodeType)return!1;this._target=f=e,this._tween=s,this._vars=t,m=c,d=t.autoRound,i=!1,n=t.suffixMap||o.suffixMap,a=J(e,""),r=this._overwriteProps;var p,g,_,w,y,b,x,S,k,C=e.style;if(h&&""===C.zIndex&&(p=K(e,"zIndex",a),("auto"===p||""===p)&&this._addLazySet(C,"zIndex",0)),"string"==typeof t&&(w=C.cssText,p=tt(e,a),C.cssText=w+";"+t,p=it(e,p,tt(e)).difs,!H&&T.test(t)&&(p.opacity=parseFloat(RegExp.$1)),t=p,C.cssText=w),this._firstPT=g=t.className?l.className.parse(e,t.className,"className",this,null,null,t):this.parse(e,t,null),this._transformType){for(k=3===this._transformType,Pt?u&&(h=!0,""===C.zIndex&&(x=K(e,"zIndex",a),("auto"===x||""===x)&&this._addLazySet(C,"zIndex",0)),v&&this._addLazySet(C,"WebkitBackfaceVisibility",this._vars.WebkitBackfaceVisibility||(k?"visible":"hidden"))):C.zoom=1,_=g;_&&_._next;)_=_._next;S=new _t(e,"transform",0,0,null,2),this._linkCSSP(S,null,_),S.setRatio=Pt?jt:Ut,S.data=this._transform||Wt(e,a,!0),S.tween=s,S.pr=-1,r.pop()}if(i){for(;g;){for(b=g._next,_=w;_&&_.pr>g.pr;)_=_._next;(g._prev=_?_._prev:y)?g._prev._next=g:w=g,(g._next=_)?_._prev=g:y=g,g=b}this._firstPT=w}return!0},c.parse=function(e,t,i,r){var o,s,c,h,u,p,v,g,_,w,y=e.style;for(o in t)p=t[o],"function"==typeof p&&(p=p(m,f)),s=l[o],s?i=s.parse(e,p,o,this,i,r,t):(u=K(e,o,a)+"",_="string"==typeof p,"color"===o||"fill"===o||"stroke"===o||-1!==o.indexOf("Color")||_&&C.test(p)?(_||(p=ut(p),p=(p.length>3?"rgba(":"rgb(")+p.join(",")+")"),i=yt(y,o,u,p,!0,"transparent",i,0,r)):_&&R.test(p)?i=yt(y,o,u,p,!0,null,i,0,r):(c=parseFloat(u),v=c||0===c?u.substr((c+"").length):"",(""===u||"auto"===u)&&("width"===o||"height"===o?(c=rt(e,o,a),v="px"):"left"===o||"top"===o?(c=et(e,o,a),v="px"):(c="opacity"!==o?0:1,v="")),w=_&&"="===p.charAt(1),w?(h=parseInt(p.charAt(0)+"1",10),p=p.substr(2),h*=parseFloat(p),g=p.replace(x,"")):(h=parseFloat(p),g=_?p.replace(x,""):""),""===g&&(g=o in n?n[o]:v),p=h||0===h?(w?h+c:h)+g:t[o],v!==g&&""!==g&&(h||0===h)&&c&&(c=Z(e,o,c,v),"%"===g?(c/=Z(e,o,100,"%")/100,t.strictUnits!==!0&&(u=c+"%")):"em"===g||"rem"===g||"vw"===g||"vh"===g?c/=Z(e,o,1,g):"px"!==g&&(h=Z(e,o,h,g),g="px"),w&&(h||0===h)&&(p=h+c+g)),w&&(h+=c),!c&&0!==c||!h&&0!==h?void 0!==y[o]&&(p||p+""!="NaN"&&null!=p)?(i=new _t(y,o,h||c||0,0,i,-1,o,!1,0,u,p),i.xs0="none"!==p||"display"!==o&&-1===o.indexOf("Style")?p:u):X("invalid "+o+" tween value: "+t[o]):(i=new _t(y,o,c,h-c,i,0,o,d!==!1&&("px"===g||"zIndex"===o),0,u,p),i.xs0=g))),r&&i&&!i.plugin&&(i.plugin=r);return i},c.setRatio=function(e){var t,i,n,a=this._firstPT,r=1e-6;if(1!==e||this._tween._time!==this._tween._duration&&0!==this._tween._time)if(e||this._tween._time!==this._tween._duration&&0!==this._tween._time||this._tween._rawPrevTime===-1e-6)for(;a;){if(t=a.c*e+a.s,a.r?t=Math.round(t):r>t&&t>-r&&(t=0),a.type)if(1===a.type)if(n=a.l,2===n)a.t[a.p]=a.xs0+t+a.xs1+a.xn1+a.xs2;else if(3===n)a.t[a.p]=a.xs0+t+a.xs1+a.xn1+a.xs2+a.xn2+a.xs3;else if(4===n)a.t[a.p]=a.xs0+t+a.xs1+a.xn1+a.xs2+a.xn2+a.xs3+a.xn3+a.xs4;else if(5===n)a.t[a.p]=a.xs0+t+a.xs1+a.xn1+a.xs2+a.xn2+a.xs3+a.xn3+a.xs4+a.xn4+a.xs5;else{for(i=a.xs0+t+a.xs1,n=1;n<a.l;n++)i+=a["xn"+n]+a["xs"+(n+1)];a.t[a.p]=i}else-1===a.type?a.t[a.p]=a.xs0:a.setRatio&&a.setRatio(e);else a.t[a.p]=t+a.xs0;a=a._next}else for(;a;)2!==a.type?a.t[a.p]=a.b:a.setRatio(e),a=a._next;else for(;a;){if(2!==a.type)if(a.r&&-1!==a.type)if(t=Math.round(a.s+a.c),a.type){if(1===a.type){for(n=a.l,i=a.xs0+t+a.xs1,n=1;n<a.l;n++)i+=a["xn"+n]+a["xs"+(n+1)];a.t[a.p]=i}}else a.t[a.p]=t+a.xs0;else a.t[a.p]=a.e;else a.setRatio(e);a=a._next}},c._enableTransforms=function(e){this._transform=this._transform||Wt(this._target,a,!0),this._transformType=this._transform.svg&&kt||!e&&3!==this._transformType?2:3};var qt=function(){this.t[this.p]=this.e,this.data._linkCSSP(this,this._next,null,!0)};c._addLazySet=function(e,t,i){var n=this._firstPT=new _t(e,t,0,0,this._firstPT,2);n.e=i,n.setRatio=qt,n.data=this},c._linkCSSP=function(e,t,i,n){return e&&(t&&(t._prev=e),e._next&&(e._next._prev=e._prev),e._prev?e._prev._next=e._next:this._firstPT===e&&(this._firstPT=e._next,n=!0),i?i._next=e:n||null!==this._firstPT||(this._firstPT=e),e._next=t,e._prev=i),e},c._mod=function(e){for(var t=this._firstPT;t;)"function"==typeof e[t.p]&&e[t.p]===Math.round&&(t.r=1),t=t._next},c._kill=function(t){var i,n,a,r=t;if(t.autoAlpha||t.alpha){r={};for(n in t)r[n]=t[n];r.opacity=1,r.autoAlpha&&(r.visibility=1)}for(t.className&&(i=this._classNamePT)&&(a=i.xfirst,a&&a._prev?this._linkCSSP(a._prev,i._next,a._prev._prev):a===this._firstPT&&(this._firstPT=i._next),i._next&&this._linkCSSP(i._next,i._next._next,a._prev),this._classNamePT=null),i=this._firstPT;i;)i.plugin&&i.plugin!==n&&i.plugin._kill&&(i.plugin._kill(t),n=i.plugin),i=i._next;return e.prototype._kill.call(this,r)};var Gt=function(e,t,i){var n,a,r,o;if(e.slice)for(a=e.length;--a>-1;)Gt(e[a],t,i);else for(n=e.childNodes,a=n.length;--a>-1;)r=n[a],o=r.type,r.style&&(t.push(tt(r)),i&&i.push(r)),1!==o&&9!==o&&11!==o||!r.childNodes.length||Gt(r,t,i)};return o.cascadeTo=function(e,i,n){var a,r,o,s,l=t.to(e,i,n),c=[l],d=[],h=[],u=[],p=t._internals.reservedProps;for(e=l._targets||l.target,Gt(e,d,u),l.render(i,!0,!0),Gt(e,h),l.render(0,!0,!0),l._enabled(!0),a=u.length;--a>-1;)if(r=it(u[a],d[a],h[a]),r.firstMPT){r=r.difs;for(o in n)p[o]&&(r[o]=n[o]);s={};for(o in r)s[o]=d[a][o];c.push(t.fromTo(u[a],i,s,r))}return c},e.activate([o]),o},!0),function(){var e=_gsScope._gsDefine.plugin({propName:"roundProps",version:"1.6.0",priority:-1,API:2,init:function(e,t,i){return this._tween=i,!0}}),t=function(e){for(;e;)e.f||e.blob||(e.m=Math.round),e=e._next},i=e.prototype;i._onInitAllProps=function(){for(var e,i,n,a=this._tween,r=a.vars.roundProps.join?a.vars.roundProps:a.vars.roundProps.split(","),o=r.length,s={},l=a._propLookup.roundProps;--o>-1;)s[r[o]]=Math.round;for(o=r.length;--o>-1;)for(e=r[o],i=a._firstPT;i;)n=i._next,i.pg?i.t._mod(s):i.n===e&&(2===i.f&&i.t?t(i.t._firstPT):(this._add(i.t,e,i.s,i.c),n&&(n._prev=i._prev),i._prev?i._prev._next=n:a._firstPT===i&&(a._firstPT=n),i._next=i._prev=null,a._propLookup[e]=l)),i=n;return!1},i._add=function(e,t,i,n){this._addTween(e,t,i,i+n,t,Math.round),this._overwriteProps.push(t)}}(),function(){_gsScope._gsDefine.plugin({propName:"attr",API:2,version:"0.6.0",init:function(e,t,i,n){var a,r;if("function"!=typeof e.setAttribute)return!1;for(a in t)r=t[a],"function"==typeof r&&(r=r(n,e)),this._addTween(e,"setAttribute",e.getAttribute(a)+"",r+"",a,!1,a),this._overwriteProps.push(a);return!0}})}(),_gsScope._gsDefine.plugin({propName:"directionalRotation",version:"0.3.0",API:2,init:function(e,t,i,n){"object"!=typeof t&&(t={rotation:t}),this.finals={};var a,r,o,s,l,c,d=t.useRadians===!0?2*Math.PI:360,h=1e-6;for(a in t)"useRadians"!==a&&(s=t[a],"function"==typeof s&&(s=s(n,e)),c=(s+"").split("_"),r=c[0],o=parseFloat("function"!=typeof e[a]?e[a]:e[a.indexOf("set")||"function"!=typeof e["get"+a.substr(3)]?a:"get"+a.substr(3)]()),s=this.finals[a]="string"==typeof r&&"="===r.charAt(1)?o+parseInt(r.charAt(0)+"1",10)*Number(r.substr(2)):Number(r)||0,l=s-o,c.length&&(r=c.join("_"),-1!==r.indexOf("short")&&(l%=d,l!==l%(d/2)&&(l=0>l?l+d:l-d)),-1!==r.indexOf("_cw")&&0>l?l=(l+9999999999*d)%d-(l/d|0)*d:-1!==r.indexOf("ccw")&&l>0&&(l=(l-9999999999*d)%d-(l/d|0)*d)),(l>h||-h>l)&&(this._addTween(e,a,o,o+l,a),this._overwriteProps.push(a)));return!0},set:function(e){var t;if(1!==e)this._super.setRatio.call(this,e);else for(t=this._firstPT;t;)t.f?t.t[t.p](this.finals[t.p]):t.t[t.p]=this.finals[t.p],t=t._next}})._autoCSS=!0,_gsScope._gsDefine("easing.Back",["easing.Ease"],function(e){var t,i,n,a=_gsScope.GreenSockGlobals||_gsScope,r=a.com.greensock,o=2*Math.PI,s=Math.PI/2,l=r._class,c=function(t,i){var n=l("easing."+t,function(){},!0),a=n.prototype=new e;return a.constructor=n,a.getRatio=i,n},d=e.register||function(){},h=function(e,t,i,n){var a=l("easing."+e,{easeOut:new t,easeIn:new i,easeInOut:new n},!0);return d(a,e),a},u=function(e,t,i){this.t=e,this.v=t,i&&(this.next=i,i.prev=this,this.c=i.v-t,this.gap=i.t-e)},p=function(t,i){var n=l("easing."+t,function(e){this._p1=e||0===e?e:1.70158,this._p2=1.525*this._p1},!0),a=n.prototype=new e;return a.constructor=n,a.getRatio=i,a.config=function(e){return new n(e)},n},v=h("Back",p("BackOut",function(e){return(e-=1)*e*((this._p1+1)*e+this._p1)+1}),p("BackIn",function(e){return e*e*((this._p1+1)*e-this._p1)}),p("BackInOut",function(e){return(e*=2)<1?.5*e*e*((this._p2+1)*e-this._p2):.5*((e-=2)*e*((this._p2+1)*e+this._p2)+2)})),g=l("easing.SlowMo",function(e,t,i){t=t||0===t?t:.7,null==e?e=.7:e>1&&(e=1),this._p=1!==e?t:0,this._p1=(1-e)/2,this._p2=e,this._p3=this._p1+this._p2,this._calcEnd=i===!0},!0),f=g.prototype=new e;return f.constructor=g,f.getRatio=function(e){var t=e+(.5-e)*this._p;return e<this._p1?this._calcEnd?1-(e=1-e/this._p1)*e:t-(e=1-e/this._p1)*e*e*e*t:e>this._p3?this._calcEnd?1-(e=(e-this._p3)/this._p1)*e:t+(e-t)*(e=(e-this._p3)/this._p1)*e*e*e:this._calcEnd?1:t},g.ease=new g(.7,.7),f.config=g.config=function(e,t,i){return new g(e,t,i)},t=l("easing.SteppedEase",function(e){e=e||1,this._p1=1/e,this._p2=e+1},!0),f=t.prototype=new e,f.constructor=t,f.getRatio=function(e){return 0>e?e=0:e>=1&&(e=.999999999),(this._p2*e>>0)*this._p1},f.config=t.config=function(e){return new t(e)},i=l("easing.RoughEase",function(t){t=t||{};for(var i,n,a,r,o,s,l=t.taper||"none",c=[],d=0,h=0|(t.points||20),p=h,v=t.randomize!==!1,g=t.clamp===!0,f=t.template instanceof e?t.template:null,m="number"==typeof t.strength?.4*t.strength:.4;--p>-1;)i=v?Math.random():1/h*p,n=f?f.getRatio(i):i,"none"===l?a=m:"out"===l?(r=1-i,a=r*r*m):"in"===l?a=i*i*m:.5>i?(r=2*i,a=r*r*.5*m):(r=2*(1-i),a=r*r*.5*m),v?n+=Math.random()*a-.5*a:p%2?n+=.5*a:n-=.5*a,g&&(n>1?n=1:0>n&&(n=0)),c[d++]={x:i,y:n};for(c.sort(function(e,t){return e.x-t.x}),s=new u(1,1,null),p=h;--p>-1;)o=c[p],s=new u(o.x,o.y,s);this._prev=new u(0,0,0!==s.t?s:s.next)},!0),f=i.prototype=new e,f.constructor=i,f.getRatio=function(e){var t=this._prev;if(e>t.t){for(;t.next&&e>=t.t;)t=t.next;t=t.prev}else for(;t.prev&&e<=t.t;)t=t.prev;return this._prev=t,t.v+(e-t.t)/t.gap*t.c},f.config=function(e){return new i(e)},i.ease=new i,h("Bounce",c("BounceOut",function(e){return 1/2.75>e?7.5625*e*e:2/2.75>e?7.5625*(e-=1.5/2.75)*e+.75:2.5/2.75>e?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375}),c("BounceIn",function(e){return(e=1-e)<1/2.75?1-7.5625*e*e:2/2.75>e?1-(7.5625*(e-=1.5/2.75)*e+.75):2.5/2.75>e?1-(7.5625*(e-=2.25/2.75)*e+.9375):1-(7.5625*(e-=2.625/2.75)*e+.984375)}),c("BounceInOut",function(e){var t=.5>e;return e=t?1-2*e:2*e-1,e=1/2.75>e?7.5625*e*e:2/2.75>e?7.5625*(e-=1.5/2.75)*e+.75:2.5/2.75>e?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375,t?.5*(1-e):.5*e+.5})),h("Circ",c("CircOut",function(e){return Math.sqrt(1-(e-=1)*e)}),c("CircIn",function(e){return-(Math.sqrt(1-e*e)-1)}),c("CircInOut",function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)})),n=function(t,i,n){var a=l("easing."+t,function(e,t){this._p1=e>=1?e:1,this._p2=(t||n)/(1>e?e:1),this._p3=this._p2/o*(Math.asin(1/this._p1)||0),this._p2=o/this._p2},!0),r=a.prototype=new e;return r.constructor=a,r.getRatio=i,r.config=function(e,t){return new a(e,t)},a},h("Elastic",n("ElasticOut",function(e){return this._p1*Math.pow(2,-10*e)*Math.sin((e-this._p3)*this._p2)+1},.3),n("ElasticIn",function(e){return-(this._p1*Math.pow(2,10*(e-=1))*Math.sin((e-this._p3)*this._p2))},.3),n("ElasticInOut",function(e){return(e*=2)<1?-.5*this._p1*Math.pow(2,10*(e-=1))*Math.sin((e-this._p3)*this._p2):this._p1*Math.pow(2,-10*(e-=1))*Math.sin((e-this._p3)*this._p2)*.5+1},.45)),h("Expo",c("ExpoOut",function(e){return 1-Math.pow(2,-10*e)}),c("ExpoIn",function(e){return Math.pow(2,10*(e-1))-.001}),c("ExpoInOut",function(e){return(e*=2)<1?.5*Math.pow(2,10*(e-1)):.5*(2-Math.pow(2,-10*(e-1)))})),h("Sine",c("SineOut",function(e){return Math.sin(e*s)}),c("SineIn",function(e){return-Math.cos(e*s)+1}),c("SineInOut",function(e){return-.5*(Math.cos(Math.PI*e)-1)})),l("easing.EaseLookup",{find:function(t){return e.map[t]}},!0),d(a.SlowMo,"SlowMo","ease,"),d(i,"RoughEase","ease,"),d(t,"SteppedEase","ease,"),v},!0)}),_gsScope._gsDefine&&_gsScope._gsQueue.pop()(),function(e,t){var i={},n=e.GreenSockGlobals=e.GreenSockGlobals||e;if(!n.TweenLite){var a,r,o,s,l,c=function(e){var t,i=e.split("."),a=n;for(t=0;t<i.length;t++)a[i[t]]=a=a[i[t]]||{};return a},d=c("com.greensock"),h=1e-10,u=function(e){var t,i=[],n=e.length;for(t=0;t!==n;i.push(e[t++]));return i},p=function(){},v=function(){var e=Object.prototype.toString,t=e.call([]);return function(i){return null!=i&&(i instanceof Array||"object"==typeof i&&!!i.push&&e.call(i)===t)}}(),g={},f=function(a,r,o,s){this.sc=g[a]?g[a].sc:[],g[a]=this,this.gsClass=null,this.func=o;var l=[];this.check=function(d){for(var h,u,p,v,m,_=r.length,w=_;--_>-1;)(h=g[r[_]]||new f(r[_],[])).gsClass?(l[_]=h.gsClass,w--):d&&h.sc.push(this);if(0===w&&o){if(u=("com.greensock."+a).split("."),p=u.pop(),v=c(u.join("."))[p]=this.gsClass=o.apply(o,l),s)if(n[p]=i[p]=v,m="undefined"!=typeof module&&module.exports,!m&&"function"==typeof define&&define.amd)define((e.GreenSockAMDPath?e.GreenSockAMDPath+"/":"")+a.split(".").pop(),[],function(){return v});else if(m)if(a===t){module.exports=i[t]=v;for(_ in i)v[_]=i[_]}else i[t]&&(i[t][p]=v);for(_=0;_<this.sc.length;_++)this.sc[_].check()}},this.check(!0)},m=e._gsDefine=function(e,t,i,n){return new f(e,t,i,n)},_=d._class=function(e,t,i){return t=t||function(){},m(e,[],function(){return t},i),t};m.globals=n;var w=[0,0,1,1],y=_("easing.Ease",function(e,t,i,n){this._func=e,this._type=i||0,this._power=n||0,this._params=t?w.concat(t):w},!0),b=y.map={},x=y.register=function(e,t,i,n){for(var a,r,o,s,l=t.split(","),c=l.length,h=(i||"easeIn,easeOut,easeInOut").split(",");--c>-1;)for(r=l[c],a=n?_("easing."+r,null,!0):d.easing[r]||{},o=h.length;--o>-1;)s=h[o],b[r+"."+s]=b[s+r]=a[s]=e.getRatio?e:e[s]||new e};for(o=y.prototype,o._calcEnd=!1,o.getRatio=function(e){if(this._func)return this._params[0]=e,this._func.apply(null,this._params);var t=this._type,i=this._power,n=1===t?1-e:2===t?e:.5>e?2*e:2*(1-e);return 1===i?n*=n:2===i?n*=n*n:3===i?n*=n*n*n:4===i&&(n*=n*n*n*n),1===t?1-n:2===t?n:.5>e?n/2:1-n/2},a=["Linear","Quad","Cubic","Quart","Quint,Strong"],r=a.length;--r>-1;)o=a[r]+",Power"+r,x(new y(null,null,1,r),o,"easeOut",!0),x(new y(null,null,2,r),o,"easeIn"+(0===r?",easeNone":"")),x(new y(null,null,3,r),o,"easeInOut");b.linear=d.easing.Linear.easeIn,b.swing=d.easing.Quad.easeInOut;var S=_("events.EventDispatcher",function(e){this._listeners={},this._eventTarget=e||this});o=S.prototype,o.addEventListener=function(e,t,i,n,a){a=a||0;var r,o,c=this._listeners[e],d=0;for(this!==s||l||s.wake(),null==c&&(this._listeners[e]=c=[]),o=c.length;--o>-1;)r=c[o],r.c===t&&r.s===i?c.splice(o,1):0===d&&r.pr<a&&(d=o+1);c.splice(d,0,{c:t,s:i,up:n,pr:a})},o.removeEventListener=function(e,t){var i,n=this._listeners[e];if(n)for(i=n.length;--i>-1;)if(n[i].c===t)return void n.splice(i,1)},o.dispatchEvent=function(e){var t,i,n,a=this._listeners[e];if(a)for(t=a.length,t>1&&(a=a.slice(0)),i=this._eventTarget;--t>-1;)n=a[t],n&&(n.up?n.c.call(n.s||i,{type:e,target:i}):n.c.call(n.s||i))};var T=e.requestAnimationFrame,k=e.cancelAnimationFrame,C=Date.now||function(){return(new Date).getTime()},P=C();for(a=["ms","moz","webkit","o"],r=a.length;--r>-1&&!T;)T=e[a[r]+"RequestAnimationFrame"],k=e[a[r]+"CancelAnimationFrame"]||e[a[r]+"CancelRequestAnimationFrame"];_("Ticker",function(e,t){var i,n,a,r,o,c=this,d=C(),u=t!==!1&&T?"auto":!1,v=500,g=33,f="tick",m=function(e){var t,s,l=C()-P;l>v&&(d+=l-g),P+=l,c.time=(P-d)/1e3,t=c.time-o,(!i||t>0||e===!0)&&(c.frame++,o+=t+(t>=r?.004:r-t),s=!0),e!==!0&&(a=n(m)),s&&c.dispatchEvent(f)};S.call(c),c.time=c.frame=0,c.tick=function(){m(!0)},c.lagSmoothing=function(e,t){v=e||1/h,g=Math.min(t,v,0)},c.sleep=function(){null!=a&&(u&&k?k(a):clearTimeout(a),n=p,a=null,c===s&&(l=!1))},c.wake=function(e){null!==a?c.sleep():e?d+=-P+(P=C()):c.frame>10&&(P=C()-v+5),n=0===i?p:u&&T?T:function(e){return setTimeout(e,1e3*(o-c.time)+1|0)},c===s&&(l=!0),m(2)},c.fps=function(e){return arguments.length?(i=e,r=1/(i||60),o=this.time+r,void c.wake()):i},c.useRAF=function(e){return arguments.length?(c.sleep(),u=e,void c.fps(i)):u},c.fps(e),setTimeout(function(){"auto"===u&&c.frame<5&&"hidden"!==document.visibilityState&&c.useRAF(!1)},1500)}),o=d.Ticker.prototype=new d.events.EventDispatcher,o.constructor=d.Ticker;var D=_("core.Animation",function(e,t){if(this.vars=t=t||{},this._duration=this._totalDuration=e||0,this._delay=Number(t.delay)||0,this._timeScale=1,this._active=t.immediateRender===!0,this.data=t.data,this._reversed=t.reversed===!0,X){l||s.wake();var i=this.vars.useFrames?Y:X;i.add(this,i._time),this.vars.paused&&this.paused(!0)}});s=D.ticker=new d.Ticker,o=D.prototype,o._dirty=o._gc=o._initted=o._paused=!1,o._totalTime=o._time=0,o._rawPrevTime=-1,o._next=o._last=o._onUpdate=o._timeline=o.timeline=null,o._paused=!1;var $=function(){l&&C()-P>2e3&&s.wake(),setTimeout($,2e3)};$(),o.play=function(e,t){return null!=e&&this.seek(e,t),this.reversed(!1).paused(!1)},o.pause=function(e,t){return null!=e&&this.seek(e,t),this.paused(!0)},o.resume=function(e,t){return null!=e&&this.seek(e,t),this.paused(!1)},o.seek=function(e,t){return this.totalTime(Number(e),t!==!1)},o.restart=function(e,t){return this.reversed(!1).paused(!1).totalTime(e?-this._delay:0,t!==!1,!0)},o.reverse=function(e,t){return null!=e&&this.seek(e||this.totalDuration(),t),this.reversed(!0).paused(!1)},o.render=function(){},o.invalidate=function(){return this._time=this._totalTime=0,this._initted=this._gc=!1,this._rawPrevTime=-1,(this._gc||!this.timeline)&&this._enabled(!0),this},o.isActive=function(){var e,t=this._timeline,i=this._startTime;return!t||!this._gc&&!this._paused&&t.isActive()&&(e=t.rawTime())>=i&&e<i+this.totalDuration()/this._timeScale},o._enabled=function(e,t){return l||s.wake(),this._gc=!e,this._active=this.isActive(),t!==!0&&(e&&!this.timeline?this._timeline.add(this,this._startTime-this._delay):!e&&this.timeline&&this._timeline._remove(this,!0)),!1},o._kill=function(){return this._enabled(!1,!1)},o.kill=function(e,t){return this._kill(e,t),this},o._uncache=function(e){for(var t=e?this:this.timeline;t;)t._dirty=!0,t=t.timeline;return this},o._swapSelfInParams=function(e){for(var t=e.length,i=e.concat();--t>-1;)"{self}"===e[t]&&(i[t]=this);
return i},o._callback=function(e){var t=this.vars,i=t[e],n=t[e+"Params"],a=t[e+"Scope"]||t.callbackScope||this,r=n?n.length:0;switch(r){case 0:i.call(a);break;case 1:i.call(a,n[0]);break;case 2:i.call(a,n[0],n[1]);break;default:i.apply(a,n)}},o.eventCallback=function(e,t,i,n){if("on"===(e||"").substr(0,2)){var a=this.vars;if(1===arguments.length)return a[e];null==t?delete a[e]:(a[e]=t,a[e+"Params"]=v(i)&&-1!==i.join("").indexOf("{self}")?this._swapSelfInParams(i):i,a[e+"Scope"]=n),"onUpdate"===e&&(this._onUpdate=t)}return this},o.delay=function(e){return arguments.length?(this._timeline.smoothChildTiming&&this.startTime(this._startTime+e-this._delay),this._delay=e,this):this._delay},o.duration=function(e){return arguments.length?(this._duration=this._totalDuration=e,this._uncache(!0),this._timeline.smoothChildTiming&&this._time>0&&this._time<this._duration&&0!==e&&this.totalTime(this._totalTime*(e/this._duration),!0),this):(this._dirty=!1,this._duration)},o.totalDuration=function(e){return this._dirty=!1,arguments.length?this.duration(e):this._totalDuration},o.time=function(e,t){return arguments.length?(this._dirty&&this.totalDuration(),this.totalTime(e>this._duration?this._duration:e,t)):this._time},o.totalTime=function(e,t,i){if(l||s.wake(),!arguments.length)return this._totalTime;if(this._timeline){if(0>e&&!i&&(e+=this.totalDuration()),this._timeline.smoothChildTiming){this._dirty&&this.totalDuration();var n=this._totalDuration,a=this._timeline;if(e>n&&!i&&(e=n),this._startTime=(this._paused?this._pauseTime:a._time)-(this._reversed?n-e:e)/this._timeScale,a._dirty||this._uncache(!1),a._timeline)for(;a._timeline;)a._timeline._time!==(a._startTime+a._totalTime)/a._timeScale&&a.totalTime(a._totalTime,!0),a=a._timeline}this._gc&&this._enabled(!0,!1),(this._totalTime!==e||0===this._duration)&&(N.length&&G(),this.render(e,t,!1),N.length&&G())}return this},o.progress=o.totalProgress=function(e,t){var i=this.duration();return arguments.length?this.totalTime(i*e,t):i?this._time/i:this.ratio},o.startTime=function(e){return arguments.length?(e!==this._startTime&&(this._startTime=e,this.timeline&&this.timeline._sortChildren&&this.timeline.add(this,e-this._delay)),this):this._startTime},o.endTime=function(e){return this._startTime+(0!=e?this.totalDuration():this.duration())/this._timeScale},o.timeScale=function(e){if(!arguments.length)return this._timeScale;if(e=e||h,this._timeline&&this._timeline.smoothChildTiming){var t=this._pauseTime,i=t||0===t?t:this._timeline.totalTime();this._startTime=i-(i-this._startTime)*this._timeScale/e}return this._timeScale=e,this._uncache(!1)},o.reversed=function(e){return arguments.length?(e!=this._reversed&&(this._reversed=e,this.totalTime(this._timeline&&!this._timeline.smoothChildTiming?this.totalDuration()-this._totalTime:this._totalTime,!0)),this):this._reversed},o.paused=function(e){if(!arguments.length)return this._paused;var t,i,n=this._timeline;return e!=this._paused&&n&&(l||e||s.wake(),t=n.rawTime(),i=t-this._pauseTime,!e&&n.smoothChildTiming&&(this._startTime+=i,this._uncache(!1)),this._pauseTime=e?t:null,this._paused=e,this._active=this.isActive(),!e&&0!==i&&this._initted&&this.duration()&&(t=n.smoothChildTiming?this._totalTime:(t-this._startTime)/this._timeScale,this.render(t,t===this._totalTime,!0))),this._gc&&!e&&this._enabled(!0,!1),this};var E=_("core.SimpleTimeline",function(e){D.call(this,0,e),this.autoRemoveChildren=this.smoothChildTiming=!0});o=E.prototype=new D,o.constructor=E,o.kill()._gc=!1,o._first=o._last=o._recent=null,o._sortChildren=!1,o.add=o.insert=function(e,t){var i,n;if(e._startTime=Number(t||0)+e._delay,e._paused&&this!==e._timeline&&(e._pauseTime=e._startTime+(this.rawTime()-e._startTime)/e._timeScale),e.timeline&&e.timeline._remove(e,!0),e.timeline=e._timeline=this,e._gc&&e._enabled(!0,!0),i=this._last,this._sortChildren)for(n=e._startTime;i&&i._startTime>n;)i=i._prev;return i?(e._next=i._next,i._next=e):(e._next=this._first,this._first=e),e._next?e._next._prev=e:this._last=e,e._prev=i,this._recent=e,this._timeline&&this._uncache(!0),this},o._remove=function(e,t){return e.timeline===this&&(t||e._enabled(!1,!0),e._prev?e._prev._next=e._next:this._first===e&&(this._first=e._next),e._next?e._next._prev=e._prev:this._last===e&&(this._last=e._prev),e._next=e._prev=e.timeline=null,e===this._recent&&(this._recent=this._last),this._timeline&&this._uncache(!0)),this},o.render=function(e,t,i){var n,a=this._first;for(this._totalTime=this._time=this._rawPrevTime=e;a;)n=a._next,(a._active||e>=a._startTime&&!a._paused)&&(a._reversed?a.render((a._dirty?a.totalDuration():a._totalDuration)-(e-a._startTime)*a._timeScale,t,i):a.render((e-a._startTime)*a._timeScale,t,i)),a=n},o.rawTime=function(){return l||s.wake(),this._totalTime};var O=_("TweenLite",function(t,i,n){if(D.call(this,i,n),this.render=O.prototype.render,null==t)throw"Cannot tween a null target.";this.target=t="string"!=typeof t?t:O.selector(t)||t;var a,r,o,s=t.jquery||t.length&&t!==e&&t[0]&&(t[0]===e||t[0].nodeType&&t[0].style&&!t.nodeType),l=this.vars.overwrite;if(this._overwrite=l=null==l?H[O.defaultOverwrite]:"number"==typeof l?l>>0:H[l],(s||t instanceof Array||t.push&&v(t))&&"number"!=typeof t[0])for(this._targets=o=u(t),this._propLookup=[],this._siblings=[],a=0;a<o.length;a++)r=o[a],r?"string"!=typeof r?r.length&&r!==e&&r[0]&&(r[0]===e||r[0].nodeType&&r[0].style&&!r.nodeType)?(o.splice(a--,1),this._targets=o=o.concat(u(r))):(this._siblings[a]=Q(r,this,!1),1===l&&this._siblings[a].length>1&&K(r,this,null,1,this._siblings[a])):(r=o[a--]=O.selector(r),"string"==typeof r&&o.splice(a+1,1)):o.splice(a--,1);else this._propLookup={},this._siblings=Q(t,this,!1),1===l&&this._siblings.length>1&&K(t,this,null,1,this._siblings);(this.vars.immediateRender||0===i&&0===this._delay&&this.vars.immediateRender!==!1)&&(this._time=-h,this.render(Math.min(0,-this._delay)))},!0),I=function(t){return t&&t.length&&t!==e&&t[0]&&(t[0]===e||t[0].nodeType&&t[0].style&&!t.nodeType)},A=function(e,t){var i,n={};for(i in e)V[i]||i in t&&"transform"!==i&&"x"!==i&&"y"!==i&&"width"!==i&&"height"!==i&&"className"!==i&&"border"!==i||!(!W[i]||W[i]&&W[i]._autoCSS)||(n[i]=e[i],delete e[i]);e.css=n};o=O.prototype=new D,o.constructor=O,o.kill()._gc=!1,o.ratio=0,o._firstPT=o._targets=o._overwrittenProps=o._startAt=null,o._notifyPluginsOfEnabled=o._lazy=!1,O.version="1.19.0",O.defaultEase=o._ease=new y(null,null,1,1),O.defaultOverwrite="auto",O.ticker=s,O.autoSleep=120,O.lagSmoothing=function(e,t){s.lagSmoothing(e,t)},O.selector=e.$||e.jQuery||function(t){var i=e.$||e.jQuery;return i?(O.selector=i,i(t)):"undefined"==typeof document?t:document.querySelectorAll?document.querySelectorAll(t):document.getElementById("#"===t.charAt(0)?t.substr(1):t)};var N=[],R={},M=/(?:(-|-=|\+=)?\d*\.?\d*(?:e[\-+]?\d+)?)[0-9]/gi,z=function(e){for(var t,i=this._firstPT,n=1e-6;i;)t=i.blob?e?this.join(""):this.start:i.c*e+i.s,i.m?t=i.m(t,this._target||i.t):n>t&&t>-n&&(t=0),i.f?i.fp?i.t[i.p](i.fp,t):i.t[i.p](t):i.t[i.p]=t,i=i._next},L=function(e,t,i,n){var a,r,o,s,l,c,d,h=[e,t],u=0,p="",v=0;for(h.start=e,i&&(i(h),e=h[0],t=h[1]),h.length=0,a=e.match(M)||[],r=t.match(M)||[],n&&(n._next=null,n.blob=1,h._firstPT=h._applyPT=n),l=r.length,s=0;l>s;s++)d=r[s],c=t.substr(u,t.indexOf(d,u)-u),p+=c||!s?c:",",u+=c.length,v?v=(v+1)%5:"rgba("===c.substr(-5)&&(v=1),d===a[s]||a.length<=s?p+=d:(p&&(h.push(p),p=""),o=parseFloat(a[s]),h.push(o),h._firstPT={_next:h._firstPT,t:h,p:h.length-1,s:o,c:("="===d.charAt(1)?parseInt(d.charAt(0)+"1",10)*parseFloat(d.substr(2)):parseFloat(d)-o)||0,f:0,m:v&&4>v?Math.round:0}),u+=d.length;return p+=t.substr(u),p&&h.push(p),h.setRatio=z,h},F=function(e,t,i,n,a,r,o,s,l){"function"==typeof n&&(n=n(l||0,e));var c,d,h="get"===i?e[t]:i,u=typeof e[t],p="string"==typeof n&&"="===n.charAt(1),v={t:e,p:t,s:h,f:"function"===u,pg:0,n:a||t,m:r?"function"==typeof r?r:Math.round:0,pr:0,c:p?parseInt(n.charAt(0)+"1",10)*parseFloat(n.substr(2)):parseFloat(n)-h||0};return"number"!==u&&("function"===u&&"get"===i&&(d=t.indexOf("set")||"function"!=typeof e["get"+t.substr(3)]?t:"get"+t.substr(3),v.s=h=o?e[d](o):e[d]()),"string"==typeof h&&(o||isNaN(h))?(v.fp=o,c=L(h,n,s||O.defaultStringFilter,v),v={t:c,p:"setRatio",s:0,c:1,f:2,pg:0,n:a||t,pr:0,m:0}):p||(v.s=parseFloat(h),v.c=parseFloat(n)-v.s||0)),v.c?((v._next=this._firstPT)&&(v._next._prev=v),this._firstPT=v,v):void 0},B=O._internals={isArray:v,isSelector:I,lazyTweens:N,blobDif:L},W=O._plugins={},U=B.tweenLookup={},j=0,V=B.reservedProps={ease:1,delay:1,overwrite:1,onComplete:1,onCompleteParams:1,onCompleteScope:1,useFrames:1,runBackwards:1,startAt:1,onUpdate:1,onUpdateParams:1,onUpdateScope:1,onStart:1,onStartParams:1,onStartScope:1,onReverseComplete:1,onReverseCompleteParams:1,onReverseCompleteScope:1,onRepeat:1,onRepeatParams:1,onRepeatScope:1,easeParams:1,yoyo:1,immediateRender:1,repeat:1,repeatDelay:1,data:1,paused:1,reversed:1,autoCSS:1,lazy:1,onOverwrite:1,callbackScope:1,stringFilter:1,id:1},H={none:0,all:1,auto:2,concurrent:3,allOnStart:4,preexisting:5,"true":1,"false":0},Y=D._rootFramesTimeline=new E,X=D._rootTimeline=new E,q=30,G=B.lazyRender=function(){var e,t=N.length;for(R={};--t>-1;)e=N[t],e&&e._lazy!==!1&&(e.render(e._lazy[0],e._lazy[1],!0),e._lazy=!1);N.length=0};X._startTime=s.time,Y._startTime=s.frame,X._active=Y._active=!0,setTimeout(G,1),D._updateRoot=O.render=function(){var e,t,i;if(N.length&&G(),X.render((s.time-X._startTime)*X._timeScale,!1,!1),Y.render((s.frame-Y._startTime)*Y._timeScale,!1,!1),N.length&&G(),s.frame>=q){q=s.frame+(parseInt(O.autoSleep,10)||120);for(i in U){for(t=U[i].tweens,e=t.length;--e>-1;)t[e]._gc&&t.splice(e,1);0===t.length&&delete U[i]}if(i=X._first,(!i||i._paused)&&O.autoSleep&&!Y._first&&1===s._listeners.tick.length){for(;i&&i._paused;)i=i._next;i||s.sleep()}}},s.addEventListener("tick",D._updateRoot);var Q=function(e,t,i){var n,a,r=e._gsTweenID;if(U[r||(e._gsTweenID=r="t"+j++)]||(U[r]={target:e,tweens:[]}),t&&(n=U[r].tweens,n[a=n.length]=t,i))for(;--a>-1;)n[a]===t&&n.splice(a,1);return U[r].tweens},J=function(e,t,i,n){var a,r,o=e.vars.onOverwrite;return o&&(a=o(e,t,i,n)),o=O.onOverwrite,o&&(r=o(e,t,i,n)),a!==!1&&r!==!1},K=function(e,t,i,n,a){var r,o,s,l;if(1===n||n>=4){for(l=a.length,r=0;l>r;r++)if((s=a[r])!==t)s._gc||s._kill(null,e,t)&&(o=!0);else if(5===n)break;return o}var c,d=t._startTime+h,u=[],p=0,v=0===t._duration;for(r=a.length;--r>-1;)(s=a[r])===t||s._gc||s._paused||(s._timeline!==t._timeline?(c=c||Z(t,0,v),0===Z(s,c,v)&&(u[p++]=s)):s._startTime<=d&&s._startTime+s.totalDuration()/s._timeScale>d&&((v||!s._initted)&&d-s._startTime<=2e-10||(u[p++]=s)));for(r=p;--r>-1;)if(s=u[r],2===n&&s._kill(i,e,t)&&(o=!0),2!==n||!s._firstPT&&s._initted){if(2!==n&&!J(s,t))continue;s._enabled(!1,!1)&&(o=!0)}return o},Z=function(e,t,i){for(var n=e._timeline,a=n._timeScale,r=e._startTime;n._timeline;){if(r+=n._startTime,a*=n._timeScale,n._paused)return-100;n=n._timeline}return r/=a,r>t?r-t:i&&r===t||!e._initted&&2*h>r-t?h:(r+=e.totalDuration()/e._timeScale/a)>t+h?0:r-t-h};o._init=function(){var e,t,i,n,a,r,o=this.vars,s=this._overwrittenProps,l=this._duration,c=!!o.immediateRender,d=o.ease;if(o.startAt){this._startAt&&(this._startAt.render(-1,!0),this._startAt.kill()),a={};for(n in o.startAt)a[n]=o.startAt[n];if(a.overwrite=!1,a.immediateRender=!0,a.lazy=c&&o.lazy!==!1,a.startAt=a.delay=null,this._startAt=O.to(this.target,0,a),c)if(this._time>0)this._startAt=null;else if(0!==l)return}else if(o.runBackwards&&0!==l)if(this._startAt)this._startAt.render(-1,!0),this._startAt.kill(),this._startAt=null;else{0!==this._time&&(c=!1),i={};for(n in o)V[n]&&"autoCSS"!==n||(i[n]=o[n]);if(i.overwrite=0,i.data="isFromStart",i.lazy=c&&o.lazy!==!1,i.immediateRender=c,this._startAt=O.to(this.target,0,i),c){if(0===this._time)return}else this._startAt._init(),this._startAt._enabled(!1),this.vars.immediateRender&&(this._startAt=null)}if(this._ease=d=d?d instanceof y?d:"function"==typeof d?new y(d,o.easeParams):b[d]||O.defaultEase:O.defaultEase,o.easeParams instanceof Array&&d.config&&(this._ease=d.config.apply(d,o.easeParams)),this._easeType=this._ease._type,this._easePower=this._ease._power,this._firstPT=null,this._targets)for(r=this._targets.length,e=0;r>e;e++)this._initProps(this._targets[e],this._propLookup[e]={},this._siblings[e],s?s[e]:null,e)&&(t=!0);else t=this._initProps(this.target,this._propLookup,this._siblings,s,0);if(t&&O._onPluginEvent("_onInitAllProps",this),s&&(this._firstPT||"function"!=typeof this.target&&this._enabled(!1,!1)),o.runBackwards)for(i=this._firstPT;i;)i.s+=i.c,i.c=-i.c,i=i._next;this._onUpdate=o.onUpdate,this._initted=!0},o._initProps=function(t,i,n,a,r){var o,s,l,c,d,h;if(null==t)return!1;R[t._gsTweenID]&&G(),this.vars.css||t.style&&t!==e&&t.nodeType&&W.css&&this.vars.autoCSS!==!1&&A(this.vars,t);for(o in this.vars)if(h=this.vars[o],V[o])h&&(h instanceof Array||h.push&&v(h))&&-1!==h.join("").indexOf("{self}")&&(this.vars[o]=h=this._swapSelfInParams(h,this));else if(W[o]&&(c=new W[o])._onInitTween(t,this.vars[o],this,r)){for(this._firstPT=d={_next:this._firstPT,t:c,p:"setRatio",s:0,c:1,f:1,n:o,pg:1,pr:c._priority,m:0},s=c._overwriteProps.length;--s>-1;)i[c._overwriteProps[s]]=this._firstPT;(c._priority||c._onInitAllProps)&&(l=!0),(c._onDisable||c._onEnable)&&(this._notifyPluginsOfEnabled=!0),d._next&&(d._next._prev=d)}else i[o]=F.call(this,t,o,"get",h,o,0,null,this.vars.stringFilter,r);return a&&this._kill(a,t)?this._initProps(t,i,n,a,r):this._overwrite>1&&this._firstPT&&n.length>1&&K(t,this,i,this._overwrite,n)?(this._kill(i,t),this._initProps(t,i,n,a,r)):(this._firstPT&&(this.vars.lazy!==!1&&this._duration||this.vars.lazy&&!this._duration)&&(R[t._gsTweenID]=!0),l)},o.render=function(e,t,i){var n,a,r,o,s=this._time,l=this._duration,c=this._rawPrevTime;if(e>=l-1e-7)this._totalTime=this._time=l,this.ratio=this._ease._calcEnd?this._ease.getRatio(1):1,this._reversed||(n=!0,a="onComplete",i=i||this._timeline.autoRemoveChildren),0===l&&(this._initted||!this.vars.lazy||i)&&(this._startTime===this._timeline._duration&&(e=0),(0>c||0>=e&&e>=-1e-7||c===h&&"isPause"!==this.data)&&c!==e&&(i=!0,c>h&&(a="onReverseComplete")),this._rawPrevTime=o=!t||e||c===e?e:h);else if(1e-7>e)this._totalTime=this._time=0,this.ratio=this._ease._calcEnd?this._ease.getRatio(0):0,(0!==s||0===l&&c>0)&&(a="onReverseComplete",n=this._reversed),0>e&&(this._active=!1,0===l&&(this._initted||!this.vars.lazy||i)&&(c>=0&&(c!==h||"isPause"!==this.data)&&(i=!0),this._rawPrevTime=o=!t||e||c===e?e:h)),this._initted||(i=!0);else if(this._totalTime=this._time=e,this._easeType){var d=e/l,u=this._easeType,p=this._easePower;(1===u||3===u&&d>=.5)&&(d=1-d),3===u&&(d*=2),1===p?d*=d:2===p?d*=d*d:3===p?d*=d*d*d:4===p&&(d*=d*d*d*d),this.ratio=1===u?1-d:2===u?d:.5>e/l?d/2:1-d/2}else this.ratio=this._ease.getRatio(e/l);if(this._time!==s||i){if(!this._initted){if(this._init(),!this._initted||this._gc)return;if(!i&&this._firstPT&&(this.vars.lazy!==!1&&this._duration||this.vars.lazy&&!this._duration))return this._time=this._totalTime=s,this._rawPrevTime=c,N.push(this),void(this._lazy=[e,t]);this._time&&!n?this.ratio=this._ease.getRatio(this._time/l):n&&this._ease._calcEnd&&(this.ratio=this._ease.getRatio(0===this._time?0:1))}for(this._lazy!==!1&&(this._lazy=!1),this._active||!this._paused&&this._time!==s&&e>=0&&(this._active=!0),0===s&&(this._startAt&&(e>=0?this._startAt.render(e,t,i):a||(a="_dummyGS")),this.vars.onStart&&(0!==this._time||0===l)&&(t||this._callback("onStart"))),r=this._firstPT;r;)r.f?r.t[r.p](r.c*this.ratio+r.s):r.t[r.p]=r.c*this.ratio+r.s,r=r._next;this._onUpdate&&(0>e&&this._startAt&&e!==-1e-4&&this._startAt.render(e,t,i),t||(this._time!==s||n||i)&&this._callback("onUpdate")),a&&(!this._gc||i)&&(0>e&&this._startAt&&!this._onUpdate&&e!==-1e-4&&this._startAt.render(e,t,i),n&&(this._timeline.autoRemoveChildren&&this._enabled(!1,!1),this._active=!1),!t&&this.vars[a]&&this._callback(a),0===l&&this._rawPrevTime===h&&o!==h&&(this._rawPrevTime=0))}},o._kill=function(e,t,i){if("all"===e&&(e=null),null==e&&(null==t||t===this.target))return this._lazy=!1,this._enabled(!1,!1);t="string"!=typeof t?t||this._targets||this.target:O.selector(t)||t;var n,a,r,o,s,l,c,d,h,u=i&&this._time&&i._startTime===this._startTime&&this._timeline===i._timeline;if((v(t)||I(t))&&"number"!=typeof t[0])for(n=t.length;--n>-1;)this._kill(e,t[n],i)&&(l=!0);else{if(this._targets){for(n=this._targets.length;--n>-1;)if(t===this._targets[n]){s=this._propLookup[n]||{},this._overwrittenProps=this._overwrittenProps||[],a=this._overwrittenProps[n]=e?this._overwrittenProps[n]||{}:"all";break}}else{if(t!==this.target)return!1;s=this._propLookup,a=this._overwrittenProps=e?this._overwrittenProps||{}:"all"}if(s){if(c=e||s,d=e!==a&&"all"!==a&&e!==s&&("object"!=typeof e||!e._tempKill),i&&(O.onOverwrite||this.vars.onOverwrite)){for(r in c)s[r]&&(h||(h=[]),h.push(r));if((h||!e)&&!J(this,i,t,h))return!1}for(r in c)(o=s[r])&&(u&&(o.f?o.t[o.p](o.s):o.t[o.p]=o.s,l=!0),o.pg&&o.t._kill(c)&&(l=!0),o.pg&&0!==o.t._overwriteProps.length||(o._prev?o._prev._next=o._next:o===this._firstPT&&(this._firstPT=o._next),o._next&&(o._next._prev=o._prev),o._next=o._prev=null),delete s[r]),d&&(a[r]=1);!this._firstPT&&this._initted&&this._enabled(!1,!1)}}return l},o.invalidate=function(){return this._notifyPluginsOfEnabled&&O._onPluginEvent("_onDisable",this),this._firstPT=this._overwrittenProps=this._startAt=this._onUpdate=null,this._notifyPluginsOfEnabled=this._active=this._lazy=!1,this._propLookup=this._targets?{}:[],D.prototype.invalidate.call(this),this.vars.immediateRender&&(this._time=-h,this.render(Math.min(0,-this._delay))),this},o._enabled=function(e,t){if(l||s.wake(),e&&this._gc){var i,n=this._targets;if(n)for(i=n.length;--i>-1;)this._siblings[i]=Q(n[i],this,!0);else this._siblings=Q(this.target,this,!0)}return D.prototype._enabled.call(this,e,t),this._notifyPluginsOfEnabled&&this._firstPT?O._onPluginEvent(e?"_onEnable":"_onDisable",this):!1},O.to=function(e,t,i){return new O(e,t,i)},O.from=function(e,t,i){return i.runBackwards=!0,i.immediateRender=0!=i.immediateRender,new O(e,t,i)},O.fromTo=function(e,t,i,n){return n.startAt=i,n.immediateRender=0!=n.immediateRender&&0!=i.immediateRender,new O(e,t,n)},O.delayedCall=function(e,t,i,n,a){return new O(t,0,{delay:e,onComplete:t,onCompleteParams:i,callbackScope:n,onReverseComplete:t,onReverseCompleteParams:i,immediateRender:!1,lazy:!1,useFrames:a,overwrite:0})},O.set=function(e,t){return new O(e,0,t)},O.getTweensOf=function(e,t){if(null==e)return[];e="string"!=typeof e?e:O.selector(e)||e;var i,n,a,r;if((v(e)||I(e))&&"number"!=typeof e[0]){for(i=e.length,n=[];--i>-1;)n=n.concat(O.getTweensOf(e[i],t));for(i=n.length;--i>-1;)for(r=n[i],a=i;--a>-1;)r===n[a]&&n.splice(i,1)}else for(n=Q(e).concat(),i=n.length;--i>-1;)(n[i]._gc||t&&!n[i].isActive())&&n.splice(i,1);return n},O.killTweensOf=O.killDelayedCallsTo=function(e,t,i){"object"==typeof t&&(i=t,t=!1);for(var n=O.getTweensOf(e,t),a=n.length;--a>-1;)n[a]._kill(i,e)};var et=_("plugins.TweenPlugin",function(e,t){this._overwriteProps=(e||"").split(","),this._propName=this._overwriteProps[0],this._priority=t||0,this._super=et.prototype},!0);if(o=et.prototype,et.version="1.19.0",et.API=2,o._firstPT=null,o._addTween=F,o.setRatio=z,o._kill=function(e){var t,i=this._overwriteProps,n=this._firstPT;if(null!=e[this._propName])this._overwriteProps=[];else for(t=i.length;--t>-1;)null!=e[i[t]]&&i.splice(t,1);for(;n;)null!=e[n.n]&&(n._next&&(n._next._prev=n._prev),n._prev?(n._prev._next=n._next,n._prev=null):this._firstPT===n&&(this._firstPT=n._next)),n=n._next;return!1},o._mod=o._roundProps=function(e){for(var t,i=this._firstPT;i;)t=e[this._propName]||null!=i.n&&e[i.n.split(this._propName+"_").join("")],t&&"function"==typeof t&&(2===i.f?i.t._applyPT.m=t:i.m=t),i=i._next},O._onPluginEvent=function(e,t){var i,n,a,r,o,s=t._firstPT;if("_onInitAllProps"===e){for(;s;){for(o=s._next,n=a;n&&n.pr>s.pr;)n=n._next;(s._prev=n?n._prev:r)?s._prev._next=s:a=s,(s._next=n)?n._prev=s:r=s,s=o}s=t._firstPT=a}for(;s;)s.pg&&"function"==typeof s.t[e]&&s.t[e]()&&(i=!0),s=s._next;return i},et.activate=function(e){for(var t=e.length;--t>-1;)e[t].API===et.API&&(W[(new e[t])._propName]=e[t]);return!0},m.plugin=function(e){if(!(e&&e.propName&&e.init&&e.API))throw"illegal plugin definition.";var t,i=e.propName,n=e.priority||0,a=e.overwriteProps,r={init:"_onInitTween",set:"setRatio",kill:"_kill",round:"_mod",mod:"_mod",initAll:"_onInitAllProps"},o=_("plugins."+i.charAt(0).toUpperCase()+i.substr(1)+"Plugin",function(){et.call(this,i,n),this._overwriteProps=a||[]},e.global===!0),s=o.prototype=new et(i);s.constructor=o,o.API=e.API;for(t in r)"function"==typeof e[t]&&(s[r[t]]=e[t]);return o.version=e.version,et.activate([o]),o},a=e._gsQueue){for(r=0;r<a.length;r++)a[r]();for(o in g)g[o].func||e.console.log("GSAP encountered missing dependency: "+o)}l=!1}}("undefined"!=typeof module&&module.exports&&"undefined"!=typeof global?global:this||window,"TweenMax"),define("greensock/TweenMax",function(){}),!function(e){var t=function(t,i){this.$element=e(t),this.options=i,this.init()};t.prototype={init:function(){_.bindAll(this)},_animate_loading:function(){return this.loading.is(":visible")?(e("div",this.loading).css("top",-40*this.loadingFrame+"px"),void(this.loadingFrame=(this.loadingFrame+1)%12)):void clearInterval(this.loadingTimer)},load:function(t){this.$element.children("#jswait-loading").remove(),this.$element.children("#jswait-overlay").remove(),this.loadingTimer=this.loadingFrame=1,this.options=t,this.$element.append(this.loading=e('<div id="jswait-loading"><div></div></div>'),this.overlay=e('<div id="jswait-overlay" class="mask hide"></div>')),this.options.modal&&this.overlay.removeClass("hide"),this.options.simple?(this.loading.css({background:"#000000","line-height":40,"text-align":"center"}),this.loading.html('<img src="/staticfs/thirdparty/jswait/jswait.gif">'),this.loading.show()):(clearInterval(this.loadingTimer),this.loading.show(),this.loadingTimer=setInterval(this._animate_loading,66)),this.waited=!0},close:function(){this.waited&&(this.loading.remove(),this.overlay.remove(),this.$element.children("#jswait-loading").remove(),this.$element.children("#jswait-overlay").remove(),this.loadingFrame=1,clearInterval(this.loadingTimer),this.waited=!1)}},e.fn.jswait=function(i){return this.each(function(){var n=e(this),a=n.data("jswait"),r=e.extend({},e.fn.jswait.defaults,"object"==typeof i&&i),o="string"==typeof i?i:null;a||n.data("jswait",a=new t(this,r)),o?a[o]():a.load(r)})},e.fn.jswait.defaults={modal:!1},e.fn.jswait.Constructor=t}(window.jQuery),define("jswait",["jquery"],function(){});var _gsScope="undefined"!=typeof module&&module.exports&&"undefined"!=typeof global?global:this||window;(_gsScope._gsQueue||(_gsScope._gsQueue=[])).push(function(){function e(e,t,i,n){return i=parseFloat(i)-parseFloat(e),n=parseFloat(n)-parseFloat(t),Math.sqrt(i*i+n*n)}function t(e){return"string"!=typeof e&&e.nodeType||(e=_gsScope.TweenLite.selector(e),e.length&&(e=e[0])),e}function i(e,t,i){var n,a,r=e.indexOf(" ");return-1===r?(n=void 0!==i?i+"":e,a=e):(n=e.substr(0,r),a=e.substr(r+1)),n=-1!==n.indexOf("%")?parseFloat(n)/100*t:parseFloat(n),a=-1!==a.indexOf("%")?parseFloat(a)/100*t:parseFloat(a),n>a?[a,n]:[n,a]}function n(i){if(!i)return 0;i=t(i);var n,a,r,o,s,l,c,d,h=i.tagName.toLowerCase();if("path"===h)n=i.getTotalLength()||0;else if("rect"===h)a=i.getBBox(),n=2*(a.width+a.height);else if("circle"===h)n=2*Math.PI*parseFloat(i.getAttribute("r"));else if("line"===h)n=e(i.getAttribute("x1"),i.getAttribute("y1"),i.getAttribute("x2"),i.getAttribute("y2"));else if("polyline"===h||"polygon"===h)for(r=i.getAttribute("points").split(" "),n=0,s=r[0].split(","),"polygon"===h&&(r.push(r[0]),-1===r[0].indexOf(",")&&r.push(r[1])),l=1;l<r.length;l++)o=r[l].split(","),1===o.length&&(o[1]=r[l++]),2===o.length&&(n+=e(s[0],s[1],o[0],o[1])||0,s=o);else"ellipse"===h&&(c=parseFloat(i.getAttribute("rx")),d=parseFloat(i.getAttribute("ry")),n=Math.PI*(3*(c+d)-Math.sqrt((3*c+d)*(c+3*d))));return n||0}function a(e,i){if(!e)return[0,0];e=t(e),i=i||n(e)+1;var a=o(e),r=a.strokeDasharray||"",s=parseFloat(a.strokeDashoffset);return r=-1===r.indexOf(" ")?i:parseFloat(r.split(" ")[0])||1e-5,r>i&&(r=i),[Math.max(0,-s),r-s]}var r,o=document.defaultView?document.defaultView.getComputedStyle:function(){};r=_gsScope._gsDefine.plugin({propName:"drawSVG",API:2,version:"0.0.4",global:!0,overwriteProps:["drawSVG"],init:function(e,t){if(!e.getBBox)return!1;var r,o,s,l=n(e)+1;return this._style=e.style,t===!0||"true"===t?t="0 100%":t?-1===(t+"").indexOf(" ")&&(t="0 "+t):t="0 0",r=a(e,l),o=i(t,l,r[0]),this._length=l+10,0===r[0]&&0===o[0]?(s=Math.max(1e-5,o[1]-l),this._dash=l+s,this._offset=l-r[1]+s,this._addTween(this,"_offset",this._offset,l-o[1]+s,"drawSVG")):(this._dash=r[1]-r[0]||1e-6,this._offset=-r[0],this._addTween(this,"_dash",this._dash,o[1]-o[0]||1e-5,"drawSVG"),this._addTween(this,"_offset",this._offset,-o[0],"drawSVG")),!0},set:function(e){this._firstPT&&(this._super.setRatio.call(this,e),this._style.strokeDashoffset=this._offset,this._style.strokeDasharray=this._dash+" "+this._length)}}),r.getLength=n,r.getPosition=a}),_gsScope._gsDefine&&_gsScope._gsQueue.pop()(),define("greensock/plugins/DrawSVGPlugin",function(){});var _gsScope="undefined"!=typeof module&&module.exports&&"undefined"!=typeof global?global:this||window;(_gsScope._gsQueue||(_gsScope._gsQueue=[])).push(function(){var e=Math.PI/180,t=180/Math.PI,i=/[achlmqstvz]|(-?\d*\.?\d*(?:e[\-+]?\d+)?)[0-9]/gi,n=/(?:(-|-=|\+=)?\d*\.?\d*(?:e[\-+]?\d+)?)[0-9]/gi,a=/[achlmqstvz]/gi,r=_gsScope.TweenLite,o=function(e){window.console&&console.log(e)},s=function(t,i){var n,a,r,o,s,l,c=Math.ceil(Math.abs(i)/90),d=0,h=[];for(t*=e,i*=e,n=i/c,a=4/3*Math.sin(n/2)/(1+Math.cos(n/2)),l=0;c>l;l++)r=t+l*n,o=Math.cos(r),s=Math.sin(r),h[d++]=o-a*s,h[d++]=s+a*o,r+=n,o=Math.cos(r),s=Math.sin(r),h[d++]=o+a*s,h[d++]=s-a*o,h[d++]=o,h[d++]=s;return h},l=function(i,n,a,r,o,l,c,d,h){if(i!==d||n!==h){a=Math.abs(a),r=Math.abs(r);var u=o%360*e,p=Math.cos(u),v=Math.sin(u),g=(i-d)/2,f=(n-h)/2,m=p*g+v*f,_=-v*g+p*f,w=a*a,y=r*r,b=m*m,x=_*_,S=b/w+x/y;S>1&&(a=Math.sqrt(S)*a,r=Math.sqrt(S)*r,w=a*a,y=r*r);var T=l===c?-1:1,k=(w*y-w*x-y*b)/(w*x+y*b);0>k&&(k=0);var C=T*Math.sqrt(k),P=C*(a*_/r),D=C*-(r*m/a),$=(i+d)/2,E=(n+h)/2,O=$+(p*P-v*D),I=E+(v*P+p*D),A=(m-P)/a,N=(_-D)/r,R=(-m-P)/a,M=(-_-D)/r,z=Math.sqrt(A*A+N*N),L=A;T=0>N?-1:1;var F=T*Math.acos(L/z)*t;z=Math.sqrt((A*A+N*N)*(R*R+M*M)),L=A*R+N*M,T=0>A*M-N*R?-1:1;var B=T*Math.acos(L/z)*t;!c&&B>0?B-=360:c&&0>B&&(B+=360),B%=360,F%=360;var W,U,j,V=s(F,B),H=p*a,Y=v*a,X=v*-r,q=p*r,G=V.length-2;for(W=0;G>W;W+=2)U=V[W],j=V[W+1],V[W]=U*H+j*X+O,V[W+1]=U*Y+j*q+I;return V[V.length-2]=d,V[V.length-1]=h,V}},c=function(e){var t,n,a,r,s,c,d,h,u,p,v,g,f,m=(e+"").match(i)||[],_=[],w=0,y=0,b=m.length,x=2,S=0;if(!e||!isNaN(m[0])||isNaN(m[1]))return o("ERROR: malformed path data: "+e),_;for(t=0;b>t;t++)if(f=s,isNaN(m[t])?(s=m[t].toUpperCase(),c=s!==m[t]):t--,a=+m[t+1],r=+m[t+2],c&&(a+=w,r+=y),0===t&&(h=a,u=r),"M"===s)d&&d.length<8&&(_.length-=1,x=0),w=h=a,y=u=r,d=[a,r],S+=x,x=2,_.push(d),t+=2,s="L";else if("C"===s)d||(d=[0,0]),d[x++]=a,d[x++]=r,c||(w=y=0),d[x++]=w+1*m[t+3],d[x++]=y+1*m[t+4],d[x++]=w+=1*m[t+5],d[x++]=y+=1*m[t+6],t+=6;else if("S"===s)"C"===f||"S"===f?(p=w-d[x-4],v=y-d[x-3],d[x++]=w+p,d[x++]=y+v):(d[x++]=w,d[x++]=y),d[x++]=a,d[x++]=r,c||(w=y=0),d[x++]=w+=1*m[t+3],d[x++]=y+=1*m[t+4],t+=4;else if("Q"===s)p=a-w,v=r-y,d[x++]=w+2*p/3,d[x++]=y+2*v/3,c||(w=y=0),w+=1*m[t+3],y+=1*m[t+4],p=a-w,v=r-y,d[x++]=w+2*p/3,d[x++]=y+2*v/3,d[x++]=w,d[x++]=y,t+=4;else if("T"===s)p=w-d[x-4],v=y-d[x-3],d[x++]=w+p,d[x++]=y+v,p=w+1.5*p-a,v=y+1.5*v-r,d[x++]=a+2*p/3,d[x++]=r+2*v/3,d[x++]=w=a,d[x++]=y=r,t+=2;else if("H"===s)r=y,d[x++]=w+(a-w)/3,d[x++]=y+(r-y)/3,d[x++]=w+2*(a-w)/3,d[x++]=y+2*(r-y)/3,d[x++]=w=a,d[x++]=r,t+=1;else if("V"===s)r=a,a=w,c&&(r+=y-w),d[x++]=a,d[x++]=y+(r-y)/3,d[x++]=a,d[x++]=y+2*(r-y)/3,d[x++]=a,d[x++]=y=r,t+=1;else if("L"===s||"Z"===s)"Z"===s&&(a=h,r=u,d.closed=!0),("L"===s||Math.abs(w-a)>.5||Math.abs(y-r)>.5)&&(d[x++]=w+(a-w)/3,d[x++]=y+(r-y)/3,d[x++]=w+2*(a-w)/3,d[x++]=y+2*(r-y)/3,d[x++]=a,d[x++]=r,"L"===s&&(t+=2)),w=a,y=r;else if("A"===s){for(g=l(w,y,1*m[t+1],1*m[t+2],1*m[t+3],1*m[t+4],1*m[t+5],(c?w:0)+1*m[t+6],(c?y:0)+1*m[t+7]),n=0;n<g.length;n++)d[x++]=g[n];w=d[x-2],y=d[x-1],t+=7}else o("Error: malformed path data: "+e);return _.totalPoints=S+x,_},d=function(e,t){var i,n,a,r,o,s,l,c,d,h,u,p,v,g,f=0,m=.999999,_=e.length,w=t/((_-2)/6);for(v=2;_>v;v+=6)for(f+=w;f>m;)i=e[v-2],n=e[v-1],a=e[v],r=e[v+1],o=e[v+2],s=e[v+3],l=e[v+4],c=e[v+5],g=1/(Math.floor(f)+1),d=i+(a-i)*g,u=a+(o-a)*g,d+=(u-d)*g,u+=(o+(l-o)*g-u)*g,h=n+(r-n)*g,p=r+(s-r)*g,h+=(p-h)*g,p+=(s+(c-s)*g-p)*g,e.splice(v,4,i+(a-i)*g,n+(r-n)*g,d,h,d+(u-d)*g,h+(p-h)*g,u,p,o+(l-o)*g,s+(c-s)*g),v+=6,_+=6,f--;return e},h=function(e){var t,i,n,a,r="",o=e.length,s=100;for(i=0;o>i;i++){for(a=e[i],r+="M"+a[0]+","+a[1]+" C",t=a.length,n=2;t>n;n++)r+=(a[n++]*s|0)/s+","+(a[n++]*s|0)/s+" "+(a[n++]*s|0)/s+","+(a[n++]*s|0)/s+" "+(a[n++]*s|0)/s+","+(a[n]*s|0)/s+" ";a.closed&&(r+="z")}return r},u=function(e){for(var t=[],i=e.length-1,n=0;--i>-1;)t[n++]=e[i],t[n++]=e[i+1],i--;for(i=0;n>i;i++)e[i]=t[i];e.reversed=e.reversed?!1:!0},p=function(e){var t,i=e.length,n=0,a=0;for(t=0;i>t;t++)n+=e[t++],a+=e[t];return[n/(i/2),a/(i/2)]},v=function(e){var t,i,n,a=e.length,r=e[0],o=r,s=e[1],l=s;for(n=6;a>n;n+=6)t=e[n],i=e[n+1],t>r?r=t:o>t&&(o=t),i>s?s=i:l>i&&(l=i);return e.centerX=(r+o)/2,e.centerY=(s+l)/2,e.size=(r-o)*(s-l)},g=function(e){for(var t,i,n,a,r,o=e.length,s=e[0][0],l=s,c=e[0][1],d=c;--o>-1;)for(r=e[o],t=r.length,a=6;t>a;a+=6)i=r[a],n=r[a+1],i>s?s=i:l>i&&(l=i),n>c?c=n:d>n&&(d=n);return e.centerX=(s+l)/2,e.centerY=(c+d)/2,e.size=(s-l)*(c-d)},f=function(e,t){return t.length-e.length},m=function(e,t){var i=e.size||v(e),n=t.size||v(t);return Math.abs(n-i)<(i+n)/20?t.centerX-e.centerX||t.centerY-e.centerY:n-i},_=function(e,t){var i,n,a=e.slice(0),r=e.length,o=r-2;for(t=0|t,i=0;r>i;i++)n=(i+t)%o,e[i++]=a[n],e[i]=a[n+1]},w=function(e,t,i,n,a){var r,o,s,l,c=e.length,d=0,h=c-2;for(i*=6,o=0;c>o;o+=6)r=(o+i)%h,l=e[r]-(t[o]-n),s=e[r+1]-(t[o+1]-a),d+=Math.sqrt(s*s+l*l);return d},y=function(e,t,i){var n,a,r,o=e.length,s=p(e),l=p(t),c=l[0]-s[0],d=l[1]-s[1],h=w(e,t,0,c,d),v=0;for(r=6;o>r;r+=6)a=w(e,t,r/6,c,d),h>a&&(h=a,v=r);if(i)for(n=e.slice(0),u(n),r=6;o>r;r+=6)a=w(n,t,r/6,c,d),h>a&&(h=a,v=-r);return v/6},b=function(e,t,i){for(var n,a,r,o,s,l,c=e.length,d=99999999999,h=0,u=0;--c>-1;)for(n=e[c],l=n.length,s=0;l>s;s+=6)a=n[s]-t,r=n[s+1]-i,o=Math.sqrt(a*a+r*r),d>o&&(d=o,h=n[s],u=n[s+1]);return[h,u]},x=function(e,t,i,n,a,r){var o,s,l,c,d,h=t.length,u=0,p=Math.min(e.size||v(e),t[i].size||v(t[i]))*n,g=999999999999,f=e.centerX+a,m=e.centerY+r;for(s=i;h>s&&(o=t[s].size||v(t[s]),!(p>o));s++)l=t[s].centerX-f,c=t[s].centerY-m,d=Math.sqrt(l*l+c*c),g>d&&(u=s,g=d);return d=t[u],t.splice(u,1),d},S=function(e,t,i,n){var a,r,s,l,c,h,p,w=t.length-e.length,S=w>0?t:e,T=w>0?e:t,k=0,C="complexity"===n?f:m,P="position"===n?0:"number"==typeof n?n:.8,D=T.length,$="object"==typeof i&&i.push?i.slice(0):[i],E="reverse"===$[0]||$[0]<0,O="log"===i;if(T[0]){if(S.length>1&&(e.sort(C),t.sort(C),h=S.size||g(S),h=T.size||g(T),h=S.centerX-T.centerX,p=S.centerY-T.centerY,C===m))for(D=0;D<T.length;D++)S.splice(D,0,x(T[D],S,D,P,h,p));if(w)for(0>w&&(w=-w),S[0].length>T[0].length&&d(T[0],(S[0].length-T[0].length)/6|0),D=T.length;w>k;)l=S[D].size||v(S[D]),s=b(T,S[D].centerX,S[D].centerY),l=s[0],c=s[1],T[D++]=[l,c,l,c,l,c,l,c],T.totalPoints+=8,k++;for(D=0;D<e.length;D++)a=t[D],r=e[D],w=a.length-r.length,0>w?d(a,-w/6|0):w>0&&d(r,w/6|0),E&&!r.reversed&&u(r),i=$[D]||0===$[D]?$[D]:"auto",i&&(r.closed||Math.abs(r[0]-r[r.length-2])<.5&&Math.abs(r[1]-r[r.length-1])<.5?"auto"===i||"log"===i?($[D]=i=y(r,a,0===D),0>i&&(E=!0,u(r),i=-i),_(r,6*i)):"reverse"!==i&&(D&&0>i&&u(r),_(r,6*(0>i?-i:i))):!E&&("auto"===i&&Math.abs(a[0]-r[0])+Math.abs(a[1]-r[1])+Math.abs(a[a.length-2]-r[r.length-2])+Math.abs(a[a.length-1]-r[r.length-1])>Math.abs(a[0]-r[r.length-2])+Math.abs(a[1]-r[r.length-1])+Math.abs(a[a.length-2]-r[0])+Math.abs(a[a.length-1]-r[1])||i%2)?(u(r),$[D]=-1,E=!0):"auto"===i?$[D]=0:"reverse"===i&&($[D]=-1),r.closed!==a.closed&&(r.closed=a.closed=!1));
return O&&o("shapeIndex:["+$.join(",")+"]"),$}},T=function(e,t,i,n){var a=c(e[0]),r=c(e[1]);S(a,r,t||0===t?t:"auto",i)&&(e[0]=h(a),e[1]=h(r),("log"===n||n===!0)&&o('precompile:["'+e[0]+'","'+e[1]+'"]'))},k=function(e,t,i){return t||i||e||0===e?function(n){T(n,e,t,i)}:T},C=function(e,t){if(!t)return e;var i,a,r,o=e.match(n)||[],s=o.length,l="";for("reverse"===t?(a=s-1,i=-2):(a=(2*(parseInt(t,10)||0)+1+100*s)%s,i=2),r=0;s>r;r+=2)l+=o[a-1]+","+o[a]+" ",a=(a+i)%s;return l},P=function(e,t){var i,n,a,r,o,s,l,c=0,d=parseFloat(e[0]),h=parseFloat(e[1]),u=d+","+h+" ",p=.999999;for(a=e.length,i=.5*t/(.5*a-1),n=0;a-2>n;n+=2){if(c+=i,s=parseFloat(e[n+2]),l=parseFloat(e[n+3]),c>p)for(o=1/(Math.floor(c)+1),r=1;c>p;)u+=(d+(s-d)*o*r).toFixed(2)+","+(h+(l-h)*o*r).toFixed(2)+" ",c--,r++;u+=s+","+l+" ",d=s,h=l}return u},D=function(e){var t=e[0].match(n)||[],i=e[1].match(n)||[],a=i.length-t.length;a>0?e[0]=P(t,a):e[1]=P(i,-a)},$=function(e){return isNaN(e)?D:function(t){D(t),t[1]=C(t[1],parseInt(e,10))}},E=function(e,t){var i=document.createElementNS("http://www.w3.org/2000/svg","path"),n=Array.prototype.slice.call(e.attributes),a=n.length;for(t=","+t+",";--a>-1;)-1===t.indexOf(","+n[a].nodeName+",")&&i.setAttributeNS(null,n[a].nodeName,n[a].nodeValue);return i},O=function(e,t){var i,a,r,o,s,l,c,d,h,u,p,v,g,f,m,_,w,y,b,x,S,T=e.tagName.toLowerCase(),k=.552284749831;return"path"!==T&&e.getBBox?(l=E(e,"x,y,width,height,cx,cy,rx,ry,r,x1,x2,y1,y2,points"),"rect"===T?(o=+e.getAttribute("rx")||0,s=+e.getAttribute("ry")||0,a=+e.getAttribute("x")||0,r=+e.getAttribute("y")||0,u=(+e.getAttribute("width")||0)-2*o,p=(+e.getAttribute("height")||0)-2*s,o||s?(v=a+o*(1-k),g=a+o,f=g+u,m=f+o*k,_=f+o,w=r+s*(1-k),y=r+s,b=y+p,x=b+s*k,S=b+s,i="M"+_+","+y+" V"+b+" C"+[_,x,m,S,f,S,f-(f-g)/3,S,g+(f-g)/3,S,g,S,v,S,a,x,a,b,a,b-(b-y)/3,a,y+(b-y)/3,a,y,a,w,v,r,g,r,g+(f-g)/3,r,f-(f-g)/3,r,f,r,m,r,_,w,_,y].join(",")+"z"):i="M"+(a+u)+","+r+" v"+p+" h"+-u+" v"+-p+" h"+u+"z"):"circle"===T||"ellipse"===T?("circle"===T?(o=s=+e.getAttribute("r")||0,d=o*k):(o=+e.getAttribute("rx")||0,s=+e.getAttribute("ry")||0,d=s*k),a=+e.getAttribute("cx")||0,r=+e.getAttribute("cy")||0,c=o*k,i="M"+(a+o)+","+r+" C"+[a+o,r+d,a+c,r+s,a,r+s,a-c,r+s,a-o,r+d,a-o,r,a-o,r-d,a-c,r-s,a,r-s,a+c,r-s,a+o,r-d,a+o,r].join(",")+"z"):"line"===T?i="M"+e.getAttribute("x1")+","+e.getAttribute("y1")+" L"+e.getAttribute("x2")+","+e.getAttribute("y2"):("polyline"===T||"polygon"===T)&&(h=(e.getAttribute("points")+"").match(n)||[],a=h.shift(),r=h.shift(),i="M"+a+","+r+" L"+h.join(","),"polygon"===T&&(i+=","+a+","+r+"z")),l.setAttribute("d",i),t&&e.parentNode&&(e.parentNode.insertBefore(l,e),e.parentNode.removeChild(e)),l):e},I=function(e,t,i){var a,s,l="string"==typeof e;return(!l||(e.match(n)||[]).length<3)&&(a=l?r.selector(e):[e],a&&a[0]?(a=a[0],s=a.nodeName.toUpperCase(),t&&"PATH"!==s&&(a=O(a,!1),s="PATH"),e=a.getAttribute("PATH"===s?"d":"points")||"",a===i&&(e=a.getAttributeNS(null,"data-original")||e)):(o("WARNING: invalid morph to: "+e),e=!1)),e},A="Use MorphSVGPlugin.convertToPath(elementOrSelectorText) to convert to a path before morphing.",N=_gsScope._gsDefine.plugin({propName:"morphSVG",API:2,global:!0,version:"0.8.1",init:function(e,t){var i,n,r,s,l;return"function"!=typeof e.setAttribute?!1:(i=e.nodeName.toUpperCase(),l="POLYLINE"===i||"POLYGON"===i,"PATH"===i||l?(n="PATH"===i?"d":"points",("string"==typeof t||t.getBBox||t[0])&&(t={shape:t}),s=I(t.shape||t.d||t.points||"","d"===n,e),l&&a.test(s)?(o("WARNING: a <"+i+"> cannot accept path data. "+A),!1):(s&&(this._target=e,e.getAttributeNS(null,"data-original")||e.setAttributeNS(null,"data-original",e.getAttribute(n)),r=this._addTween(e,"setAttribute",e.getAttribute(n)+"",s+"","morphSVG",!1,n,"object"==typeof t.precompile?function(e){e[0]=t.precompile[0],e[1]=t.precompile[1]}:"d"===n?k(t.shapeIndex,t.map||N.defaultMap,t.precompile):$(t.shapeIndex)),r&&(this._overwriteProps.push("morphSVG"),r.end=s,r.endProp=n)),!0)):(o("WARNING: cannot morph a <"+i+"> SVG element. "+A),!1))},set:function(e){var t;if(this._super.setRatio.call(this,e),1===e)for(t=this._firstPT;t;)t.end&&this._target.setAttribute(t.endProp,t.end),t=t._next}});N.pathFilter=T,N.pointsFilter=D,N.subdivideRawBezier=d,N.defaultMap="size",N.pathDataToRawBezier=function(e){return c(I(e,!0))},N.equalizeSegmentQuantity=S,N.convertToPath=function(e,t){"string"==typeof e&&(e=r.selector(e));for(var i=e&&0!==e.length?e.length&&e[0]&&e[0].nodeType?Array.prototype.slice.call(e,0):[e]:[],n=i.length;--n>-1;)i[n]=O(i[n],t!==!1);return i},N.pathDataToBezier=function(e,t){var i,n,a,o,s,l,d,h,u=c(I(e,!0))[0]||[],p=0;if(t=t||{},h=t.align||t.relative,o=t.matrix||[1,0,0,1,0,0],s=t.offsetX||0,l=t.offsetY||0,"relative"===h||h===!0?(s-=u[0]*o[0]+u[1]*o[2],l-=u[0]*o[1]+u[1]*o[3],p="+="):(s+=o[4],l+=o[5],h&&(h="string"==typeof h?r.selector(h):[h],h&&h[0]&&(d=h[0].getBBox()||{x:0,y:0},s-=d.x,l-=d.y))),i=[],a=u.length,o)for(n=0;a>n;n+=2)i.push({x:p+(u[n]*o[0]+u[n+1]*o[2]+s),y:p+(u[n]*o[1]+u[n+1]*o[3]+l)});else for(n=0;a>n;n+=2)i.push({x:p+(u[n]+s),y:p+(u[n+1]+l)});return i}}),_gsScope._gsDefine&&_gsScope._gsQueue.pop()(),define("greensock/plugins/MorphSVGPlugin",function(){});var _gsScope="undefined"!=typeof module&&module.exports&&"undefined"!=typeof global?global:this||window;(_gsScope._gsQueue||(_gsScope._gsQueue=[])).push(function(){var e=function(t){var i=t.nodeType,n="";if(1===i||9===i||11===i){if("string"==typeof t.textContent)return t.textContent;for(t=t.firstChild;t;t=t.nextSibling)n+=e(t)}else if(3===i||4===i)return t.nodeValue;return n},t=_gsScope._gsDefine.plugin({propName:"text",API:2,version:"0.5.1",init:function(t,i,n){var a,r;if(!("innerHTML"in t))return!1;if(this._target=t,"object"!=typeof i&&(i={value:i}),void 0===i.value)return this._text=this._original=[""],!0;if(this._delimiter=i.delimiter||"",this._original=e(t).replace(/\s+/g," ").split(this._delimiter),this._delimiter)this._text=i.value.replace(/\s+/g," ").split(this._delimiter);else{var o=i.value.replace(/\s+/g," ");this._text=[];for(var s=0;o.length;){{var l=o.indexOf("<div>"),c=o.indexOf("</div>");o.indexOf("<br>")}if(-1!=l||-1!=c){if(-1==l&&(l=99999),-1==c&&(c=99999),c>l)var d=!0;else var d=!1;if(d){var h=o.slice(s,l);if(h)for(var u=h.split(""),p=0;p<u.length;p++)"<"==u[p]&&"b"==u[p+1]&&"r"==u[p+2]&&">"==u[p+3]?(this._text.push("<br>"),p+=3):this._text.push(u[p]);this._text.push("<div>"),o=o.slice(l+5)}else{var h=o.slice(s,c);if(h)for(var u=h.split(""),p=0;p<u.length;p++)"<"==u[p]&&"b"==u[p+1]&&"r"==u[p+2]&&">"==u[p+3]?(this._text.push("<br>"),p+=3):this._text.push(u[p]);this._text.push("</div>"),o=o.slice(c+6)}}else{if(o)for(var u=o.split(""),p=0;p<u.length;p++)this._text.push(u[p]);o=""}}}for(this._runBackwards=n.vars.runBackwards===!0,this._runBackwards&&(a=this._original,this._original=this._text,this._text=a),"string"==typeof i.newClass&&(this._newClass=i.newClass,this._hasClass=!0),"string"==typeof i.oldClass&&(this._oldClass=i.oldClass,this._hasClass=!0),a=this._original.length-this._text.length,r=0>a?this._original:this._text,this._fillChar=i.fillChar||(i.padSpace?"&nbsp;":""),0>a&&(a=-a);--a>-1;)r.push(this._fillChar);return!0},set:function(e){e>1?e=1:0>e&&(e=0),this._runBackwards&&(e=1-e);var t,i,n,a=this._text.length,r=e*a+.5|0;this._hasClass?(t=this._newClass&&0!==r,i=this._oldClass&&r!==a,n=(t?"<span class='"+this._newClass+"'>":"")+this._text.slice(0,r).join(this._delimiter)+(t?"</span>":"")+(i?"<span class='"+this._oldClass+"'>":"")+this._delimiter+this._original.slice(r).join(this._delimiter)+(i?"</span>":"")):n=this._text.slice(0,r).join(this._delimiter)+this._delimiter+this._original.slice(r).join(this._delimiter),this._target.innerHTML="&nbsp;"===this._fillChar&&-1!==n.indexOf("  ")?n.split("  ").join("&nbsp;&nbsp;"):n}}),i=t.prototype;i._newClass=i._oldClass=i._delimiter=""}),_gsScope._gsDefine&&_gsScope._gsQueue.pop()(),define("greensock/plugins/TextPlugin",function(){}),function(e,t,i){function n(e,i){this.wrapper="string"==typeof e?t.querySelector(e):e,this.scroller=this.wrapper.children[0],this.scrollerStyle=this.scroller.style,this.options={resizeScrollbars:!0,mouseWheelSpeed:20,snapThreshold:.334,startX:0,startY:0,scrollY:!0,directionLockThreshold:5,momentum:!0,bounce:!0,bounceTime:600,bounceEasing:"",preventDefault:!0,preventDefaultException:{tagName:/^(INPUT|TEXTAREA|BUTTON|SELECT)$/},HWCompositing:!0,useTransition:!0,useTransform:!0};for(var n in i)this.options[n]=i[n];this.translateZ=this.options.HWCompositing&&s.hasPerspective?" translateZ(0)":"",this.options.useTransition=s.hasTransition&&this.options.useTransition,this.options.useTransform=s.hasTransform&&this.options.useTransform,this.options.eventPassthrough=this.options.eventPassthrough===!0?"vertical":this.options.eventPassthrough,this.options.preventDefault=!this.options.eventPassthrough&&this.options.preventDefault,this.options.scrollY="vertical"==this.options.eventPassthrough?!1:this.options.scrollY,this.options.scrollX="horizontal"==this.options.eventPassthrough?!1:this.options.scrollX,this.options.freeScroll=this.options.freeScroll&&!this.options.eventPassthrough,this.options.directionLockThreshold=this.options.eventPassthrough?0:this.options.directionLockThreshold,this.options.bounceEasing="string"==typeof this.options.bounceEasing?s.ease[this.options.bounceEasing]||s.ease.circular:this.options.bounceEasing,this.options.resizePolling=void 0===this.options.resizePolling?60:this.options.resizePolling,this.options.tap===!0&&(this.options.tap="tap"),"scale"==this.options.shrinkScrollbars&&(this.options.useTransition=!1),this.options.invertWheelDirection=this.options.invertWheelDirection?-1:1,3==this.options.probeType&&(this.options.useTransition=!1),this.x=0,this.y=0,this.directionX=0,this.directionY=0,this._events={},this._init(),this.refresh(),this.scrollTo(this.options.startX,this.options.startY),this.enable()}function a(e,i,n){var a=t.createElement("div"),r=t.createElement("div");return n===!0&&(a.style.cssText="position:absolute;z-index:9999",r.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;position:absolute;background:rgba(0,0,0,0.5);border:1px solid rgba(255,255,255,0.9);border-radius:3px"),r.className="iScrollIndicator","h"==e?(n===!0&&(a.style.cssText+=";height:7px;left:2px;right:2px;bottom:0",r.style.height="100%"),a.className="iScrollHorizontalScrollbar"):(n===!0&&(a.style.cssText+=";width:7px;bottom:2px;top:2px;right:1px",r.style.width="100%"),a.className="iScrollVerticalScrollbar"),a.style.cssText+=";overflow:hidden",i||(a.style.pointerEvents="none"),a.appendChild(r),a}function r(i,n){this.wrapper="string"==typeof n.el?t.querySelector(n.el):n.el,this.wrapperStyle=this.wrapper.style,this.indicator=this.wrapper.children[0],this.indicatorStyle=this.indicator.style,this.scroller=i,this.options={listenX:!0,listenY:!0,interactive:!1,resize:!0,defaultScrollbars:!1,shrink:!1,fade:!1,speedRatioX:0,speedRatioY:0};for(var a in n)this.options[a]=n[a];this.sizeRatioX=1,this.sizeRatioY=1,this.maxPosX=0,this.maxPosY=0,this.options.interactive&&(this.options.disableTouch||(s.addEvent(this.indicator,"touchstart",this),s.addEvent(e,"touchend",this)),this.options.disablePointer||(s.addEvent(this.indicator,"MSPointerDown",this),s.addEvent(e,"MSPointerUp",this)),this.options.disableMouse||(s.addEvent(this.indicator,"mousedown",this),s.addEvent(e,"mouseup",this))),this.options.fade&&(this.wrapperStyle[s.style.transform]=this.scroller.translateZ,this.wrapperStyle[s.style.transitionDuration]=s.isBadAndroid?"0.001s":"0ms",this.wrapperStyle.opacity="0")}var o=e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||e.msRequestAnimationFrame||function(t){e.setTimeout(t,1e3/60)},s=function(){function n(e){return o===!1?!1:""===o?e:o+e.charAt(0).toUpperCase()+e.substr(1)}var a={},r=t.createElement("div").style,o=function(){for(var e,t=["t","webkitT","MozT","msT","OT"],i=0,n=t.length;n>i;i++)if(e=t[i]+"ransform",e in r)return t[i].substr(0,t[i].length-1);return!1}();a.getTime=Date.now||function(){return(new Date).getTime()},a.extend=function(e,t){for(var i in t)e[i]=t[i]},a.addEvent=function(e,t,i,n){e.addEventListener?e.addEventListener(t,i,!!n):e.attachEvent(t,i)},a.removeEvent=function(e,t,i,n){e.removeEventListener?e.removeEventListener(t,i,!!n):e.detachEvent(t,i)},a.momentum=function(e,t,n,a,r,o){var s,l,c=e-t,d=i.abs(c)/n;return o=void 0===o?6e-4:o,s=e+d*d/(2*o)*(0>c?-1:1),l=d/o,a>s?(s=r?a-r/2.5*(d/8):a,c=i.abs(s-e),l=c/d):s>0&&(s=r?r/2.5*(d/8):0,c=i.abs(e)+s,l=c/d),{destination:i.round(s),duration:l}};var s=n("transform");return a.extend(a,{hasTransform:s!==!1,hasPerspective:n("perspective")in r,hasTouch:"ontouchstart"in e,hasPointer:navigator.msPointerEnabled,hasTransition:n("transition")in r}),a.isBadAndroid=/Android /.test(e.navigator.appVersion)&&!/Chrome\/\d/.test(e.navigator.appVersion),a.extend(a.style={},{transform:s,transitionTimingFunction:n("transitionTimingFunction"),transitionDuration:n("transitionDuration"),transitionDelay:n("transitionDelay"),transformOrigin:n("transformOrigin")}),a.hasClass=function(e,t){var i=new RegExp("(^|\\s)"+t+"(\\s|$)");return i.test(e.className)},a.addClass=function(e,t){if(!a.hasClass(e,t)){var i=e.className.split(" ");i.push(t),e.className=i.join(" ")}},a.removeClass=function(e,t){if(a.hasClass(e,t)){var i=new RegExp("(^|\\s)"+t+"(\\s|$)","g");e.className=e.className.replace(i," ")}},a.offset=function(e){for(var t=-e.offsetLeft,i=-e.offsetTop;e=e.offsetParent;)t-=e.offsetLeft,i-=e.offsetTop;return{left:t,top:i}},a.preventDefaultException=function(e,t){for(var i in t)if(t[i].test(e[i]))return!0;return!1},a.extend(a.eventType={},{touchstart:1,touchmove:1,touchend:1,mousedown:2,mousemove:2,mouseup:2,MSPointerDown:3,MSPointerMove:3,MSPointerUp:3}),a.extend(a.ease={},{quadratic:{style:"cubic-bezier(0.25, 0.46, 0.45, 0.94)",fn:function(e){return e*(2-e)}},circular:{style:"cubic-bezier(0.1, 0.57, 0.1, 1)",fn:function(e){return i.sqrt(1- --e*e)}},back:{style:"cubic-bezier(0.175, 0.885, 0.32, 1.275)",fn:function(e){var t=4;return(e-=1)*e*((t+1)*e+t)+1}},bounce:{style:"",fn:function(e){return(e/=1)<1/2.75?7.5625*e*e:2/2.75>e?7.5625*(e-=1.5/2.75)*e+.75:2.5/2.75>e?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375}},elastic:{style:"",fn:function(e){var t=.22,n=.4;return 0===e?0:1==e?1:n*i.pow(2,-10*e)*i.sin(2*(e-t/4)*i.PI/t)+1}}}),a.tap=function(e,i){var n=t.createEvent("Event");n.initEvent(i,!0,!0),n.pageX=e.pageX,n.pageY=e.pageY,e.target.dispatchEvent(n)},a.click=function(e){var i,n=e.target;/(SELECT|INPUT|TEXTAREA)/i.test(n.tagName)||(i=t.createEvent("MouseEvents"),i.initMouseEvent("click",!0,!0,e.view,1,n.screenX,n.screenY,n.clientX,n.clientY,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,0,null),i._constructed=!0,n.dispatchEvent(i))},a}();n.prototype={version:"5.1.1",_init:function(){this._initEvents(),(this.options.scrollbars||this.options.indicators)&&this._initIndicators(),this.options.mouseWheel&&this._initWheel(),this.options.snap&&this._initSnap(),this.options.keyBindings&&this._initKeys()},destroy:function(){this._initEvents(!0),this._execEvent("destroy")},_transitionEnd:function(e){e.target==this.scroller&&this.isInTransition&&(this._transitionTime(),this.resetPosition(this.options.bounceTime)||(this.isInTransition=!1,this._execEvent("scrollEnd")))},_start:function(e){if(!(1!=s.eventType[e.type]&&0!==e.button||!this.enabled||this.initiated&&s.eventType[e.type]!==this.initiated)){!this.options.preventDefault||s.isBadAndroid||s.preventDefaultException(e.target,this.options.preventDefaultException)||e.preventDefault();var t,n=e.touches?e.touches[0]:e;this.initiated=s.eventType[e.type],this.moved=!1,this.distX=0,this.distY=0,this.directionX=0,this.directionY=0,this.directionLocked=0,this._transitionTime(),this.startTime=s.getTime(),this.options.useTransition&&this.isInTransition?(this.isInTransition=!1,t=this.getComputedPosition(),this._translate(i.round(t.x),i.round(t.y)),this._execEvent("scrollEnd")):!this.options.useTransition&&this.isAnimating&&(this.isAnimating=!1,this._execEvent("scrollEnd")),this.startX=this.x,this.startY=this.y,this.absStartX=this.x,this.absStartY=this.y,this.pointX=n.pageX,this.pointY=n.pageY,this._execEvent("beforeScrollStart")}},_move:function(e){if(this.enabled&&s.eventType[e.type]===this.initiated){this.options.preventDefault&&e.preventDefault();var t,n,a,r,o=e.touches?e.touches[0]:e,l=o.pageX-this.pointX,c=o.pageY-this.pointY,d=s.getTime();if(this.pointX=o.pageX,this.pointY=o.pageY,this.distX+=l,this.distY+=c,a=i.abs(this.distX),r=i.abs(this.distY),!(d-this.endTime>300&&10>a&&10>r)){if(this.directionLocked||this.options.freeScroll||(this.directionLocked=a>r+this.options.directionLockThreshold?"h":r>=a+this.options.directionLockThreshold?"v":"n"),"h"==this.directionLocked){if("vertical"==this.options.eventPassthrough)e.preventDefault();else if("horizontal"==this.options.eventPassthrough)return void(this.initiated=!1);c=0}else if("v"==this.directionLocked){if("horizontal"==this.options.eventPassthrough)e.preventDefault();else if("vertical"==this.options.eventPassthrough)return void(this.initiated=!1);l=0}l=this.hasHorizontalScroll?l:0,c=this.hasVerticalScroll?c:0,(this.options.scrollX&&l||this.options.scrollY&&c)&&e.stopPropagation(),t=this.x+l,n=this.y+c,(t>0||t<this.maxScrollX)&&(t=this.options.bounce?this.x+l/3:t>0?0:this.maxScrollX),(n>0||n<this.maxScrollY)&&(n=this.options.bounce?this.y+c/3:n>0?0:this.maxScrollY),this.directionX=l>0?-1:0>l?1:0,this.directionY=c>0?-1:0>c?1:0,this.moved||this._execEvent("scrollStart"),this.enabled&&(this.moved=!0,this._translate(t,n),d-this.startTime>300&&(this.startTime=d,this.startX=this.x,this.startY=this.y,1==this.options.probeType&&this._execEvent("scroll")),this.options.probeType>1&&this._execEvent("scroll"))}}},_end:function(e){if(this.enabled&&s.eventType[e.type]===this.initiated){this.options.preventDefault&&!s.preventDefaultException(e.target,this.options.preventDefaultException)&&e.preventDefault();var t,n,a=(e.changedTouches?e.changedTouches[0]:e,s.getTime()-this.startTime),r=i.round(this.x),o=i.round(this.y),l=i.abs(r-this.startX),c=i.abs(o-this.startY),d=0,h="";if(this.isInTransition=0,this.initiated=0,this.endTime=s.getTime(),!this.resetPosition(this.options.bounceTime)){if(this.scrollTo(r,o),!this.moved)return this.options.tap&&s.tap(e,this.options.tap),this.options.click&&s.click(e),void this._execEvent("scrollCancel");if(this._events.flick&&200>a&&100>l&&100>c)return void this._execEvent("flick");if(this.options.momentum&&300>a&&(t=this.hasHorizontalScroll?s.momentum(this.x,this.startX,a,this.maxScrollX,this.options.bounce?this.wrapperWidth:0,this.options.deceleration):{destination:r,duration:0},n=this.hasVerticalScroll?s.momentum(this.y,this.startY,a,this.maxScrollY,this.options.bounce?this.wrapperHeight:0,this.options.deceleration):{destination:o,duration:0},r=t.destination,o=n.destination,d=i.max(t.duration,n.duration),this.isInTransition=1),this.options.snap){var u=this._nearestSnap(r,o);this.currentPage=u,d=this.options.snapSpeed||i.max(i.max(i.min(i.abs(r-u.x),1e3),i.min(i.abs(o-u.y),1e3)),300),r=u.x,o=u.y,this.directionX=0,this.directionY=0,h=this.options.bounceEasing}return r!=this.x||o!=this.y?((r>0||r<this.maxScrollX||o>0||o<this.maxScrollY)&&(h=s.ease.quadratic),void this.scrollTo(r,o,d,h)):void this._execEvent("scrollEnd")}}},_resize:function(){var e=this;clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(function(){e.refresh()},this.options.resizePolling)},resetPosition:function(e){var t=this.x,i=this.y;return e=e||0,!this.hasHorizontalScroll||this.x>0?t=0:this.x<this.maxScrollX&&(t=this.maxScrollX),!this.hasVerticalScroll||this.y>0?i=0:this.y<this.maxScrollY&&(i=this.maxScrollY),t==this.x&&i==this.y?!1:(this.scrollTo(t,i,e,this.options.bounceEasing),!0)},disable:function(){this.enabled=!1},enable:function(){this.enabled=!0},refresh:function(){this.options.scrollerHeight||this.wrapper.offsetHeight;this.wrapperWidth=this.options.wrapperWidth||this.wrapper.clientWidth,this.wrapperHeight=this.options.wrapperHeight||this.wrapper.clientHeight,this.scrollerWidth=this.options.scrollerWidth||this.scroller.offsetWidth,this.scrollerHeight=this.options.scrollerHeight||this.scroller.offsetHeight,this.maxScrollX=this.wrapperWidth-this.scrollerWidth,this.maxScrollY=this.wrapperHeight-this.scrollerHeight,this.hasHorizontalScroll=this.options.scrollX&&this.maxScrollX<0,this.hasVerticalScroll=this.options.scrollY&&this.maxScrollY<0,this.hasHorizontalScroll||(this.maxScrollX=0,this.scrollerWidth=this.wrapperWidth),this.hasVerticalScroll||(this.maxScrollY=0,this.scrollerHeight=this.wrapperHeight),this.endTime=0,this.directionX=0,this.directionY=0,this.wrapperOffset=s.offset(this.wrapper),this._execEvent("refresh"),this.resetPosition()},on:function(e,t){this._events[e]||(this._events[e]=[]),this._events[e].push(t)},off:function(e,t){if(this._events[e]){var i=this._events[e].indexOf(t);i>-1&&this._events[e].splice(i,1)}},_execEvent:function(e){if(this._events[e]){var t=0,i=this._events[e].length;if(i)for(;i>t;t++)this._events[e][t].apply(this,[].slice.call(arguments,1))}},scrollBy:function(e,t,i,n){e=this.x+e,t=this.y+t,i=i||0,this.scrollTo(e,t,i,n)},scrollTo:function(e,t,i,n){n=n||s.ease.circular,this.isInTransition=this.options.useTransition&&i>0,!i||this.options.useTransition&&n.style?(this._transitionTimingFunction(n.style),this._transitionTime(i),this._translate(e,t)):this._animate(e,t,i,n.fn)},scrollToElement:function(e,t,n,a,r){if(e=e.nodeType?e:this.scroller.querySelector(e)){var o=s.offset(e);o.left-=this.wrapperOffset.left,o.top-=this.wrapperOffset.top,n===!0&&(n=i.round(e.offsetWidth/2-this.wrapper.offsetWidth/2)),a===!0&&(a=i.round(e.offsetHeight/2-this.wrapper.offsetHeight/2)),o.left-=n||0,o.top-=a||0,o.left=o.left>0?0:o.left<this.maxScrollX?this.maxScrollX:o.left,o.top=o.top>0?0:o.top<this.maxScrollY?this.maxScrollY:o.top,t=void 0===t||null===t||"auto"===t?i.max(i.abs(this.x-o.left),i.abs(this.y-o.top)):t,this.scrollTo(o.left,o.top,t,r)}},_transitionTime:function(e){if(e=e||0,this.scrollerStyle[s.style.transitionDuration]=e+"ms",!e&&s.isBadAndroid&&(this.scrollerStyle[s.style.transitionDuration]="0.001s"),this.indicators)for(var t=this.indicators.length;t--;)this.indicators[t].transitionTime(e)},_transitionTimingFunction:function(e){if(this.scrollerStyle[s.style.transitionTimingFunction]=e,this.indicators)for(var t=this.indicators.length;t--;)this.indicators[t].transitionTimingFunction(e)},_translate:function(e,t){if(this.options.useTransform?this.scrollerStyle[s.style.transform]="translate("+e+"px,"+t+"px)"+this.translateZ:(e=i.round(e),t=i.round(t),this.scrollerStyle.left=e+"px",this.scrollerStyle.top=t+"px"),this.x=e,this.y=t,this.indicators)for(var n=this.indicators.length;n--;)this.indicators[n].updatePosition()},_initEvents:function(t){var i=t?s.removeEvent:s.addEvent,n=this.options.bindToWrapper?this.wrapper:e;i(e,"orientationchange",this),i(e,"resize",this),this.options.click&&i(this.wrapper,"click",this,!0),this.options.disableMouse||(i(this.wrapper,"mousedown",this),i(n,"mousemove",this),i(n,"mousecancel",this),i(n,"mouseup",this)),s.hasPointer&&!this.options.disablePointer&&(i(this.wrapper,"MSPointerDown",this),i(n,"MSPointerMove",this),i(n,"MSPointerCancel",this),i(n,"MSPointerUp",this)),s.hasTouch&&!this.options.disableTouch&&(i(this.wrapper,"touchstart",this),i(n,"touchmove",this),i(n,"touchcancel",this),i(n,"touchend",this)),i(this.scroller,"transitionend",this),i(this.scroller,"webkitTransitionEnd",this),i(this.scroller,"oTransitionEnd",this),i(this.scroller,"MSTransitionEnd",this)},getComputedPosition:function(){var t,i,n=e.getComputedStyle(this.scroller,null);return this.options.useTransform?(n=n[s.style.transform].split(")")[0].split(", "),t=+(n[12]||n[4]),i=+(n[13]||n[5])):(t=+n.left.replace(/[^-\d.]/g,""),i=+n.top.replace(/[^-\d.]/g,"")),{x:t,y:i}},_initIndicators:function(){function e(e){for(var t=s.indicators.length;t--;)e.call(s.indicators[t])}var t,i=this.options.interactiveScrollbars,n="string"!=typeof this.options.scrollbars,o=[],s=this;this.indicators=[],this.options.scrollbars&&(this.options.scrollY&&(t={el:a("v",i,this.options.scrollbars),interactive:i,defaultScrollbars:!0,customStyle:n,resize:this.options.resizeScrollbars,shrink:this.options.shrinkScrollbars,fade:this.options.fadeScrollbars,listenX:!1},this.wrapper.appendChild(t.el),o.push(t)),this.options.scrollX&&(t={el:a("h",i,this.options.scrollbars),interactive:i,defaultScrollbars:!0,customStyle:n,resize:this.options.resizeScrollbars,shrink:this.options.shrinkScrollbars,fade:this.options.fadeScrollbars,listenY:!1},this.wrapper.appendChild(t.el),o.push(t))),this.options.indicators&&(o=o.concat(this.options.indicators));for(var l=o.length;l--;)this.indicators.push(new r(this,o[l]));this.options.fadeScrollbars&&(this.on("scrollEnd",function(){e(function(){this.fade()})}),this.on("scrollCancel",function(){e(function(){this.fade()})}),this.on("scrollStart",function(){e(function(){this.fade(1)})}),this.on("beforeScrollStart",function(){e(function(){this.fade(1,!0)})})),this.on("refresh",function(){e(function(){this.refresh()})}),this.on("destroy",function(){e(function(){this.destroy()}),delete this.indicators})},_initWheel:function(){s.addEvent(this.wrapper,"wheel",this),s.addEvent(this.wrapper,"mousewheel",this),s.addEvent(this.wrapper,"DOMMouseScroll",this),this.on("destroy",function(){s.removeEvent(this.wrapper,"wheel",this),s.removeEvent(this.wrapper,"mousewheel",this),s.removeEvent(this.wrapper,"DOMMouseScroll",this)})},_wheel:function(e){if(this.enabled){var t,n,a,r,o=this;if("deltaX"in e?(t=-e.deltaX,n=-e.deltaY):"wheelDeltaX"in e?(t=e.wheelDeltaX/120*this.options.mouseWheelSpeed,n=e.wheelDeltaY/120*this.options.mouseWheelSpeed):t=n="wheelDelta"in e?e.wheelDelta/120*this.options.mouseWheelSpeed:"detail"in e?-e.detail/3*this.options.mouseWheelSpeed:void 0,(!t||this.options.scrollX||this.wheelTimeout)&&(!n||this.options.scrollY||this.wheelTimeout)&&(e.preventDefault(),e.stopPropagation(),void 0===this.wheelTimeout&&o._execEvent("scrollStart"),this.enabled&&(clearTimeout(this.wheelTimeout),this.wheelTimeout=setTimeout(function(){o._execEvent("scrollEnd"),o.wheelTimeout=void 0},400),void 0!=t||void 0!=n))){if(t*=this.options.invertWheelDirection,n*=this.options.invertWheelDirection,this.hasVerticalScroll||(n=0),this.hasHorizontalScroll||(t=0),this.options.snap)return a=this.currentPage.pageX,r=this.currentPage.pageY,t>0?a--:0>t&&a++,n>0?r--:0>n&&r++,void this.goToPage(a,r);a=this.x+i.round(this.hasHorizontalScroll?t:0),r=this.y+i.round(this.hasVerticalScroll?n:0),a>0?a=0:a<this.maxScrollX&&(a=this.maxScrollX),r>0?r=0:r<this.maxScrollY&&(r=this.maxScrollY),this.scrollTo(a,r,0),this.options.probeType>1&&this._execEvent("scroll")}}},_initSnap:function(){this.currentPage={},"string"==typeof this.options.snap&&(this.options.snap=this.scroller.querySelectorAll(this.options.snap)),this.on("refresh",function(){var e,t,n,a,r,o,s=0,l=0,c=0,d=this.options.snapStepX||this.wrapperWidth,h=this.options.snapStepY||this.wrapperHeight;if(this.pages=[],this.wrapperWidth&&this.wrapperHeight&&this.scrollerWidth&&this.scrollerHeight){if(this.options.snap===!0)for(n=i.round(d/2),a=i.round(h/2);c>-this.scrollerWidth;){for(this.pages[s]=[],e=0,r=0;r>-this.scrollerHeight;)this.pages[s][e]={x:i.max(c,this.maxScrollX),y:i.max(r,this.maxScrollY),width:d,height:h,cx:c-n,cy:r-a},r-=h,e++;c-=d,s++}else for(o=this.options.snap,e=o.length,t=-1;e>s;s++)(0===s||o[s].offsetLeft<=o[s-1].offsetLeft)&&(l=0,t++),this.pages[l]||(this.pages[l]=[]),c=i.max(-o[s].offsetLeft,this.maxScrollX),r=i.max(-o[s].offsetTop,this.maxScrollY),n=c-i.round(o[s].offsetWidth/2),a=r-i.round(o[s].offsetHeight/2),this.pages[l][t]={x:c,y:r,width:o[s].offsetWidth,height:o[s].offsetHeight,cx:n,cy:a},c>this.maxScrollX&&l++;this.goToPage(this.currentPage.pageX||0,this.currentPage.pageY||0,0),this.options.snapThreshold%1===0?(this.snapThresholdX=this.options.snapThreshold,this.snapThresholdY=this.options.snapThreshold):(this.snapThresholdX=i.round(this.pages[this.currentPage.pageX][this.currentPage.pageY].width*this.options.snapThreshold),this.snapThresholdY=i.round(this.pages[this.currentPage.pageX][this.currentPage.pageY].height*this.options.snapThreshold))}}),this.on("flick",function(){var e=this.options.snapSpeed||i.max(i.max(i.min(i.abs(this.x-this.startX),1e3),i.min(i.abs(this.y-this.startY),1e3)),300);this.goToPage(this.currentPage.pageX+this.directionX,this.currentPage.pageY+this.directionY,e)})},_nearestSnap:function(e,t){if(!this.pages.length)return{x:0,y:0,pageX:0,pageY:0};var n=0,a=this.pages.length,r=0;if(i.abs(e-this.absStartX)<this.snapThresholdX&&i.abs(t-this.absStartY)<this.snapThresholdY)return this.currentPage;for(e>0?e=0:e<this.maxScrollX&&(e=this.maxScrollX),t>0?t=0:t<this.maxScrollY&&(t=this.maxScrollY);a>n;n++)if(e>=this.pages[n][0].cx){e=this.pages[n][0].x;break}for(a=this.pages[n].length;a>r;r++)if(t>=this.pages[0][r].cy){t=this.pages[0][r].y;break}return n==this.currentPage.pageX&&(n+=this.directionX,0>n?n=0:n>=this.pages.length&&(n=this.pages.length-1),e=this.pages[n][0].x),r==this.currentPage.pageY&&(r+=this.directionY,0>r?r=0:r>=this.pages[0].length&&(r=this.pages[0].length-1),t=this.pages[0][r].y),{x:e,y:t,pageX:n,pageY:r}},goToPage:function(e,t,n,a){a=a||this.options.bounceEasing,e>=this.pages.length?e=this.pages.length-1:0>e&&(e=0),t>=this.pages[e].length?t=this.pages[e].length-1:0>t&&(t=0);var r=this.pages[e][t].x,o=this.pages[e][t].y;n=void 0===n?this.options.snapSpeed||i.max(i.max(i.min(i.abs(r-this.x),1e3),i.min(i.abs(o-this.y),1e3)),300):n,this.currentPage={x:r,y:o,pageX:e,pageY:t},this.scrollTo(r,o,n,a)},next:function(e,t){var i=this.currentPage.pageX,n=this.currentPage.pageY;i++,i>=this.pages.length&&this.hasVerticalScroll&&(i=0,n++),this.goToPage(i,n,e,t)},prev:function(e,t){var i=this.currentPage.pageX,n=this.currentPage.pageY;i--,0>i&&this.hasVerticalScroll&&(i=0,n--),this.goToPage(i,n,e,t)},_initKeys:function(){var t,i={pageUp:33,pageDown:34,end:35,home:36,left:37,up:38,right:39,down:40};if("object"==typeof this.options.keyBindings)for(t in this.options.keyBindings)"string"==typeof this.options.keyBindings[t]&&(this.options.keyBindings[t]=this.options.keyBindings[t].toUpperCase().charCodeAt(0));else this.options.keyBindings={};for(t in i)this.options.keyBindings[t]=this.options.keyBindings[t]||i[t];s.addEvent(e,"keydown",this),this.on("destroy",function(){s.removeEvent(e,"keydown",this)})},_key:function(e){if(this.enabled){var t,n=this.options.snap,a=n?this.currentPage.pageX:this.x,r=n?this.currentPage.pageY:this.y,o=s.getTime(),l=this.keyTime||0,c=.25;switch(this.options.useTransition&&this.isInTransition&&(t=this.getComputedPosition(),this._translate(i.round(t.x),i.round(t.y)),this.isInTransition=!1),this.keyAcceleration=200>o-l?i.min(this.keyAcceleration+c,50):0,e.keyCode){case this.options.keyBindings.pageUp:this.hasHorizontalScroll&&!this.hasVerticalScroll?a+=n?1:this.wrapperWidth:r+=n?1:this.wrapperHeight;break;case this.options.keyBindings.pageDown:this.hasHorizontalScroll&&!this.hasVerticalScroll?a-=n?1:this.wrapperWidth:r-=n?1:this.wrapperHeight;break;case this.options.keyBindings.end:a=n?this.pages.length-1:this.maxScrollX,r=n?this.pages[0].length-1:this.maxScrollY;break;case this.options.keyBindings.home:a=0,r=0;break;case this.options.keyBindings.left:a+=n?-1:5+this.keyAcceleration>>0;break;case this.options.keyBindings.up:r+=n?1:5+this.keyAcceleration>>0;break;case this.options.keyBindings.right:a-=n?-1:5+this.keyAcceleration>>0;break;case this.options.keyBindings.down:r-=n?1:5+this.keyAcceleration>>0;break;default:return}if(n)return void this.goToPage(a,r);a>0?(a=0,this.keyAcceleration=0):a<this.maxScrollX&&(a=this.maxScrollX,this.keyAcceleration=0),r>0?(r=0,this.keyAcceleration=0):r<this.maxScrollY&&(r=this.maxScrollY,this.keyAcceleration=0),this.scrollTo(a,r,0),this.keyTime=o}},_animate:function(e,t,i,n){function a(){var u,p,v,g=s.getTime();
return g>=h?(r.isAnimating=!1,r._translate(e,t),void(r.resetPosition(r.options.bounceTime)||r._execEvent("scrollEnd"))):(g=(g-d)/i,v=n(g),u=(e-l)*v+l,p=(t-c)*v+c,r._translate(u,p),r.isAnimating&&o(a),void(3==r.options.probeType&&r._execEvent("scroll")))}var r=this,l=this.x,c=this.y,d=s.getTime(),h=d+i;this.isAnimating=!0,a()},handleEvent:function(e){switch(e.type){case"touchstart":case"MSPointerDown":case"mousedown":this._start(e);break;case"touchmove":case"MSPointerMove":case"mousemove":this._move(e);break;case"touchend":case"MSPointerUp":case"mouseup":case"touchcancel":case"MSPointerCancel":case"mousecancel":this._end(e);break;case"orientationchange":case"resize":this._resize();break;case"transitionend":case"webkitTransitionEnd":case"oTransitionEnd":case"MSTransitionEnd":this._transitionEnd(e);break;case"wheel":case"DOMMouseScroll":case"mousewheel":this._wheel(e);break;case"keydown":this._key(e);break;case"click":e._constructed||s.preventDefaultException(e.target,this.options.preventDefaultException)||(e.preventDefault(),e.stopPropagation())}}},r.prototype={handleEvent:function(e){switch(e.type){case"touchstart":case"MSPointerDown":case"mousedown":this._start(e);break;case"touchmove":case"MSPointerMove":case"mousemove":this._move(e);break;case"touchend":case"MSPointerUp":case"mouseup":case"touchcancel":case"MSPointerCancel":case"mousecancel":this._end(e)}},destroy:function(){this.options.interactive&&(s.removeEvent(this.indicator,"touchstart",this),s.removeEvent(this.indicator,"MSPointerDown",this),s.removeEvent(this.indicator,"mousedown",this),s.removeEvent(e,"touchmove",this),s.removeEvent(e,"MSPointerMove",this),s.removeEvent(e,"mousemove",this),s.removeEvent(e,"touchend",this),s.removeEvent(e,"MSPointerUp",this),s.removeEvent(e,"mouseup",this)),this.options.defaultScrollbars&&this.wrapper.parentNode.removeChild(this.wrapper)},_start:function(t){var i=t.touches?t.touches[0]:t;t.preventDefault(),t.stopPropagation(),this.transitionTime(),this.initiated=!0,this.moved=!1,this.lastPointX=i.pageX,this.lastPointY=i.pageY,this.startTime=s.getTime(),this.options.disableTouch||s.addEvent(e,"touchmove",this),this.options.disablePointer||s.addEvent(e,"MSPointerMove",this),this.options.disableMouse||s.addEvent(e,"mousemove",this),this.scroller._execEvent("beforeScrollStart")},_move:function(e){var t,i,n,a,r=e.touches?e.touches[0]:e,o=s.getTime();this.moved||this.scroller._execEvent("scrollStart"),this.enabled&&(this.moved=!0,t=r.pageX-this.lastPointX,this.lastPointX=r.pageX,i=r.pageY-this.lastPointY,this.lastPointY=r.pageY,n=this.x+t,a=this.y+i,this._pos(n,a),1==this.scroller.options.probeType&&o-this.startTime>300?(this.startTime=o,this.scroller._execEvent("scroll")):this.scroller.options.probeType>1&&this.scroller._execEvent("scroll"),e.preventDefault(),e.stopPropagation())},_end:function(t){if(this.initiated){if(this.initiated=!1,t.preventDefault(),t.stopPropagation(),s.removeEvent(e,"touchmove",this),s.removeEvent(e,"MSPointerMove",this),s.removeEvent(e,"mousemove",this),this.scroller.options.snap){var n=this.scroller._nearestSnap(this.scroller.x,this.scroller.y),a=this.options.snapSpeed||i.max(i.max(i.min(i.abs(this.scroller.x-n.x),1e3),i.min(i.abs(this.scroller.y-n.y),1e3)),300);(this.scroller.x!=n.x||this.scroller.y!=n.y)&&(this.scroller.directionX=0,this.scroller.directionY=0,this.scroller.currentPage=n,this.scroller.scrollTo(n.x,n.y,a,this.scroller.options.bounceEasing))}this.moved&&this.scroller._execEvent("scrollEnd")}},transitionTime:function(e){e=e||0,this.indicatorStyle[s.style.transitionDuration]=e+"ms",!e&&s.isBadAndroid&&(this.indicatorStyle[s.style.transitionDuration]="0.001s")},transitionTimingFunction:function(e){this.indicatorStyle[s.style.transitionTimingFunction]=e},refresh:function(){this.transitionTime(),this.indicatorStyle.display=this.options.listenX&&!this.options.listenY?this.scroller.hasHorizontalScroll?"block":"none":this.options.listenY&&!this.options.listenX?this.scroller.hasVerticalScroll?"block":"none":this.scroller.hasHorizontalScroll||this.scroller.hasVerticalScroll?"block":"none",this.scroller.hasHorizontalScroll&&this.scroller.hasVerticalScroll?(s.addClass(this.wrapper,"iScrollBothScrollbars"),s.removeClass(this.wrapper,"iScrollLoneScrollbar"),this.options.defaultScrollbars&&this.options.customStyle&&(this.options.listenX?this.wrapper.style.right="8px":this.wrapper.style.bottom="8px")):(s.removeClass(this.wrapper,"iScrollBothScrollbars"),s.addClass(this.wrapper,"iScrollLoneScrollbar"),this.options.defaultScrollbars&&this.options.customStyle&&(this.options.listenX?this.wrapper.style.right="2px":this.wrapper.style.bottom="2px"));this.wrapper.offsetHeight;this.options.listenX&&(this.wrapperWidth=this.options.wrapperWidth||this.wrapper.clientWidth,this.options.resize?(this.indicatorWidth=i.max(i.round(this.wrapperWidth*this.wrapperWidth/(this.scroller.scrollerWidth||this.wrapperWidth||1)),8),this.indicatorStyle.width=this.indicatorWidth+"px"):this.indicatorWidth=this.indicator.clientWidth,this.maxPosX=this.wrapperWidth-this.indicatorWidth,"clip"==this.options.shrink?(this.minBoundaryX=-this.indicatorWidth+8,this.maxBoundaryX=this.wrapperWidth-8):(this.minBoundaryX=0,this.maxBoundaryX=this.maxPosX),this.sizeRatioX=this.options.speedRatioX||this.scroller.maxScrollX&&this.maxPosX/this.scroller.maxScrollX),this.options.listenY&&(this.wrapperHeight=this.options.wrapperHeight||this.wrapper.clientHeight,this.options.resize?(this.indicatorHeight=i.max(i.round(this.wrapperHeight*this.wrapperHeight/(this.scroller.scrollerHeight||this.wrapperHeight||1)),8),this.indicatorStyle.height=this.indicatorHeight+"px"):this.indicatorHeight=this.indicator.clientHeight,this.maxPosY=this.wrapperHeight-this.indicatorHeight,"clip"==this.options.shrink?(this.minBoundaryY=-this.indicatorHeight+8,this.maxBoundaryY=this.wrapperHeight-8):(this.minBoundaryY=0,this.maxBoundaryY=this.maxPosY),this.maxPosY=this.wrapperHeight-this.indicatorHeight,this.sizeRatioY=this.options.speedRatioY||this.scroller.maxScrollY&&this.maxPosY/this.scroller.maxScrollY),this.updatePosition()},updatePosition:function(){var e=this.options.listenX&&i.round(this.sizeRatioX*this.scroller.x)||0,t=this.options.listenY&&i.round(this.sizeRatioY*this.scroller.y)||0;this.options.ignoreBoundaries||(e<this.minBoundaryX?("scale"==this.options.shrink&&(this.width=i.max(this.indicatorWidth+e,8),this.indicatorStyle.width=this.width+"px"),e=this.minBoundaryX):e>this.maxBoundaryX?"scale"==this.options.shrink?(this.width=i.max(this.indicatorWidth-(e-this.maxPosX),8),this.indicatorStyle.width=this.width+"px",e=this.maxPosX+this.indicatorWidth-this.width):e=this.maxBoundaryX:"scale"==this.options.shrink&&this.width!=this.indicatorWidth&&(this.width=this.indicatorWidth,this.indicatorStyle.width=this.width+"px"),t<this.minBoundaryY?("scale"==this.options.shrink&&(this.height=i.max(this.indicatorHeight+3*t,8),this.indicatorStyle.height=this.height+"px"),t=this.minBoundaryY):t>this.maxBoundaryY?"scale"==this.options.shrink?(this.height=i.max(this.indicatorHeight-3*(t-this.maxPosY),8),this.indicatorStyle.height=this.height+"px",t=this.maxPosY+this.indicatorHeight-this.height):t=this.maxBoundaryY:"scale"==this.options.shrink&&this.height!=this.indicatorHeight&&(this.height=this.indicatorHeight,this.indicatorStyle.height=this.height+"px")),this.x=e,this.y=t,this.scroller.options.useTransform?this.indicatorStyle[s.style.transform]="translate("+e+"px,"+t+"px)"+this.scroller.translateZ:(this.indicatorStyle.left=e+"px",this.indicatorStyle.top=t+"px")},_pos:function(e,t){0>e?e=0:e>this.maxPosX&&(e=this.maxPosX),0>t?t=0:t>this.maxPosY&&(t=this.maxPosY),e=this.options.listenX?i.round(e/this.sizeRatioX):this.scroller.x,t=this.options.listenY?i.round(t/this.sizeRatioY):this.scroller.y,this.scroller.scrollTo(e,t)},fade:function(e,t){if(!t||this.visible){clearTimeout(this.fadeTimeout),this.fadeTimeout=null;var i=e?250:500,n=e?0:300;e=e?"1":"0",this.wrapperStyle[s.style.transitionDuration]=i+"ms",this.fadeTimeout=setTimeout(function(e){this.wrapperStyle.opacity=e,this.visible=+e}.bind(this,e),n)}}},n.utils=s,"undefined"!=typeof module&&module.exports?module.exports=n:e.IScroll=n}(window,document,Math),define("iScroll",function(){}),function(){var e=function(e){this.init(e)};e.prototype={init:function(e){var t={containment:".mask",contentel:".layer-content",mask_width:200,mask_height:100,content_width:1024,content_height:768,content_x:0,content_y:0,throw_enabled:!0,scrollX:!0,scrollY:!0,onScrollStart:null,onScrolling:null,onScrollEnd:null,HWCompositing:!0};return this.options=e?$.extend(!0,{},t,e):t,_.bindAll(this),this._initVaribles(),this._initScrollItems(),this.iScroll},_initVaribles:function(){this.dragged=!1,this.dragstart=!1,this.dragging=!1,this.sliding=!1},_initScrollItems:function(){var e=this;this.containment=this.mask=$(this.options.containment),this.content=$(this.options.contentel),this.containment.css({width:this.options.mask_width,height:this.options.mask_height,overflow:"hidden"}),this.content.css({width:this.options.content_width,height:this.options.content_height}),this.iScroll=new IScroll(this.containment[0],{mouseWheel:!0,probeType:3,click:!0,scrollX:this.options.scrollX,scrollY:this.options.scrollY,wrapperWidth:this.options.mask_width,wrapperHeight:this.options.mask_height,scrollerWidth:this.options.content_width,scrollerHeight:this.options.content_height,HWCompositing:!0}),this.iScroll.scrollTo(this.options.content_x,this.options.content_y),this.iScroll.on("scrollStart",function(){document.activeElement&&"INPUT"==document.activeElement.tagName&&interaction_view.isAndroid&&document.activeElement.blur(),e.options.onScrollStart&&e.options.onScrollStart()}),this.iScroll.on("scroll",function(){var t=!1;e.dragstart&&(t=!0),e.options.onScrolling&&e.options.onScrolling({deltaX:this.x,deltaY:this.y,controller:t})}),this.iScroll.on("scrollEnd",function(){e.options.onScrollend&&e.options.onScrollend&&(this.y=parseFloat(this.y),e.options.onScrollend({deltaX:this.x,deltaY:this.y}))})},_checkX:function(e){return e-this.options.mask_width<-this.options.content_width&&(e=this.options.mask_width-this.options.content_width),e>0&&(e=0),e},_checkY:function(e){return e-this.options.mask_height<-this.options.content_height&&(e=this.options.mask_height-this.options.content_height),e>0&&(e=0),e},_getCurrentPosition:function(){var e={x:0,y:0};return e.x=this.iScroll.x,e.y=this.iScroll.y,e},_scrollTo:function(e,t,i,n){this.iScroll.scrollTo(e,t,1e3,n)}},"undefined"==typeof require?(window._g||(window._g={}),window._g.scrollview=e):define("interaction_view/ui/scrollview",["_g/base","jquery.hammer","underscore","jquery.transit","iScroll"],function(){return window._g.scrollview=e,window._g.scrollview})}(window);var _gsScope="undefined"!=typeof module&&module.exports&&"undefined"!=typeof global?global:this||window;(_gsScope._gsQueue||(_gsScope._gsQueue=[])).push(function(){var e=document.documentElement,t=window,i=function(i,n){var a="x"===n?"Width":"Height",r="scroll"+a,o="client"+a,s=document.body;return i===t||i===e||i===s?Math.max(e[r],s[r])-(t["inner"+a]||Math.max(e[o],s[o])):i[r]-i["offset"+a]},n=_gsScope._gsDefine.plugin({propName:"scrollTo",API:2,version:"1.7.4",init:function(e,n,a){return this._wdw=e===t,this._target=e,this._tween=a,"object"!=typeof n&&(n={y:n}),this.vars=n,this._autoKill=n.autoKill!==!1,this.x=this.xPrev=this.getX(),this.y=this.yPrev=this.getY(),null!=n.x?(this._addTween(this,"x",this.x,"max"===n.x?i(e,"x"):n.x,"scrollTo_x",!0),this._overwriteProps.push("scrollTo_x")):this.skipX=!0,null!=n.y?(this._addTween(this,"y",this.y,"max"===n.y?i(e,"y"):n.y,"scrollTo_y",!0),this._overwriteProps.push("scrollTo_y")):this.skipY=!0,!0},set:function(e){this._super.setRatio.call(this,e);var n=this._wdw||!this.skipX?this.getX():this.xPrev,a=this._wdw||!this.skipY?this.getY():this.yPrev,r=a-this.yPrev,o=n-this.xPrev;this._autoKill&&(!this.skipX&&(o>7||-7>o)&&n<i(this._target,"x")&&(this.skipX=!0),!this.skipY&&(r>7||-7>r)&&a<i(this._target,"y")&&(this.skipY=!0),this.skipX&&this.skipY&&(this._tween.kill(),this.vars.onAutoKill&&this.vars.onAutoKill.apply(this.vars.onAutoKillScope||this._tween,this.vars.onAutoKillParams||[]))),this._wdw?t.scrollTo(this.skipX?n:this.x,this.skipY?a:this.y):(this.skipY||(this._target.scrollTop=this.y),this.skipX||(this._target.scrollLeft=this.x)),this.xPrev=this.x,this.yPrev=this.y}}),a=n.prototype;n.max=i,a.getX=function(){return this._wdw?null!=t.pageXOffset?t.pageXOffset:null!=e.scrollLeft?e.scrollLeft:document.body.scrollLeft:this._target.scrollLeft},a.getY=function(){return this._wdw?null!=t.pageYOffset?t.pageYOffset:null!=e.scrollTop?e.scrollTop:document.body.scrollTop:this._target.scrollTop},a._kill=function(e){return e.scrollTo_x&&(this.skipX=!0),e.scrollTo_y&&(this.skipY=!0),this._super._kill.call(this,e)}}),_gsScope._gsDefine&&_gsScope._gsQueue.pop()(),define("greensock/plugins/ScrollToPlugin",function(){}),function(){var e=function(e){this.init(e)};e.prototype={init:function(e){var t={containment:".mask",contentel:".layer-content",mask_width:200,mask_height:100,content_width:1024,content_height:768,content_x:0,content_y:0,throw_enabled:!0,scrollX:!0,scrollY:!0,onScrollStart:null,onScrolling:null,onScrollEnd:null,HWCompositing:!1};return this.options=e?$.extend(!0,{},t,e):t,_.bindAll(this),this._initVaribles(),this._initScrollItems(),this.iScroll},_initVaribles:function(){this.dragged=!1,this.dragstart=!1,this.dragging=!1,this.sliding=!1},_initScrollItems:function(){var e=this;this.containment=this.mask=$(this.options.containment),this.content=$(this.options.contentel),this.containment.css({width:this.options.mask_width,height:this.options.mask_height,overflow:"hidden"}),this.content.css({width:this.options.content_width,height:this.options.content_height}),this.iScroll=new IScroll(this.containment[0],{mouseWheel:!0,probeType:3,click:!0,scrollX:this.options.scrollX,scrollY:this.options.scrollY,wrapperWidth:this.options.mask_width,wrapperHeight:this.options.mask_height,scrollerWidth:this.options.content_width,scrollerHeight:this.options.content_height,HWCompositing:!1}),this.iScroll.scrollTo(this.options.content_x,this.options.content_y),this.iScroll.on("scrollStart",function(){e.options.onScrollStart&&e.options.onScrollStart()}),this.iScroll.on("scroll",function(){var t=!1;e.dragstart&&(t=!0),e.options.onScrolling&&e.options.onScrolling({deltaX:this.x,deltaY:this.y,controller:t})}),this.iScroll.on("scrollEnd",function(){e.options.onScrollend&&e.options.onScrollend&&(this.y=parseFloat(this.y),e.options.onScrollend({deltaX:this.x,deltaY:this.y}))})},_checkX:function(e){return e-this.options.mask_width<-this.options.content_width&&(e=this.options.mask_width-this.options.content_width),e>0&&(e=0),e},_checkY:function(e){return e-this.options.mask_height<-this.options.content_height&&(e=this.options.mask_height-this.options.content_height),e>0&&(e=0),e},_getCurrentPosition:function(){var e={x:0,y:0};return e.x=this.iScroll.x,e.y=this.iScroll.y,e},_scrollTo:function(e,t,i,n){this.iScroll.scrollTo(e,t,1e3,n)},_scrollToEl:function(e,t,i,n,a){this.iScroll.scrollToElement(e,t,i,n,a)}},"undefined"==typeof require?(window._g||(window._g={}),window._g.scrollview=e):define("_g/scrollview",["_g/base","jquery.hammer","underscore","jquery.transit","iScroll"],function(){return window._g.scrollview=e,window._g.scrollview})}(window),function(){var e=function(e){this.init(e)};e.prototype={percent:0,init:function(e){var t={containment:".g-slider",handle:".g-slider-handle",range:".g-slider-range"};return this.options=e?$.extend(!0,{},t,e):t,_.bindAll(this),this.handle=$(this.options.containment).find(this.options.handle).first(),this.range=$(this.options.containment).find(this.options.range).first(),this._bindControl(),this},_bindControl:function(){var e=this;this.handle.hammer().on("dragstart",function(){e.dragstart=!0,e.startleft=parseInt(e.handle.css("left"),10)}),this.handle.hammer().on("drag",function(t){return console.log("dragleft"),e.dragstart=!0,e._doDragingEvent(t),t.gesture.preventDefault(),!1}),this.handle.hammer().on("dragend",function(t){return e.dragstart?(e.dragstart=!1,e._doDragEndEvent(t),t.gesture.preventDefault(),!1):void 0})},_doDragingEvent:function(e){console.log(e);var t=this.startleft,i=this.handle.parent().width(),n=$.zoom||1;t+=e.gesture.deltaX/n,0>t&&(t=0),t>i&&(t=i),this.percent=100*_g.number.decimal(t/i,2),this.handle.css("left",this.percent+"%"),this.range.css("width",this.percent+"%")},_doDragEndEvent:function(){this.options.onChange&&this.options.onChange(this.percent)},change:function(e){this.dragstart||(this.handle.css("left",e+"%"),this.range.css("width",e+"%"))}},"undefined"==typeof require?(window._g||(window._g={}),window._g.slider=e):define("_g/slider",["_g/base","_g/event","jquery.hammer"],function(){return window._g.slider=e,window._g.slider})}(window),function(){var e={sendBinary:function(e){if(!e||!e.dataUrl&&!e.blob||!e.url)return!1;if(e.blob)var t=e.blob;else{e.b64Data=e.dataUrl.split(",")[1];var t=_g.fileapi.b64toBlob(e)}var i=new FormData;i.append(e.filekey||"file",t),i.append("Filename",e.filename||"blob"),e.upload_type&&i.append("type",e.upload_type),e.width&&i.append("width",e.width),e.height&&i.append("height",e.height),$.ajax({url:e.url,type:"POST",data:i,processData:!1,contentType:!1}).done(function(t){e.callback&&e.callback(t)}).fail(function(t){e.onFail&&e.onFail(t)})},b64toBlob:function(e){contentType=e.type||"image/png",sliceSize=e.sliceSize||512;for(var t=atob(e.b64Data),i=[],n=0;n<t.length;n+=sliceSize){for(var a=t.slice(n,n+sliceSize),r=new Array(a.length),o=0;o<a.length;o++)r[o]=a.charCodeAt(o);var s=new Uint8Array(r);i.push(s)}var l=new Blob(i,{type:contentType});return l},blobtoUrl:function(e){var t=self.URL||self.webkitURL||self,i=t.createObjectURL(e);return i},base64urltoBase64:function(e){return e.split(",")[1]},blobtoBase64:function(e,t){var i=new FileReader;i.onload=function(e){var i="undefined"!=typeof event?event.target.result:e.originalTarget.result;t&&t(i)},i.readAsDataURL(e)},fileUrltoBlob:function(e,t){var i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="blob",i.onload=function(){if(200==this.status){var e=this.response;t.onSuccess&&t.onSuccess(e)}else t.onFail&&t.onFail(e)},i.send()},imageUrltoBlob:function(e,t){var i=document.createElement("canvas"),n=i.getContext("2d"),a=(self.URL||self.webkitURL||self,new Image);a.onload=function(){i.width=image.width,i.height=image.height,n.drawImage(a,0,0),t.callback&&t.callback(i)},a.src=e,a.crossOrigin="Anonymous"}};"undefined"==typeof require?(window._g||(window._g={}),window._g.fileapi=e):define("_g/file",["_g/base"],function(){return window._g.fileapi=e,window._g.fileapi})}(window),function(){var e=["Image","ImageBlock","CycleImage","Slide","Gallery"],t={init:function(){interaction_view.preloadpageactions=new interaction_view.collection.Action},renderActions:function(e,t){for(var i=0;i<e.length;i++){var n=$.extend(!0,{},e[i]),a=new interaction_view.model.Action(n);a.iview.render(),function(e){var i={preload_hash:t,func:function(){e.iview.executeAction(e.iview)}};interaction_view.events.preloadPageEvents.push(i)}(a)}},preload:function(i,n){for(var a=[],r=function(){if(!a.length){var e=_.filter(interaction_view.events.preloadPageEvents,function(e){return e.preload_hash==n});e.length>0&&_.each(e,function(e){e.func()})}},o=0;o<i.length;o++){var s=i[o],l=interaction_view.ipagelist.getPage(s)||interaction_view.imasterlist.get(s)||interaction_view.ibackgroundlist.get(s);if(l){for(var c=l.get("overlays"),d=[],h=0;h<c.length;h++){var u=c[h];if(_.include(["LayerRef","LayerSlide"],u.iType)){var p=u.iDetail.layer_ids||[];d=_.union(d,p)}else if(_.include(e,u.iType)){var v=t.getPreloadImgs(u);a=_.union(a,v)}}if(d.length)for(var g=0;g<d.length;g++){var f=d[g],m=interaction_view.ilayerlist.get(f);if(m)for(var c=m.get("overlays"),h=0;h<c.length;h++){var u=c[h],v=t.getPreloadImgs(u);a=_.union(a,v)}}}}if(a.length)for(var o=0;o<a.length;o++)_e.preloadpage.loadImg(a[o],function(e,t,i){i&&(interaction_view.iImgs[e]=t),a=_.reject(a,function(t){return t==e}),r()});else r()},getPreloadImgs:function(t){var i=[];if(_.include(e,t.iType)){var n=t.iDetail.iImg;if(n&&n.length)for(var a=0;a<n.length;a++)interaction_view.iImgs[n[a].picture]||i.push(n[a].picture)}return i},loadImg:function(e,t){var i=new Image;i.onload=function(){t(e,i,!0)},i.onerror=function(){t(e,i,!1)},i.src=e}};"undefined"==typeof require?(window._e||(window._e={}),window._e.preloadpage=t):define("_e/preloadpage",[],function(){return window._e||(window._e={}),window._e.preloadpage=t,window._e.preloadpage})}(window),function(){window.e_api=function(){var e={custom:{}};return e}(),function(api){api._initialize=function(apis){for(var i=0;i<apis.length;i++){var apidata=apis[i];if(apidata&&apidata.name&&apidata.data){var data=unescape(apidata.data);if(data){data="function(){"+data+"}";try{api.custom[apidata.name]=eval("("+data+")")}catch(e){console.log(e)}}}}},api.doc={goToPage:function(e,t){presentation.gotopagebyargs(e,t)}}}(e_api),"undefined"!=typeof Epub&&Epub||(window.Epub={Player:{},PlayerSDK:{},MessageEvents:[]},window.addEventListener("message",function(e){console.log(e);var t=e.data;if(t&&t.indexOf&&-1!=t.indexOf("_epub360_2016_player_oauth_"))try{var i=JSON.parse(t),n=i.event;if(Epub.MessageEvents.length)for(var a=0;a<Epub.MessageEvents.length;a++){var r=Epub.MessageEvents[a];r.event==n&&r.func(i.data)}}catch(e){console.log(e)}}),Epub.PlayerSDK.sendMessage=function(e,t){for(var i={oauth:"_epub360_2016_player_oauth_",data:t,event:e||"message"},n=document.getElementsByTagName("IFRAME"),a=JSON.stringify(i),r=0;r<n.length;r++)n[r].contentWindow.postMessage(a,"*")},Epub.PlayerSDK.onMessage=function(e,t){e||(e="message"),Epub.MessageEvents.push({event:e,func:t})},Epub.PlayerSDK.offMessage=function(e,t){if(e){for(var i=[],n=0;n<Epub.MessageEvents.length;n++){var a=Epub.MessageEvents[n];t?a.event==e&&t==a.func||i.push(a):a.event==e||i.push(a)}Epub.MessageEvents=i}})}(window),define("_e/api",function(){}),function(){function e(e,t){this.queue=e,this._callbacks=[];t&&(t.done=this.done,this.func=t)}function t(t){function i(e){return function(){r+=1,a[e]=Array.prototype.slice.call(arguments),r===o&&n.done(a)}}var n=new e,a=[];if(!t||!t.length)return n.done(a),n;for(var r=0,o=t.length,s=0;o>s;s++)t[s].then(i(s));return n}function i(t,n){var a=new e;return 0===t.length?a.done.apply(a,n):t[0].apply(null,n).then(function(){t.splice(0,1),i(t,arguments).then(function(){a.done.apply(a,arguments)})}),a}function n(e){if(this.options={continuous:!0},"object"==typeof e)for(var t in e)e.hasOwnProperty(t)&&(this.options[t]=e[t]);this.init()}e.prototype.then=function(t,i){var n;return this._isdone?n=t.apply(i,this.result):(n=new e,this._callbacks.push(function(){var e=t.apply(i,arguments);e&&"function"==typeof e.then&&e.then(n.done,n)})),n},e.prototype.done=function(){this.result=arguments,this._isdone=!0;for(var e=0;e<this._callbacks.length;e++)this._callbacks[e].apply(null,arguments);this._callbacks=[],this.queue&&this.queue.next.apply(this.queue,arguments)},n.prototype.init=function(){this.queues=[],this.pointer=null},n.prototype.add=function(t,i,n){if(n||(n={}),!(this.queues.length>1e3)){var a=new e(this,t);return this.queues.push({func:a,type:1,args:i,opts:n}),this.options.continuous&&this._exec(),a}},n.prototype.immediate=function(e,t,i){i||(i={}),this.queues.length>1e3||(this.queues.push({type:0,func:e,args:t,opts:i}),this.options.continuous&&this._exec())},n.prototype.length=function(){return this.queues.length},n.prototype.next=function(e){e?this.error(e):(interaction_view.queue.current=null,this.pointer=null,this._exec())},n.prototype._exec=function(){!this.pointer&&this.queues.length?(interaction_view.DEBUG&&(interaction_view.queue.current=this.queues[0].opts),this.queues.length&&(this.pointer=this.queues.shift()),0===this.pointer.type?(this.pointer.func(this.pointer.args),this.pointer=null,interaction_view.queue.current=null,this._exec()):this.pointer.func.func(this.pointer.args)):this.queues.length||this.options.onComplete&&this.options.onComplete()},n.prototype.error=function(e){console.log(e),this.queues=[],this.pointer=null,this.options.onError&&this.options.onError()},n.prototype.clear=function(){this.queues=[],this.pointer=null},window.Queue=n,window.promise={Promise:e,join:t,chain:i,ENOXHR:1,ETIMEOUT:2}}(window),define("_e/queue",function(){}),function(){window.dboperate=function(e){this.defaults={db_id:"",query:[],fields:[]},this.options=e,this.options=$.extend(!0,{},this.defaults,"object"==typeof e&&e)},window.dboperate.prototype={init:function(e){var t=this.options.operation,i=this.options.datalistid,n=this.options.db_select;if(null!=i){if(this.options.datalistid=i.match(/\$[^\$]+\$/g)[0],this.db_id=this.options.datalistid.split(".")[0].split("$d_")[1],0==interaction_view.dblist.length||_.isUndefined(interaction_view.dblist.get(this.db_id)))return console.log("æ•°æ®è¡¨ç»„ä»¶ "+this.db_id+" ä¸å­˜åœ¨"),void(e&&e(""));this.tableid=interaction_view.dblist.get(this.db_id).attributes.sheet_id,this.queryid=this.options.datalistid.split(".")[1].split("$")[0],this.db=new DB.DBObject(this.tableid),_.bindAll(this),"add"==t?this.addValue(e):"del"==t||"upd"==t?this.changeValue(t,e):"ref"==t||"req"==t&&this.requestValue(e)}null!=n&&"query"==t&&this.queryText(this.options,e),"cacheload"==t&&this.loadCachelist(e)},query:function(){var e=this;epub360.dbs={};for(var t=0;t<interaction_view.dblist.models.length;t++){var i=interaction_view.dblist.models[t],n=i.get("querys"),a=i.get("sheet_id"),r=i.get("id");DB.Utils.setOpt(epub360.dbs,r,{}),epub360.dbs[r].query={};for(var o=0;o<n.length;o++)"1"==n[o].type&&n[o].autoload&&e.uploadQuery({value:n[o],table_id:a,db_id:r,type:n[o].type,cache:!0})}},uploadQuery:function(e,t){e||(e={});var i=e.value,n=e.table_id,a=e.db_id;if(!i)return void(t&&t([]));var r=i.id,o=this,s=new DB.DBQuery;if(e.page||(e.page=""),e.size||(e.size=""),e.type)var l=e.type;e.israndom||(e.israndom=!1),s=this.formatQuery(i,s,e),s.Query(n,e.page,e.size,function(i){var n=i.data.results;if(e.cache&&(_.isUndefined(epub360.dbs[a].query[r])&&DB.Utils.setOpt(epub360.dbs[a].query,r,{}),_.isUndefined(epub360.dbs[a].query[r].list)&&o.queryValue(epub360.dbs[a].query[r],n),l&&(epub360.dbs[a].query[r].type=l),epub360.dbs[a].query[r].list.add(n,{merge:!0})),e.getcache)return e.isfind=!0,void o.getCache(e,t,r);if(t){var s=o.getSpecial(e.option,i,e.field,e.join,e.israndom);t(s)}},function(e){t&&t(e)},{start:e.start,id:e.id,israndom:e.israndom})},formatQuery:function(e,t,i){var n,a=interaction_view.expression.id2values(e.filter[0].value,function(e){return e},{no_compute:!0}),r=interaction_view.expression.id2values(e.filter[1].value,function(e){return e},{no_compute:!0}),o=new DB.DBFilter({key:e.filter[0].key,value:a}),s=new DB.DBFilter({key:e.filter[1].key,value:r});if(i||(i={}),e.fetch_fields&&t.addFields(e.fetch_fields),e.sort&&t.addSort(e.sort.field,1==e.sort.order?"ASC":"DESC"),e.scope&&t.addScope(e.scope),e.op&&(n="0"==e.op?o.and(s):o.or(s)),t.addFilter(n),i.query){try{i.query.query.value=interaction_view.expression.id2values(i.query.query.value)}catch(l){}var c=new DB.DBLimit;c.equalTo(i.query.query.key,i.query.query.value),t.addLimit(c)}if(i&&i.agg&&t.addAggregate(i.agg),e.join_table&&"undefined"!=e.join&&e.join.data_list&&interaction_view.dblist&&interaction_view.dblist.get(e.join.data_list)){var d=interaction_view.dblist.get(e.join.data_list).get("sheet_id");d&&e.join.join_field&&0!=e.join.fetch_fields.length&&t.addJoin(d,e.join.join_field,e.join.fetch_fields)}return t},queryValue:function(e,t){var i=Backbone.Model.extend({}),n=Backbone.Collection.extend({model:i});e.list=new n,e.list.add(t)},getqueryValue:function(e,t,i,n,a,r){var o,s;if(r||(r={}),0==interaction_view.dblist.length||!interaction_view.dblist.get(e))return console.log("æ•°æ®è¡¨ç»„ä»¶ "+e+" ä¸å­˜åœ¨"),void(a&&a(""));this.size=n;for(var l=interaction_view.dblist.get(e).get("sheet_id"),c=0;c<interaction_view.dblist.get(e).get("querys").length;c++){var d=interaction_view.dblist.get(e).get("querys")[c];t==d.id&&(o=d)}s={value:o,table_id:l,db_id:e,page:i,size:n,query:r},"0"==o.type&&this.uploadQuery(s,a),"1"==o.type&&(s.cache=!0,this.getCache(s,a,t))},getCache:function(e,t,i){var n=e.page,a=e.size,r=epub360.dbs[e.db_id].query[i];if(!_.isUndefined(r)&&r.list&&r.list.at((n-1)*a))if(r.list.at(n*a-1)||!r.list.at(n*a-1)&&e.isfind){for(var o=[],s=0;a>s;s++)o.push(r.list.at((n-1)*a+s)?r.list.at((n-1)*a+s).attributes:"");t&&t(o)}else e.getcache=!0,this.uploadQuery(e,t);else e.getcache=!0,this.uploadQuery(e,t)},getSpecial:function(e,t,i,n,a){var r;if(e){if("MAX"==e||"MIN"==e||"SUM"==e||"COUNT"==e||"RANDOM"==e&&!a)switch(e){case"COUNT":r=_.isUndefined(t.data.sum)?0/0:t.data.sum;break;case"MAX":r=_.isUndefined(t.data.facet[0].items[0])?0/0:t.data.facet[0].items[0].max;break;case"MIN":r=_.isUndefined(t.data.facet[0].items[0])?0/0:t.data.facet[0].items[0].min;break;case"SUM":r=_.isUndefined(t.data.facet[0].items[0])?0/0:t.data.facet[0].items[0].sum;break;case"RANDOM":r=_.isUndefined(t.data.facet[0].items[0])?0/0:t.data.facet[0].items[0].random}if(-1!=e.indexOf("LINENUMBER")||-1!=e.indexOf("ID"))if(_.isUndefined(t.data.results[0])||_.isNull(t.data.results[0]))r=0/0,0==t.data.sum;else if(n){var o=interaction_view.dblist.get(n.split("|")[0]).attributes.sheet_id;r=t.data.results[0][o+"."+n.split("|")[1]]}else r=t.data.results[0][i];else a&&"RANDOM"==e&&(r=t)}else r=t;return r=_.isUndefined(r)?0/0:r},setFields:function(){for(var e=0;e<interaction_view.dblist.models.length;e++){var t=interaction_view.dblist.models[e],i=t.get("fields"),n=t.get("id");epub360.dbs[n].fields=i}},saveLocal:function(e){e=e.replace(/\$/g,"");var t=e.substr(2),i=t.match(this.Regs[0]);if(null!=i)for(var n=0;n<i.length;n++){var a=this.id2value(i[n],function(e){return e});t=t.replace(i[n],a)}t.split(this.Spliter)},addValue:function(e){var t=[],i=this;for(var n in this.options.fields)t.push(n);for(var a=0;a<t.length;a++){var r=t[a],o=interaction_view.expression.id2values(i.options.fields[r],function(e){return e},{});0!==o&&""==o?delete i.options.fields[r]:i.options.fields[r]=o}this.db.flushRecord(!0,this.tableid,this.options.fields,function(t){i.returnData(t),e&&e()})},changeValue:function(e,t){var i,n,a,r=this.options.chooseposition,o=this.options.choosepositionname,s=this,l=[],c=null;if("line"==r)a?i=a.id:c=o-1;else if("random"==r)n=!0;else if(i=o,i=interaction_view.expression.id2values(i,function(e){return e},{}),!i)return;if("del"==e&&this.db.deleteRecord(this.tableid,i,function(){t&&t()}),"upd"==e){for(var d in this.options.fields)l.push(d);for(var h=0;h<l.length;h++){var u=l[h],p=interaction_view.expression.id2values(s.options.fields[u],function(e){return e},{});0!==p&&""==p?delete s.options.fields[u]:s.options.fields[u]=p}if(i||null==c){var v,g={};if(n){for(var h=0;h<interaction_view.dblist.get(s.db_id).get("querys").length;h++){var u=interaction_view.dblist.get(s.db_id).get("querys")[h];if(s.queryid==u.id){v=u;break}}var f=new DB.DBQuery;g.data=JSON.stringify(s.formatQuery(v,f)),i="random"}this.db.updateRecord(!0,this.tableid,i,this.options.fields,g,function(e){s.returnData(e),t&&t()})}else;}},requestValue:function(e){for(var t,i=this.options.choosepositionname,n=this,a=0;a<interaction_view.dblist.get(n.db_id).get("querys").length;a++){var r=interaction_view.dblist.get(n.db_id).get("querys")[a];if(n.queryid==r.id){t=r;break}}if("random"==this.options.chooseposition){var o=new DB.DBAggregate("table_id");o.random("id");var s={value:t,table_id:n.tableid,db_id:n.db_id,israndom:!0,agg:o,option:"RANDOM"}}else var l=interaction_view.expression.id2values(i,function(e){return e},{no_compute:!0}),s={value:t,table_id:n.tableid,db_id:n.db_id,id:l};n.uploadQuery(s,function(t){n.returnData(t),e&&e()})},loadCachelist:function(e){for(var t=0;t<interaction_view.dblist.models.length;t++)for(var i=interaction_view.dblist.models[t],n=i.get("querys"),a=i.get("sheet_id"),r=i.get("id"),o=0;o<n.length;o++)_.include(this.options.cachelist,n[o].id)&&this.uploadQuery({value:n[o],table_id:a,db_id:r,type:n[o].type,size:n[o].size,cache:!0},e)
},refresh:function(e){for(var t=this,i=interaction_view.dblist.get(t.db_id).get("querys"),n=0;n<i.length;n++){var a=i[n];if(t.queryid==a.id){var r={value:a,table_id:t.tableid,db_id:t.db_id};t.uploadQuery(r,e)}}},returnData:function(e){var t=this,i=e.data.results[0].id;if(t.options.transferid&&t.options.return_data&&"on"==t.options.return_data[0]){var n=t.options.transferid;interaction_view.expression.transferId(n,i)}if(t.options.returnfield&&t.options.return_data&&"on"==t.options.return_data[0]){var a=t.options.returnfield;for(var r in a)interaction_view.expression.setAssignment(a[r],r,e.data)}},queryText:function(e,t){{var i=(e.db_select,e.bind_item),n=e.bind_item_type,a=e.bind_page_id,r=e.field_item,o=e.express_id,s=e.db_db_id,l=e.db_query_id;_.find(interaction_view.dblist.models,function(e){return e.attributes.id==s})}if(i){var c=null;switch(n){case"page":c=interaction_view.ipagelist.getPage(a);break;case"master":c=interaction_view.imasterlist.models[0];break;case"background":c=interaction_view.ibackgroundlist.models[0]}var d=c.iOverlaylist.get(i);return d.iview.renderQuery(s,l,{key:r,value:o},function(){t&&t()}),void(d.attributes.iDetail.query={key:r,value:o})}t&&t()}}}(window),define("_e/dboperate",function(){}),function(e){e.connector={dragcontroller:function(e,t,i,n){if(e.data("dragArgs"))var a=e.data("dragArgs");else{var a=new connector.controller({dom:e,funcs:i});e.data("dragArgs",a)}a.handle(t,n)},getDragArgs:function(e){for(var t={0:{funcs:[],start:0,end:0,range:0,_current:0,_delta:0},1:{funcs:[],start:0,end:0,range:0,_current:0,_delta:0}},i=0;i<e.length;i++){var n=(1==e[i].axis||3==e[i].axis)&&1||0;t[n].funcs.push(e[i])}return t},clearDragController:function(e){var t=e.data("dragArgs");t&&t.clear()},removeDragController:function(e){e.removeClass("is_exceededY").removeClass("is_exceededX"),e.data("dragArgs",null),e.data("dragfuncs",null)}},connector.controller=function(e){if(this.options={dom:null,funcs:null},"object"==typeof e)for(var t in e)e.hasOwnProperty(t)&&(this.options[t]=e[t]);this.init()},connector.controller.prototype.init=function(){this.args=connector.getDragArgs(this.options.funcs),this.dom=this.options.dom},connector.controller.prototype.handle=function(t,i){var n=this.args,a={0:0,1:0};if("dragend"!=t.type){this.inertiaTimer&&e.clearInterval(this.inertiaTimer);var r=1===i?"Y":"X";a[i]=t.gesture["delta"+r];for(var o={0:{max:0,min:0},1:{max:0,min:0}},s=0;s<n[i].funcs.length;s++){var l=n[i].funcs[s].func(t,a[i]);l&&0>l&&o[i].min>l&&(o[i].min=l),l&&l>0&&o[i].max<l&&(o[i].max=l)}i&&o[i].min<-30&&this.dom.attr("data-up")?this.dom.addClass("is_exceededY"):i&&o[i].max>30&&this.dom.attr("data-down")?this.dom.addClass("is_exceededY"):!i&&o[i].min<-30&&this.dom.attr("data-left")?this.dom.addClass("is_exceededX"):!i&&o[i].max>30&&this.dom.attr("data-right")&&this.dom.addClass("is_exceededX")}else{for(j=0;2>j;j++)for(var s=0;s<n[j].funcs.length;s++)n[j].funcs[s].func(t);this.inertia(t)}},connector.controller.prototype.clear=function(){this.inertiaTimer&&e.clearInterval(this.inertiaTimer),this.dom.removeClass("is_exceededY").removeClass("is_exceededX")},connector.controller.prototype.inertia=function(t){var i=3*t.gesture.velocityX,n=3*t.gesture.velocityY,a=this,r=this.args,o=0;this.inertiaTimer&&e.clearInterval(this.inertiaTimer),this.inertiaTimer=e.setInterval(function(){var s={0:0,1:0};if(n>0&&(s[1]=t.gesture.deltaY/Math.abs(t.gesture.deltaY)*n),i>0&&(s[0]=t.gesture.deltaX/Math.abs(t.gesture.deltaX)*i),i>0)for(var l=0,c=0;c<r[l].funcs.length;c++)r[l].funcs[c].func(t,s[0],!0);if(n>0)for(var l=1,c=0;c<r[l].funcs.length;c++)r[l].funcs[c].func(t,s[1],!0);n-=1e-5*o*o,i-=1e-5*o*o,0>=i&&0>=n&&e.clearInterval(a.inertiaTimer),o+=1},1)},connector.controller.prototype.excceeded=function(){},connector.controller.prototype.end=function(){}}(window),define("_e/connector",function(){}),function(){window.stategroup=function(e){this.defaults={},this.options=e,this.options=$.extend(!0,{},this.defaults,"object"==typeof e&&e)},window.stategroup.prototype={render:function(){var e=this;if(this.detail=this.options.group?this.options.group.toJSON().iDetail:this.options.toJSON().iDetail,this.els=this.detail.chooseElement,this.getPageOverlay(interaction_view.currentPage,{type:"iOverlaylist"})){var t,i=this.getPageOverlay(interaction_view.currentPage,{type:"iOverlaylist"});this.options.page.isLayer&&(i=i.concat(this.options.page.iOverlaylist.models)),e.ioverlaylist=i,t=_.map(i,function(e){return e.id});for(var n=_.map(this.els,function(e){return e.id}),a=0;a<n.length;a++){var r=_.find(t,function(e){return e==n[a]});_.isUndefined(r)&&n.splice(a,1)}_.each(e.detail.states,function(e){if(e.element)for(key in e.element)_.include(n,e.element[key].id)||delete e.element[key]})}var o=this.detail.loop?this.detail.loop:!1;o&&(this.repeat=!0),this.changeState()},changeState:function(){var e=this,t=this.detail.states,i=e.getPageOverlay(interaction_view.currentPage,{type:"iActionlist"});if(e.options.page.isLayer&&(i=i.concat(e.options.page.iActionlist.models)),this.detail.autoplay&&!this.options.config){this.duration=0;var n=this.detail.loop?this.detail.loop:!1;if(n)var a=-1;else a=0;this.detail.timeLine=new TimelineMax({repeat:a,paused:!0});var r=1;for(r;r<t.length;){var o=e.parseData(t[r]),s=e.createStateTimeline(i,t[r],!1);s.addLabel("state",0),1==r?(this.detail.timeLine.addLabel("timeInterval"+r,"0"),this.duration+=parseInt(t[r].duration)):t[r-1]&&t[r-1].duration&&(this.detail.timeLine.addLabel("timeInterval"+r,this.duration),this.duration+=parseInt(t[r].duration)),this.stateplay(o,{label:"timeInterval"+r,state:t[r],stateLine:s,stateLabel:"state"}),r++}if(this.repeat){var l=this.getPageOverlay(this.els[0].page_id,{type:"iOverlaylist"});this.options.page.isLayer&&(l=l.concat(this.options.page.iOverlaylist.models)),t=this.addFirstel(l,t);var o=e.parseData(t[0]);this.detail.timeLine.addLabel("timeInterval0",this.duration);var c=e.createStateTimeline(i,t[0],!1);c.addLabel("repeatstate",0),this.stateplay(o,{label:"timeInterval0",state:t[0],stateLine:c,stateLabel:"repeatstate"})}this.detail.timeLine.play()}else if(this.options.config){var d,h=this.options.config,u=h.ope,t=this.options.group.get("iDetail").states;t=this.addFirstel(this.options.page.iOverlaylist.models,t),this.killOverlayTweenmax(this.els),this.detail.timeLine&&this.detail.timeLine.kill();var p=this.detail.currentTargetState?this.detail.currentTargetState:this.detail.currentState;switch(u){case"first":d=t[0];break;case"last":d=t[t.length-1];break;case"pre":this.repeat?(_.isUndefined(p)?_.isUndefined(p)&&(d=t[t.indexOf(p)-1]):d=t[t.indexOf(p)-1],d||(d=t[t.length-1])):_.isUndefined(p)||(d=t[t.indexOf(p)-1]);break;case"next":this.repeat?(d=_.isUndefined(p)?t[1]:t[t.indexOf(p)+1],d||(d=t[0])):d=_.isUndefined(p)?t[1]:t[t.indexOf(p)+1];break;case"to":_.isUndefined(h.startTo)||(d=t[h.startTo])}if(d){this.detail.timeLine=e.createStateTimeline(i,d,!0),this.detail.timeLine.addLabel("timeduration",0);var o=this.parseData(d,!0);this.detail.currentTargetState=d,this.stateplay(o,{state:d,label:"timeduration"}),this.detail.timeLine.play()}}},stateplay:function(e,t){var i=this;if(e&&e.objs&&e.objs.length)for(var n=0;n<e.objs.length;n++){var a={obj:e.objs[n],opt:e,others:t,length:e.objs.length,size:n},r=e.objs[n].wrap?e.objs[n].wrap[0]:e.objs[n].element?e.objs[n].element[0]:e.objs[n].el[0];if(r){a.css=e.objs[n].css;var o=i.createTween(r,a)}if(e.objs[n].el){a.css=$.extend(!0,{},e.objs[n].EL);var s=i.createTween(e.objs[n].el[0],a)}if(e.objs[n].element){a.css=e.objs[n].size;var l=i.createTween(e.objs[n].element[0],a)}i.detail.timeLine&&(t.stateLine?(o&&t.stateLine.add(o,t.stateLabel),s&&t.stateLine.add(s,t.stateLabel),l&&t.stateLine.add(l,t.stateLabel),i.detail.timeLine.add(t.stateLine,t.label)):(o&&i.detail.timeLine.add(o,t.label),s&&i.detail.timeLine.add(s,t.label),l&&i.detail.timeLine.add(l,t.label)))}},parseData:function(e,t){var i,a=interaction_view.currentPage;a!=this.els[0].page_id&&(i=interaction_view.imasterlist.models[0].id==this.els[0].page_id?interaction_view.imasterlist.models[0]:interaction_view.ibackgroundlist.models[0]);var r=this.options.page?this.options.page:i?i:a,o=[];for(key in e.element){var s,l,c={},d={},h={},u=r.iOverlaylist.get(key);if(!u)return;var p=u.iview.$el;if(u.iview.$el.find(".el_wrap")&&(s=u.iview.$el.find(".el_wrap")),u.iview.$el.find(".Element")&&(l=u.iview.$el.find(".Element")),e.element[key].iDetail&&(_.isUndefined(e.element[key].iDetail.init_opacity)||(d.opacity=e.element[key].iDetail.init_opacity),_.isUndefined(e.element[key].iDetail.init_rotation)||(c.rotation=isNaN(e.element[key].iDetail.init_rotation)?0:e.element[key].iDetail.init_rotation,c.rotationX=e.element[key].iDetail.rotationX||0,c.rotationY=e.element[key].iDetail.rotationY||0,c.skewX=e.element[key].iDetail.skewX||0,c.skewY=e.element[key].iDetail.skewY||0,c.transformOrigin=(_.isUndefined(e.element[key].iDetail.originX)&&"50"||e.element[key].iDetail.originX)+"% "+(_.isUndefined(e.element[key].iDetail.originY)&&"50"||e.element[key].iDetail.originY)+"% 0px"),e.element[key].iDetail.iStyle&&(c=$.extend(!0,{},c,this.css2json(e.element[key].iDetail.iStyle)),_.isUndefined(c)||(c["border-width"]&&delete c["border-width"],c["border-style"]&&delete c["border-style"],c["border-color"]&&delete c["border-color"],c["border-radius"]&&delete c["border-radius"]),c=this.parseStyle(c))),d.perspective=600,e.element[key].iCommon){if(_.isUndefined(e.element[key].iCommon.iWidth)||(h.width=e.element[key].iCommon.iWidth,h.left=-h.width/2),_.isUndefined(e.element[key].iCommon.iHeight)||(h.height=e.element[key].iCommon.iHeight,h.top=-h.height/2),!_.isUndefined(e.element[key].iCommon.iStartx)){var v=_.isUndefined(e.element[key].iCommon.iWidth)?u.get("iCommon")[iPageDirection].iWidth:e.element[key].iCommon.iWidth;d.x=e.element[key].iCommon.iStartx+v/2}if(!_.isUndefined(e.element[key].iCommon.iStarty)){var g=_.isUndefined(e.element[key].iCommon.iHeight)?u.get("iCommon")[iPageDirection].iHeight:e.element[key].iCommon.iHeight;d.y=e.element[key].iCommon.iStarty+g/2}}if(this.detail.state){if(this.detail.state.css[key])for(k in this.detail.state.css[key])_.isUndefined(c[k])&&("rotation"!=k&&"backgroundColor"!=k&&(c[k]=""),"transformOrigin"==k&&(c[k]="50% 50% 0px"),"backgroundColor"==k&&(c[k]="transparent"));if(this.detail.state.el[key])for(n in this.detail.state.el[key])_.isUndefined(d[n])&&("opacity"==n&&(d[n]=1),t||("x"==n&&(d[n]=u.get("iCommon")[iPageDirection].iWidth/2),"y"==n&&(d[n]=u.get("iCommon")[iPageDirection].iHeight/2)));if(this.detail.state.size[key])for(m in this.detail.state.size[key])_.isUndefined(h[m])&&("width"==m&&(h[m]=u.get("iCommon")[iPageDirection].iWidth),"height"==m&&(h[m]=u.get("iCommon")[iPageDirection].iHeight),"left"==m&&(h[m]=-u.get("iCommon")[iPageDirection].iWidth/2),"top"==m&&(h[m]=-u.get("iCommon")[iPageDirection].iHeight/2))}this.detail.state||(this.detail.state={}),this.detail.state.css||(this.detail.state.css={}),this.detail.state.el||(this.detail.state.el={}),this.detail.state.size||(this.detail.state.size={}),this.detail.state.css[key]=c,this.detail.state.el[key]=d,this.detail.state.size[key]=h,this.options.group?this.options.group.set("iDetail",this.detail):this.options.set("iDetail",this.detail);var f={el:p,wrap:s,element:l,css:c,EL:d,size:h};o.push(f)}var w={id:e.id,objs:o,delay:e.duration,ease:e.animate,state:e.id};return w},parseStyle:function(e){var t={};for(attr in e){var i=/\b(\w)|\s(\w)/g,n=e[attr];-1!=attr.indexOf("-webkit")&&(attr=attr.substr(1));for(var a=attr.split("-"),r=1;r<a.length;r++)a[r]=a[r].toLowerCase(),a[r]=a[r].replace(i,function(e){return e.toUpperCase()});attr=a.join(""),t[attr]=n}return t},addFirstel:function(e,t){t[0].element={};var i=_.map(e,function(e){return e.id});return _.each(this.els,function(n){if(_.include(i,n.id)){var a=_.find(e,function(e){return e.id==n.id});t[0].element[n.id]={iCommon:a.get("iCommon").landscape,iDetail:{iStyle:a.get("iDetail").iStyle,init_rotation:a.get("iDetail").init_rotation,init_opacity:a.get("iDetail").init_opacity,rotationX:a.get("iDetail").rotationX,rotationY:a.get("iDetail").rotationY,skewX:a.get("iDetail").skewX,skewY:a.get("iDetail").skewY},id:n.id}}}),this.parseData(t[0]),t},css2json:function(e){var t={};if(!e)return t;if("object"==typeof e)for(var i in e)e[i].toLowerCase&&(t[e[i].toLowerCase()]=e[e[i]]);else if("string"==typeof e){e=e.split("; "),e.length&&(e[e.length-1]=e[e.length-1].replace(";",""));for(var i in e){var n=e[i].split(": ");t[n[0].toLowerCase()]=n[1]}}return t},createTween:function(e,t){var i=TweenMax.to(e,t.opt.delay,{css:t.css,ease:animation.prototype.EaseTypes[t.opt.ease],immediateRender:!1,x:t.x,y:t.y});return i},createStateTimeline:function(e,t,i){var n=this,a=new TimelineMax({repeat:0,paused:i,onStart:function(t){_.each(e,function(e){var i=e.get("condition");i==t.id&&"statestart"==e.attributes.iDetail.customType&&e.iview.executeAction(e.iview)})},onComplete:function(t){_.each(e,function(e){var i=e.get("condition");i==t.id&&"stateend"==e.attributes.iDetail.customType&&e.iview.executeAction(e.iview)}),n.detail.currentState=t,n.detail.currentTargetState&&delete n.detail.currentTargetState,n.options.group?n.options.group.set("iDetail",n.detail):n.options.set("iDetail",n.detail)},onStartParams:[t],onCompleteParams:[t]});return a},getPageOverlay:function(e,t){if(e){var i=interaction_view.ipagelist.getPage(e);if(i)var n=i[t.type].models}if(n||(n=[]),interaction_view.imasterlist.length){var a=interaction_view.imasterlist.models[0][t.type].models;n=n.concat(a)}if(interaction_view.ibackgroundlist.length){var r=interaction_view.ibackgroundlist.models[0][t.type].models;n=n.concat(r)}return n},killOverlayTweenmax:function(e){var t=this;_.each(e,function(e){var i=t.getPageOverlay(e.page_id,{type:"iOverlaylist"});t.options.page.isLayer&&(i=i.concat(t.options.page.iOverlaylist.models)),_.each(i,function(t){t.id==e.id&&(TweenMax.killTweensOf(t.iview.$el),t.iview.$el.find(".el_wrap")&&TweenMax.killTweensOf(t.iview.$el.find(".el_wrap")),t.iview.$el.find(".Element")&&TweenMax.killTweensOf(t.iview.$el.find(".Element")))})})}}}(window),define("_e/stategroup",function(){}),function(){var e=1,t={init:function(){_e.orientation.orientationSupport&&window.addEventListener("deviceorientation",_e.orientation.onDeviceOrientation),_e.orientation.deltaX=0,_e.orientation.deltaY=0,_e.orientation.event={},_e.orientation.x=0,_e.orientation.y=0,_e.orientation.z=0,_.extend(_e.orientation.event,Backbone.Events)},orientationSupport:function(){return!!window.DeviceOrientationEvent},onDeviceOrientation:function(){var t,i,n,a;if(null!==event.beta&&null!==event.gamma){this.orientationStatus=1;var r=(event.beta-30||0)/e,o=(event.gamma-30||0)/e,s=window.innerHeight>window.innerWidth;s?(t=o+30,i=r,n=180,a=90):(t=-(r+30),i=o,n=90,a=180),_.each(_e.orientation.orientationEvents,function(e){var r=t,o=i;e.scrollX||(r=0),e.scrollY||(o=0),e.func&&e.func(-r*e.speed,-o*e.speed,n,a)})}_e.orientation.x=event.beta,_e.orientation.y=event.gamma,_e.orientation.z=event.alpha,_e.orientation.event.trigger("orientation",event)},orientationEvents:[]};"undefined"==typeof require?(window._e||(window._e={}),window._e.orientation=t):define("_e/orientation",["jquery"],function(){return window._e||(window._e={}),window._e.orientation=t,window._e.orientation})}(window),function(e){var t=window.DB={};t.OptionBase={},t.Sync={},t.DBObject={},t.Utils={},t.DB=t,t.Logs={},t.Debug=!1,t.instants={},t.config={errorcallback:function(e){setTimeout(function(){e.msg&&(void 0!=typeof interaction_view?(interaction_view.errorAlert(e.msg),interaction_view.queue.clear()):global.message("error",e.msg))},300)}};var i=t.DBObject=function(e){var i=this;i.baseUrl="/v2/api",i.className=e,t.instants[e]=i};i.prototype={extend:function(e){return d.extend(this,e,!0)},saveTable:function(e,t,i){var n=this;void 0==e&&(e=!0),n.post(n.baseUrl+"/tables/",e?JSON.stringify(n):n,t,i)},getTableObject:function(e){var t=this,n=new i(e);return t.options(t.baseUrl+"/tables/"+e+"/",{},function(e){"200"==e.code&&d.extend(n,e.data.results,!1)},function(){n=null},!1),n},convert2Table:function(e){var i=new t.DBObject(e.className);return d.extend(i,e,!1),i},getTableFields:function(e,t,i){var n=this;n.options(n.baseUrl+"/tables/"+e+"/",{},t,i)},updateTable:function(e,t,i,n,a){var r=this;void 0==e&&(e=!0),r.put(r.baseUrl+"/tables/"+t+"/",e?JSON.stringify(i):i,n,a)},deleteTable:function(e,t,i){var n=this;n.delete(n.baseUrl+"/tables/"+e+"/",{},t,i)},getTableRules:function(e){var t=this,i={};return t.get(t.baseUrl+"/tables/"+e+"/info/",{},function(e){if(e){var t=e.data.results[0].user_info,n=e.data.results[0].table_rule;d.extend(i,t,!1),d.extend(i,n,!1)}},function(){i={}},!1),i},flushRecord:function(e,t,i,n){var a=this;a.post(a.baseUrl+"/tables/"+t+"/objects/",e?JSON.stringify(i):i,n)},updateRecord:function(e,i,n,a,r,o){var s=this;n?s.put(s.baseUrl+"/tables/"+i+"/objects/"+n+"/"+(r.data?"?data="+encodeURI(r.data):""),e?JSON.stringify(a):a,o):t.config.errorcallback()},deleteRecord:function(e,t,i){var n=this;n.delete(n.baseUrl+"/tables/"+e+"/objects/"+t+"/",{},i)},deleteRecords:function(e,t,i,n){var a=this;a.delete(a.baseUrl+"/tables/"+e+"/objects/",{ids:t},i,n)},saveOrUpdateRecord:function(e,t,i,n,a){var r=this;r.post(r.baseUrl+"/tables/"+t+"/objects/",e?JSON.stringify(i):i,n,a)}};var n=t.DBConfig=function(e){this.hit=e||0,this.start=0};n.prototype={setStart:function(e){var t=this;return this.start=e,t},setPage:function(e){var t=this;return t.start=t.hit*e,t},getPage:function(){return this.start/this.hit},nextPage:function(){var e=this;return e.start+=e.hit,e},prevPage:function(){var e=this;return e.start-=e.hit,e.start<0&&(e.start=0),e},setCount:function(e){var t=this;return t.hit=e,this},getCount:function(){return this.hit}};var a=t.DBAggregate=function(e){d.setOpt(this,"group_key",e)};a.prototype={sum:function(e){var t=d.getOpt(this,"agg_fun")||"";return d.setOpt(this,"agg_fun",""==t?"sum("+e+")":t+"#sum("+e+")"),this},max:function(e){var t=d.getOpt(this,"agg_fun")||"";return d.setOpt(this,"agg_fun",""==t?"max("+e+")":t+"#max("+e+")"),this},min:function(e){var t=d.getOpt(this,"agg_fun")||"";return d.setOpt(this,"agg_fun",""==t?"min("+e+")":t+"#min("+e+")"),this},random:function(e){var t=d.getOpt(this,"agg_fun")||"";return d.setOpt(this,"agg_fun",""==t?"random("+e+")":t+"#random("+e+")"),this},count:function(){var e=d.getOpt(this,"agg_fun")||"";return d.setOpt(this,"agg_fun",""==e?"count()":e+"#count()"),this},setRange:function(e,t){return d.setOpt(this,"range",e+"~"+t),this},setFilter:function(e){return d.setOpt(this,"agg_filter",e),this},setSamplerThreshold:function(e,t){return d.setOpt(this,"agg_sampler_threshold",e),d.setOpt(this,"agg_sampler_step",t),this},setMaxGroup:function(e){return d.setOpt(this,"max_group",e),this}};var r=t.DBLimit=function(){};r.prototype={equalTo:function(e,t){return t?(d.setOpt(this,"key",e),d.setOpt(this,"value",t),this):this},and:function(e){var t={opt:"AND",values:[]};t.values.push(this),d.isArray(e)?d.each(e,function(e){t.values.push(e)}):t.values.push(e);var i=new r;return i.statement=t,i},or:function(e){var t={opt:"OR",values:[]};t.values.push(this),d.isArray(e)?d.each(e,function(e){t.values.push(e)}):t.values.push(e);var i=new r;return i.statement=t,i},and_not:function(e){var t={opt:"ANDNOT",values:[]};t.values.push(this),d.isArray(e)?d.each(e,function(e){t.values.push(e)}):t.values.push(e);var i=new r;return i.statement=t,i},rank:function(e){var t={opt:"RANK",values:[]};t.values.push(this),d.isArray(e)?d.each(e,function(e){t.values.push(e)}):t.values.push(e);var i=new r;return i.statement=t,i}};var o=t.DBFilter=function(e){if(e&&e.key){var t=this.analysz(e.value);this.key=e.key,d.extend(this,t,!1)}};o.prototype={analysz:function(e){var t={option:"=",value:""};e+="";var i=d.trim(e,"g"),n=["<","<=",">",">=","=","!="],a=0;return i&&(d.each(n,function(e){0==i.indexOf(e)&&(a=1,t.option=e,t.value=i.substr(e.length))}),0==a&&(t.option="=",t.value=e)),t},and:function(e){var t={opt:"AND",values:[]},i=this;t.values.push(this),d.isArray(e)?d.each(e,function(e){t.values.push(e)}):t.values.push(e);var n=0;if(d.each(t.values,function(e){e.value&&(n=1)}),0==n)return i;var a=new o;return a.statement=t,a},or:function(e){var t={opt:"OR",values:[]},i=this;t.values.push(this),d.isArray(e)?d.each(e,function(e){t.values.push(e)}):t.values.push(e);var n=0;if(d.each(t.values,function(e){e.value&&(n=1)}),0==n)return i;var a=new o;return a.statement=t,a},and_not:function(e){var t={opt:"ANDNOT",values:[]},i=this;t.values.push(this),d.isArray(e)?d.each(e,function(e){t.values.push(e)}):t.values.push(e);var n=0;if(d.each(t.values,function(e){e.value&&(n=1)}),0==n)return i;var a=new o;return a.statement=t,a},equalTo:function(e,t){return d.setOpt(this,"key",e),d.setOpt(this,"value",t),d.setOpt(this,"option","="),this},notEqualTo:function(e,t){return d.setOpt(this,"key",e),d.setOpt(this,"value",t),d.setOpt(this,"option","!="),this},lessThan:function(e,t){return d.setOpt(this,"key",e),d.setOpt(this,"value",t),d.setOpt(this,"option","<"),this},lessThanOrEqualTo:function(e,t){return d.setOpt(this,"key",e),d.setOpt(this,"value",t),d.setOpt(this,"option","<="),this},greaterThan:function(e,t){return d.setOpt(this,"key",e),d.setOpt(this,"value",t),d.setOpt(this,"option",">"),this},greaterThanOrEqualTo:function(e,t){return d.setOpt(this,"key",e),d.setOpt(this,"value",t),d.setOpt(this,"option",">="),this}};var s=t.DBQuery=function(){var e=this;e.aggregate=[],e.baseUrl="/v2/api"};s.prototype={addAggregate:function(e){var t=this;return e&&t.aggregate.push(e),this},addLimit:function(e){var t=this;return e&&e&&(t.query=e),this},addFilter:function(e){var t=this;return e&&(t.filter=e),this},addSort:function(e,t){if(!e||!t)return this;this.sort||(this.sort=[]);var i="ASC"==t.toUpperCase()?"+":"-";return this.sort.push(i+e),this},addConfig:function(e){var t=this;return e&&(t.config=e),this},addSQL:function(e){var t=this;return t.execSQL=e,t},addFields:function(e){var t=this;return t.fetch_fields||(t.fetch_fields=[]),d.isArray(e)&&d.each(e,function(e){t.fetch_fields.push(e)}),t},addScope:function(e){var t=this;return t.scope=e,t},addJoin:function(e,t,i){var n=this;return n.join||(n.join={}),n.join={table_id:e,join_field:t,fetch_fields:i},n},Query:function(e,t,i,n,a,r){var o=this,s={};t||(t=1),i||(i=20),s=d.clone(o,s),r&&d.isObject(r)&&null!=r.start&&void 0!=r.start&&(s.config||(s.config={}),s.config.start=r.start,s.config.hit=1),r.id&&null!=r.id&&void 0!=r.id?o.send("get",o.baseUrl+"/tables/"+e+"/objects/"+r.id+"/",{data:JSON.stringify(s)},n,a):r.israndom?o.send("get",o.baseUrl+"/tables/"+e+"/objects/random/",{data:JSON.stringify(s)},n,a):o.send("get",o.baseUrl+"/tables/"+e+"/objects/",{data:JSON.stringify(s),page:t,size:i},n,a)},JSON2Str:function(e){return e?e+"/data/?data="+encodeURIComponent(JSON.stringify(this))+"&page=1&size=20":null}};var l=t.Sync=function(){};l.prototype={send:function(i,n,a,r,o,s){if(null!=i&&(i=i.toUpperCase()),n){if(void 0==s&&(s=!0),"POST"!=i&&"PUT"!=i&&"GET"!=i&&"DELETE"!=i&&"OPTIONS"!=i)return void console.log("å¯¹ä¸èµ·,è¯·æ±‚çš„æ–¹æ³•ä¸æ­£ç¡®!");if(t.Debug){var l=t.Utils.uuid(2),c=n+" ("+i+")";t.Utils.log(l,c,a)}e.ajax({type:i,url:n,data:a,async:s,contentType:"application/json",xhrFields:{withCredentials:!0},dataType:"json",crossDomain:!0,success:function(e,i,n){200==e.code?r&&r(e,n):t.config.errorcallback(e,n),t.Debug&&t.Utils.log(l," Success",e,!0)},error:function(e,i,n){t.config.errorcallback(e,n),t.Debug&&t.Utils.log(l," Fail",e,!0)}})}},post:function(e,t,i){this.send("POST",e,t,i)},get:function(e,t,i,n,a){this.send("GET",e,t,i,n,a)},put:function(e,t,i,n){this.send("PUT",e,t,i,n)},"delete":function(e,t,i){this.send("delete",e,t,i)},options:function(e,t,i,n){this.send("options",e,t,i,n)}};var c=t.OptionBase=function(){};c.prototype={addField:function(e){var t=this;return t.fields||(t.fields=[]),null!=e&&(d.isObject(e)&&t.fields.push(e),d.isArray(e)&&d.each(e,function(e){t.fields.push(e)})),this},addTitle:function(e){return d.setOpt(this,"title",e),this},addStartDate:function(e){return d.setOpt(this,"startTime",e),this},addEndDate:function(e){return d.setOpt(this,"endTime",e),this},addRule:function(e){return d.setOpt(this,"rule",e),this},addShowWeixinInfo:function(e){return d.setOpt(this,"show_weixin_info",e),this},addShowContactInfo:function(e){return d.setOpt(this,"show_contact_info",e),this},addOpt:function(e,t){return d.setOpt(this,e,t),this},addAppId:function(e){return d.setOpt(this,"app_id",e),this},updateField:function(e,t,i){var n=this,a=n.fields;return d.each(a,function(n){n.cid==e&&(n[t]=i)}),this},getField:function(e,t){var i;return d.each(this.fields,function(n){return n[e]==t?(i=n,!1):void 0}),i},getFields:function(){return this.fields},removeField:function(e,t){var i=this,n=i.fields;return d.each(n,function(i,a){return i[e]==t?(n.splice(a,1),!1):void 0}),i},removeAll:function(){this.fields=[]}};var d=t.Utils={trim:function(e,t){var i;return d.isString(e)?(i=e.replace(/(^\s+)|(\s+$)/g,""),"g"==t.toLowerCase()&&(i=i.replace(/\s/g,""))):i=e,i},each:function(e,t,i){if(null!=e)if(e.length===+e.length){for(var n=0,a=e.length;a>n;n++)if(t.call(i,e[n],n,e)===!1)return!1}else for(var r in e)if(e.hasOwnProperty(r)&&t.call(i,e[r],r,e)===!1)return!1},setOpt:function(e,t,i){var n={};d.isString(t)?n[t]=i:n=t,d.extend(e,n,!1)},getOpt:function(e,t){return e[t]},contains:function(e,t){for(var i=e.length;i--;)if(e[i]===t)return!0;return!1},clone:function(e,t){var i;t=t||{};for(var n in e)e.hasOwnProperty(n)&&(i=e[n],"object"==typeof i?(t[n]=d.isArray(i)?[]:{},d.clone(e[n],t[n])):t[n]=i);return t},inherits:function(e,t){var i=e.prototype,n=d.makeInstance(t.prototype);return d.extend(n,i,!0),e.prototype=n,n.constructor=e},extend:function(e,t,i){if(t)for(var n in t)i&&e.hasOwnProperty(n)||(e[n]=t[n]);return e},makeInstance:function(e){var t=new Function;return t.prototype=e,e=new t,t.prototype=null,e},delArray:function(e,t){return 0>t?this:e.slice(0,t).concat(e.slice(t+1,e.length))},uuid:function(e){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}if(e){for(var i="";e--;)i+=t();return i}return t()+t()+t()+t()+t()+t()+t()+t()},log:function(e,i,n,a){if(t.Debug)if(a){var r='<span style="margin-left:10px">'+(new Date).toLocaleTimeString()+i+"</span> <pre>"+JSON.stringify(n)+"</pre>";t.Logs[e]&&(t.Logs[e].res=r)}else{var r=(new Date).toLocaleTimeString()+"</br/>"+i+" <pre>"+JSON.stringify(n)+"</pre>";t.Logs[e]={},t.Logs[e].req=r}}};d.each(["String","Function","Array","Number","RegExp","Object","Date"],function(e){t.Utils["is"+e]=function(t){return Object.prototype.toString.apply(t)=="[object "+e+"]"}}),d.inherits(i,c),d.inherits(i,l),d.inherits(i,s),d.inherits(s,l)}(window.jQuery),define("thirdparty/dataEngine/dataEngine",["jquery"],function(){}),function(){function e(e,i,n,a){return new t(e,i,n,a)}function t(e,t,n,a){this.options=a||{},this.options.adapters=this.options.adapters||{},this.obj=e,this.keypath=t,this.callback=n,this.objectPath=[],this.parse(),i(this.target=this.realize())&&this.set(!0,this.key,this.target,this.callback)}function i(e){return"object"==typeof e&&null!==e}function n(e){throw new Error("[sightglass] "+e)}e.adapters={},t.tokenize=function(e,t,i){var n,a,r=[],o={i:i,path:""};for(n=0;n<e.length;n++)a=e.charAt(n),~t.indexOf(a)?(r.push(o),o={i:a,path:""}):o.path+=a;return r.push(o),r},t.prototype.parse=function(){var i,a,r=this.interfaces();r.length||n("Must define at least one adapter interface."),~r.indexOf(this.keypath[0])?(i=this.keypath[0],a=this.keypath.substr(1)):("undefined"==typeof(i=this.options.root||e.root)&&n("Must define a default root adapter."),a=this.keypath),this.tokens=t.tokenize(a,r,i),this.key=this.tokens.pop()},t.prototype.realize=function(){var e,t=this.obj,n=!1;return this.tokens.forEach(function(a,r){i(t)?("undefined"!=typeof this.objectPath[r]?t!==(e=this.objectPath[r])&&(this.set(!1,a,e,this.update.bind(this)),this.set(!0,a,t,this.update.bind(this)),this.objectPath[r]=t):(this.set(!0,a,t,this.update.bind(this)),this.objectPath[r]=t),t=this.get(a,t)):(n===!1&&(n=r),(e=this.objectPath[r])&&this.set(!1,a,e,this.update.bind(this)))},this),n!==!1&&this.objectPath.splice(n),t},t.prototype.update=function(){var e,t;(e=this.realize())!==this.target&&(i(this.target)&&this.set(!1,this.key,this.target,this.callback),i(e)&&this.set(!0,this.key,e,this.callback),t=this.value(),this.target=e,this.value()!==t&&this.callback())},t.prototype.value=function(){return i(this.target)?this.get(this.key,this.target):void 0},t.prototype.setValue=function(e){i(this.target)&&this.adapter(this.key).set(this.target,this.key.path,e)},t.prototype.get=function(e,t){return this.adapter(e).get(t,e.path)},t.prototype.set=function(e,t,i,n){var a=e?"observe":"unobserve";this.adapter(t)[a](i,t.path,n)},t.prototype.interfaces=function(){var t=Object.keys(this.options.adapters);return Object.keys(e.adapters).forEach(function(e){~t.indexOf(e)||t.push(e)}),t},t.prototype.adapter=function(t){return this.options.adapters[t.i]||e.adapters[t.i]},t.prototype.unobserve=function(){var e;this.tokens.forEach(function(t,i){(e=this.objectPath[i])&&this.set(!1,t,e,this.update.bind(this))},this),i(this.target)&&this.set(!1,this.key,this.target,this.callback)},"undefined"!=typeof module&&module.exports?module.exports=e:"function"==typeof define&&define.amd?define("sightglass",[],function(){return this.sightglass=e}):this.sightglass=e}.call(this),function(){var e,t,i,n,a=function(e,t){return function(){return e.apply(t,arguments)}},r=[].slice,o={}.hasOwnProperty,s=function(e,t){function i(){this.constructor=e}for(var n in t)o.call(t,n)&&(e[n]=t[n]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e},l=[].indexOf||function(e){for(var t=0,i=this.length;i>t;t++)if(t in this&&this[t]===e)return t;return-1};e={options:["prefix","templateDelimiters","rootInterface","preloadData","handler","executeFunctions"],extensions:["binders","formatters","components","adapters"],"public":{binders:{},components:{},formatters:{},adapters:{},prefix:"rv",templateDelimiters:["{","}"],rootInterface:".",preloadData:!0,executeFunctions:!1,iterationAlias:function(e){return"%"+e+"%"},handler:function(e,t,i){return this.call(e,t,i.view.models)},configure:function(t){var i,n,a,r;null==t&&(t={});for(a in t)if(r=t[a],"binders"===a||"components"===a||"formatters"===a||"adapters"===a)for(n in r)i=r[n],e[a][n]=i;else e["public"][a]=r},bind:function(t,i,n){var a;return null==i&&(i={}),null==n&&(n={}),a=new e.View(t,i,n),a.bind(),a},init:function(t,i,n){var a,r,o;if(null==n&&(n={}),null==i&&(i=document.createElement("div")),t=e["public"].components[t],r=t.template.call(this,i),r instanceof HTMLElement){for(;i.firstChild;)i.removeChild(i.firstChild);i.appendChild(r)}else i.innerHTML=r;return a=t.initialize.call(this,i,n),o=new e.View(i,a),o.bind(),o}}},window.jQuery||window.$?(n="on"in jQuery.prototype?["on","off"]:["bind","unbind"],t=n[0],i=n[1],e.Util={bindEvent:function(e,i,n){return jQuery(e)[t](i,n)},unbindEvent:function(e,t,n){return jQuery(e)[i](t,n)},getInputValue:function(e){var t;return t=jQuery(e),"checkbox"===t.attr("type")?t.is(":checked"):t.val()}}):e.Util={bindEvent:function(){return"addEventListener"in window?function(e,t,i){return e.addEventListener(t,i,!1)}:function(e,t,i){return e.attachEvent("on"+t,i)}}(),unbindEvent:function(){return"removeEventListener"in window?function(e,t,i){return e.removeEventListener(t,i,!1)}:function(e,t,i){return e.detachEvent("on"+t,i)}}(),getInputValue:function(e){var t,i,n,a;if("checkbox"===e.type)return e.checked;if("select-multiple"===e.type){for(a=[],i=0,n=e.length;n>i;i++)t=e[i],t.selected&&a.push(t.value);return a}return e.value}},e.TypeParser=function(){function e(){}return e.types={primitive:0,keypath:1},e.parse=function(e){return/^'.*'$|^".*"$/.test(e)?{type:this.types.primitive,value:e.slice(1,-1)}:"true"===e?{type:this.types.primitive,value:!0}:"false"===e?{type:this.types.primitive,value:!1}:"null"===e?{type:this.types.primitive,value:null}:"undefined"===e?{type:this.types.primitive,value:void 0}:""===e?{type:this.types.primitive,value:void 0}:isNaN(Number(e))===!1?{type:this.types.primitive,value:Number(e)}:{type:this.types.keypath,value:e}
},e}(),e.TextTemplateParser=function(){function e(){}return e.types={text:0,binding:1},e.parse=function(e,t){var i,n,a,r,o,s,l;for(s=[],r=e.length,i=0,n=0;r>n;){if(i=e.indexOf(t[0],n),0>i){s.push({type:this.types.text,value:e.slice(n)});break}if(i>0&&i>n&&s.push({type:this.types.text,value:e.slice(n,i)}),n=i+t[0].length,i=e.indexOf(t[1],n),0>i){o=e.slice(n-t[1].length),a=s[s.length-1],(null!=a?a.type:void 0)===this.types.text?a.value+=o:s.push({type:this.types.text,value:o});break}l=e.slice(n,i).trim(),s.push({type:this.types.binding,value:l}),n=i+t[1].length}return s},e}(),e.View=function(){function t(t,i,n){var r,o,s,l,c,d,h,u,p,v,g,f,m;for(this.els=t,this.models=i,null==n&&(n={}),this.update=a(this.update,this),this.publish=a(this.publish,this),this.sync=a(this.sync,this),this.unbind=a(this.unbind,this),this.bind=a(this.bind,this),this.select=a(this.select,this),this.traverse=a(this.traverse,this),this.build=a(this.build,this),this.buildBinding=a(this.buildBinding,this),this.bindingRegExp=a(this.bindingRegExp,this),this.options=a(this.options,this),this.els.jquery||this.els instanceof Array||(this.els=[this.els]),p=e.extensions,c=0,h=p.length;h>c;c++){if(o=p[c],this[o]={},n[o]){v=n[o];for(r in v)s=v[r],this[o][r]=s}g=e["public"][o];for(r in g)s=g[r],null==(l=this[o])[r]&&(l[r]=s)}for(f=e.options,d=0,u=f.length;u>d;d++)o=f[d],this[o]=null!=(m=n[o])?m:e["public"][o];this.build()}return t.prototype.options=function(){var t,i,n,a,r;for(i={},r=e.extensions.concat(e.options),n=0,a=r.length;a>n;n++)t=r[n],i[t]=this[t];return i},t.prototype.bindingRegExp=function(){return new RegExp("^"+this.prefix+"-")},t.prototype.buildBinding=function(t,i,n,a){var r,o,s,l,c,d,h;return c={},h=function(){var e,t,i,n;for(i=a.match(/((?:'[^']*')*(?:(?:[^\|']+(?:'[^']*')*[^\|']*)+|[^\|]+))|^$/g),n=[],e=0,t=i.length;t>e;e++)d=i[e],n.push(d.trim());return n}(),r=function(){var e,t,i,n;for(i=h.shift().split("<"),n=[],e=0,t=i.length;t>e;e++)o=i[e],n.push(o.trim());return n}(),l=r.shift(),c.formatters=h,(s=r.shift())&&(c.dependencies=s.split(/\s+/)),this.bindings.push(new e[t](this,i,n,l,c))},t.prototype.build=function(){var t,i,n,a,r;for(this.bindings=[],i=function(t){return function(n){var a,r,o,s,l,c,d,h,u,p,v,g,f;if(3===n.nodeType){if(l=e.TextTemplateParser,(o=t.templateDelimiters)&&(h=l.parse(n.data,o)).length&&(1!==h.length||h[0].type!==l.types.text)){for(u=0,v=h.length;v>u;u++)d=h[u],c=document.createTextNode(d.value),n.parentNode.insertBefore(c,n),1===d.type&&t.buildBinding("TextBinding",c,null,d.value);n.parentNode.removeChild(n)}}else 1===n.nodeType&&(a=t.traverse(n));if(!a)for(f=function(){var e,t,i,a;for(i=n.childNodes,a=[],e=0,t=i.length;t>e;e++)s=i[e],a.push(s);return a}(),p=0,g=f.length;g>p;p++)r=f[p],i(r)}}(this),r=this.els,n=0,a=r.length;a>n;n++)t=r[n],i(t);this.bindings.sort(function(e,t){var i,n;return((null!=(i=t.binder)?i.priority:void 0)||0)-((null!=(n=e.binder)?n.priority:void 0)||0)})},t.prototype.traverse=function(t){var i,n,a,r,o,s,l,c,d,h,u,p,v,g,f,m;for(r=this.bindingRegExp(),o="SCRIPT"===t.nodeName||"STYLE"===t.nodeName,g=t.attributes,h=0,p=g.length;p>h;h++)if(i=g[h],r.test(i.name)){if(c=i.name.replace(r,""),!(a=this.binders[c])){f=this.binders;for(s in f)d=f[s],"*"!==s&&-1!==s.indexOf("*")&&(l=new RegExp("^"+s.replace(/\*/g,".+")+"$"),l.test(c)&&(a=d))}a||(a=this.binders["*"]),a.block&&(o=!0,n=[i])}for(m=n||t.attributes,u=0,v=m.length;v>u;u++)i=m[u],r.test(i.name)&&(c=i.name.replace(r,""),this.buildBinding("Binding",t,c,i.value));return o||(c=t.nodeName.toLowerCase(),this.components[c]&&!t._bound&&(this.bindings.push(new e.ComponentBinding(this,t,c)),o=!0)),o},t.prototype.select=function(e){var t,i,n,a,r;for(a=this.bindings,r=[],i=0,n=a.length;n>i;i++)t=a[i],e(t)&&r.push(t);return r},t.prototype.bind=function(){var e,t,i,n;for(n=this.bindings,t=0,i=n.length;i>t;t++)e=n[t],e.bind()},t.prototype.unbind=function(){var e,t,i,n;for(n=this.bindings,t=0,i=n.length;i>t;t++)e=n[t],e.unbind()},t.prototype.sync=function(){var e,t,i,n;for(n=this.bindings,t=0,i=n.length;i>t;t++)e=n[t],"function"==typeof e.sync&&e.sync()},t.prototype.publish=function(){var e,t,i,n;for(n=this.select(function(e){var t;return null!=(t=e.binder)?t.publishes:void 0}),t=0,i=n.length;i>t;t++)e=n[t],e.publish()},t.prototype.update=function(e){var t,i,n,a,r,o;null==e&&(e={});for(i in e)n=e[i],this.models[i]=n;for(o=this.bindings,a=0,r=o.length;r>a;a++)t=o[a],"function"==typeof t.update&&t.update(e)},t}(),e.Binding=function(){function t(e,t,i,n,r){this.view=e,this.el=t,this.type=i,this.keypath=n,this.options=null!=r?r:{},this.getValue=a(this.getValue,this),this.update=a(this.update,this),this.unbind=a(this.unbind,this),this.bind=a(this.bind,this),this.publish=a(this.publish,this),this.sync=a(this.sync,this),this.set=a(this.set,this),this.eventHandler=a(this.eventHandler,this),this.formattedValue=a(this.formattedValue,this),this.parseTarget=a(this.parseTarget,this),this.observe=a(this.observe,this),this.setBinder=a(this.setBinder,this),this.formatters=this.options.formatters||[],this.dependencies=[],this.formatterObservers={},this.model=void 0,this.setBinder()}return t.prototype.setBinder=function(){var e,t,i,n;if(!(this.binder=this.view.binders[this.type])){n=this.view.binders;for(e in n)i=n[e],"*"!==e&&-1!==e.indexOf("*")&&(t=new RegExp("^"+e.replace(/\*/g,".+")+"$"),t.test(this.type)&&(this.binder=i,this.args=new RegExp("^"+e.replace(/\*/g,"(.+)")+"$").exec(this.type),this.args.shift()))}return this.binder||(this.binder=this.view.binders["*"]),this.binder instanceof Function?this.binder={routine:this.binder}:void 0},t.prototype.observe=function(t,i,n){return e.sightglass(t,i,n,{root:this.view.rootInterface,adapters:this.view.adapters})},t.prototype.parseTarget=function(){var t;return t=e.TypeParser.parse(this.keypath),0===t.type?this.value=t.value:(this.observer=this.observe(this.view.models,this.keypath,this.sync),this.model=this.observer.target)},t.prototype.formattedValue=function(t){var i,n,a,o,s,l,c,d,h,u,p,v,g,f,m;for(f=this.formatters,o=u=0,v=f.length;v>u;o=++u){for(s=f[o],a=s.match(/[^\s']+|'([^']|'[^\s])*'|"([^"]|"[^\s])*"/g),l=a.shift(),s=this.view.formatters[l],a=function(){var t,i,r;for(r=[],t=0,i=a.length;i>t;t++)n=a[t],r.push(e.TypeParser.parse(n));return r}(),d=[],i=p=0,g=a.length;g>p;i=++p)n=a[i],d.push(0===n.type?n.value:((h=this.formatterObservers)[o]||(h[o]={}),(c=this.formatterObservers[o][i])?void 0:(c=this.observe(this.view.models,n.value,this.sync),this.formatterObservers[o][i]=c),c.value()));(null!=s?s.read:void 0)instanceof Function?t=(m=s.read).call.apply(m,[this.model,t].concat(r.call(d))):s instanceof Function&&(t=s.call.apply(s,[this.model,t].concat(r.call(d))))}return t},t.prototype.eventHandler=function(e){var t,i;return i=(t=this).view.handler,function(n){return i.call(e,this,n,t)}},t.prototype.set=function(t){var i;return t=this.formattedValue(t instanceof Function&&!this.binder["function"]&&e["public"].executeFunctions?t.call(this.model):t),null!=(i=this.binder.routine)?i.call(this,this.el,t):void 0},t.prototype.sync=function(){var e,t;return this.set(function(){var i,n,a,r,o,s,l;if(this.observer){if(this.model!==this.observer.target){for(o=this.dependencies,i=0,a=o.length;a>i;i++)t=o[i],t.unobserve();if(this.dependencies=[],null!=(this.model=this.observer.target)&&(null!=(s=this.options.dependencies)?s.length:void 0))for(l=this.options.dependencies,n=0,r=l.length;r>n;n++)e=l[n],t=this.observe(this.model,e,this.sync),this.dependencies.push(t)}return this.observer.value()}return this.value}.call(this))},t.prototype.publish=function(){var e,t,i,n,a,o,s,l,c;if(this.observer){for(n=this.getValue(this.el),s=this.formatters.slice(0).reverse(),a=0,o=s.length;o>a;a++)t=s[a],e=t.split(/\s+/),i=e.shift(),(null!=(l=this.view.formatters[i])?l.publish:void 0)&&(n=(c=this.view.formatters[i]).publish.apply(c,[n].concat(r.call(e))));return this.observer.setValue(n)}},t.prototype.bind=function(){var e,t,i,n,a,r,o;if(this.parseTarget(),null!=(a=this.binder.bind)&&a.call(this,this.el),null!=this.model&&(null!=(r=this.options.dependencies)?r.length:void 0))for(o=this.options.dependencies,i=0,n=o.length;n>i;i++)e=o[i],t=this.observe(this.model,e,this.sync),this.dependencies.push(t);return this.view.preloadData?this.sync():void 0},t.prototype.unbind=function(){var e,t,i,n,a,r,o,s,l,c;for(null!=(o=this.binder.unbind)&&o.call(this,this.el),null!=(s=this.observer)&&s.unobserve(),l=this.dependencies,a=0,r=l.length;r>a;a++)n=l[a],n.unobserve();this.dependencies=[],c=this.formatterObservers;for(i in c){t=c[i];for(e in t)n=t[e],n.unobserve()}return this.formatterObservers={}},t.prototype.update=function(e){var t,i;return null==e&&(e={}),this.model=null!=(t=this.observer)?t.target:void 0,null!=(i=this.binder.update)?i.call(this,e):void 0},t.prototype.getValue=function(t){return this.binder&&null!=this.binder.getValue?this.binder.getValue.call(this,t):e.Util.getInputValue(t)},t}(),e.ComponentBinding=function(t){function i(t,i,n){var r,o,s,c,d,h,u,p;for(this.view=t,this.el=i,this.type=n,this.unbind=a(this.unbind,this),this.bind=a(this.bind,this),this.locals=a(this.locals,this),this.component=this.view.components[this.type],this["static"]={},this.observers={},this.upstreamObservers={},o=t.bindingRegExp(),u=this.el.attributes||[],d=0,h=u.length;h>d;d++)r=u[d],o.test(r.name)||(s=this.camelCase(r.name),c=e.TypeParser.parse(r.value),l.call(null!=(p=this.component["static"])?p:[],s)>=0?this["static"][s]=r.value:0===c.type?this["static"][s]=c.value:this.observers[s]=r.value)}return s(i,t),i.prototype.sync=function(){},i.prototype.update=function(){},i.prototype.publish=function(){},i.prototype.locals=function(){var e,t,i,n,a,r;i={},a=this["static"];for(e in a)n=a[e],i[e]=n;r=this.observers;for(e in r)t=r[e],i[e]=t.value();return i},i.prototype.camelCase=function(e){return e.replace(/-([a-z])/g,function(e){return e[1].toUpperCase()})},i.prototype.bind=function(){var t,i,n,a,r,o,s,l,c,d,h,u,p,v,g,f,m,_,w,y;if(!this.bound){v=this.observers;for(i in v)n=v[i],this.observers[i]=this.observe(this.view.models,n,function(e){return function(t){return function(){return e.componentView.models[t]=e.observers[t].value()}}}(this).call(this,i));this.bound=!0}if(null!=this.componentView)this.componentView.bind();else{for(this.el.innerHTML=this.component.template.call(this),s=this.component.initialize.call(this,this.el,this.locals()),this.el._bound=!0,o={},g=e.extensions,d=0,u=g.length;u>d;d++){if(r=g[d],o[r]={},this.component[r]){f=this.component[r];for(t in f)l=f[t],o[r][t]=l}m=this.view[r];for(t in m)l=m[t],null==(c=o[r])[t]&&(c[t]=l)}for(_=e.options,h=0,p=_.length;p>h;h++)r=_[h],o[r]=null!=(w=this.component[r])?w:this.view[r];this.componentView=new e.View(Array.prototype.slice.call(this.el.childNodes),s,o),this.componentView.bind(),y=this.observers;for(i in y)a=y[i],this.upstreamObservers[i]=this.observe(this.componentView.models,i,function(e){return function(t,i){return function(){return i.setValue(e.componentView.models[t])}}}(this).call(this,i,a))}},i.prototype.unbind=function(){var e,t,i,n,a;i=this.upstreamObservers;for(e in i)t=i[e],t.unobserve();n=this.observers;for(e in n)t=n[e],t.unobserve();return null!=(a=this.componentView)?a.unbind.call(this):void 0},i}(e.Binding),e.TextBinding=function(e){function t(e,t,i,n,r){this.view=e,this.el=t,this.type=i,this.keypath=n,this.options=null!=r?r:{},this.sync=a(this.sync,this),this.formatters=this.options.formatters||[],this.dependencies=[],this.formatterObservers={}}return s(t,e),t.prototype.binder={routine:function(e,t){return e.data=null!=t?t:""}},t.prototype.sync=function(){return t.__super__.sync.apply(this,arguments)},t}(e.Binding),e["public"].binders.text=function(e,t){return null!=e.textContent?e.textContent=null!=t?t:"":e.innerText=null!=t?t:""},e["public"].binders.html=function(e,t){return e.innerHTML=null!=t?t:""},e["public"].binders.show=function(e,t){return e.style.display=t?"":"none"},e["public"].binders.hide=function(e,t){return e.style.display=t?"none":""},e["public"].binders.enabled=function(e,t){return e.disabled=!t},e["public"].binders.disabled=function(e,t){return e.disabled=!!t},e["public"].binders.checked={publishes:!0,priority:2e3,bind:function(t){return e.Util.bindEvent(t,"change",this.publish)},unbind:function(t){return e.Util.unbindEvent(t,"change",this.publish)},routine:function(e,t){var i;return e.checked="radio"===e.type?(null!=(i=e.value)?i.toString():void 0)===(null!=t?t.toString():void 0):!!t}},e["public"].binders.unchecked={publishes:!0,priority:2e3,bind:function(t){return e.Util.bindEvent(t,"change",this.publish)},unbind:function(t){return e.Util.unbindEvent(t,"change",this.publish)},routine:function(e,t){var i;return e.checked="radio"===e.type?(null!=(i=e.value)?i.toString():void 0)!==(null!=t?t.toString():void 0):!t}},e["public"].binders.value={publishes:!0,priority:3e3,bind:function(t){return"INPUT"!==t.tagName||"radio"!==t.type?(this.event="SELECT"===t.tagName?"change":"input",e.Util.bindEvent(t,this.event,this.publish)):void 0},unbind:function(t){return"INPUT"!==t.tagName||"radio"!==t.type?e.Util.unbindEvent(t,this.event,this.publish):void 0},routine:function(e,t){var i,n,a,r,o,s,c;if("INPUT"===e.tagName&&"radio"===e.type)return e.setAttribute("value",t);if(null!=window.jQuery){if(e=jQuery(e),(null!=t?t.toString():void 0)!==(null!=(r=e.val())?r.toString():void 0))return e.val(null!=t?t:"")}else if("select-multiple"===e.type){if(null!=t){for(c=[],n=0,a=e.length;a>n;n++)i=e[n],c.push(i.selected=(o=i.value,l.call(t,o)>=0));return c}}else if((null!=t?t.toString():void 0)!==(null!=(s=e.value)?s.toString():void 0))return e.value=null!=t?t:""}},e["public"].binders["if"]={block:!0,priority:4e3,bind:function(e){var t,i;return null==this.marker?(t=[this.view.prefix,this.type].join("-").replace("--","-"),i=e.getAttribute(t),this.marker=document.createComment(" rivets: "+this.type+" "+i+" "),this.bound=!1,e.removeAttribute(t),e.parentNode.insertBefore(this.marker,e),e.parentNode.removeChild(e)):void 0},unbind:function(){return this.nested?(this.nested.unbind(),this.bound=!1):void 0},routine:function(t,i){var n,a,r,o;if(!!i==!this.bound){if(i){r={},o=this.view.models;for(n in o)a=o[n],r[n]=a;return(this.nested||(this.nested=new e.View(t,r,this.view.options()))).bind(),this.marker.parentNode.insertBefore(t,this.marker.nextSibling),this.bound=!0}return t.parentNode.removeChild(t),this.nested.unbind(),this.bound=!1}},update:function(e){var t;return null!=(t=this.nested)?t.update(e):void 0}},e["public"].binders.unless={block:!0,priority:4e3,bind:function(t){return e["public"].binders["if"].bind.call(this,t)},unbind:function(){return e["public"].binders["if"].unbind.call(this)},routine:function(t,i){return e["public"].binders["if"].routine.call(this,t,!i)},update:function(t){return e["public"].binders["if"].update.call(this,t)}},e["public"].binders["on-*"]={"function":!0,priority:1e3,unbind:function(t){return this.handler?e.Util.unbindEvent(t,this.args[0],this.handler):void 0},routine:function(t,i){return this.handler&&e.Util.unbindEvent(t,this.args[0],this.handler),e.Util.bindEvent(t,this.args[0],this.handler=this.eventHandler(i))}},e["public"].binders["each-*"]={block:!0,priority:4e3,bind:function(e){var t,i,n,a,r;if(null==this.marker)t=[this.view.prefix,this.type].join("-").replace("--","-"),this.marker=document.createComment(" rivets: "+this.type+" "),this.iterated=[],e.removeAttribute(t),e.parentNode.insertBefore(this.marker,e),e.parentNode.removeChild(e);else for(r=this.iterated,n=0,a=r.length;a>n;n++)i=r[n],i.bind()},unbind:function(){var e,t,i,n;if(null!=this.iterated)for(n=this.iterated,t=0,i=n.length;i>t;t++)e=n[t],e.unbind()},routine:function(t,i){var n,a,r,o,s,l,c,d,h,u,p,v,g,f,m,_,w,y,b,x;if(c=this.args[0],i=i||[],this.iterated.length>i.length)for(y=Array(this.iterated.length-i.length),v=0,m=y.length;m>v;v++)r=y[v],p=this.iterated.pop(),p.unbind(),this.marker.parentNode.removeChild(p.els[0]);for(o=g=0,_=i.length;_>g;o=++g)if(l=i[o],a={index:o},a[e["public"].iterationAlias(c)]=o,a[c]=l,null==this.iterated[o]){b=this.view.models;for(s in b)l=b[s],null==a[s]&&(a[s]=l);h=this.iterated.length?this.iterated[this.iterated.length-1].els[0]:this.marker,d=this.view.options(),d.preloadData=!0,u=t.cloneNode(!0),p=new e.View(u,a,d),p.bind(),this.iterated.push(p),this.marker.parentNode.insertBefore(u,h.nextSibling)}else this.iterated[o].models[c]!==l&&this.iterated[o].update(a);if("OPTION"===t.nodeName)for(x=this.view.bindings,f=0,w=x.length;w>f;f++)n=x[f],n.el===this.marker.parentNode&&"value"===n.type&&n.sync()},update:function(e){var t,i,n,a,r,o,s;t={};for(i in e)n=e[i],i!==this.args[0]&&(t[i]=n);for(s=this.iterated,r=0,o=s.length;o>r;r++)a=s[r],a.update(t)}},e["public"].binders["class-*"]=function(e,t){var i;return i=" "+e.className+" ",!t==(-1!==i.indexOf(" "+this.args[0]+" "))?e.className=t?""+e.className+" "+this.args[0]:i.replace(" "+this.args[0]+" "," ").trim():void 0},e["public"].binders["*"]=function(e,t){return null!=t?e.setAttribute(this.type,t):e.removeAttribute(this.type)},e["public"].formatters.call=function(){var e,t;return t=arguments[0],e=2<=arguments.length?r.call(arguments,1):[],t.call.apply(t,[this].concat(r.call(e)))},e["public"].adapters["."]={id:"_rv",counter:0,weakmap:{},weakReference:function(e){var t,i,n;return e.hasOwnProperty(this.id)||(t=this.counter++,Object.defineProperty(e,this.id,{value:t})),(i=this.weakmap)[n=e[this.id]]||(i[n]={callbacks:{}})},cleanupWeakReference:function(e,t){return Object.keys(e.callbacks).length||e.pointers&&Object.keys(e.pointers).length?void 0:delete this.weakmap[t]},stubFunction:function(e,t){var i,n,a;return n=e[t],i=this.weakReference(e),a=this.weakmap,e[t]=function(){var t,r,o,s,l,c,d,h,u,p;s=n.apply(e,arguments),d=i.pointers;for(o in d)for(r=d[o],p=null!=(h=null!=(u=a[o])?u.callbacks[r]:void 0)?h:[],l=0,c=p.length;c>l;l++)(t=p[l])();return s}},observeMutations:function(e,t,i){var n,a,r,o,s,c;if(Array.isArray(e)){if(r=this.weakReference(e),null==r.pointers)for(r.pointers={},a=["push","pop","shift","unshift","sort","reverse","splice"],s=0,c=a.length;c>s;s++)n=a[s],this.stubFunction(e,n);if(null==(o=r.pointers)[t]&&(o[t]=[]),l.call(r.pointers[t],i)<0)return r.pointers[t].push(i)}},unobserveMutations:function(e,t,i){var n,a,r;return Array.isArray(e)&&null!=e[this.id]&&(a=this.weakmap[e[this.id]])&&(r=a.pointers[t])?((n=r.indexOf(i))>=0&&r.splice(n,1),r.length||delete a.pointers[t],this.cleanupWeakReference(a,e[this.id])):void 0},observe:function(e,t,i){var n,a,r;return n=this.weakReference(e).callbacks,null==n[t]&&(n[t]=[],a=Object.getOwnPropertyDescriptor(e,t),(null!=a?a.get:void 0)||(null!=a?a.set:void 0)||(r=e[t],Object.defineProperty(e,t,{enumerable:!0,get:function(){return r},set:function(i){return function(a){var o,s,l,c,d;if(a!==r&&(i.unobserveMutations(r,e[i.id],t),r=a,s=i.weakmap[e[i.id]])){if(n=s.callbacks,n[t])for(d=n[t],l=0,c=d.length;c>l;l++)(o=d[l])();return i.observeMutations(a,e[i.id],t)}}}(this)}))),l.call(n[t],i)<0&&n[t].push(i),this.observeMutations(e[t],e[this.id],t)},unobserve:function(e,t,i){var n,a,r;return(r=this.weakmap[e[this.id]])&&(n=r.callbacks[t])?((a=n.indexOf(i))>=0&&(n.splice(a,1),n.length||delete r.callbacks[t]),this.unobserveMutations(e[t],e[this.id],t),this.cleanupWeakReference(r,e[this.id])):void 0},get:function(e,t){return e[t]},set:function(e,t,i){return e[t]=i}},e.factory=function(t){return e.sightglass=t,e["public"]._=e,e["public"]},"object"==typeof("undefined"!=typeof module&&null!==module?module.exports:void 0)?module.exports=e.factory(require("sightglass")):"function"==typeof define&&define.amd?define("thirdparty/rivets/rivets.min",["sightglass"],function(t){return this.rivets=e.factory(t)}):this.rivets=e.factory(sightglass)}.call(this),jQuery.handleError=function(e,t,i,n){e.error&&e.error.call(e.context||e,t,i,n),e.global&&(e.context?jQuery(e.context):jQuery.event).trigger("ajaxError",[t,e,n])},jQuery.extend({createUploadIframe:function(e,t){var i="jUploadFrame"+e,n='<iframe id="'+i+'" name="'+i+'" style="position:absolute; top:-9999px; left:-9999px"';return window.ActiveXObject&&("boolean"==typeof t?n+=' src="javascript:false"':"string"==typeof t&&(n+=' src="'+t+'"')),n+=" />",jQuery(n).appendTo(document.body),jQuery("#"+i).get(0)},createUploadForm:function(e,t,i){var n="jUploadForm"+e,a="jUploadFile"+e,r=jQuery('<form  action="" method="POST" name="'+n+'" id="'+n+'" enctype="multipart/form-data"></form>');if(i)for(var o in i)jQuery('<input type="hidden" name="'+o+'" value="'+i[o]+'" />').appendTo(r);var s=jQuery("#"+t),l=jQuery(s).clone();return jQuery(s).attr("id",a),jQuery(s).before(l),jQuery(s).appendTo(r),jQuery(r).css("position","absolute"),jQuery(r).css("top","-1200px"),jQuery(r).css("left","-1200px"),jQuery(r).appendTo("body"),r},ajaxFileUpload:function(e){e=jQuery.extend({},jQuery.ajaxSettings,e);var t=(new Date).getTime(),i=jQuery.createUploadForm(t,e.fileElementId,"undefined"==typeof e.data?!1:e.data),n=(jQuery.createUploadIframe(t,e.secureuri),"jUploadFrame"+t),a="jUploadForm"+t;e.global&&!jQuery.active++&&jQuery.event.trigger("ajaxStart");var r=!1,o={};e.global&&jQuery.event.trigger("ajaxSend",[o,e]);var s=function(t){var a=document.getElementById(n);try{a.contentWindow?(o.responseText=a.contentWindow.document.body?a.contentWindow.document.body.innerHTML:null,o.responseXML=a.contentWindow.document.XMLDocument?a.contentWindow.document.XMLDocument:a.contentWindow.document):a.contentDocument&&(o.responseText=a.contentDocument.document.body?a.contentDocument.document.body.innerHTML:null,o.responseXML=a.contentDocument.document.XMLDocument?a.contentDocument.document.XMLDocument:a.contentDocument.document)}catch(s){jQuery.handleError(e,o,null,s)}if(o||"timeout"==t){r=!0;var l;try{if(l="timeout"!=t?"success":"error","error"!=l){var c=jQuery.uploadHttpData(o,e.dataType);e.success&&e.success(c,l),e.global&&jQuery.event.trigger("ajaxSuccess",[o,e])}else jQuery.handleError(e,o,l)}catch(s){l="error",jQuery.handleError(e,o,l,s)}e.global&&jQuery.event.trigger("ajaxComplete",[o,e]),e.global&&!--jQuery.active&&jQuery.event.trigger("ajaxStop"),e.complete&&e.complete(o,l),jQuery(a).unbind(),setTimeout(function(){try{jQuery(a).remove(),jQuery(i).remove()}catch(t){jQuery.handleError(e,o,null,t)}},100),o=null}};e.timeout>0&&setTimeout(function(){r||s("timeout")},e.timeout);try{var i=jQuery("#"+a);jQuery(i).attr("action",e.url),jQuery(i).attr("method","POST"),jQuery(i).attr("target",n),i.encoding?jQuery(i).attr("encoding","multipart/form-data"):jQuery(i).attr("enctype","multipart/form-data"),jQuery(i).submit()}catch(l){jQuery.handleError(e,o,null,l)}return jQuery("#"+n).load(s),{abort:function(){}}},uploadHttpData:function(r,type){var data=!type;return data="xml"==type||data?r.responseXML:r.responseText,"script"==type&&jQuery.globalEval(data),"json"==type&&eval("data = "+data),"html"==type&&jQuery("<div>").html(data).evalScripts(),data}}),define("ajaxfile",["jquery"],function(){}),window._file_change_simple=function($file,exts,url,callback,opts){opts||(opts={});var f=$file.clone(),img_path=$file[0].value;if(""!=$.trim(img_path)){var legal=!1;if(0==exts.length?legal=!0:$.each(exts,function(e,t){img_path.toLowerCase().lastIndexOf("."+t)==img_path.length-t.length-1&&(legal=!0)}),!legal)return void global.message("error","ä¸Šä¼ æ–‡ä»¶æ ¼å¼ï¼š "+exts.toString());$.ajaxFileUpload({url:url,secureuri:!1,fileElementId:$file.attr("id"),dataType:"json",beforeSend:opts.beforeSend,data:opts.data,complete:function(server_data){try{var data=server_data;if(server_data.data||(data=eval("("+$(server_data.responseText).html()+")")),opts.callback)return void opts.callback(data);if(200==data.code)return void(callback&&callback(data.data));200!=data.code&&global.message("error",data.msg)}catch(e){global.message("error","æœåŠ¡å™¨é”™è¯¯å“åº”")}}}),$("input[type='file']#"+f.attr("id")).unbind("change").change(function(){_file_change_simple($("#"+f.attr("id")),exts,url,callback)})}},window._file_change=function($file,exts,url,before,call_ok,call_error,after,opts){opts||(opts={});var f=$file.clone(),img_path=$file[0].value;if(""!=$.trim(img_path)){var legal=!1;if(0==exts.length?legal=!0:$.each(exts,function(e,t){img_path.toLowerCase().lastIndexOf("."+t)==img_path.length-t.length-1&&(legal=!0)}),!legal)return void global.message("error","ä¸Šä¼ æ–‡ä»¶æ ¼å¼ï¼š "+exts.toString());var $bck=$($("input[type='file']#"+f.attr("id")).parent().parent().find("img").parent()[0]),w=$bck.width(),h=$bck.height(),old_html=$bck.html();$bck.html('<div style="padding-top: '+(h-32)/2+"px; padding-left: "+(w-32)/2+"px; height: "+(h-(h-32)/2)+'px; background-color: #fff;"><div style="width:32px; height:32px; background:url(/staticfs/admin-epub360/img/loading.gif) no-repeat 50% 50%;"></div></div>'),before&&before($bck),$.ajaxFileUpload({url:url,secureuri:!1,fileElementId:$file.attr("id"),dataType:"json",beforeSend:opts.beforeSend,complete:function(server_data){try{var data=server_data;if(server_data.data||(data=eval("("+$(server_data.responseText).html()+")")),200==data.code)return void(call_ok?call_ok(data.data,old_html,$bck):$("<img/>").attr("src",data.data.url).on("load",function(){$bck.html($(this)),$bck.find("img").hide().fadeIn(function(){global.message("success","æˆåŠŸæ›¿æ¢å›¾ç‰‡")}),data.data.data&&$(this).attr("data",data.data.data),after&&after($(this))}).error(function(){$bck.html(old_html),global.message("error","æœåŠ¡å™¨é”™è¯¯å“åº”"),call_error&&call_error($bck)}));200!=data.code&&($bck.html(old_html),call_error&&call_error($bck),global.message("error",data.msg))}catch(e){$bck.html(old_html),call_error&&call_error($bck),global.message("error","æœåŠ¡å™¨é”™è¯¯å“åº”")}}}),$("input[type='file']#"+f.attr("id")).unbind("change").change(function(){_file_change($("#"+f.attr("id")),exts,url,before,call_ok,call_error,after)})}},window._file_change_for_edit=function($file,exts,url,before,callback,opts){opts||(opts={});var f=$file.clone(),img_path=$file[0].value;if(""!=$.trim(img_path)){var legal=!1;if(0==exts.length?legal=!0:$.each(exts,function(e,t){img_path.toLowerCase().lastIndexOf("."+t)==img_path.length-t.length-1&&(legal=!0)}),!legal)return void global.message("error","ä¸Šä¼ æ–‡ä»¶æ ¼å¼ï¼š "+exts.toString());var $bck=$($("input[type='file']#"+f.attr("id")).parent().parent().find("img").parent()[0]),w=$bck.width(),h=$bck.height(),old_html=$bck.html();$bck.html('<div style="padding-top: '+(h-32)/2+"px; padding-left: "+(w-32)/2+"px; height: "+(h-(h-32)/2)+'px; background-color: #fff;"><div style="width:32px; height:32px; background:url(/staticfs/admin-epub360/img/loading.gif) no-repeat 50% 50%;"></div></div>'),before&&before(),$.ajaxFileUpload({url:url,secureuri:!1,fileElementId:$file.attr("id"),dataType:"json",beforeSend:opts.beforeSend,complete:function(server_data){try{var data=server_data;server_data.data||(data=eval("("+$(server_data.responseText).html()+")")),200==data.code?$("<img/>").attr("src",data.data.data).on("load",function(){$bck.html($(this)),$(this).attr("data",data.data.url),global.message("success","æˆåŠŸæ›¿æ¢å›¾ç‰‡"),callback&&callback($(this))}):200!=data.code&&($bck.html(old_html),global.message("error",data.msg))}catch(e){$bck.html(old_html),global.message("error","æœåŠ¡å™¨é”™è¯¯å“åº”")}}}),$("input[type='file']#"+f.attr("id")).unbind("change").change(function(){_file_change_for_edit($("#"+f.attr("id")),exts,url,before,callback)})}},define("ajaximage",["ajaxfile"],function(){}),function(e){e.configpage={page:null,el:null,init:function(e){interaction_view.foredit&&"config"==interaction.doc.mode||e.data.configpages&&e.data.configpages.length&&(configpage.initMVC(),interaction_view.iconfiglist=_g.mvc.createTreeByData({collection:configpage.configpagecollection,data:e.data.configpages}),configpage.page=interaction_view.iconfiglist.at(0),configpage.actions=[])},initMVC:function(){var e=require("interaction_view/view/page");configpage.configpageview=$.extend({},e,{template:null,className:null,containment:null,wrap:null,wrapClassName:null,autoRender:!0,position:1,parseData:null,isConfig:!0,render:function(){this.setElement(configpage.el)}});var t=require("interaction_view/model/page"),i=t.extend({defaults:{iType:"Config",position:0,description:"",title:"untitled",picture:null,thumbnail:null,width:null,height:null,bg_color:"#FFFFFF",bg_opacity:1,pageno_horizontal:{show:!1,x:500,y:20},pageno_vertical:{show:!1,x:20,y:300}}}),n=require("interaction_view/collection/page");configpage.configpagecollection=n.extend({model:i})},renderView:function(){if(interaction_view.foredit&&"config"==interaction.doc.mode)return configpage.page=interaction_view.ipagelist.getPages()[0],void(configpage.actions=[]);if(configpage.page){$(".reveal").append('<div class="config_wrap" style="position: absolute; width: 100%; height: 100%; left: 0px; top: 0px; z-index: 3000; overflow: hidden;"><div class="interaction-area typo"><div class="interaction-view" style="overflow:visible"></div></div></div>'),configpage.el=$(".config_wrap").children(),$(".config_wrap").addClass("disableDragY iMouseWheel disableMouseWheelY"),"undefined"!=typeof config_player&&config_player||$(".config_wrap").hide(),interaction_view.iconfiglist.length&&interaction_view.iconfiglist.at(0).addView("iview",configpage.configpageview);var e=configpage.page.get("bg_color"),t=configpage.page.get("bg_opacity"),i=-1==e.indexOf("rgba")?_g.getRGBA(e,t):e;configpage.page.iview.$el.css({"background-color":i,"margin-left":Reveal.marginLeft,"margin-top":Reveal.marginTop}),ScrollPage.bindScrollPage(configpage.page)}},saveConfig:function(){var e=context_url+"config/",t=configpage.page.iOverlaylist.models,i={};_.each(t,function(e){if(e.attributes.iDetail.isConfigOverlay)return!0;var t=e.id,n=configpage.page.iOverlaylist.get(t),a=n&&n.attributes.iDetail,r=e.attributes.iType,o=interaction_view.expression.getOverlayValue(configpage.page,t,{raw:!0}),s=[];switch(r){case"Input":a.initial=o,i[t]=a;break;case"Textarea":a.initial=o,i[t]=a;break;case"Variable":a.initial=o,i[t]=a;break;case"Paragraph":a.iText=o,i[t]=a;break;case"Image":case"ImageBlock":a.iImg[0].picture=o,i[t]=a;break;case"Select":a.initial=parseInt(o),i[t]=a;break;case"DataBinder":s.push(t)}for(var l=0;l<s.length;l++){var c=configpage.page.iOverlaylist.get(s[l]);if(c){var d=c.attributes.iDetail.dataBinder;_.each(d,function(e){var t=interaction_view.expression,n=t.getPagePath(e.id),a=e.expression_id,r=/\$d_(\w+)\..*\$/,o=a.match(r)[1];a=a.replace(o,interaction_view.dblist.get(o).get("sheet_id"));var s=configpage.page.iOverlaylist.get(n.element_id);s.attributes.iDetail.binding=a,i[n.element_id]=s.attributes.iDetail})}}}),$.ajax({type:"POST",url:e,data:JSON.stringify(i),contentType:"application/json",dataType:"json",success:function(e){if(200==e.code){interaction_view.errorAlert("ä¿å­˜æˆåŠŸ");for(var t=0;t<configpage.actions.length;t++)configpage.actions[t].func()}else interaction_view.errorAlert(e.msg)},error:function(){interaction_view.errorAlert("ä¿å­˜å¤±è´¥")}})}}}(window),define("_e/configpage",function(){});var _tmpDIV=document.createElement("DIV"),PropPrefix="transform";e=_tmpDIV,p="transform";var s=e.style,a,i;if(void 0!==s[PropPrefix]);else{for(a=["O","Moz","ms","Ms","Webkit"],i=5;--i>-1&&void 0===s[a[i]+p];);i>=0&&(_prefix=3===i?"ms":a[i],_prefixCSS="-"+_prefix.toLowerCase()+"-",PropPrefix=_prefix+PropPrefix)}"undefined"==typeof WebKitCSSMatrix&&(WebKitCSSMatrix=MSCSSMatrix),"undefined"!=typeof WebKitCSSMatrix&&(WebKitCSSMatrix.prototype.toString3D=function(){for(var e=this.m11.toFixed(6),t=1;16>t;t++)e+=","+this["m"+((t/4|0)+1)+(t%4+1)].toFixed(6);return"matrix3d("+e+")"},WebKitCSSMatrix.prototype.__clone__=function(){var e=new WebKitCSSMatrix;e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.e=this.e,e.f=this.f;for(var t=0;16>t;t++)e["m"+((t/4|0)+1)+(t%4+1)]=this["m"+((t/4|0)+1)+(t%4+1)];return e});var CSSMatrix={PID180:Math.PI/180,_set:function(e,t){e.style[PropPrefix]=-1==e.style[PropPrefix].indexOf("matrix3d")?t.toString():t.toString3D()},setTranslate:function(e,t,i,n){if(e=e[0]?e[0]:e){if(!interaction_view.ismobile)return void TweenMax.set(e,{x:t,y:i,z:n});var a=new WebKitCSSMatrix(e.style[PropPrefix]);(0===t||t)&&(e._gsTransform&&(e._gsTransform.x=t),a.e=t,a.m41=t),(0===i||i)&&(e._gsTransform&&(e._gsTransform.y=i),a.f=i,a.m42=i),(0===n||n)&&(e._gsTransform&&(e._gsTransform.z=n),a.m43=n),CSSMatrix._set(e,a)
}},setRotation:function(e,t,i,n){TweenMax.set(e,{rotationX:t,rotationY:i,rotation:n})},setSkew:function(e,t,i){TweenMax.set(e,{skewX:t,skewY:i})},setPerspective:function(e,t){TweenMax.set(e,{transformPerspective:t})},getTranslate:function(e){if(!interaction_view.ismobile)return e=e[0]?e[0]:e,e._gsTransform?{x:e._gsTransform.x,y:e._gsTransform.y,z:e._gsTransform.z}:{x:0,y:0,z:0};var t=CSSMatrix.getTransform(e);return{x:t.x,y:t.y,z:t.z}},getTransform:function(e){if(e){if(e=e[0]?e[0]:e,!interaction_view.ismobile||e._gsTransform)return e._gsTransform;if(e._csTransform)return e._csTransform;var t=new WebKitCSSMatrix(e.style[PropPrefix]);return e._csTransform={x:t.m41,y:t.m42,z:t.m43,rotation:0,rotationX:0,rotationY:0,skewX:0,skewY:0,perspective:0},e._csTransform}},setTransform:function(e,t){TweenMax.set(e,t)}};define("_e/cssmatrix",function(){}),define("interaction_view/mobilemain",["interaction_view/model/main","interaction_view/ui/main","interaction_view/ui/presentation","interaction_view/ui/control","interaction_view/ui/event","interaction_view/ui/environment","interaction_view/ui/mobilemedia","interaction_view/ui/adapt","interaction_view/ui/analytics","interaction_view/ui/weixin","interaction_view/modules/desktop/uploadimage_desktop","interaction_view/ui/pageslide","_g/device","jquery.actual","interaction_view/ui/screenset","interaction_view/ui/touchinit","interaction_view/ui/application","interaction_view/ui/timeline","interaction_view/ui/expression","interaction_view/ui/pluginmanage","interaction_view/ui/transform","coverFlow","_e/eraser","_e/shake","_e/cssanimate","_e/scrollpage","_e/animate","greensock/TweenMax","jswait","greensock/plugins/DrawSVGPlugin","greensock/plugins/MorphSVGPlugin","greensock/plugins/TextPlugin","interaction_view/ui/scrollview","greensock/plugins/ScrollToPlugin","_g/scrollview","_g/slider","_g/file","_e/preloadpage","_e/api","_e/queue","_e/dboperate","_e/connector","_e/stategroup","_e/orientation","thirdparty/dataEngine/dataEngine","thirdparty/rivets/rivets.min","ajaximage","_e/configpage","_e/cssmatrix"],function(){CSSPlugin.defaultSkewType="simple","undefined"==typeof dboperate&&(dboperate=null),"undefined"==typeof DB&&(DB=null),rivets.configure({templateDelimiters:["<%","%>"]});var e=require("interaction_view/ui/main");interaction_view.force3D=!1,interaction_view=$.extend({},interaction_view,e),void 0==typeof _e&&(_e={}),interaction_view.DEBUG=_g.getUrlParameterByName("-debug"),interaction_view.LOCAL_DEBUG=_g.getUrlParameterByName("-local"),interaction_view.weixin=require("interaction_view/ui/weixin"),interaction_view.control=require("interaction_view/ui/control"),interaction_view.events=require("interaction_view/ui/event"),interaction_view.environment=require("interaction_view/ui/environment"),interaction_view.media=require("interaction_view/ui/mobilemedia"),interaction_view.screenset=require("interaction_view/ui/screenset"),interaction_view.adapt=require("interaction_view/ui/adapt"),interaction_view.analytics=require("interaction_view/ui/analytics"),interaction_view.application=require("interaction_view/ui/application"),(_g.device.mobile()||_g.device.tablet())&&(interaction_view.ismobile=!0),interaction_view.touchview=!0,interaction_view.isAndroid=interaction_view.android=_g.device.android(),interaction_view.isWeixin=_g.device.isWeixin(),interaction_view.isIos=_g.device.ios(),interaction_view.isWin=!1,interaction_view.isMac=!1,interaction_view.touchinit=require("interaction_view/ui/touchinit"),workEnd("--------0 mobilemain touchinit.init --------"),interaction_view.touchinit.init(),interaction_view.isAndroid&&$("body").click(function(e){"INPUT"!=e.target.tagName&&$("input").blur()})}),require(["interaction_view/mobilemain","_g/base"],function(){window.start_player=function(){_g.browserSupport({msie:8,chrome:1,safari:1,mozilla:1})?(interaction_view.init(),$(".return a").live("click",function(){var e=location.search,t={};if(-1!=e.indexOf("?")){var i=e.substr(1);strs=i.split("&");for(var n=0;n<strs.length;n++)t[strs[n].split("=")[0]]=unescape(strs[n].split("=")[1])}return"page"==t.from&&$(window.parent.document.getElementById("PreviewWindow")).remove(),!1})):_g.ajax.get({url:"index.json",callback:function(e){if(console.log(e),200==e.code&&e.data){var t=String(e.data.slave_url);window.location.href=t&&t.length?t:"/staticfs/admin-epub360/browser-old.html"}else window.location.href="/staticfs/admin-epub360/browser-old.html"}})}}),define("common/js/interaction_view/mobile",function(){});